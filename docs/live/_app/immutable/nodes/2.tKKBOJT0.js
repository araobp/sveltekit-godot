import"../chunks/Bzak7iHL.js";import{o as ls,d as vd,s as wd}from"../chunks/D27dbFNF.js";import{T as Is,F as hs,z as cr,j as Mt,G as cs,a as ds,I as us,aN as Nt,b as Se,H as nc,J as oo,M as mn,K as ro}from"../chunks/Dr32EDzy.js";import{b as Qo,p as Zi}from"../chunks/CfMKKhEV.js";function Ed(n,e){return n==null?null:String(n)}function so(n,e,t,i){var o=n.__style;if(Is||o!==e){var r=Ed(e);(!Is||r!==n.getAttribute("style"))&&(r==null?n.removeAttribute("style"):n.style.cssText=r),n.__style=e}return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Cd,Ad;function Sd(){return{geminiUrl:Cd,vertexUrl:Ad}}function Bd(n,e,t,i){var o,r;if(!(n!=null&&n.baseUrl)){const l=Sd();return e?(o=l.vertexUrl)!==null&&o!==void 0?o:t:(r=l.geminiUrl)!==null&&r!==void 0?r:i}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class li{}function Me(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function s(n,e,t){for(let r=0;r<e.length-1;r++){const l=e[r];if(l.endsWith("[]")){const h=l.slice(0,-2);if(!(h in n))if(Array.isArray(t))n[h]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(n[h])){const c=n[h];if(Array.isArray(t))for(let d=0;d<c.length;d++){const u=c[d];s(u,e.slice(r+1),t[d])}else for(const d of c)s(d,e.slice(r+1),t)}return}else if(l.endsWith("[0]")){const h=l.slice(0,-3);h in n||(n[h]=[{}]);const c=n[h];s(c[0],e.slice(r+1),t);return}(!n[l]||typeof n[l]!="object")&&(n[l]={}),n=n[l]}const i=e[e.length-1],o=n[i];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else i==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[i]=t}function a(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const i=e[t];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in n){const r=n[o];return Array.isArray(r)?r.map(l=>a(l,e.slice(t+1))):void 0}else return}else n=n[i]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fs(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function _d(n){const e={},t=a(n,["operationName"]);t!=null&&s(e,["operationName"],t);const i=a(n,["resourceName"]);return i!=null&&s(e,["_url","resourceName"],i),e}function Td(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["metadata"]);i!=null&&s(e,["metadata"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);r!=null&&s(e,["error"],r);const l=a(n,["response","generateVideoResponse"]);return l!=null&&s(e,["response"],Dd(l)),e}function Fd(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["metadata"]);i!=null&&s(e,["metadata"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);r!=null&&s(e,["error"],r);const l=a(n,["response"]);return l!=null&&s(e,["response"],Md(l)),e}function Dd(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(l=>Pd(l))),s(e,["generatedVideos"],r)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&s(e,["raiMediaFilteredReasons"],o),e}function Md(n){const e={},t=a(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(l=>kd(l))),s(e,["generatedVideos"],r)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&s(e,["raiMediaFilteredReasons"],o),e}function Pd(n){const e={},t=a(n,["_self"]);return t!=null&&s(e,["video"],Nd(t)),e}function kd(n){const e={},t=a(n,["_self"]);return t!=null&&s(e,["video"],Ld(t)),e}function Id(n){const e={},t=a(n,["operationName"]);return t!=null&&s(e,["_url","operationName"],t),e}function Rd(n){const e={},t=a(n,["operationName"]);return t!=null&&s(e,["_url","operationName"],t),e}function Nd(n){const e={},t=a(n,["video","uri"]);t!=null&&s(e,["uri"],t);const i=a(n,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],fs(i));const o=a(n,["encoding"]);return o!=null&&s(e,["mimeType"],o),e}function Ld(n){const e={},t=a(n,["gcsUri"]);t!=null&&s(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],fs(i));const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Rs;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Rs||(Rs={}));var Ns;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Ns||(Ns={}));var Wn;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Wn||(Wn={}));var Ls;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT"})(Ls||(Ls={}));var Hs;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Hs||(Hs={}));var Gs;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Gs||(Gs={}));var Us;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Us||(Us={}));var Os;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(Os||(Os={}));var zs;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(zs||(zs={}));var Vs;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(Vs||(Vs={}));var Ws;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT"})(Ws||(Ws={}));var Js;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Js||(Js={}));var qs;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(qs||(qs={}));var Xs;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY"})(Xs||(Xs={}));var Ks;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(Ks||(Ks={}));var co;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(co||(co={}));var Ys;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Ys||(Ys={}));var la;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(la||(la={}));var $s;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})($s||($s={}));var Zs;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Zs||(Zs={}));var Qs;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V"})(Qs||(Qs={}));var js;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(js||(js={}));var el;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(el||(el={}));var tl;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(tl||(tl={}));var nl;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(nl||(nl={}));var il;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(il||(il={}));var ol;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(ol||(ol={}));var rl;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(rl||(rl={}));var al;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(al||(al={}));var sl;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(sl||(sl={}));var ll;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ll||(ll={}));var hl;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(hl||(hl={}));var cl;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(cl||(cl={}));var dl;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(dl||(dl={}));var ul;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(ul||(ul={}));var fl;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(fl||(fl={}));var ml;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(ml||(ml={}));var pl;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(pl||(pl={}));var xl;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(xl||(xl={}));var gl;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(gl||(gl={}));var bl;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(bl||(bl={}));var yl;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(yl||(yl={}));var vl;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(vl||(vl={}));var wl;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(wl||(wl={}));var El;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(El||(El={}));var Cl;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(Cl||(Cl={}));var Al;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Al||(Al={}));var Sl;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(Sl||(Sl={}));var _i;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(_i||(_i={}));class ha{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Qi{get text(){var e,t,i,o,r,l,h,c;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",u=!1;const f=[];for(const m of(c=(h=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)!==null&&c!==void 0?c:[]){for(const[p,b]of Object.entries(m))p!=="text"&&p!=="thought"&&(b!==null||b!==void 0)&&f.push(p);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;u=!0,d+=m.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?d:void 0}get data(){var e,t,i,o,r,l,h,c;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const u=[];for(const f of(c=(h=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)!==null&&c!==void 0?c:[]){for(const[m,p]of Object.entries(f))m!=="inlineData"&&(p!==null||p!==void 0)&&u.push(m);f.inlineData&&typeof f.inlineData.data=="string"&&(d+=atob(f.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,i,o,r,l,h,c;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(h=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||c===void 0?void 0:c.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,i,o,r,l,h,c,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=(c=(h=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||c===void 0?void 0:c.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,i,o,r,l,h,c,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=(c=(h=(l=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||c===void 0?void 0:c.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.output}}class Bl{}class _l{}class Hd{}class Gd{}class Ud{}class Od{}class Tl{}class Fl{}class Dl{}class zd{}class dr{_fromAPIResponse({apiResponse:e,isVertexAI:t}){const i=new dr;let o;const r=e;return t?o=Fd(r):o=Td(r),Object.assign(i,o),i}}class Ml{}class Pl{}class kl{}class Vd{}class Wd{}class Jd{}class Il{}class qd{get text(){var e,t,i;let o="",r=!1;const l=[];for(const h of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[c,d]of Object.entries(h))c!=="text"&&c!=="thought"&&d!==null&&l.push(c);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;r=!0,o+=h.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?o:void 0}get data(){var e,t,i;let o="";const r=[];for(const l of(i=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&i!==void 0?i:[]){for(const[h,c]of Object.entries(l))h!=="inlineData"&&c!==null&&r.push(h);l.inlineData&&typeof l.inlineData.data=="string"&&(o+=atob(l.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),o.length>0?btoa(o):void 0}}class Xd{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dt(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function ic(n,e){const t=dt(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function oc(n){return Array.isArray(n)?n.map(e=>ur(e)):[ur(n)]}function ur(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function rc(n){const e=ur(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ac(n){const e=ur(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Rl(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function sc(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Rl(e)):[Rl(n)]}function ca(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Nl(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Ll(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function It(n){if(n==null)throw new Error("ContentUnion is required");return ca(n)?n:{role:"user",parts:sc(n)}}function ms(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=It(t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=It(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>It(t)):[It(e)]}function tn(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Nl(n)||Ll(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[It(n)]}const e=[],t=[],i=ca(n[0]);for(const o of n){const r=ca(o);if(r!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(o);else{if(Nl(o)||Ll(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(o)}}return i||e.push({role:"user",parts:sc(t)}),e}function Kd(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(i=>i!=="null");if(t.length===1)e.type=Object.values(Wn).includes(t[0].toUpperCase())?t[0].toUpperCase():Wn.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const i of t)e.anyOf.push({type:Object.values(Wn).includes(i.toUpperCase())?i.toUpperCase():Wn.TYPE_UNSPECIFIED})}}function Di(n){const e={},t=["items"],i=["anyOf"],o=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=n.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,n=r[1]):r[1].type==="null"&&(e.nullable=!0,n=r[0])),n.type instanceof Array&&Kd(n.type,e);for(const[l,h]of Object.entries(n))if(h!=null)if(l=="type"){if(h==="null")throw new Error("type: null can not be the only possible type for the field.");if(h instanceof Array)continue;e.type=Object.values(Wn).includes(h.toUpperCase())?h.toUpperCase():Wn.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=Di(h);else if(i.includes(l)){const c=[];for(const d of h){if(d.type=="null"){e.nullable=!0;continue}c.push(Di(d))}e[l]=c}else if(o.includes(l)){const c={};for(const[d,u]of Object.entries(h))c[d]=Di(u);e[l]=c}else{if(l==="additionalProperties")continue;e[l]=h}return e}function ps(n){return Di(n)}function xs(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function gs(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Ui(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Di(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Di(e.response));return n}function Oi(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function Yd(n,e,t,i=1){const o=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function In(n,e){if(typeof e!="string")throw new Error("name must be a string");return Yd(n,e,"cachedContents")}function lc(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function hi(n){return fs(n)}function $d(n){return n!=null&&typeof n=="object"&&"name"in n}function Zd(n){return n!=null&&typeof n=="object"&&"video"in n}function Qd(n){return n!=null&&typeof n=="object"&&"uri"in n}function hc(n){var e;let t;if($d(n)&&(t=n.name),!(Qd(n)&&(t=n.uri,t===void 0))&&!(Zd(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const o=t.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${t}`);t=o[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function cc(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function dc(n){for(const e of["models","tunedModels","publisherModels"])if(jd(n,e))return n[e];return[]}function jd(n,e){return n!==null&&typeof n=="object"&&e in n}function eu(n,e={}){const t=n,i={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(i.responseJsonSchema=t.outputSchema),e.behavior&&(i.behavior=e.behavior),{functionDeclarations:[i]}}function tu(n,e={}){const t=[],i=new Set;for(const o of n){const r=o.name;if(i.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);i.add(r);const l=eu(o,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function uc(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const i=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,o=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(o>0||i!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(i>0||o!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function nu(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function fc(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const o=t.inlinedResponses;if(!Array.isArray(o)||o.length===0)return n;let r=!1;for(const l of o){if(typeof l!="object"||l===null)continue;const c=l.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function zi(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function mc(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function iu(n){const e={},t=a(n,["responsesFile"]);t!=null&&s(e,["fileName"],t);const i=a(n,["inlinedResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Ju(l))),s(e,["inlinedResponses"],r)}const o=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Vu(l))),s(e,["inlinedEmbedContentResponses"],r)}return e}function ou(n){const e={},t=a(n,["predictionsFormat"]);t!=null&&s(e,["format"],t);const i=a(n,["gcsDestination","outputUriPrefix"]);i!=null&&s(e,["gcsUri"],i);const o=a(n,["bigqueryDestination","outputUri"]);return o!=null&&s(e,["bigqueryUri"],o),e}function ru(n){const e={},t=a(n,["format"]);t!=null&&s(e,["predictionsFormat"],t);const i=a(n,["gcsUri"]);i!=null&&s(e,["gcsDestination","outputUriPrefix"],i);const o=a(n,["bigqueryUri"]);if(o!=null&&s(e,["bigqueryDestination","outputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function Bi(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["metadata","displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["metadata","state"]);o!=null&&s(e,["state"],mc(o));const r=a(n,["metadata","createTime"]);r!=null&&s(e,["createTime"],r);const l=a(n,["metadata","endTime"]);l!=null&&s(e,["endTime"],l);const h=a(n,["metadata","updateTime"]);h!=null&&s(e,["updateTime"],h);const c=a(n,["metadata","model"]);c!=null&&s(e,["model"],c);const d=a(n,["metadata","output"]);return d!=null&&s(e,["dest"],iu(fc(d))),e}function da(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["state"]);o!=null&&s(e,["state"],mc(o));const r=a(n,["error"]);r!=null&&s(e,["error"],xc(r));const l=a(n,["createTime"]);l!=null&&s(e,["createTime"],l);const h=a(n,["startTime"]);h!=null&&s(e,["startTime"],h);const c=a(n,["endTime"]);c!=null&&s(e,["endTime"],c);const d=a(n,["updateTime"]);d!=null&&s(e,["updateTime"],d);const u=a(n,["model"]);u!=null&&s(e,["model"],u);const f=a(n,["inputConfig"]);f!=null&&s(e,["src"],au(f));const m=a(n,["outputConfig"]);return m!=null&&s(e,["dest"],ou(fc(m))),e}function au(n){const e={},t=a(n,["instancesFormat"]);t!=null&&s(e,["format"],t);const i=a(n,["gcsSource","uris"]);i!=null&&s(e,["gcsUri"],i);const o=a(n,["bigquerySource","inputUri"]);return o!=null&&s(e,["bigqueryUri"],o),e}function su(n,e){const t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const i=a(e,["fileName"]);i!=null&&s(t,["fileName"],i);const o=a(e,["inlinedRequests"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Wu(n,l))),s(t,["requests","requests"],r)}return t}function lu(n){const e={},t=a(n,["format"]);t!=null&&s(e,["instancesFormat"],t);const i=a(n,["gcsUri"]);i!=null&&s(e,["gcsSource","uris"],i);const o=a(n,["bigqueryUri"]);if(o!=null&&s(e,["bigquerySource","inputUri"],o),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function hu(n){const e={},t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function cu(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function du(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function uu(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function fu(n){const e={},t=a(n,["content"]);t!=null&&s(e,["content"],gu(t));const i=a(n,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],mu(i));const o=a(n,["tokenCount"]);o!=null&&s(e,["tokenCount"],o);const r=a(n,["finishReason"]);r!=null&&s(e,["finishReason"],r);const l=a(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],mf(l));const h=a(n,["avgLogprobs"]);h!=null&&s(e,["avgLogprobs"],h);const c=a(n,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const d=a(n,["index"]);d!=null&&s(e,["index"],d);const u=a(n,["logprobsResult"]);u!=null&&s(e,["logprobsResult"],u);const f=a(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function mu(n){const e={},t=a(n,["citationSources"]);return t!=null&&s(e,["citations"],t),e}function pu(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function xu(n){const e={},t=a(n,["values"]);return t!=null&&s(e,["values"],t),e}function gu(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>tf(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function pc(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>nf(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function bu(n,e){const t={},i=a(n,["displayName"]);if(e!==void 0&&i!=null&&s(e,["batch","displayName"],i),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function yu(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const o=a(n,["dest"]);return e!==void 0&&o!=null&&s(e,["outputConfig"],ru(nu(o))),t}function _r(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["src"]);o!=null&&s(t,["batch","inputConfig"],su(n,uc(n,o)));const r=a(e,["config"]);return r!=null&&bu(r,t),t}function vu(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["model"],dt(n,i));const o=a(e,["src"]);o!=null&&s(t,["inputConfig"],lu(uc(n,o)));const r=a(e,["config"]);return r!=null&&yu(r,t),t}function wu(n,e){const t={},i=a(n,["displayName"]);return e!==void 0&&i!=null&&s(e,["batch","displayName"],i),t}function Tr(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["src"]);o!=null&&s(t,["batch","inputConfig"],Fu(n,o));const r=a(e,["config"]);return r!=null&&wu(r,t),t}function Eu(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function Cu(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function Au(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);return r!=null&&s(e,["error"],bs(r)),e}function Su(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);return r!=null&&s(e,["error"],xc(r)),e}function Bu(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function _u(n,e){const t={},i=a(e,["contents"]);i!=null&&s(t,["requests[]","request","content"],ms(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],Tu(o,t)),t}function Tu(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&s(e,["requests[]","title"],o);const r=a(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&s(e,["requests[]","outputDimensionality"],r),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Fu(n,e){const t={},i=a(e,["fileName"]);i!=null&&s(t,["file_name"],i);const o=a(e,["inlinedRequests"]);return o!=null&&s(t,["requests"],_u(n,o)),t}function Du(n){const e={},t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Mu(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Pu(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function ku(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Iu(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Ru(n){const e={},t=a(n,["behavior"]);t!=null&&s(e,["behavior"],t);const i=a(n,["description"]);i!=null&&s(e,["description"],i);const o=a(n,["name"]);o!=null&&s(e,["name"],o);const r=a(n,["parameters"]);r!=null&&s(e,["parameters"],r);const l=a(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const h=a(n,["response"]);h!=null&&s(e,["response"],h);const c=a(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Nu(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],pc(It(o)));const r=a(e,["temperature"]);r!=null&&s(i,["temperature"],r);const l=a(e,["topP"]);l!=null&&s(i,["topP"],l);const h=a(e,["topK"]);h!=null&&s(i,["topK"],h);const c=a(e,["candidateCount"]);c!=null&&s(i,["candidateCount"],c);const d=a(e,["maxOutputTokens"]);d!=null&&s(i,["maxOutputTokens"],d);const u=a(e,["stopSequences"]);u!=null&&s(i,["stopSequences"],u);const f=a(e,["responseLogprobs"]);f!=null&&s(i,["responseLogprobs"],f);const m=a(e,["logprobs"]);m!=null&&s(i,["logprobs"],m);const p=a(e,["presencePenalty"]);p!=null&&s(i,["presencePenalty"],p);const b=a(e,["frequencyPenalty"]);b!=null&&s(i,["frequencyPenalty"],b);const E=a(e,["seed"]);E!=null&&s(i,["seed"],E);const g=a(e,["responseMimeType"]);g!=null&&s(i,["responseMimeType"],g);const x=a(e,["responseSchema"]);x!=null&&s(i,["responseSchema"],sf(ps(x)));const T=a(e,["responseJsonSchema"]);if(T!=null&&s(i,["responseJsonSchema"],T),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=a(e,["safetySettings"]);if(t!==void 0&&C!=null){let U=C;Array.isArray(U)&&(U=U.map(z=>af(z))),s(t,["safetySettings"],U)}const y=a(e,["tools"]);if(t!==void 0&&y!=null){let U=Oi(y);Array.isArray(U)&&(U=U.map(z=>ff(Ui(z)))),s(t,["tools"],U)}const F=a(e,["toolConfig"]);if(t!==void 0&&F!=null&&s(t,["toolConfig"],uf(F)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=a(e,["cachedContent"]);t!==void 0&&_!=null&&s(t,["cachedContent"],In(n,_));const B=a(e,["responseModalities"]);B!=null&&s(i,["responseModalities"],B);const P=a(e,["mediaResolution"]);P!=null&&s(i,["mediaResolution"],P);const A=a(e,["speechConfig"]);if(A!=null&&s(i,["speechConfig"],cf(xs(A))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const S=a(e,["thinkingConfig"]);S!=null&&s(i,["thinkingConfig"],df(S));const R=a(e,["imageConfig"]);return R!=null&&s(i,["imageConfig"],zu(R)),i}function Lu(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>fu(d))),s(e,["candidates"],c)}const o=a(n,["modelVersion"]);o!=null&&s(e,["modelVersion"],o);const r=a(n,["promptFeedback"]);r!=null&&s(e,["promptFeedback"],r);const l=a(n,["responseId"]);l!=null&&s(e,["responseId"],l);const h=a(n,["usageMetadata"]);return h!=null&&s(e,["usageMetadata"],h),e}function Hu(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function Gu(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],zi(n,i)),t}function Uu(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Bu(t)),e}function Ou(n){const e={},t=a(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],qu(t)),a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function zu(n){const e={},t=a(n,["aspectRatio"]);return t!=null&&s(e,["aspectRatio"],t),e}function Vu(n){const e={},t=a(n,["response"]);t!=null&&s(e,["response"],lf(t));const i=a(n,["error"]);return i!=null&&s(e,["error"],bs(i)),e}function Wu(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["request","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let l=tn(o);Array.isArray(l)&&(l=l.map(h=>pc(h))),s(t,["request","contents"],l)}const r=a(e,["config"]);return r!=null&&s(t,["request","generationConfig"],Nu(n,r,t)),t}function Ju(n){const e={},t=a(n,["response"]);t!=null&&s(e,["response"],Lu(t));const i=a(n,["error"]);return i!=null&&s(e,["error"],bs(i)),e}function qu(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function bs(n){const e={},t=a(n,["details"]);t!=null&&s(e,["details"],t);const i=a(n,["code"]);i!=null&&s(e,["code"],i);const o=a(n,["message"]);return o!=null&&s(e,["message"],o),e}function xc(n){const e={},t=a(n,["details"]);t!=null&&s(e,["details"],t);const i=a(n,["code"]);i!=null&&s(e,["code"],i);const o=a(n,["message"]);return o!=null&&s(e,["message"],o),e}function Xu(n){const e={},t=a(n,["latitude"]);t!=null&&s(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function Ku(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);if(e!==void 0&&o!=null&&s(e,["_query","pageToken"],o),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function Yu(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);e!==void 0&&o!=null&&s(e,["_query","pageToken"],o);const r=a(n,["filter"]);return e!==void 0&&r!=null&&s(e,["_query","filter"],r),t}function $u(n){const e={},t=a(n,["config"]);return t!=null&&Ku(t,e),e}function Zu(n){const e={},t=a(n,["config"]);return t!=null&&Yu(t,e),e}function Qu(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["operations"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Bi(l))),s(e,["batchJobs"],r)}return e}function ju(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["batchPredictionJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>da(l))),s(e,["batchJobs"],r)}return e}function ef(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>hf(o))),s(e,["speakerVoiceConfigs"],i)}return e}function tf(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],gf(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],hu(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Du(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Pu(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function nf(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],bf(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],cu(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Mu(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],ku(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function of(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function rf(n){const e={},t=a(n,["latLng"]);t!=null&&s(e,["latLng"],Xu(t));const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function af(n){const e={};if(a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=a(n,["category"]);t!=null&&s(e,["category"],t);const i=a(n,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function sf(n){const e={},t=a(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&s(e,["default"],i);const o=a(n,["description"]);o!=null&&s(e,["description"],o);const r=a(n,["enum"]);r!=null&&s(e,["enum"],r);const l=a(n,["example"]);l!=null&&s(e,["example"],l);const h=a(n,["format"]);h!=null&&s(e,["format"],h);const c=a(n,["items"]);c!=null&&s(e,["items"],c);const d=a(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const u=a(n,["maxLength"]);u!=null&&s(e,["maxLength"],u);const f=a(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const m=a(n,["maximum"]);m!=null&&s(e,["maximum"],m);const p=a(n,["minItems"]);p!=null&&s(e,["minItems"],p);const b=a(n,["minLength"]);b!=null&&s(e,["minLength"],b);const E=a(n,["minProperties"]);E!=null&&s(e,["minProperties"],E);const g=a(n,["minimum"]);g!=null&&s(e,["minimum"],g);const x=a(n,["nullable"]);x!=null&&s(e,["nullable"],x);const T=a(n,["pattern"]);T!=null&&s(e,["pattern"],T);const C=a(n,["properties"]);C!=null&&s(e,["properties"],C);const y=a(n,["propertyOrdering"]);y!=null&&s(e,["propertyOrdering"],y);const F=a(n,["required"]);F!=null&&s(e,["required"],F);const _=a(n,["title"]);_!=null&&s(e,["title"],_);const B=a(n,["type"]);return B!=null&&s(e,["type"],B),e}function lf(n){const e={},t=a(n,["embedding"]);t!=null&&s(e,["embedding"],xu(t));const i=a(n,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function hf(n){const e={},t=a(n,["speaker"]);t!=null&&s(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&s(e,["voiceConfig"],gc(i)),e}function cf(n){const e={},t=a(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],gc(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&s(e,["multiSpeakerVoiceConfig"],ef(i));const o=a(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function df(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function uf(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],Iu(t));const i=a(n,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],rf(i)),e}function ff(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>Ru(d))),s(e,["functionDeclarations"],c)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],Ou(i));const o=a(n,["googleSearchRetrieval"]);if(o!=null&&s(e,["googleSearchRetrieval"],Uu(o)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&s(e,["urlContext"],pf());const l=a(n,["computerUse"]);l!=null&&s(e,["computerUse"],pu(l));const h=a(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function mf(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>xf(o))),s(e,["urlMetadata"],i)}return e}function pf(){return{}}function xf(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&s(e,["urlRetrievalStatus"],i),e}function gf(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function bf(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function gc(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],of(t)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var ai;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(ai||(ai={}));class xo{constructor(e,t,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,o)}init(e,t,i){var o,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!i||Object.keys(i).length===0?l={config:{}}:typeof i=="object"?l=Object.assign({},i):l=i,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(r=(o=l.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yf extends li{constructor(e){super(),this.apiClient=e,this.create=async t=>{var i,o;if(this.apiClient.isVertexAI())return t.config=this.formatDestination(t.src,t.config),this.createInternal(t);const r=t.src;if(!(Array.isArray(t.src)||r.inlinedRequests!==void 0))return this.createInternal(t);const h=this.createInlinedGenerateContentRequest(t),c=h.path,d=h.body,u=_r(this.apiClient,t)._query||{};return this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()).then(m=>Bi(m))},this.createEmbeddings=async t=>{var i,o;if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");if(!(t.src.inlinedRequests!==void 0))return this.createEmbeddingsInternal(t);const h=this.createInlinedEmbedContentRequest(t),c=h.path,d=h.body,u=Tr(this.apiClient,t)._query||{};return this.apiClient.request({path:c,queryParams:u,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(o=t.config)===null||o===void 0?void 0:o.abortSignal}).then(m=>m.json()).then(m=>Bi(m))},this.list=async(t={})=>new xo(ai.PAGED_ITEM_BATCH_JOBS,i=>this.listInternal(i),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){const t=_r(this.apiClient,e),i=t._url,o=Me("{model}:batchGenerateContent",i),h=t.batch.inputConfig.requests,c=h.requests,d=[];for(const u of c){const f=Object.assign({},u);if(f.systemInstruction){const m=f.systemInstruction;delete f.systemInstruction;const p=f.request;p.systemInstruction=m,f.request=p}d.push(f)}return h.requests=d,delete t.config,delete t._url,delete t._query,{path:o,body:t}}createInlinedEmbedContentRequest(e){const t=Tr(this.apiClient,e),i=t._url,o=Me("{model}:asyncBatchEmbedContent",i),h=t.batch.inputConfig.requests,c=h.requests,d=[];delete h.config;for(const u of c){const f=Object.assign({},u),m=f.request;for(const p in f)p!=="request"&&(m[p]=f[p],delete f[p]);d.push(f)}return h.requests=d,delete t.config,delete t._url,delete t._query,{path:o,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const i=t?Object.assign({},t):{},o=Date.now().toString();if(i.displayName||(i.displayName=`genaiBatchJob_${o}`),i.dest===void 0){const r=this.getGcsUri(e),l=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?i.dest=`${r.slice(0,-6)}/dest`:i.dest=`${r}_dest_${o}`;else if(l)i.dest=`${l}_dest_${o}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return i}async createInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=vu(this.apiClient,e);return h=Me("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>da(u))}else{const d=_r(this.apiClient,e);return h=Me("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>Bi(u))}}async createEmbeddingsInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=Tr(this.apiClient,e);return r=Me("{model}:asyncBatchEmbedContent",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>Bi(c))}}async get(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Gu(this.apiClient,e);return h=Me("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>da(u))}else{const d=Hu(this.apiClient,e);return h=Me("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>Bi(u))}}async cancel(e){var t,i,o,r;let l="",h={};if(this.apiClient.isVertexAI()){const c=uu(this.apiClient,e);l=Me("batchPredictionJobs/{name}:cancel",c._url),h=c._query,delete c._url,delete c._query,await this.apiClient.request({path:l,queryParams:h,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const c=du(this.apiClient,e);l=Me("batches/{name}:cancel",c._url),h=c._query,delete c._url,delete c._query,await this.apiClient.request({path:l,queryParams:h,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Zu(e);return h=Me("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=ju(u),m=new Il;return Object.assign(m,f),m})}else{const d=$u(e);return h=Me("batches",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Qu(u),m=new Il;return Object.assign(m,f),m})}}async delete(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Cu(this.apiClient,e);return h=Me("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>Su(u))}else{const d=Eu(this.apiClient,e);return h=Me("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>Au(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vf(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function wf(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],vf(t));const i=a(n,["authType"]);i!=null&&s(e,["authType"],i);const o=a(n,["googleServiceAccountConfig"]);o!=null&&s(e,["googleServiceAccountConfig"],o);const r=a(n,["httpBasicAuthConfig"]);r!=null&&s(e,["httpBasicAuthConfig"],r);const l=a(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const h=a(n,["oidcConfig"]);return h!=null&&s(e,["oidcConfig"],h),e}function Ef(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Cf(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["data"]);i!=null&&s(e,["data"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function jo(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["model"]);o!=null&&s(e,["model"],o);const r=a(n,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(n,["updateTime"]);l!=null&&s(e,["updateTime"],l);const h=a(n,["expireTime"]);h!=null&&s(e,["expireTime"],h);const c=a(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function er(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["model"]);o!=null&&s(e,["model"],o);const r=a(n,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(n,["updateTime"]);l!=null&&s(e,["updateTime"],l);const h=a(n,["expireTime"]);h!=null&&s(e,["expireTime"],h);const c=a(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function Af(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function Sf(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function Hl(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>lm(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function Gl(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>hm(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function Bf(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const o=a(n,["expireTime"]);e!==void 0&&o!=null&&s(e,["expireTime"],o);const r=a(n,["displayName"]);e!==void 0&&r!=null&&s(e,["displayName"],r);const l=a(n,["contents"]);if(e!==void 0&&l!=null){let u=tn(l);Array.isArray(u)&&(u=u.map(f=>Hl(f))),s(e,["contents"],u)}const h=a(n,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["systemInstruction"],Hl(It(h)));const c=a(n,["tools"]);if(e!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(f=>mm(f))),s(e,["tools"],u)}const d=a(n,["toolConfig"]);if(e!==void 0&&d!=null&&s(e,["toolConfig"],um(d)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function _f(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const o=a(n,["expireTime"]);e!==void 0&&o!=null&&s(e,["expireTime"],o);const r=a(n,["displayName"]);e!==void 0&&r!=null&&s(e,["displayName"],r);const l=a(n,["contents"]);if(e!==void 0&&l!=null){let f=tn(l);Array.isArray(f)&&(f=f.map(m=>Gl(m))),s(e,["contents"],f)}const h=a(n,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["systemInstruction"],Gl(It(h)));const c=a(n,["tools"]);if(e!==void 0&&c!=null){let f=c;Array.isArray(f)&&(f=f.map(m=>pm(m))),s(e,["tools"],f)}const d=a(n,["toolConfig"]);e!==void 0&&d!=null&&s(e,["toolConfig"],fm(d));const u=a(n,["kmsKeyName"]);return e!==void 0&&u!=null&&s(e,["encryption_spec","kmsKeyName"],u),t}function Tf(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["model"],ic(n,i));const o=a(e,["config"]);return o!=null&&Bf(o,t),t}function Ff(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["model"],ic(n,i));const o=a(e,["config"]);return o!=null&&_f(o,t),t}function Df(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],In(n,i)),t}function Mf(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],In(n,i)),t}function Pf(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function kf(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function If(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Rf(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Nf(n){const e={},t=a(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function Lf(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Hf(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&s(e,["fileUri"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Gf(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Uf(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Of(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function zf(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Vf(n){const e={},t=a(n,["behavior"]);t!=null&&s(e,["behavior"],t);const i=a(n,["description"]);i!=null&&s(e,["description"],i);const o=a(n,["name"]);o!=null&&s(e,["name"],o);const r=a(n,["parameters"]);r!=null&&s(e,["parameters"],r);const l=a(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const h=a(n,["response"]);h!=null&&s(e,["response"],h);const c=a(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Wf(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&s(e,["description"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["parameters"]);o!=null&&s(e,["parameters"],o);const r=a(n,["parametersJsonSchema"]);r!=null&&s(e,["parametersJsonSchema"],r);const l=a(n,["response"]);l!=null&&s(e,["response"],l);const h=a(n,["responseJsonSchema"]);return h!=null&&s(e,["responseJsonSchema"],h),e}function Jf(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],In(n,i)),t}function qf(n,e){const t={},i=a(e,["name"]);return i!=null&&s(t,["_url","name"],In(n,i)),t}function Xf(n){const e={},t=a(n,["authConfig"]);return t!=null&&s(e,["authConfig"],wf(t)),e}function Kf(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],If(t)),e}function Yf(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],Rf(t)),e}function $f(n){const e={},t=a(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],Qf(t)),a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Zf(n){const e={},t=a(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],jf(t));const i=a(n,["excludeDomains"]);return i!=null&&s(e,["excludeDomains"],i),e}function Qf(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function jf(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function em(n){const e={},t=a(n,["latitude"]);t!=null&&s(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function tm(n){const e={},t=a(n,["latitude"]);t!=null&&s(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function nm(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&s(e,["_query","pageToken"],o),t}function im(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&s(e,["_query","pageToken"],o),t}function om(n){const e={},t=a(n,["config"]);return t!=null&&nm(t,e),e}function rm(n){const e={},t=a(n,["config"]);return t!=null&&im(t,e),e}function am(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>jo(l))),s(e,["cachedContents"],r)}return e}function sm(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["cachedContents"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>er(l))),s(e,["cachedContents"],r)}return e}function lm(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Em(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Ef(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Lf(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Gf(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function hm(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Cm(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Cf(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Hf(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Uf(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function cm(n){const e={},t=a(n,["latLng"]);t!=null&&s(e,["latLng"],em(t));const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function dm(n){const e={},t=a(n,["latLng"]);t!=null&&s(e,["latLng"],tm(t));const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function um(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],Of(t));const i=a(n,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],cm(i)),e}function fm(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],zf(t));const i=a(n,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],dm(i)),e}function mm(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>Vf(d))),s(e,["functionDeclarations"],c)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],$f(i));const o=a(n,["googleSearchRetrieval"]);if(o!=null&&s(e,["googleSearchRetrieval"],Kf(o)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&s(e,["urlContext"],vm());const l=a(n,["computerUse"]);l!=null&&s(e,["computerUse"],Af(l));const h=a(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function pm(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(m=>Wf(m))),s(e,["functionDeclarations"],f)}const i=a(n,["retrieval"]);i!=null&&s(e,["retrieval"],i);const o=a(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],Zf(o));const r=a(n,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],Yf(r));const l=a(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],Nf(l));const h=a(n,["googleMaps"]);h!=null&&s(e,["googleMaps"],Xf(h)),a(n,["urlContext"])!=null&&s(e,["urlContext"],wm());const d=a(n,["computerUse"]);d!=null&&s(e,["computerUse"],Sf(d));const u=a(n,["codeExecution"]);return u!=null&&s(e,["codeExecution"],u),e}function xm(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const o=a(n,["expireTime"]);return e!==void 0&&o!=null&&s(e,["expireTime"],o),t}function gm(n,e){const t={},i=a(n,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const o=a(n,["expireTime"]);return e!==void 0&&o!=null&&s(e,["expireTime"],o),t}function bm(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],In(n,i));const o=a(e,["config"]);return o!=null&&xm(o,t),t}function ym(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],In(n,i));const o=a(e,["config"]);return o!=null&&gm(o,t),t}function vm(){return{}}function wm(){return{}}function Em(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Cm(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Am extends li{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xo(ai.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Ff(this.apiClient,e);return h=Me("cachedContents",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>er(u))}else{const d=Tf(this.apiClient,e);return h=Me("cachedContents",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>jo(u))}}async get(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=qf(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>er(u))}else{const d=Jf(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>jo(u))}}async delete(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Mf(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=kf(u),m=new Pl;return Object.assign(m,f),m})}else{const d=Df(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Pf(u),m=new Pl;return Object.assign(m,f),m})}}async update(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=ym(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>er(u))}else{const d=bm(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>jo(u))}}async listInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=rm(e);return h=Me("cachedContents",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=sm(u),m=new kl;return Object.assign(m,f),m})}else{const d=om(e);return h=Me("cachedContents",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=am(u),m=new kl;return Object.assign(m,f),m})}}}function Ul(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function gt(n){return this instanceof gt?(this.v=n,this):new gt(n)}function Mi(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),h("next"),h("throw"),h("return",l),o[Symbol.asyncIterator]=function(){return this},o;function l(p){return function(b){return Promise.resolve(b).then(p,f)}}function h(p,b){i[p]&&(o[p]=function(E){return new Promise(function(g,x){r.push([p,E,g,x])>1||c(p,E)})},b&&(o[p]=b(o[p])))}function c(p,b){try{d(i[p](b))}catch(E){m(r[0][3],E)}}function d(p){p.value instanceof gt?Promise.resolve(p.value.v).then(u,f):m(r[0][2],p)}function u(p){c("next",p)}function f(p){c("throw",p)}function m(p,b){p(b),r.shift(),r.length&&c(r[0][0],r[0][1])}}function lo(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Ul=="function"?Ul(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=n[r]&&function(l){return new Promise(function(h,c){l=n[r](l),o(h,c,l.done,l.value)})}}function o(r,l,h,c){Promise.resolve(c).then(function(d){r({value:d,done:h})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Sm(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:bc(t)}function bc(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Bm(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Ol(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0;for(;i<t;)if(n[i].role==="user")e.push(n[i]),i++;else{const o=[];let r=!0;for(;i<t&&n[i].role==="model";)o.push(n[i]),r&&!bc(n[i])&&(r=!1),i++;r?e.push(...o):e.pop()}return e}class _m{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Tm(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class Tm{constructor(e,t,i,o={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),Bm(r)}async sendMessage(e){var t;await this.sendPromise;const i=It(e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,l,h;const c=await o,d=(l=(r=c.candidates)===null||r===void 0?void 0:r[0])===null||l===void 0?void 0:l.content,u=c.automaticFunctionCallingHistory,f=this.getHistory(!0).length;let m=[];u!=null&&(m=(h=u.slice(f))!==null&&h!==void 0?h:[]);const p=d?[d]:[];this.recordHistory(i,p,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),o}async sendMessageStream(e){var t;await this.sendPromise;const i=It(e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{}).catch(()=>{});const r=await o;return this.processStreamResponse(r,i)}getHistory(e=!1){const t=e?Ol(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var i,o;return Mi(this,arguments,function*(){var l,h,c,d;const u=[];try{for(var f=!0,m=lo(e),p;p=yield gt(m.next()),l=p.done,!l;f=!0){d=p.value,f=!1;const b=d;if(Sm(b)){const E=(o=(i=b.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content;E!==void 0&&u.push(E)}yield yield gt(b)}}catch(b){h={error:b}}finally{try{!f&&!l&&(c=m.return)&&(yield gt(c.call(m)))}finally{if(h)throw h.error}}this.recordHistory(t,u)})}recordHistory(e,t,i){let o=[];t.length>0&&t.every(r=>r.role!==void 0)?o=t:o.push({role:"model",parts:[]}),i&&i.length>0?this.history.push(...Ol(i)):this.history.push(e),this.history.push(...o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yr extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,yr.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Fm(n){const e={},t=a(n,["file"]);return t!=null&&s(e,["file"],Rm(t)),e}function Dm(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function Mm(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","file"],hc(t)),e}function Pm(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function ua(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["mimeType"]);o!=null&&s(e,["mimeType"],o);const r=a(n,["sizeBytes"]);r!=null&&s(e,["sizeBytes"],r);const l=a(n,["createTime"]);l!=null&&s(e,["createTime"],l);const h=a(n,["expirationTime"]);h!=null&&s(e,["expirationTime"],h);const c=a(n,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=a(n,["sha256Hash"]);d!=null&&s(e,["sha256Hash"],d);const u=a(n,["uri"]);u!=null&&s(e,["uri"],u);const f=a(n,["downloadUri"]);f!=null&&s(e,["downloadUri"],f);const m=a(n,["state"]);m!=null&&s(e,["state"],m);const p=a(n,["source"]);p!=null&&s(e,["source"],p);const b=a(n,["videoMetadata"]);b!=null&&s(e,["videoMetadata"],b);const E=a(n,["error"]);return E!=null&&s(e,["error"],km(E)),e}function km(n){const e={},t=a(n,["details"]);t!=null&&s(e,["details"],t);const i=a(n,["message"]);i!=null&&s(e,["message"],i);const o=a(n,["code"]);return o!=null&&s(e,["code"],o),e}function Im(n){const e={},t=a(n,["details"]);t!=null&&s(e,["details"],t);const i=a(n,["message"]);i!=null&&s(e,["message"],i);const o=a(n,["code"]);return o!=null&&s(e,["code"],o),e}function Rm(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["mimeType"]);o!=null&&s(e,["mimeType"],o);const r=a(n,["sizeBytes"]);r!=null&&s(e,["sizeBytes"],r);const l=a(n,["createTime"]);l!=null&&s(e,["createTime"],l);const h=a(n,["expirationTime"]);h!=null&&s(e,["expirationTime"],h);const c=a(n,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=a(n,["sha256Hash"]);d!=null&&s(e,["sha256Hash"],d);const u=a(n,["uri"]);u!=null&&s(e,["uri"],u);const f=a(n,["downloadUri"]);f!=null&&s(e,["downloadUri"],f);const m=a(n,["state"]);m!=null&&s(e,["state"],m);const p=a(n,["source"]);p!=null&&s(e,["source"],p);const b=a(n,["videoMetadata"]);b!=null&&s(e,["videoMetadata"],b);const E=a(n,["error"]);return E!=null&&s(e,["error"],Im(E)),e}function Nm(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","file"],hc(t)),e}function Lm(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);return e!==void 0&&o!=null&&s(e,["_query","pageToken"],o),t}function Hm(n){const e={},t=a(n,["config"]);return t!=null&&Lm(t,e),e}function Gm(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["files"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>ua(l))),s(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Um extends li{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new xo(ai.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>ua(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=Hm(e);return r=Me("files",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>{const d=Gm(c),u=new Vd;return Object.assign(u,d),u})}}async createInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=Fm(e);return r=Me("upload/v1beta/files",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>{const d=Dm(c),u=new Wd;return Object.assign(u,d),u})}}async get(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=Nm(e);return r=Me("files/{file}",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>ua(c))}}async delete(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=Mm(e);return r=Me("files/{file}",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>{const d=Pm(c),u=new Jd;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Om(){return{}}function zm(){return{}}function Vm(){return{}}function Wm(){return{}}function Jm(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function qm(n){const e={},t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);i!=null&&s(e,["mimeType"],i);const o=a(n,["sourceMetadata"]);return o!=null&&s(e,["sourceMetadata"],H0(o)),e}function zl(){return{}}function Vl(){return{}}function Xm(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],Jm(t));const i=a(n,["authType"]);i!=null&&s(e,["authType"],i);const o=a(n,["googleServiceAccountConfig"]);o!=null&&s(e,["googleServiceAccountConfig"],o);const r=a(n,["httpBasicAuthConfig"]);r!=null&&s(e,["httpBasicAuthConfig"],r);const l=a(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const h=a(n,["oidcConfig"]);return h!=null&&s(e,["oidcConfig"],h),e}function Km(n){const e={},t=a(n,["disabled"]);t!=null&&s(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const o=a(n,["endOfSpeechSensitivity"]);o!=null&&s(e,["endOfSpeechSensitivity"],o);const r=a(n,["prefixPaddingMs"]);r!=null&&s(e,["prefixPaddingMs"],r);const l=a(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function Ym(n){const e={},t=a(n,["disabled"]);t!=null&&s(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const o=a(n,["endOfSpeechSensitivity"]);o!=null&&s(e,["endOfSpeechSensitivity"],o);const r=a(n,["prefixPaddingMs"]);r!=null&&s(e,["prefixPaddingMs"],r);const l=a(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function $m(n){const e={},t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Zm(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["data"]);i!=null&&s(e,["data"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Qm(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function jm(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["data"]);i!=null&&s(e,["data"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function e0(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function t0(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function n0(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>np(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function i0(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>ip(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function o0(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>op(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function r0(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>rp(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function a0(n){const e={},t=a(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],mp(i)),e}function s0(n){const e={},t=a(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],pp(i)),e}function l0(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function h0(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function c0(n){const e={},t=a(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function d0(n){const e={},t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function u0(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&s(e,["fileUri"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function f0(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function m0(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&s(e,["fileUri"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function yc(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function vc(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function p0(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function x0(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function g0(n){const e={},t=a(n,["behavior"]);t!=null&&s(e,["behavior"],t);const i=a(n,["description"]);i!=null&&s(e,["description"],i);const o=a(n,["name"]);o!=null&&s(e,["name"],o);const r=a(n,["parameters"]);r!=null&&s(e,["parameters"],r);const l=a(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const h=a(n,["response"]);h!=null&&s(e,["response"],h);const c=a(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function b0(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&s(e,["description"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["parameters"]);o!=null&&s(e,["parameters"],o);const r=a(n,["parametersJsonSchema"]);r!=null&&s(e,["parametersJsonSchema"],r);const l=a(n,["response"]);l!=null&&s(e,["response"],l);const h=a(n,["responseJsonSchema"]);return h!=null&&s(e,["responseJsonSchema"],h),e}function y0(n){const e={},t=a(n,["authConfig"]);return t!=null&&s(e,["authConfig"],Xm(t)),e}function v0(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],l0(t)),e}function w0(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],h0(t)),e}function E0(n){const e={},t=a(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],A0(t)),a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function C0(n){const e={},t=a(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],S0(t));const i=a(n,["excludeDomains"]);return i!=null&&s(e,["excludeDomains"],i),e}function A0(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function S0(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function B0(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig","responseModalities"],o);const r=a(n,["temperature"]);e!==void 0&&r!=null&&s(e,["setup","generationConfig","temperature"],r);const l=a(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const h=a(n,["topK"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","topK"],h);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","maxOutputTokens"],c);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const u=a(n,["seed"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","seed"],u);const f=a(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],gp(gs(f)));const m=a(n,["thinkingConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","thinkingConfig"],yp(m));const p=a(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const b=a(n,["systemInstruction"]);e!==void 0&&b!=null&&s(e,["setup","systemInstruction"],o0(It(b)));const E=a(n,["tools"]);if(e!==void 0&&E!=null){let _=Oi(E);Array.isArray(_)&&(_=_.map(B=>wp(Ui(B)))),s(e,["setup","tools"],_)}const g=a(n,["sessionResumption"]);e!==void 0&&g!=null&&s(e,["setup","sessionResumption"],up(g));const x=a(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&s(e,["setup","inputAudioTranscription"],zl());const T=a(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&s(e,["setup","outputAudioTranscription"],zl());const C=a(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&s(e,["setup","realtimeInputConfig"],cp(C));const y=a(n,["contextWindowCompression"]);e!==void 0&&y!=null&&s(e,["setup","contextWindowCompression"],a0(y));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&s(e,["setup","proactivity"],lp(F)),t}function _0(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig","responseModalities"],o);const r=a(n,["temperature"]);e!==void 0&&r!=null&&s(e,["setup","generationConfig","temperature"],r);const l=a(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const h=a(n,["topK"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","topK"],h);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","maxOutputTokens"],c);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const u=a(n,["seed"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","seed"],u);const f=a(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],bp(gs(f)));const m=a(n,["thinkingConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","thinkingConfig"],vp(m));const p=a(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const b=a(n,["systemInstruction"]);e!==void 0&&b!=null&&s(e,["setup","systemInstruction"],r0(It(b)));const E=a(n,["tools"]);if(e!==void 0&&E!=null){let _=Oi(E);Array.isArray(_)&&(_=_.map(B=>Ep(Ui(B)))),s(e,["setup","tools"],_)}const g=a(n,["sessionResumption"]);e!==void 0&&g!=null&&s(e,["setup","sessionResumption"],fp(g));const x=a(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&s(e,["setup","inputAudioTranscription"],Vl());const T=a(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&s(e,["setup","outputAudioTranscription"],Vl());const C=a(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&s(e,["setup","realtimeInputConfig"],dp(C));const y=a(n,["contextWindowCompression"]);e!==void 0&&y!=null&&s(e,["setup","contextWindowCompression"],s0(y));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&s(e,["setup","proactivity"],hp(F)),t}function T0(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["setup","model"],dt(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],B0(o,t)),t}function F0(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["setup","model"],dt(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],_0(o,t)),t}function D0(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Ip(o))),s(e,["weightedPrompts"],i)}return e}function wc(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Sc(o))),s(e,["weightedPrompts"],i)}return e}function fa(n){const e={},t=a(n,["setup"]);t!=null&&s(e,["setup"],Ec(t));const i=a(n,["clientContent"]);i!=null&&s(e,["clientContent"],wc(i));const o=a(n,["musicGenerationConfig"]);o!=null&&s(e,["musicGenerationConfig"],Cc(o));const r=a(n,["playbackControl"]);return r!=null&&s(e,["playbackControl"],r),e}function Ec(n){const e={},t=a(n,["model"]);return t!=null&&s(e,["model"],t),e}function M0(n){const e={},t=a(n,["text"]);t!=null&&s(e,["text"],t);const i=a(n,["filteredReason"]);return i!=null&&s(e,["filteredReason"],i),e}function P0(n){const e={},t=a(n,["temperature"]);t!=null&&s(e,["temperature"],t);const i=a(n,["topK"]);i!=null&&s(e,["topK"],i);const o=a(n,["seed"]);o!=null&&s(e,["seed"],o);const r=a(n,["guidance"]);r!=null&&s(e,["guidance"],r);const l=a(n,["bpm"]);l!=null&&s(e,["bpm"],l);const h=a(n,["density"]);h!=null&&s(e,["density"],h);const c=a(n,["brightness"]);c!=null&&s(e,["brightness"],c);const d=a(n,["scale"]);d!=null&&s(e,["scale"],d);const u=a(n,["muteBass"]);u!=null&&s(e,["muteBass"],u);const f=a(n,["muteDrums"]);f!=null&&s(e,["muteDrums"],f);const m=a(n,["onlyBassAndDrums"]);m!=null&&s(e,["onlyBassAndDrums"],m);const p=a(n,["musicGenerationMode"]);return p!=null&&s(e,["musicGenerationMode"],p),e}function Cc(n){const e={},t=a(n,["temperature"]);t!=null&&s(e,["temperature"],t);const i=a(n,["topK"]);i!=null&&s(e,["topK"],i);const o=a(n,["seed"]);o!=null&&s(e,["seed"],o);const r=a(n,["guidance"]);r!=null&&s(e,["guidance"],r);const l=a(n,["bpm"]);l!=null&&s(e,["bpm"],l);const h=a(n,["density"]);h!=null&&s(e,["density"],h);const c=a(n,["brightness"]);c!=null&&s(e,["brightness"],c);const d=a(n,["scale"]);d!=null&&s(e,["scale"],d);const u=a(n,["muteBass"]);u!=null&&s(e,["muteBass"],u);const f=a(n,["muteDrums"]);f!=null&&s(e,["muteDrums"],f);const m=a(n,["onlyBassAndDrums"]);m!=null&&s(e,["onlyBassAndDrums"],m);const p=a(n,["musicGenerationMode"]);return p!=null&&s(e,["musicGenerationMode"],p),e}function k0(n){const e={},t=a(n,["audioChunks"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>qm(o))),s(e,["audioChunks"],i)}return e}function I0(n){const e={};a(n,["setupComplete"])!=null&&s(e,["setupComplete"],R0());const i=a(n,["serverContent"]);i!=null&&s(e,["serverContent"],k0(i));const o=a(n,["filteredPrompt"]);return o!=null&&s(e,["filteredPrompt"],M0(o)),e}function R0(){return{}}function N0(n){const e={},t=a(n,["musicGenerationConfig"]);return t!=null&&s(e,["musicGenerationConfig"],Cc(t)),e}function L0(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Sc(o))),s(e,["weightedPrompts"],i)}return e}function H0(n){const e={},t=a(n,["clientContent"]);t!=null&&s(e,["clientContent"],D0(t));const i=a(n,["musicGenerationConfig"]);return i!=null&&s(e,["musicGenerationConfig"],P0(i)),e}function G0(n){const e={},t=a(n,["media"]);if(t!=null){let d=oc(t);Array.isArray(d)&&(d=d.map(u=>u)),s(e,["mediaChunks"],d)}const i=a(n,["audio"]);i!=null&&s(e,["audio"],ac(i));const o=a(n,["audioStreamEnd"]);o!=null&&s(e,["audioStreamEnd"],o);const r=a(n,["video"]);r!=null&&s(e,["video"],rc(r));const l=a(n,["text"]);return l!=null&&s(e,["text"],l),a(n,["activityStart"])!=null&&s(e,["activityStart"],Vm()),a(n,["activityEnd"])!=null&&s(e,["activityEnd"],Om()),e}function U0(n){const e={},t=a(n,["media"]);if(t!=null){let d=oc(t);Array.isArray(d)&&(d=d.map(u=>u)),s(e,["mediaChunks"],d)}const i=a(n,["audio"]);i!=null&&s(e,["audio"],ac(i));const o=a(n,["audioStreamEnd"]);o!=null&&s(e,["audioStreamEnd"],o);const r=a(n,["video"]);r!=null&&s(e,["video"],rc(r));const l=a(n,["text"]);return l!=null&&s(e,["text"],l),a(n,["activityStart"])!=null&&s(e,["activityStart"],Wm()),a(n,["activityEnd"])!=null&&s(e,["activityEnd"],zm()),e}function O0(n){const e={},t=a(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],n0(t));const i=a(n,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const o=a(n,["interrupted"]);o!=null&&s(e,["interrupted"],o);const r=a(n,["groundingMetadata"]);r!=null&&s(e,["groundingMetadata"],r);const l=a(n,["generationComplete"]);l!=null&&s(e,["generationComplete"],l);const h=a(n,["inputTranscription"]);h!=null&&s(e,["inputTranscription"],Wl(h));const c=a(n,["outputTranscription"]);c!=null&&s(e,["outputTranscription"],Wl(c));const d=a(n,["urlContextMetadata"]);d!=null&&s(e,["urlContextMetadata"],Cp(d));const u=a(n,["turnCompleteReason"]);u!=null&&s(e,["turnCompleteReason"],u);const f=a(n,["waitingForInput"]);return f!=null&&s(e,["waitingForInput"],f),e}function z0(n){const e={},t=a(n,["modelTurn"]);t!=null&&s(e,["modelTurn"],i0(t));const i=a(n,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const o=a(n,["interrupted"]);o!=null&&s(e,["interrupted"],o);const r=a(n,["groundingMetadata"]);r!=null&&s(e,["groundingMetadata"],r);const l=a(n,["generationComplete"]);l!=null&&s(e,["generationComplete"],l);const h=a(n,["inputTranscription"]);h!=null&&s(e,["inputTranscription"],Jl(h));const c=a(n,["outputTranscription"]);c!=null&&s(e,["outputTranscription"],Jl(c));const d=a(n,["turnCompleteReason"]);d!=null&&s(e,["turnCompleteReason"],d);const u=a(n,["waitingForInput"]);return u!=null&&s(e,["waitingForInput"],u),e}function V0(n){const e={},t=a(n,["timeLeft"]);return t!=null&&s(e,["timeLeft"],t),e}function W0(n){const e={},t=a(n,["timeLeft"]);return t!=null&&s(e,["timeLeft"],t),e}function J0(n){const e={};a(n,["setupComplete"])!=null&&s(e,["setupComplete"],Y0());const i=a(n,["serverContent"]);i!=null&&s(e,["serverContent"],O0(i));const o=a(n,["toolCall"]);o!=null&&s(e,["toolCall"],j0(o));const r=a(n,["toolCallCancellation"]);r!=null&&s(e,["toolCallCancellation"],Z0(r));const l=a(n,["usageMetadata"]);l!=null&&s(e,["usageMetadata"],_p(l));const h=a(n,["goAway"]);h!=null&&s(e,["goAway"],V0(h));const c=a(n,["sessionResumptionUpdate"]);return c!=null&&s(e,["sessionResumptionUpdate"],X0(c)),e}function q0(n){const e={},t=a(n,["setupComplete"]);t!=null&&s(e,["setupComplete"],$0(t));const i=a(n,["serverContent"]);i!=null&&s(e,["serverContent"],z0(i));const o=a(n,["toolCall"]);o!=null&&s(e,["toolCall"],ep(o));const r=a(n,["toolCallCancellation"]);r!=null&&s(e,["toolCallCancellation"],Q0(r));const l=a(n,["usageMetadata"]);l!=null&&s(e,["usageMetadata"],Tp(l));const h=a(n,["goAway"]);h!=null&&s(e,["goAway"],W0(h));const c=a(n,["sessionResumptionUpdate"]);return c!=null&&s(e,["sessionResumptionUpdate"],K0(c)),e}function X0(n){const e={},t=a(n,["newHandle"]);t!=null&&s(e,["newHandle"],t);const i=a(n,["resumable"]);i!=null&&s(e,["resumable"],i);const o=a(n,["lastConsumedClientMessageIndex"]);return o!=null&&s(e,["lastConsumedClientMessageIndex"],o),e}function K0(n){const e={},t=a(n,["newHandle"]);t!=null&&s(e,["newHandle"],t);const i=a(n,["resumable"]);i!=null&&s(e,["resumable"],i);const o=a(n,["lastConsumedClientMessageIndex"]);return o!=null&&s(e,["lastConsumedClientMessageIndex"],o),e}function Y0(){return{}}function $0(n){const e={},t=a(n,["sessionId"]);return t!=null&&s(e,["sessionId"],t),e}function Z0(n){const e={},t=a(n,["ids"]);return t!=null&&s(e,["ids"],t),e}function Q0(n){const e={},t=a(n,["ids"]);return t!=null&&s(e,["ids"],t),e}function j0(n){const e={},t=a(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>yc(o))),s(e,["functionCalls"],i)}return e}function ep(n){const e={},t=a(n,["functionCalls"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>vc(o))),s(e,["functionCalls"],i)}return e}function _o(n){const e={},t=a(n,["modality"]);t!=null&&s(e,["modality"],t);const i=a(n,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function To(n){const e={},t=a(n,["modality"]);t!=null&&s(e,["modality"],t);const i=a(n,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function tp(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>xp(o))),s(e,["speakerVoiceConfigs"],i)}return e}function np(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Fp(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],$m(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],d0(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],yc(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function ip(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Dp(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Zm(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],u0(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],vc(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function op(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Mp(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Qm(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],f0(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],p0(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function rp(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Pp(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],jm(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],m0(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],x0(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function ap(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function sp(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function lp(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function hp(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function cp(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],Km(t));const i=a(n,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const o=a(n,["turnCoverage"]);return o!=null&&s(e,["turnCoverage"],o),e}function dp(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],Ym(t));const i=a(n,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const o=a(n,["turnCoverage"]);return o!=null&&s(e,["turnCoverage"],o),e}function up(n){const e={},t=a(n,["handle"]);if(t!=null&&s(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function fp(n){const e={},t=a(n,["handle"]);t!=null&&s(e,["handle"],t);const i=a(n,["transparent"]);return i!=null&&s(e,["transparent"],i),e}function mp(n){const e={},t=a(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function pp(n){const e={},t=a(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function xp(n){const e={},t=a(n,["speaker"]);t!=null&&s(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&s(e,["voiceConfig"],Ac(i)),e}function gp(n){const e={},t=a(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],Ac(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&s(e,["multiSpeakerVoiceConfig"],tp(i));const o=a(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function bp(n){const e={},t=a(n,["voiceConfig"]);if(t!=null&&s(e,["voiceConfig"],kp(t)),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function yp(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function vp(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function wp(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>g0(d))),s(e,["functionDeclarations"],c)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],E0(i));const o=a(n,["googleSearchRetrieval"]);if(o!=null&&s(e,["googleSearchRetrieval"],v0(o)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&s(e,["urlContext"],Ap());const l=a(n,["computerUse"]);l!=null&&s(e,["computerUse"],e0(l));const h=a(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function Ep(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(m=>b0(m))),s(e,["functionDeclarations"],f)}const i=a(n,["retrieval"]);i!=null&&s(e,["retrieval"],i);const o=a(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],C0(o));const r=a(n,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],w0(r));const l=a(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],c0(l));const h=a(n,["googleMaps"]);h!=null&&s(e,["googleMaps"],y0(h)),a(n,["urlContext"])!=null&&s(e,["urlContext"],Sp());const d=a(n,["computerUse"]);d!=null&&s(e,["computerUse"],t0(d));const u=a(n,["codeExecution"]);return u!=null&&s(e,["codeExecution"],u),e}function Wl(n){const e={},t=a(n,["text"]);t!=null&&s(e,["text"],t);const i=a(n,["finished"]);return i!=null&&s(e,["finished"],i),e}function Jl(n){const e={},t=a(n,["text"]);t!=null&&s(e,["text"],t);const i=a(n,["finished"]);return i!=null&&s(e,["finished"],i),e}function Cp(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Bp(o))),s(e,["urlMetadata"],i)}return e}function Ap(){return{}}function Sp(){return{}}function Bp(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&s(e,["urlRetrievalStatus"],i),e}function _p(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&s(e,["promptTokenCount"],t);const i=a(n,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const o=a(n,["responseTokenCount"]);o!=null&&s(e,["responseTokenCount"],o);const r=a(n,["toolUsePromptTokenCount"]);r!=null&&s(e,["toolUsePromptTokenCount"],r);const l=a(n,["thoughtsTokenCount"]);l!=null&&s(e,["thoughtsTokenCount"],l);const h=a(n,["totalTokenCount"]);h!=null&&s(e,["totalTokenCount"],h);const c=a(n,["promptTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(p=>_o(p))),s(e,["promptTokensDetails"],m)}const d=a(n,["cacheTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(p=>_o(p))),s(e,["cacheTokensDetails"],m)}const u=a(n,["responseTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(p=>_o(p))),s(e,["responseTokensDetails"],m)}const f=a(n,["toolUsePromptTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(p=>_o(p))),s(e,["toolUsePromptTokensDetails"],m)}return e}function Tp(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&s(e,["promptTokenCount"],t);const i=a(n,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const o=a(n,["candidatesTokenCount"]);o!=null&&s(e,["responseTokenCount"],o);const r=a(n,["toolUsePromptTokenCount"]);r!=null&&s(e,["toolUsePromptTokenCount"],r);const l=a(n,["thoughtsTokenCount"]);l!=null&&s(e,["thoughtsTokenCount"],l);const h=a(n,["totalTokenCount"]);h!=null&&s(e,["totalTokenCount"],h);const c=a(n,["promptTokensDetails"]);if(c!=null){let p=c;Array.isArray(p)&&(p=p.map(b=>To(b))),s(e,["promptTokensDetails"],p)}const d=a(n,["cacheTokensDetails"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(b=>To(b))),s(e,["cacheTokensDetails"],p)}const u=a(n,["candidatesTokensDetails"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(b=>To(b))),s(e,["responseTokensDetails"],p)}const f=a(n,["toolUsePromptTokensDetails"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(b=>To(b))),s(e,["toolUsePromptTokensDetails"],p)}const m=a(n,["trafficType"]);return m!=null&&s(e,["trafficType"],m),e}function Fp(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Dp(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Mp(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Pp(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Ac(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],ap(t)),e}function kp(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],sp(t)),e}function Ip(n){const e={},t=a(n,["text"]);t!=null&&s(e,["text"],t);const i=a(n,["weight"]);return i!=null&&s(e,["weight"],i),e}function Sc(n){const e={},t=a(n,["text"]);t!=null&&s(e,["text"],t);const i=a(n,["weight"]);return i!=null&&s(e,["weight"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Rp(n){const e={},t=a(n,["apiKeyString"]);return t!=null&&s(e,["apiKeyString"],t),e}function Np(n){const e={},t=a(n,["apiKeyConfig"]);t!=null&&s(e,["apiKeyConfig"],Rp(t));const i=a(n,["authType"]);i!=null&&s(e,["authType"],i);const o=a(n,["googleServiceAccountConfig"]);o!=null&&s(e,["googleServiceAccountConfig"],o);const r=a(n,["httpBasicAuthConfig"]);r!=null&&s(e,["httpBasicAuthConfig"],r);const l=a(n,["oauthConfig"]);l!=null&&s(e,["oauthConfig"],l);const h=a(n,["oidcConfig"]);return h!=null&&s(e,["oidcConfig"],h),e}function Lp(n){const e={},t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Hp(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["data"]);i!=null&&s(e,["data"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Gp(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Up(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["data"]);i!=null&&s(e,["data"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Op(n){const e={},t=a(n,["content"]);t!=null&&s(e,["content"],jp(t));const i=a(n,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],Wp(i));const o=a(n,["tokenCount"]);o!=null&&s(e,["tokenCount"],o);const r=a(n,["finishReason"]);r!=null&&s(e,["finishReason"],r);const l=a(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],yb(l));const h=a(n,["avgLogprobs"]);h!=null&&s(e,["avgLogprobs"],h);const c=a(n,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const d=a(n,["index"]);d!=null&&s(e,["index"],d);const u=a(n,["logprobsResult"]);u!=null&&s(e,["logprobsResult"],u);const f=a(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function zp(n){const e={},t=a(n,["content"]);t!=null&&s(e,["content"],ex(t));const i=a(n,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],Jp(i));const o=a(n,["finishMessage"]);o!=null&&s(e,["finishMessage"],o);const r=a(n,["finishReason"]);r!=null&&s(e,["finishReason"],r);const l=a(n,["urlContextMetadata"]);l!=null&&s(e,["urlContextMetadata"],vb(l));const h=a(n,["avgLogprobs"]);h!=null&&s(e,["avgLogprobs"],h);const c=a(n,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const d=a(n,["index"]);d!=null&&s(e,["index"],d);const u=a(n,["logprobsResult"]);u!=null&&s(e,["logprobsResult"],u);const f=a(n,["safetyRatings"]);return f!=null&&s(e,["safetyRatings"],f),e}function Vp(n){const e={},t=a(n,["checkpointId"]);t!=null&&s(e,["checkpointId"],t);const i=a(n,["epoch"]);i!=null&&s(e,["epoch"],i);const o=a(n,["step"]);return o!=null&&s(e,["step"],o),e}function Wp(n){const e={},t=a(n,["citationSources"]);return t!=null&&s(e,["citations"],t),e}function Jp(n){const e={},t=a(n,["citations"]);return t!=null&&s(e,["citations"],t),e}function qp(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let r=tn(o);Array.isArray(r)&&(r=r.map(l=>Vi(l))),s(t,["contents"],r)}return t}function Xp(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["tokensInfo"]);return i!=null&&s(e,["tokensInfo"],i),e}function Kp(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function Yp(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function $p(n){const e={},t=a(n,["values"]);return t!=null&&s(e,["values"],t),e}function Zp(n){const e={},t=a(n,["values"]);t!=null&&s(e,["values"],t);const i=a(n,["statistics"]);return i!=null&&s(e,["statistics"],Qp(i)),e}function Qp(n){const e={},t=a(n,["truncated"]);t!=null&&s(e,["truncated"],t);const i=a(n,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function jp(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>Mg(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function ex(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>Pg(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function vr(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>kg(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function Vi(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>Ig(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function tx(n){const e={},t=a(n,["controlType"]);t!=null&&s(e,["controlType"],t);const i=a(n,["enableControlImageComputation"]);return i!=null&&s(e,["computeControl"],i),e}function nx(n){const e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function ix(n,e){const t={},i=a(n,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],Vi(It(i)));const o=a(n,["tools"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(h=>Dc(h))),s(e,["tools"],l)}const r=a(n,["generationConfig"]);return e!==void 0&&r!=null&&s(e,["generationConfig"],r),t}function ox(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let l=tn(o);Array.isArray(l)&&(l=l.map(h=>vr(h))),s(t,["contents"],l)}const r=a(e,["config"]);return r!=null&&nx(r),t}function rx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let l=tn(o);Array.isArray(l)&&(l=l.map(h=>Vi(h))),s(t,["contents"],l)}const r=a(e,["config"]);return r!=null&&ix(r,t),t}function ax(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["totalTokens"]);i!=null&&s(e,["totalTokens"],i);const o=a(n,["cachedContentTokenCount"]);return o!=null&&s(e,["cachedContentTokenCount"],o),e}function sx(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["totalTokens"]);return i!=null&&s(e,["totalTokens"],i),e}function lx(n,e){const t={},i=a(e,["model"]);return i!=null&&s(t,["_url","name"],dt(n,i)),t}function hx(n,e){const t={},i=a(e,["model"]);return i!=null&&s(t,["_url","name"],dt(n,i)),t}function cx(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function dx(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&s(e,["sdkHttpResponse"],t),e}function ux(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function fx(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function mx(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&s(e,["parameters","negativePrompt"],o);const r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&s(e,["parameters","sampleCount"],r);const l=a(n,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const h=a(n,["guidanceScale"]);e!==void 0&&h!=null&&s(e,["parameters","guidanceScale"],h);const c=a(n,["seed"]);e!==void 0&&c!=null&&s(e,["parameters","seed"],c);const d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const u=a(n,["personGeneration"]);e!==void 0&&u!=null&&s(e,["parameters","personGeneration"],u);const f=a(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&s(e,["parameters","includeSafetyAttributes"],f);const m=a(n,["includeRaiReason"]);e!==void 0&&m!=null&&s(e,["parameters","includeRaiReason"],m);const p=a(n,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const b=a(n,["outputMimeType"]);e!==void 0&&b!=null&&s(e,["parameters","outputOptions","mimeType"],b);const E=a(n,["outputCompressionQuality"]);e!==void 0&&E!=null&&s(e,["parameters","outputOptions","compressionQuality"],E);const g=a(n,["addWatermark"]);e!==void 0&&g!=null&&s(e,["parameters","addWatermark"],g);const x=a(n,["editMode"]);e!==void 0&&x!=null&&s(e,["parameters","editMode"],x);const T=a(n,["baseSteps"]);return e!==void 0&&T!=null&&s(e,["parameters","editConfig","baseSteps"],T),t}function px(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["referenceImages"]);if(r!=null){let h=r;Array.isArray(h)&&(h=h.map(c=>zg(c))),s(t,["instances[0]","referenceImages"],h)}const l=a(e,["config"]);return l!=null&&mx(l,t),t}function xx(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>wr(r))),s(e,["generatedImages"],o)}return e}function gx(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&s(e,["requests[]","title"],o);const r=a(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&s(e,["requests[]","outputDimensionality"],r),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function bx(n,e){const t={},i=a(n,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const o=a(n,["title"]);e!==void 0&&o!=null&&s(e,["instances[]","title"],o);const r=a(n,["outputDimensionality"]);e!==void 0&&r!=null&&s(e,["parameters","outputDimensionality"],r);const l=a(n,["mimeType"]);e!==void 0&&l!=null&&s(e,["instances[]","mimeType"],l);const h=a(n,["autoTruncate"]);return e!==void 0&&h!=null&&s(e,["parameters","autoTruncate"],h),t}function yx(){return{}}function vx(n){const e={},t=a(n,["billableCharacterCount"]);return t!=null&&s(e,["billableCharacterCount"],t),e}function wx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);o!=null&&s(t,["requests[]","content"],ms(n,o));const r=a(e,["config"]);r!=null&&gx(r,t);const l=a(e,["model"]);return l!==void 0&&s(t,["requests[]","model"],dt(n,l)),t}function Ex(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);o!=null&&s(t,["instances[]","content"],ms(n,o));const r=a(e,["config"]);return r!=null&&bx(r,t),t}function Cx(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["embeddings"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>$p(l))),s(e,["embeddings"],r)}return a(n,["metadata"])!=null&&s(e,["metadata"],yx()),e}function Ax(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["predictions[]","embeddings"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>Zp(l))),s(e,["embeddings"],r)}const o=a(n,["metadata"]);return o!=null&&s(e,["metadata"],vx(o)),e}function Sx(n){const e={},t=a(n,["endpoint"]);t!=null&&s(e,["name"],t);const i=a(n,["deployedModelId"]);return i!=null&&s(e,["deployedModelId"],i),e}function Bx(n){const e={},t=a(n,["excludeDomains"]);return t!=null&&s(e,["excludeDomains"],t),e}function _x(n){const e={},t=a(n,["label"]);t!=null&&s(e,["label"],t);const i=a(n,["score"]);return i!=null&&s(e,["score"],i),e}function Tx(n){const e={},t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Fx(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&s(e,["fileUri"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Dx(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Mx(n){const e={},t=a(n,["displayName"]);t!=null&&s(e,["displayName"],t);const i=a(n,["fileUri"]);i!=null&&s(e,["fileUri"],i);const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Px(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function kx(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Ix(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Rx(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function Nx(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Lx(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Hx(n){const e={},t=a(n,["behavior"]);t!=null&&s(e,["behavior"],t);const i=a(n,["description"]);i!=null&&s(e,["description"],i);const o=a(n,["name"]);o!=null&&s(e,["name"],o);const r=a(n,["parameters"]);r!=null&&s(e,["parameters"],r);const l=a(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const h=a(n,["response"]);h!=null&&s(e,["response"],h);const c=a(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function Gx(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&s(e,["description"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["parameters"]);o!=null&&s(e,["parameters"],o);const r=a(n,["parametersJsonSchema"]);r!=null&&s(e,["parametersJsonSchema"],r);const l=a(n,["response"]);l!=null&&s(e,["response"],l);const h=a(n,["responseJsonSchema"]);return h!=null&&s(e,["responseJsonSchema"],h),e}function Ux(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],vr(It(o)));const r=a(e,["temperature"]);r!=null&&s(i,["temperature"],r);const l=a(e,["topP"]);l!=null&&s(i,["topP"],l);const h=a(e,["topK"]);h!=null&&s(i,["topK"],h);const c=a(e,["candidateCount"]);c!=null&&s(i,["candidateCount"],c);const d=a(e,["maxOutputTokens"]);d!=null&&s(i,["maxOutputTokens"],d);const u=a(e,["stopSequences"]);u!=null&&s(i,["stopSequences"],u);const f=a(e,["responseLogprobs"]);f!=null&&s(i,["responseLogprobs"],f);const m=a(e,["logprobs"]);m!=null&&s(i,["logprobs"],m);const p=a(e,["presencePenalty"]);p!=null&&s(i,["presencePenalty"],p);const b=a(e,["frequencyPenalty"]);b!=null&&s(i,["frequencyPenalty"],b);const E=a(e,["seed"]);E!=null&&s(i,["seed"],E);const g=a(e,["responseMimeType"]);g!=null&&s(i,["responseMimeType"],g);const x=a(e,["responseSchema"]);x!=null&&s(i,["responseSchema"],Xg(ps(x)));const T=a(e,["responseJsonSchema"]);if(T!=null&&s(i,["responseJsonSchema"],T),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=a(e,["safetySettings"]);if(t!==void 0&&C!=null){let U=C;Array.isArray(U)&&(U=U.map(z=>Jg(z))),s(t,["safetySettings"],U)}const y=a(e,["tools"]);if(t!==void 0&&y!=null){let U=Oi(y);Array.isArray(U)&&(U=U.map(z=>hb(Ui(z)))),s(t,["tools"],U)}const F=a(e,["toolConfig"]);if(t!==void 0&&F!=null&&s(t,["toolConfig"],sb(F)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const _=a(e,["cachedContent"]);t!==void 0&&_!=null&&s(t,["cachedContent"],In(n,_));const B=a(e,["responseModalities"]);B!=null&&s(i,["responseModalities"],B);const P=a(e,["mediaResolution"]);P!=null&&s(i,["mediaResolution"],P);const A=a(e,["speechConfig"]);if(A!=null&&s(i,["speechConfig"],tb(xs(A))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const S=a(e,["thinkingConfig"]);S!=null&&s(i,["thinkingConfig"],rb(S));const R=a(e,["imageConfig"]);return R!=null&&s(i,["imageConfig"],pg(R)),i}function Ox(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],Vi(It(o)));const r=a(e,["temperature"]);r!=null&&s(i,["temperature"],r);const l=a(e,["topP"]);l!=null&&s(i,["topP"],l);const h=a(e,["topK"]);h!=null&&s(i,["topK"],h);const c=a(e,["candidateCount"]);c!=null&&s(i,["candidateCount"],c);const d=a(e,["maxOutputTokens"]);d!=null&&s(i,["maxOutputTokens"],d);const u=a(e,["stopSequences"]);u!=null&&s(i,["stopSequences"],u);const f=a(e,["responseLogprobs"]);f!=null&&s(i,["responseLogprobs"],f);const m=a(e,["logprobs"]);m!=null&&s(i,["logprobs"],m);const p=a(e,["presencePenalty"]);p!=null&&s(i,["presencePenalty"],p);const b=a(e,["frequencyPenalty"]);b!=null&&s(i,["frequencyPenalty"],b);const E=a(e,["seed"]);E!=null&&s(i,["seed"],E);const g=a(e,["responseMimeType"]);g!=null&&s(i,["responseMimeType"],g);const x=a(e,["responseSchema"]);x!=null&&s(i,["responseSchema"],Kg(ps(x)));const T=a(e,["responseJsonSchema"]);T!=null&&s(i,["responseJsonSchema"],T);const C=a(e,["routingConfig"]);C!=null&&s(i,["routingConfig"],C);const y=a(e,["modelSelectionConfig"]);y!=null&&s(i,["modelConfig"],Fg(y));const F=a(e,["safetySettings"]);if(t!==void 0&&F!=null){let X=F;Array.isArray(X)&&(X=X.map(ee=>qg(ee))),s(t,["safetySettings"],X)}const _=a(e,["tools"]);if(t!==void 0&&_!=null){let X=Oi(_);Array.isArray(X)&&(X=X.map(ee=>Dc(Ui(ee)))),s(t,["tools"],X)}const B=a(e,["toolConfig"]);t!==void 0&&B!=null&&s(t,["toolConfig"],lb(B));const P=a(e,["labels"]);t!==void 0&&P!=null&&s(t,["labels"],P);const A=a(e,["cachedContent"]);t!==void 0&&A!=null&&s(t,["cachedContent"],In(n,A));const S=a(e,["responseModalities"]);S!=null&&s(i,["responseModalities"],S);const R=a(e,["mediaResolution"]);R!=null&&s(i,["mediaResolution"],R);const U=a(e,["speechConfig"]);U!=null&&s(i,["speechConfig"],nb(xs(U)));const z=a(e,["audioTimestamp"]);z!=null&&s(i,["audioTimestamp"],z);const J=a(e,["thinkingConfig"]);J!=null&&s(i,["thinkingConfig"],ab(J));const Y=a(e,["imageConfig"]);return Y!=null&&s(i,["imageConfig"],xg(Y)),i}function ql(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let l=tn(o);Array.isArray(l)&&(l=l.map(h=>vr(h))),s(t,["contents"],l)}const r=a(e,["config"]);return r!=null&&s(t,["generationConfig"],Ux(n,r,t)),t}function Xl(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["contents"]);if(o!=null){let l=tn(o);Array.isArray(l)&&(l=l.map(h=>Vi(h))),s(t,["contents"],l)}const r=a(e,["config"]);return r!=null&&s(t,["generationConfig"],Ox(n,r,t)),t}function Kl(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let c=i;Array.isArray(c)&&(c=c.map(d=>Op(d))),s(e,["candidates"],c)}const o=a(n,["modelVersion"]);o!=null&&s(e,["modelVersion"],o);const r=a(n,["promptFeedback"]);r!=null&&s(e,["promptFeedback"],r);const l=a(n,["responseId"]);l!=null&&s(e,["responseId"],l);const h=a(n,["usageMetadata"]);return h!=null&&s(e,["usageMetadata"],h),e}function Yl(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["candidates"]);if(i!=null){let d=i;Array.isArray(d)&&(d=d.map(u=>zp(u))),s(e,["candidates"],d)}const o=a(n,["createTime"]);o!=null&&s(e,["createTime"],o);const r=a(n,["modelVersion"]);r!=null&&s(e,["modelVersion"],r);const l=a(n,["promptFeedback"]);l!=null&&s(e,["promptFeedback"],l);const h=a(n,["responseId"]);h!=null&&s(e,["responseId"],h);const c=a(n,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function zx(n,e){const t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&s(e,["parameters","aspectRatio"],o);const r=a(n,["guidanceScale"]);if(e!==void 0&&r!=null&&s(e,["parameters","guidanceScale"],r),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=a(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&s(e,["parameters","safetySetting"],l);const h=a(n,["personGeneration"]);e!==void 0&&h!=null&&s(e,["parameters","personGeneration"],h);const c=a(n,["includeSafetyAttributes"]);e!==void 0&&c!=null&&s(e,["parameters","includeSafetyAttributes"],c);const d=a(n,["includeRaiReason"]);e!==void 0&&d!=null&&s(e,["parameters","includeRaiReason"],d);const u=a(n,["language"]);e!==void 0&&u!=null&&s(e,["parameters","language"],u);const f=a(n,["outputMimeType"]);e!==void 0&&f!=null&&s(e,["parameters","outputOptions","mimeType"],f);const m=a(n,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&s(e,["parameters","outputOptions","compressionQuality"],m),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");const p=a(n,["imageSize"]);if(e!==void 0&&p!=null&&s(e,["parameters","sampleImageSize"],p),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Vx(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const o=a(n,["negativePrompt"]);e!==void 0&&o!=null&&s(e,["parameters","negativePrompt"],o);const r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&s(e,["parameters","sampleCount"],r);const l=a(n,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const h=a(n,["guidanceScale"]);e!==void 0&&h!=null&&s(e,["parameters","guidanceScale"],h);const c=a(n,["seed"]);e!==void 0&&c!=null&&s(e,["parameters","seed"],c);const d=a(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const u=a(n,["personGeneration"]);e!==void 0&&u!=null&&s(e,["parameters","personGeneration"],u);const f=a(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&s(e,["parameters","includeSafetyAttributes"],f);const m=a(n,["includeRaiReason"]);e!==void 0&&m!=null&&s(e,["parameters","includeRaiReason"],m);const p=a(n,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const b=a(n,["outputMimeType"]);e!==void 0&&b!=null&&s(e,["parameters","outputOptions","mimeType"],b);const E=a(n,["outputCompressionQuality"]);e!==void 0&&E!=null&&s(e,["parameters","outputOptions","compressionQuality"],E);const g=a(n,["addWatermark"]);e!==void 0&&g!=null&&s(e,["parameters","addWatermark"],g);const x=a(n,["imageSize"]);e!==void 0&&x!=null&&s(e,["parameters","sampleImageSize"],x);const T=a(n,["enhancePrompt"]);return e!==void 0&&T!=null&&s(e,["parameters","enhancePrompt"],T),t}function Wx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["config"]);return r!=null&&zx(r,t),t}function Jx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["config"]);return r!=null&&Vx(r,t),t}function qx(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>og(l))),s(e,["generatedImages"],r)}const o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&s(e,["positivePromptSafetyAttributes"],Tc(o)),e}function Xx(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(l=>wr(l))),s(e,["generatedImages"],r)}const o=a(n,["positivePromptSafetyAttributes"]);return o!=null&&s(e,["positivePromptSafetyAttributes"],Fc(o)),e}function Kx(n,e){const t={},i=a(n,["numberOfVideos"]);if(e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=a(n,["durationSeconds"]);if(e!==void 0&&o!=null&&s(e,["parameters","durationSeconds"],o),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&s(e,["parameters","aspectRatio"],r);const l=a(n,["resolution"]);e!==void 0&&l!=null&&s(e,["parameters","resolution"],l);const h=a(n,["personGeneration"]);if(e!==void 0&&h!=null&&s(e,["parameters","personGeneration"],h),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=a(n,["negativePrompt"]);e!==void 0&&c!=null&&s(e,["parameters","negativePrompt"],c);const d=a(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&s(e,["parameters","enhancePrompt"],d),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(a(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");if(a(n,["referenceImages"])!==void 0)throw new Error("referenceImages parameter is not supported in Gemini API.");if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function Yx(n,e){const t={},i=a(n,["numberOfVideos"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const o=a(n,["outputGcsUri"]);e!==void 0&&o!=null&&s(e,["parameters","storageUri"],o);const r=a(n,["fps"]);e!==void 0&&r!=null&&s(e,["parameters","fps"],r);const l=a(n,["durationSeconds"]);e!==void 0&&l!=null&&s(e,["parameters","durationSeconds"],l);const h=a(n,["seed"]);e!==void 0&&h!=null&&s(e,["parameters","seed"],h);const c=a(n,["aspectRatio"]);e!==void 0&&c!=null&&s(e,["parameters","aspectRatio"],c);const d=a(n,["resolution"]);e!==void 0&&d!=null&&s(e,["parameters","resolution"],d);const u=a(n,["personGeneration"]);e!==void 0&&u!=null&&s(e,["parameters","personGeneration"],u);const f=a(n,["pubsubTopic"]);e!==void 0&&f!=null&&s(e,["parameters","pubsubTopic"],f);const m=a(n,["negativePrompt"]);e!==void 0&&m!=null&&s(e,["parameters","negativePrompt"],m);const p=a(n,["enhancePrompt"]);e!==void 0&&p!=null&&s(e,["parameters","enhancePrompt"],p);const b=a(n,["generateAudio"]);e!==void 0&&b!=null&&s(e,["parameters","generateAudio"],b);const E=a(n,["lastFrame"]);e!==void 0&&E!=null&&s(e,["instances[0]","lastFrame"],fn(E));const g=a(n,["referenceImages"]);if(e!==void 0&&g!=null){let C=g;Array.isArray(C)&&(C=C.map(y=>Tb(y))),s(e,["instances[0]","referenceImages"],C)}const x=a(n,["mask"]);e!==void 0&&x!=null&&s(e,["instances[0]","mask"],_b(x));const T=a(n,["compressionQuality"]);return e!==void 0&&T!=null&&s(e,["parameters","compressionQuality"],T),t}function $x(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["metadata"]);i!=null&&s(e,["metadata"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);r!=null&&s(e,["error"],r);const l=a(n,["response","generateVideoResponse"]);return l!=null&&s(e,["response"],eg(l)),e}function Zx(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["metadata"]);i!=null&&s(e,["metadata"],i);const o=a(n,["done"]);o!=null&&s(e,["done"],o);const r=a(n,["error"]);r!=null&&s(e,["error"],r);const l=a(n,["response"]);return l!=null&&s(e,["response"],tg(l)),e}function Qx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["image"]);if(r!=null&&s(t,["instances[0]","image"],_c(r)),a(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const l=a(e,["source"]);l!=null&&ng(l,t);const h=a(e,["config"]);return h!=null&&Kx(h,t),t}function jx(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["image"]);r!=null&&s(t,["instances[0]","image"],fn(r));const l=a(e,["video"]);l!=null&&s(t,["instances[0]","video"],Mc(l));const h=a(e,["source"]);h!=null&&ig(h,t);const c=a(e,["config"]);return c!=null&&Yx(c,t),t}function eg(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(l=>ag(l))),s(e,["generatedVideos"],r)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&s(e,["raiMediaFilteredReasons"],o),e}function tg(n){const e={},t=a(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(l=>sg(l))),s(e,["generatedVideos"],r)}const i=a(n,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const o=a(n,["raiMediaFilteredReasons"]);return o!=null&&s(e,["raiMediaFilteredReasons"],o),e}function ng(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&s(e,["instances[0]","prompt"],i);const o=a(n,["image"]);if(e!==void 0&&o!=null&&s(e,["instances[0]","image"],_c(o)),a(n,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");return t}function ig(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&s(e,["instances[0]","prompt"],i);const o=a(n,["image"]);e!==void 0&&o!=null&&s(e,["instances[0]","image"],fn(o));const r=a(n,["video"]);return e!==void 0&&r!=null&&s(e,["instances[0]","video"],Mc(r)),t}function og(n){const e={},t=a(n,["_self"]);t!=null&&s(e,["image"],gg(t));const i=a(n,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const o=a(n,["_self"]);return o!=null&&s(e,["safetyAttributes"],Tc(o)),e}function wr(n){const e={},t=a(n,["_self"]);t!=null&&s(e,["image"],Bc(t));const i=a(n,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const o=a(n,["_self"]);o!=null&&s(e,["safetyAttributes"],Fc(o));const r=a(n,["prompt"]);return r!=null&&s(e,["enhancedPrompt"],r),e}function rg(n){const e={},t=a(n,["_self"]);t!=null&&s(e,["mask"],Bc(t));const i=a(n,["labels"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>_x(r))),s(e,["labels"],o)}return e}function ag(n){const e={},t=a(n,["_self"]);return t!=null&&s(e,["video"],Sb(t)),e}function sg(n){const e={},t=a(n,["_self"]);return t!=null&&s(e,["video"],Bb(t)),e}function lg(n,e){const t={},i=a(e,["model"]);return i!=null&&s(t,["_url","name"],dt(n,i)),t}function hg(n,e){const t={},i=a(e,["model"]);return i!=null&&s(t,["_url","name"],dt(n,i)),t}function cg(n){const e={},t=a(n,["authConfig"]);return t!=null&&s(e,["authConfig"],Np(t)),e}function dg(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],ux(t)),e}function ug(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],fx(t)),e}function fg(n){const e={},t=a(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],bg(t)),a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function mg(n){const e={},t=a(n,["timeRangeFilter"]);t!=null&&s(e,["timeRangeFilter"],yg(t));const i=a(n,["excludeDomains"]);return i!=null&&s(e,["excludeDomains"],i),e}function pg(n){const e={},t=a(n,["aspectRatio"]);return t!=null&&s(e,["aspectRatio"],t),e}function xg(n){const e={},t=a(n,["aspectRatio"]);return t!=null&&s(e,["aspectRatio"],t),e}function gg(n){const e={},t=a(n,["bytesBase64Encoded"]);t!=null&&s(e,["imageBytes"],hi(t));const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Bc(n){const e={},t=a(n,["gcsUri"]);t!=null&&s(e,["gcsUri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],hi(i));const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function _c(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=a(n,["imageBytes"]);t!=null&&s(e,["bytesBase64Encoded"],hi(t));const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function fn(n){const e={},t=a(n,["gcsUri"]);t!=null&&s(e,["gcsUri"],t);const i=a(n,["imageBytes"]);i!=null&&s(e,["bytesBase64Encoded"],hi(i));const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function bg(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function yg(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function vg(n){const e={},t=a(n,["latitude"]);t!=null&&s(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function wg(n){const e={},t=a(n,["latitude"]);t!=null&&s(e,["latitude"],t);const i=a(n,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function Eg(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&s(t,["_query","pageSize"],o);const r=a(e,["pageToken"]);t!==void 0&&r!=null&&s(t,["_query","pageToken"],r);const l=a(e,["filter"]);t!==void 0&&l!=null&&s(t,["_query","filter"],l);const h=a(e,["queryBase"]);return t!==void 0&&h!=null&&s(t,["_url","models_url"],cc(n,h)),i}function Cg(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&s(t,["_query","pageSize"],o);const r=a(e,["pageToken"]);t!==void 0&&r!=null&&s(t,["_query","pageToken"],r);const l=a(e,["filter"]);t!==void 0&&l!=null&&s(t,["_query","filter"],l);const h=a(e,["queryBase"]);return t!==void 0&&h!=null&&s(t,["_url","models_url"],cc(n,h)),i}function Ag(n,e){const t={},i=a(e,["config"]);return i!=null&&Eg(n,i,t),t}function Sg(n,e){const t={},i=a(e,["config"]);return i!=null&&Cg(n,i,t),t}function Bg(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["_self"]);if(o!=null){let r=dc(o);Array.isArray(r)&&(r=r.map(l=>ma(l))),s(e,["models"],r)}return e}function _g(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["_self"]);if(o!=null){let r=dc(o);Array.isArray(r)&&(r=r.map(l=>pa(l))),s(e,["models"],r)}return e}function Tg(n){const e={},t=a(n,["maskMode"]);t!=null&&s(e,["maskMode"],t);const i=a(n,["segmentationClasses"]);i!=null&&s(e,["maskClasses"],i);const o=a(n,["maskDilation"]);return o!=null&&s(e,["dilation"],o),e}function ma(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["description"]);o!=null&&s(e,["description"],o);const r=a(n,["version"]);r!=null&&s(e,["version"],r);const l=a(n,["_self"]);l!=null&&s(e,["tunedModelInfo"],cb(l));const h=a(n,["inputTokenLimit"]);h!=null&&s(e,["inputTokenLimit"],h);const c=a(n,["outputTokenLimit"]);c!=null&&s(e,["outputTokenLimit"],c);const d=a(n,["supportedGenerationMethods"]);return d!=null&&s(e,["supportedActions"],d),e}function pa(n){const e={},t=a(n,["name"]);t!=null&&s(e,["name"],t);const i=a(n,["displayName"]);i!=null&&s(e,["displayName"],i);const o=a(n,["description"]);o!=null&&s(e,["description"],o);const r=a(n,["versionId"]);r!=null&&s(e,["version"],r);const l=a(n,["deployedModels"]);if(l!=null){let f=l;Array.isArray(f)&&(f=f.map(m=>Sx(m))),s(e,["endpoints"],f)}const h=a(n,["labels"]);h!=null&&s(e,["labels"],h);const c=a(n,["_self"]);c!=null&&s(e,["tunedModelInfo"],db(c));const d=a(n,["defaultCheckpointId"]);d!=null&&s(e,["defaultCheckpointId"],d);const u=a(n,["checkpoints"]);if(u!=null){let f=u;Array.isArray(f)&&(f=f.map(m=>Vp(m))),s(e,["checkpoints"],f)}return e}function Fg(n){const e={},t=a(n,["featureSelectionPreference"]);return t!=null&&s(e,["featureSelectionPreference"],t),e}function Dg(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>eb(o))),s(e,["speakerVoiceConfigs"],i)}return e}function Mg(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Fb(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Lp(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Tx(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Px(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function Pg(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Db(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Hp(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Fx(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],kx(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function kg(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Mb(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Gp(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Dx(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Ix(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function Ig(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Pb(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],Up(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],Mx(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],Rx(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function Rg(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Ng(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Lg(n){const e={},t=a(n,["productImage"]);return t!=null&&s(e,["image"],fn(t)),e}function Hg(n,e){const t={},i=a(n,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const o=a(n,["baseSteps"]);e!==void 0&&o!=null&&s(e,["parameters","editConfig","baseSteps"],o);const r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&s(e,["parameters","storageUri"],r);const l=a(n,["seed"]);e!==void 0&&l!=null&&s(e,["parameters","seed"],l);const h=a(n,["safetyFilterLevel"]);e!==void 0&&h!=null&&s(e,["parameters","safetySetting"],h);const c=a(n,["personGeneration"]);e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c);const d=a(n,["addWatermark"]);e!==void 0&&d!=null&&s(e,["parameters","addWatermark"],d);const u=a(n,["outputMimeType"]);e!==void 0&&u!=null&&s(e,["parameters","outputOptions","mimeType"],u);const f=a(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&s(e,["parameters","outputOptions","compressionQuality"],f);const m=a(n,["enhancePrompt"]);return e!==void 0&&m!=null&&s(e,["parameters","enhancePrompt"],m),t}function Gg(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["source"]);o!=null&&Og(o,t);const r=a(e,["config"]);return r!=null&&Hg(r,t),t}function Ug(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>wr(o))),s(e,["generatedImages"],i)}return e}function Og(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&s(e,["instances[0]","prompt"],i);const o=a(n,["personImage"]);e!==void 0&&o!=null&&s(e,["instances[0]","personImage","image"],fn(o));const r=a(n,["productImages"]);if(e!==void 0&&r!=null){let l=r;Array.isArray(l)&&(l=l.map(h=>Lg(h))),s(e,["instances[0]","productImages"],l)}return t}function zg(n){const e={},t=a(n,["referenceImage"]);t!=null&&s(e,["referenceImage"],fn(t));const i=a(n,["referenceId"]);i!=null&&s(e,["referenceId"],i);const o=a(n,["referenceType"]);o!=null&&s(e,["referenceType"],o);const r=a(n,["maskImageConfig"]);r!=null&&s(e,["maskImageConfig"],Tg(r));const l=a(n,["controlImageConfig"]);l!=null&&s(e,["controlImageConfig"],tx(l));const h=a(n,["styleImageConfig"]);h!=null&&s(e,["styleImageConfig"],ib(h));const c=a(n,["subjectImageConfig"]);return c!=null&&s(e,["subjectImageConfig"],ob(c)),e}function Vg(n){const e={},t=a(n,["latLng"]);t!=null&&s(e,["latLng"],vg(t));const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function Wg(n){const e={},t=a(n,["latLng"]);t!=null&&s(e,["latLng"],wg(t));const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function Tc(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&s(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const o=a(n,["contentType"]);return o!=null&&s(e,["contentType"],o),e}function Fc(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&s(e,["categories"],t);const i=a(n,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const o=a(n,["contentType"]);return o!=null&&s(e,["contentType"],o),e}function Jg(n){const e={};if(a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=a(n,["category"]);t!=null&&s(e,["category"],t);const i=a(n,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function qg(n){const e={},t=a(n,["method"]);t!=null&&s(e,["method"],t);const i=a(n,["category"]);i!=null&&s(e,["category"],i);const o=a(n,["threshold"]);return o!=null&&s(e,["threshold"],o),e}function Xg(n){const e={},t=a(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&s(e,["default"],i);const o=a(n,["description"]);o!=null&&s(e,["description"],o);const r=a(n,["enum"]);r!=null&&s(e,["enum"],r);const l=a(n,["example"]);l!=null&&s(e,["example"],l);const h=a(n,["format"]);h!=null&&s(e,["format"],h);const c=a(n,["items"]);c!=null&&s(e,["items"],c);const d=a(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const u=a(n,["maxLength"]);u!=null&&s(e,["maxLength"],u);const f=a(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const m=a(n,["maximum"]);m!=null&&s(e,["maximum"],m);const p=a(n,["minItems"]);p!=null&&s(e,["minItems"],p);const b=a(n,["minLength"]);b!=null&&s(e,["minLength"],b);const E=a(n,["minProperties"]);E!=null&&s(e,["minProperties"],E);const g=a(n,["minimum"]);g!=null&&s(e,["minimum"],g);const x=a(n,["nullable"]);x!=null&&s(e,["nullable"],x);const T=a(n,["pattern"]);T!=null&&s(e,["pattern"],T);const C=a(n,["properties"]);C!=null&&s(e,["properties"],C);const y=a(n,["propertyOrdering"]);y!=null&&s(e,["propertyOrdering"],y);const F=a(n,["required"]);F!=null&&s(e,["required"],F);const _=a(n,["title"]);_!=null&&s(e,["title"],_);const B=a(n,["type"]);return B!=null&&s(e,["type"],B),e}function Kg(n){const e={},t=a(n,["anyOf"]);t!=null&&s(e,["anyOf"],t);const i=a(n,["default"]);i!=null&&s(e,["default"],i);const o=a(n,["description"]);o!=null&&s(e,["description"],o);const r=a(n,["enum"]);r!=null&&s(e,["enum"],r);const l=a(n,["example"]);l!=null&&s(e,["example"],l);const h=a(n,["format"]);h!=null&&s(e,["format"],h);const c=a(n,["items"]);c!=null&&s(e,["items"],c);const d=a(n,["maxItems"]);d!=null&&s(e,["maxItems"],d);const u=a(n,["maxLength"]);u!=null&&s(e,["maxLength"],u);const f=a(n,["maxProperties"]);f!=null&&s(e,["maxProperties"],f);const m=a(n,["maximum"]);m!=null&&s(e,["maximum"],m);const p=a(n,["minItems"]);p!=null&&s(e,["minItems"],p);const b=a(n,["minLength"]);b!=null&&s(e,["minLength"],b);const E=a(n,["minProperties"]);E!=null&&s(e,["minProperties"],E);const g=a(n,["minimum"]);g!=null&&s(e,["minimum"],g);const x=a(n,["nullable"]);x!=null&&s(e,["nullable"],x);const T=a(n,["pattern"]);T!=null&&s(e,["pattern"],T);const C=a(n,["properties"]);C!=null&&s(e,["properties"],C);const y=a(n,["propertyOrdering"]);y!=null&&s(e,["propertyOrdering"],y);const F=a(n,["required"]);F!=null&&s(e,["required"],F);const _=a(n,["title"]);_!=null&&s(e,["title"],_);const B=a(n,["type"]);return B!=null&&s(e,["type"],B),e}function Yg(n){const e={},t=a(n,["image"]);return t!=null&&s(e,["image"],fn(t)),e}function $g(n,e){const t={},i=a(n,["mode"]);e!==void 0&&i!=null&&s(e,["parameters","mode"],i);const o=a(n,["maxPredictions"]);e!==void 0&&o!=null&&s(e,["parameters","maxPredictions"],o);const r=a(n,["confidenceThreshold"]);e!==void 0&&r!=null&&s(e,["parameters","confidenceThreshold"],r);const l=a(n,["maskDilation"]);e!==void 0&&l!=null&&s(e,["parameters","maskDilation"],l);const h=a(n,["binaryColorThreshold"]);return e!==void 0&&h!=null&&s(e,["parameters","binaryColorThreshold"],h),t}function Zg(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["source"]);o!=null&&jg(o,t);const r=a(e,["config"]);return r!=null&&$g(r,t),t}function Qg(n){const e={},t=a(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>rg(o))),s(e,["generatedMasks"],i)}return e}function jg(n,e){const t={},i=a(n,["prompt"]);e!==void 0&&i!=null&&s(e,["instances[0]","prompt"],i);const o=a(n,["image"]);e!==void 0&&o!=null&&s(e,["instances[0]","image"],fn(o));const r=a(n,["scribbleImage"]);return e!==void 0&&r!=null&&s(e,["instances[0]","scribble"],Yg(r)),t}function eb(n){const e={},t=a(n,["speaker"]);t!=null&&s(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&s(e,["voiceConfig"],Pc(i)),e}function tb(n){const e={},t=a(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],Pc(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&s(e,["multiSpeakerVoiceConfig"],Dg(i));const o=a(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function nb(n){const e={},t=a(n,["voiceConfig"]);if(t!=null&&s(e,["voiceConfig"],kb(t)),a(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const i=a(n,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function ib(n){const e={},t=a(n,["styleDescription"]);return t!=null&&s(e,["styleDescription"],t),e}function ob(n){const e={},t=a(n,["subjectType"]);t!=null&&s(e,["subjectType"],t);const i=a(n,["subjectDescription"]);return i!=null&&s(e,["subjectDescription"],i),e}function rb(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function ab(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function sb(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],Nx(t));const i=a(n,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],Vg(i)),e}function lb(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&s(e,["functionCallingConfig"],Lx(t));const i=a(n,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],Wg(i)),e}function hb(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>Hx(d))),s(e,["functionDeclarations"],c)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],fg(i));const o=a(n,["googleSearchRetrieval"]);if(o!=null&&s(e,["googleSearchRetrieval"],dg(o)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&s(e,["urlContext"],wb());const l=a(n,["computerUse"]);l!=null&&s(e,["computerUse"],Kp(l));const h=a(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function Dc(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(m=>Gx(m))),s(e,["functionDeclarations"],f)}const i=a(n,["retrieval"]);i!=null&&s(e,["retrieval"],i);const o=a(n,["googleSearch"]);o!=null&&s(e,["googleSearch"],mg(o));const r=a(n,["googleSearchRetrieval"]);r!=null&&s(e,["googleSearchRetrieval"],ug(r));const l=a(n,["enterpriseWebSearch"]);l!=null&&s(e,["enterpriseWebSearch"],Bx(l));const h=a(n,["googleMaps"]);h!=null&&s(e,["googleMaps"],cg(h)),a(n,["urlContext"])!=null&&s(e,["urlContext"],Eb());const d=a(n,["computerUse"]);d!=null&&s(e,["computerUse"],Yp(d));const u=a(n,["codeExecution"]);return u!=null&&s(e,["codeExecution"],u),e}function cb(n){const e={},t=a(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&s(e,["createTime"],i);const o=a(n,["updateTime"]);return o!=null&&s(e,["updateTime"],o),e}function db(n){const e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&s(e,["baseModel"],t);const i=a(n,["createTime"]);i!=null&&s(e,["createTime"],i);const o=a(n,["updateTime"]);return o!=null&&s(e,["updateTime"],o),e}function ub(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const o=a(n,["description"]);e!==void 0&&o!=null&&s(e,["description"],o);const r=a(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&s(e,["defaultCheckpointId"],r),t}function fb(n,e){const t={},i=a(n,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const o=a(n,["description"]);e!==void 0&&o!=null&&s(e,["description"],o);const r=a(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&s(e,["defaultCheckpointId"],r),t}function mb(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","name"],dt(n,i));const o=a(e,["config"]);return o!=null&&ub(o,t),t}function pb(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["config"]);return o!=null&&fb(o,t),t}function xb(n,e){const t={},i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const o=a(n,["includeRaiReason"]);e!==void 0&&o!=null&&s(e,["parameters","includeRaiReason"],o);const r=a(n,["outputMimeType"]);e!==void 0&&r!=null&&s(e,["parameters","outputOptions","mimeType"],r);const l=a(n,["outputCompressionQuality"]);e!==void 0&&l!=null&&s(e,["parameters","outputOptions","compressionQuality"],l);const h=a(n,["enhanceInputImage"]);e!==void 0&&h!=null&&s(e,["parameters","upscaleConfig","enhanceInputImage"],h);const c=a(n,["imagePreservationFactor"]);e!==void 0&&c!=null&&s(e,["parameters","upscaleConfig","imagePreservationFactor"],c);const d=a(n,["numberOfImages"]);e!==void 0&&d!=null&&s(e,["parameters","sampleCount"],d);const u=a(n,["mode"]);return e!==void 0&&u!=null&&s(e,["parameters","mode"],u),t}function gb(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],dt(n,i));const o=a(e,["image"]);o!=null&&s(t,["instances[0]","image"],fn(o));const r=a(e,["upscaleFactor"]);r!=null&&s(t,["parameters","upscaleConfig","upscaleFactor"],r);const l=a(e,["config"]);return l!=null&&xb(l,t),t}function bb(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["predictions"]);if(i!=null){let o=i;Array.isArray(o)&&(o=o.map(r=>wr(r))),s(e,["generatedImages"],o)}return e}function yb(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Cb(o))),s(e,["urlMetadata"],i)}return e}function vb(n){const e={},t=a(n,["urlMetadata"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>Ab(o))),s(e,["urlMetadata"],i)}return e}function wb(){return{}}function Eb(){return{}}function Cb(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&s(e,["urlRetrievalStatus"],i),e}function Ab(n){const e={},t=a(n,["retrievedUrl"]);t!=null&&s(e,["retrievedUrl"],t);const i=a(n,["urlRetrievalStatus"]);return i!=null&&s(e,["urlRetrievalStatus"],i),e}function Sb(n){const e={},t=a(n,["video","uri"]);t!=null&&s(e,["uri"],t);const i=a(n,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],hi(i));const o=a(n,["encoding"]);return o!=null&&s(e,["mimeType"],o),e}function Bb(n){const e={},t=a(n,["gcsUri"]);t!=null&&s(e,["uri"],t);const i=a(n,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],hi(i));const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function _b(n){const e={},t=a(n,["image"]);t!=null&&s(e,["_self"],fn(t));const i=a(n,["maskMode"]);return i!=null&&s(e,["maskMode"],i),e}function Tb(n){const e={},t=a(n,["image"]);t!=null&&s(e,["image"],fn(t));const i=a(n,["referenceType"]);return i!=null&&s(e,["referenceType"],i),e}function Fb(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Db(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Mb(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Pb(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Mc(n){const e={},t=a(n,["uri"]);t!=null&&s(e,["gcsUri"],t);const i=a(n,["videoBytes"]);i!=null&&s(e,["bytesBase64Encoded"],hi(i));const o=a(n,["mimeType"]);return o!=null&&s(e,["mimeType"],o),e}function Pc(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Rg(t)),e}function kb(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Ng(t)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ib="Content-Type",Rb="X-Server-Timeout",Nb="User-Agent",xa="x-goog-api-client",Lb="1.22.0",Hb=`google-genai-sdk/${Lb}`,Gb="v1beta1",Ub="v1beta",$l=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Ob{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Gb,o.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:Ub,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,i){const o=[this.getRequestUrlInternal(t)];return i&&o.push(this.getBaseResourcePath()),e!==""&&o.push(e),new URL(`${o.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);if(e.queryParams)for(const[l,h]of Object.entries(e.queryParams))o.searchParams.append(l,String(h));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,e.abortSignal),this.unaryApiCall(o,r,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[o,r]of Object.entries(t))typeof r=="object"?i[o]=Object.assign(Object.assign({},i[o]),r):r!==void 0&&(i[o]=r);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.shouldPrependVertexProjectPath(e),o=this.constructUrl(e.path,t,i);(!o.searchParams.has("alt")||o.searchParams.get("alt")!=="sse")&&o.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,e.abortSignal),this.streamApiCall(o,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,i){if(t&&t.timeout||i){const o=new AbortController,r=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const l=setTimeout(()=>o.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}i&&i.addEventListener("abort",()=>{o.abort()}),e.signal=r}return t&&t.extraBody!==null&&zb(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Zl(o),new ha(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Zl(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var t;return Mi(this,arguments,function*(){const o=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let l="";for(;;){const{done:h,value:c}=yield gt(o.read());if(h){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=r.decode(c,{stream:!0});try{const f=JSON.parse(d);if("error"in f){const m=JSON.parse(JSON.stringify(f.error)),p=m.status,b=m.code,E=`got status: ${p}. ${JSON.stringify(f)}`;if(b>=400&&b<600)throw new yr({message:E,status:b})}}catch(f){if(f.name==="ApiError")throw f}l+=d;let u=l.match($l);for(;u;){const f=u[1];try{const m=new Response(f,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield gt(new ha(m)),l=l.slice(u[0].length),u=l.match($l)}catch(m){throw new Error(`exception parsing stream chunk ${f}. ${m}`)}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=Hb+" "+this.clientOptions.userAgentExtra;return e[Nb]=t,e[xa]=t,e[Ib]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[i,o]of Object.entries(e.headers))t.append(i,o);e.timeout&&e.timeout>0&&t.append(Rb,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var i;const o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const r=this.clientOptions.uploader,l=await r.stat(e);o.sizeBytes=String(l.size);const h=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:l.type;if(h===void 0||h==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=h;const c=await this.fetchUploadUrl(o,t);return r.upload(e,c,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var i;let o={};t!=null&&t.httpOptions?o=t.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const r={file:e},l=await this.request({path:Me("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(i=l==null?void 0:l.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Zl(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let i;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?i=await n.json():i={error:{message:await n.text(),code:n.status,status:n.statusText}};const o=JSON.stringify(i);throw t>=400&&t<600?new yr({message:o,status:t}):new Error(o)}}function zb(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const r=JSON.parse(n.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function i(r,l){const h=Object.assign({},r);for(const c in l)if(Object.prototype.hasOwnProperty.call(l,c)){const d=l[c],u=h[c];d&&typeof d=="object"&&!Array.isArray(d)&&u&&typeof u=="object"&&!Array.isArray(u)?h[c]=i(u,d):(u&&d&&typeof u!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof u}, New type: ${typeof d}. Overwriting.`),h[c]=d)}return h}const o=i(t,e);n.body=JSON.stringify(o)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vb="mcp_used/unknown";let Wb=!1;function kc(n){for(const e of n)if(Jb(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Wb}function Ic(n){var e;const t=(e=n[xa])!==null&&e!==void 0?e:"";n[xa]=(t+` ${Vb}`).trimStart()}function Jb(n){return n!==null&&typeof n=="object"&&n instanceof ys}function qb(n,e=100){return Mi(this,arguments,function*(){let i,o=0;for(;o<e;){const r=yield gt(n.listTools({cursor:i}));for(const l of r.tools)yield yield gt(l),o++;if(!r.nextCursor)break;i=r.nextCursor}})}class ys{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new ys(e,t)}async initialize(){var e,t,i,o;if(this.mcpTools.length>0)return;const r={},l=[];for(const u of this.mcpClients)try{for(var h=!0,c=(t=void 0,lo(qb(u))),d;d=await c.next(),e=d.done,!e;h=!0){o=d.value,h=!1;const f=o;l.push(f);const m=f.name;if(r[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);r[m]=u}}catch(f){t={error:f}}finally{try{!h&&!e&&(i=c.return)&&await i.call(c)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),tu(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const i of e)if(i.name in this.functionNameToMcpClient){const o=this.functionNameToMcpClient[i.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const l=await o.callTool({name:i.name,arguments:i.args},void 0,r);t.push({functionResponse:{name:i.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Xb(n,e,t){const i=new Xd;let o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data);const r=I0(o);Object.assign(i,r),e(i)}class Kb{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),l=Zb(this.apiClient.getDefaultHeaders()),h=this.apiClient.getApiKey(),c=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${h}`;let d=()=>{};const u=new Promise(C=>{d=C}),f=e.callbacks,m=function(){d({})},p=this.apiClient,b={onopen:m,onmessage:C=>{Xb(p,f.onmessage,C)},onerror:(t=f==null?void 0:f.onerror)!==null&&t!==void 0?t:function(C){},onclose:(i=f==null?void 0:f.onclose)!==null&&i!==void 0?i:function(C){}},E=this.webSocketFactory.create(c,$b(l),b);E.connect(),await u;const g=dt(this.apiClient,e.model),x=Ec({model:g}),T=fa({setup:x});return E.send(JSON.stringify(T)),new Yb(E,this.apiClient)}}class Yb{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=L0(e),i=wc(t);this.conn.send(JSON.stringify({clientContent:i}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=N0(e),i=fa(t);this.conn.send(JSON.stringify(i))}sendPlaybackControl(e){const t=fa({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(_i.PLAY)}pause(){this.sendPlaybackControl(_i.PAUSE)}stop(){this.sendPlaybackControl(_i.STOP)}resetContext(){this.sendPlaybackControl(_i.RESET_CONTEXT)}close(){this.conn.close()}}function $b(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function Zb(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Qb="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function jb(n,e,t){const i=new qd;let o;t.data instanceof Blob?o=await t.data.text():t.data instanceof ArrayBuffer?o=new TextDecoder().decode(t.data):o=t.data;const r=JSON.parse(o);if(n.isVertexAI()){const l=q0(r);Object.assign(i,l)}else{const l=J0(r);Object.assign(i,l)}e(i)}class ey{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i,this.music=new Kb(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,i,o,r,l,h;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let u;const f=this.apiClient.getHeaders();e.config&&e.config.tools&&kc(e.config.tools)&&Ic(f);const m=oy(f);if(this.apiClient.isVertexAI())u=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const A=this.apiClient.getApiKey();let S="BidiGenerateContent",R="key";A!=null&&A.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),S="BidiGenerateContentConstrained",R="access_token"),u=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${S}?${R}=${A}`}let p=()=>{};const b=new Promise(A=>{p=A}),E=e.callbacks,g=function(){var A;(A=E==null?void 0:E.onopen)===null||A===void 0||A.call(E),p({})},x=this.apiClient,T={onopen:g,onmessage:A=>{jb(x,E.onmessage,A)},onerror:(t=E==null?void 0:E.onerror)!==null&&t!==void 0?t:function(A){},onclose:(i=E==null?void 0:E.onclose)!==null&&i!==void 0?i:function(A){}},C=this.webSocketFactory.create(u,iy(m),T);C.connect(),await b;let y=dt(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&y.startsWith("publishers/")){const A=this.apiClient.getProject(),S=this.apiClient.getLocation();y=`projects/${A}/locations/${S}/`+y}let F={};this.apiClient.isVertexAI()&&((o=e.config)===null||o===void 0?void 0:o.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[co.AUDIO]}:e.config.responseModalities=[co.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const _=(h=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&h!==void 0?h:[],B=[];for(const A of _)if(this.isCallableTool(A)){const S=A;B.push(await S.tool())}else B.push(A);B.length>0&&(e.config.tools=B);const P={model:y,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?F=F0(this.apiClient,P):F=T0(this.apiClient,P),delete F.config,C.send(JSON.stringify(F)),new ny(C,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const ty={turnComplete:!0};class ny{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=tn(t.turns),e.isVertexAI()?i=i.map(o=>Vi(o)):i=i.map(o=>vr(o))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const r of i){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(Qb)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},ty),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:U0(e)}:t={realtimeInput:G0(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function iy(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function oy(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ql=10;function jl(n){var e,t,i;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let o=!1;for(const l of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(Pi(l)){o=!0;break}if(!o)return!0;const r=(i=n==null?void 0:n.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Pi(n){return"callTool"in n&&typeof n.callTool=="function"}function ry(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>Pi(o)))!==null&&i!==void 0?i:!1}function ay(n){var e,t,i;return(i=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(o=>!Pi(o)))!==null&&i!==void 0?i:!1}function eh(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sy extends li{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var i,o,r,l,h;const c=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!ry(t)||jl(t.config))return await this.generateContentInternal(c);if(ay(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let d,u;const f=tn(c.contents),m=(r=(o=(i=c.config)===null||i===void 0?void 0:i.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&r!==void 0?r:Ql;let p=0;for(;p<m&&(d=await this.generateContentInternal(c),!(!d.functionCalls||d.functionCalls.length===0));){const b=d.candidates[0].content,E=[];for(const g of(h=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&h!==void 0?h:[])if(Pi(g)){const T=await g.callTool(d.functionCalls);E.push(...T)}p++,u={role:"user",parts:E},c.contents=tn(c.contents),c.contents.push(b),c.contents.push(u),eh(c.config)&&(f.push(b),f.push(u))}return eh(c.config)&&(d.automaticFunctionCallingHistory=f),d},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),jl(t.config)){const i=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(i)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var o;let r;const l=[];if(i!=null&&i.generatedImages)for(const c of i.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((o=c==null?void 0:c.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=c==null?void 0:c.safetyAttributes:l.push(c);let h;return r?h={generatedImages:l,positivePromptSafetyAttributes:r,sdkHttpResponse:i.sdkHttpResponse}:h={generatedImages:l,sdkHttpResponse:i.sdkHttpResponse},h}),this.list=async t=>{var i;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((i=l.config)===null||i===void 0)&&i.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new xo(ai.PAGED_ITEM_MODELS,h=>this.listInternal(h),await this.listInternal(l),l)},this.editImage=async t=>{const i={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(i.referenceImages=t.referenceImages.map(o=>o.toReferenceImageAPI())),await this.editImageInternal(i)},this.upscaleImage=async t=>{let i={numberOfImages:1,mode:"upscale"};t.config&&(i=Object.assign(Object.assign({},i),t.config));const o={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:i};return await this.upscaleImageInternal(o)},this.generateVideos=async t=>{if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,i,o;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const l=await Promise.all(r.map(async c=>Pi(c)?await c.tool():c)),h={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(h.config.tools=l,e.config&&e.config.tools&&kc(e.config.tools)){const c=(o=(i=e.config.httpOptions)===null||i===void 0?void 0:i.headers)!==null&&o!==void 0?o:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Ic(d),h.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return h}async initAfcToolsMap(e){var t,i,o;const r=new Map;for(const l of(i=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&i!==void 0?i:[])if(Pi(l)){const h=l,c=await h.tool();for(const d of(o=c.functionDeclarations)!==null&&o!==void 0?o:[]){if(!d.name)throw new Error("Function declaration name is required.");if(r.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);r.set(d.name,h)}}return r}async processAfcStream(e){var t,i,o;const r=(o=(i=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&o!==void 0?o:Ql;let l=!1,h=0;const c=await this.initAfcToolsMap(e);return(function(d,u,f){var m,p;return Mi(this,arguments,function*(){for(var b,E,g,x;h<r;){l&&(h++,l=!1);const F=yield gt(d.processParamsMaybeAddMcpUsage(f)),_=yield gt(d.generateContentStreamInternal(F)),B=[],P=[];try{for(var T=!0,C=(E=void 0,lo(_)),y;y=yield gt(C.next()),b=y.done,!b;T=!0){x=y.value,T=!1;const A=x;if(yield yield gt(A),A.candidates&&(!((m=A.candidates[0])===null||m===void 0)&&m.content)){P.push(A.candidates[0].content);for(const S of(p=A.candidates[0].content.parts)!==null&&p!==void 0?p:[])if(h<r&&S.functionCall){if(!S.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(S.functionCall.name)){const R=yield gt(u.get(S.functionCall.name).callTool([S.functionCall]));B.push(...R)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${S.functionCall.name}`)}}}}catch(A){E={error:A}}finally{try{!T&&!b&&(g=C.return)&&(yield gt(g.call(C)))}finally{if(E)throw E.error}}if(B.length>0){l=!0;const A=new Qi;A.candidates=[{content:{role:"user",parts:B}}],yield yield gt(A);const S=[];S.push(...P),S.push({role:"user",parts:B});const R=tn(f.contents).concat(S);f.contents=R}else break}})})(this,c,e)}async generateContentInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Xl(this.apiClient,e);return h=Me("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Yl(u),m=new Qi;return Object.assign(m,f),m})}else{const d=ql(this.apiClient,e);return h=Me("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Kl(u),m=new Qi;return Object.assign(m,f),m})}}async generateContentStreamInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Xl(this.apiClient,e);return h=Me("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.requestStream({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}),l.then(function(f){return Mi(this,arguments,function*(){var m,p,b,E;try{for(var g=!0,x=lo(f),T;T=yield gt(x.next()),m=T.done,!m;g=!0){E=T.value,g=!1;const C=E,y=Yl(yield gt(C.json()));y.sdkHttpResponse={headers:C.headers};const F=new Qi;Object.assign(F,y),yield yield gt(F)}}catch(C){p={error:C}}finally{try{!g&&!m&&(b=x.return)&&(yield gt(b.call(x)))}finally{if(p)throw p.error}}})})}else{const d=ql(this.apiClient,e);return h=Me("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.requestStream({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),l.then(function(f){return Mi(this,arguments,function*(){var m,p,b,E;try{for(var g=!0,x=lo(f),T;T=yield gt(x.next()),m=T.done,!m;g=!0){E=T.value,g=!1;const C=E,y=Kl(yield gt(C.json()));y.sdkHttpResponse={headers:C.headers};const F=new Qi;Object.assign(F,y),yield yield gt(F)}}catch(C){p={error:C}}finally{try{!g&&!m&&(b=x.return)&&(yield gt(b.call(x)))}finally{if(p)throw p.error}}})})}}async embedContent(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Ex(this.apiClient,e);return h=Me("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Ax(u),m=new Bl;return Object.assign(m,f),m})}else{const d=wx(this.apiClient,e);return h=Me("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Cx(u),m=new Bl;return Object.assign(m,f),m})}}async generateImagesInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Jx(this.apiClient,e);return h=Me("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Xx(u),m=new _l;return Object.assign(m,f),m})}else{const d=Wx(this.apiClient,e);return h=Me("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=qx(u),m=new _l;return Object.assign(m,f),m})}}async editImageInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=px(this.apiClient,e);return r=Me("{model}:predict",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>{const d=xx(c),u=new Hd;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=gb(this.apiClient,e);return r=Me("{model}:predict",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>{const d=bb(c),u=new Gd;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=Gg(this.apiClient,e);return r=Me("{model}:predict",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>{const d=Ug(c),u=new Ud;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=Zg(this.apiClient,e);return r=Me("{model}:predict",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o.then(c=>{const d=Qg(c),u=new Od;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=hg(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>pa(u))}else{const d=lg(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>ma(u))}}async listInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Sg(this.apiClient,e);return h=Me("{models_url}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=_g(u),m=new Tl;return Object.assign(m,f),m})}else{const d=Ag(this.apiClient,e);return h=Me("{models_url}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=Bg(u),m=new Tl;return Object.assign(m,f),m})}}async update(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=pb(this.apiClient,e);return h=Me("{model}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>pa(u))}else{const d=mb(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>ma(u))}}async delete(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=hx(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=dx(u),m=new Fl;return Object.assign(m,f),m})}else{const d=lx(this.apiClient,e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=cx(u),m=new Fl;return Object.assign(m,f),m})}}async countTokens(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=rx(this.apiClient,e);return h=Me("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=sx(u),m=new Dl;return Object.assign(m,f),m})}else{const d=ox(this.apiClient,e);return h=Me("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=ax(u),m=new Dl;return Object.assign(m,f),m})}}async computeTokens(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=qp(this.apiClient,e);return r=Me("{model}:computeTokens",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>{const d=Xp(c),u=new zd;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=jx(this.apiClient,e);return h=Me("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l.then(u=>{const f=Zx(u),m=new dr;return Object.assign(m,f),m})}else{const d=Qx(this.apiClient,e);return h=Me("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l.then(u=>{const f=$x(u),m=new dr;return Object.assign(m,f),m})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ly extends li{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let r;i&&"httpOptions"in i&&(r=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const o=t.name.split("/operations/")[0];let r;i&&"httpOptions"in i&&(r=i.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:o,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:l,isVertexAI:!0})}else{const o=await this.getVideosOperationInternal({operationName:t.name,config:i});return t._fromAPIResponse({apiResponse:o,isVertexAI:!1})}}async getVideosOperationInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Rd(e);return h=Me("{operationName}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json()),l}else{const d=Id(e);return h=Me("{operationName}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),l}}async fetchPredictVideosOperationInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=_d(e);return r=Me("{resourceName}:fetchPredictOperation",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json()),o}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function th(){return{}}function hy(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["name"],t),e}function cy(n){const e={},t=a(n,["disabled"]);t!=null&&s(e,["disabled"],t);const i=a(n,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const o=a(n,["endOfSpeechSensitivity"]);o!=null&&s(e,["endOfSpeechSensitivity"],o);const r=a(n,["prefixPaddingMs"]);r!=null&&s(e,["prefixPaddingMs"],r);const l=a(n,["silenceDurationMs"]);return l!=null&&s(e,["silenceDurationMs"],l),e}function dy(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["data"]);t!=null&&s(e,["data"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function uy(n){const e={},t=a(n,["environment"]);t!=null&&s(e,["environment"],t);const i=a(n,["excludedPredefinedFunctions"]);return i!=null&&s(e,["excludedPredefinedFunctions"],i),e}function fy(n){const e={},t=a(n,["parts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(r=>_y(r))),s(e,["parts"],o)}const i=a(n,["role"]);return i!=null&&s(e,["role"],i),e}function my(n){const e={},t=a(n,["triggerTokens"]);t!=null&&s(e,["triggerTokens"],t);const i=a(n,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],Py(i)),e}function py(n,e,t){const i={},o=a(e,["expireTime"]);t!==void 0&&o!=null&&s(t,["expireTime"],o);const r=a(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&s(t,["newSessionExpireTime"],r);const l=a(e,["uses"]);t!==void 0&&l!=null&&s(t,["uses"],l);const h=a(e,["liveConnectConstraints"]);t!==void 0&&h!=null&&s(t,["bidiGenerateContentSetup"],Sy(n,h));const c=a(e,["lockAdditionalFields"]);return t!==void 0&&c!=null&&s(t,["fieldMask"],c),i}function xy(n,e){const t={},i=a(e,["config"]);return i!=null&&s(t,["config"],py(n,i,t)),t}function gy(n){const e={},t=a(n,["mode"]);t!=null&&s(e,["mode"],t);const i=a(n,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function by(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&s(e,["fileUri"],t);const i=a(n,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function yy(n){const e={},t=a(n,["id"]);t!=null&&s(e,["id"],t);const i=a(n,["args"]);i!=null&&s(e,["args"],i);const o=a(n,["name"]);return o!=null&&s(e,["name"],o),e}function vy(n){const e={},t=a(n,["behavior"]);t!=null&&s(e,["behavior"],t);const i=a(n,["description"]);i!=null&&s(e,["description"],i);const o=a(n,["name"]);o!=null&&s(e,["name"],o);const r=a(n,["parameters"]);r!=null&&s(e,["parameters"],r);const l=a(n,["parametersJsonSchema"]);l!=null&&s(e,["parametersJsonSchema"],l);const h=a(n,["response"]);h!=null&&s(e,["response"],h);const c=a(n,["responseJsonSchema"]);return c!=null&&s(e,["responseJsonSchema"],c),e}function wy(n){const e={},t=a(n,["dynamicRetrievalConfig"]);return t!=null&&s(e,["dynamicRetrievalConfig"],gy(t)),e}function Ey(n){const e={},t=a(n,["timeRangeFilter"]);if(t!=null&&s(e,["timeRangeFilter"],Cy(t)),a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");return e}function Cy(n){const e={},t=a(n,["startTime"]);t!=null&&s(e,["startTime"],t);const i=a(n,["endTime"]);return i!=null&&s(e,["endTime"],i),e}function Ay(n,e){const t={},i=a(n,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const o=a(n,["responseModalities"]);e!==void 0&&o!=null&&s(e,["setup","generationConfig","responseModalities"],o);const r=a(n,["temperature"]);e!==void 0&&r!=null&&s(e,["setup","generationConfig","temperature"],r);const l=a(n,["topP"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","topP"],l);const h=a(n,["topK"]);e!==void 0&&h!=null&&s(e,["setup","generationConfig","topK"],h);const c=a(n,["maxOutputTokens"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","maxOutputTokens"],c);const d=a(n,["mediaResolution"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","mediaResolution"],d);const u=a(n,["seed"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","seed"],u);const f=a(n,["speechConfig"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","speechConfig"],Iy(gs(f)));const m=a(n,["thinkingConfig"]);e!==void 0&&m!=null&&s(e,["setup","generationConfig","thinkingConfig"],Ry(m));const p=a(n,["enableAffectiveDialog"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","enableAffectiveDialog"],p);const b=a(n,["systemInstruction"]);e!==void 0&&b!=null&&s(e,["setup","systemInstruction"],fy(It(b)));const E=a(n,["tools"]);if(e!==void 0&&E!=null){let _=Oi(E);Array.isArray(_)&&(_=_.map(B=>Ny(Ui(B)))),s(e,["setup","tools"],_)}const g=a(n,["sessionResumption"]);e!==void 0&&g!=null&&s(e,["setup","sessionResumption"],My(g));const x=a(n,["inputAudioTranscription"]);e!==void 0&&x!=null&&s(e,["setup","inputAudioTranscription"],th());const T=a(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&s(e,["setup","outputAudioTranscription"],th());const C=a(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&s(e,["setup","realtimeInputConfig"],Dy(C));const y=a(n,["contextWindowCompression"]);e!==void 0&&y!=null&&s(e,["setup","contextWindowCompression"],my(y));const F=a(n,["proactivity"]);return e!==void 0&&F!=null&&s(e,["setup","proactivity"],Fy(F)),t}function Sy(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["setup","model"],dt(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],Ay(o,t)),t}function By(n){const e={},t=a(n,["speakerVoiceConfigs"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>ky(o))),s(e,["speakerVoiceConfigs"],i)}return e}function _y(n){const e={},t=a(n,["videoMetadata"]);t!=null&&s(e,["videoMetadata"],Hy(t));const i=a(n,["thought"]);i!=null&&s(e,["thought"],i);const o=a(n,["inlineData"]);o!=null&&s(e,["inlineData"],dy(o));const r=a(n,["fileData"]);r!=null&&s(e,["fileData"],by(r));const l=a(n,["thoughtSignature"]);l!=null&&s(e,["thoughtSignature"],l);const h=a(n,["functionCall"]);h!=null&&s(e,["functionCall"],yy(h));const c=a(n,["codeExecutionResult"]);c!=null&&s(e,["codeExecutionResult"],c);const d=a(n,["executableCode"]);d!=null&&s(e,["executableCode"],d);const u=a(n,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=a(n,["text"]);return f!=null&&s(e,["text"],f),e}function Ty(n){const e={},t=a(n,["voiceName"]);return t!=null&&s(e,["voiceName"],t),e}function Fy(n){const e={},t=a(n,["proactiveAudio"]);return t!=null&&s(e,["proactiveAudio"],t),e}function Dy(n){const e={},t=a(n,["automaticActivityDetection"]);t!=null&&s(e,["automaticActivityDetection"],cy(t));const i=a(n,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const o=a(n,["turnCoverage"]);return o!=null&&s(e,["turnCoverage"],o),e}function My(n){const e={},t=a(n,["handle"]);if(t!=null&&s(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Py(n){const e={},t=a(n,["targetTokens"]);return t!=null&&s(e,["targetTokens"],t),e}function ky(n){const e={},t=a(n,["speaker"]);t!=null&&s(e,["speaker"],t);const i=a(n,["voiceConfig"]);return i!=null&&s(e,["voiceConfig"],Rc(i)),e}function Iy(n){const e={},t=a(n,["voiceConfig"]);t!=null&&s(e,["voiceConfig"],Rc(t));const i=a(n,["multiSpeakerVoiceConfig"]);i!=null&&s(e,["multiSpeakerVoiceConfig"],By(i));const o=a(n,["languageCode"]);return o!=null&&s(e,["languageCode"],o),e}function Ry(n){const e={},t=a(n,["includeThoughts"]);t!=null&&s(e,["includeThoughts"],t);const i=a(n,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function Ny(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(d=>vy(d))),s(e,["functionDeclarations"],c)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const i=a(n,["googleSearch"]);i!=null&&s(e,["googleSearch"],Ey(i));const o=a(n,["googleSearchRetrieval"]);if(o!=null&&s(e,["googleSearchRetrieval"],wy(o)),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(a(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");a(n,["urlContext"])!=null&&s(e,["urlContext"],Ly());const l=a(n,["computerUse"]);l!=null&&s(e,["computerUse"],uy(l));const h=a(n,["codeExecution"]);return h!=null&&s(e,["codeExecution"],h),e}function Ly(){return{}}function Hy(n){const e={},t=a(n,["fps"]);t!=null&&s(e,["fps"],t);const i=a(n,["endOffset"]);i!=null&&s(e,["endOffset"],i);const o=a(n,["startOffset"]);return o!=null&&s(e,["startOffset"],o),e}function Rc(n){const e={},t=a(n,["prebuiltVoiceConfig"]);return t!=null&&s(e,["prebuiltVoiceConfig"],Ty(t)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Gy(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const i=n[t];if(typeof i=="object"&&i!=null&&Object.keys(i).length>0){const o=Object.keys(i).map(r=>`${t}.${r}`);e.push(...o)}else e.push(t)}return e.join(",")}function Uy(n,e){let t=null;const i=n.bidiGenerateContentSetup;if(typeof i=="object"&&i!==null&&"setup"in i){const r=i.setup;typeof r=="object"&&r!==null?(n.bidiGenerateContentSetup=r,t=r):delete n.bidiGenerateContentSetup}else i!==void 0&&delete n.bidiGenerateContentSetup;const o=n.fieldMask;if(t){const r=Gy(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?n.fieldMask=r:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&o!==null&&Array.isArray(o)&&o.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let h=[];o.length>0&&(h=o.map(d=>l.includes(d)?`generationConfig.${d}`:d));const c=[];r&&c.push(r),h.length>0&&c.push(...h),c.length>0?n.fieldMask=c.join(","):delete n.fieldMask}else delete n.fieldMask}else o!==null&&Array.isArray(o)&&o.length>0?n.fieldMask=o.join(","):delete n.fieldMask;return n}class Oy extends li{constructor(e){super(),this.apiClient=e}async create(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const h=xy(this.apiClient,e);r=Me("auth_tokens",h._url),l=h._query,delete h.config,delete h._url,delete h._query;const c=Uy(h,e.config);return o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(d=>d.json()),o.then(d=>hy(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zy(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","name"],t),e}function Vy(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","name"],t),e}function Wy(n,e){const t={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=a(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&s(e,["displayName"],i),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=a(n,["epochCount"]);e!==void 0&&o!=null&&s(e,["tuningTask","hyperparameters","epochCount"],o);const r=a(n,["learningRateMultiplier"]);if(r!=null&&s(t,["tuningTask","hyperparameters","learningRateMultiplier"],r),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=a(n,["batchSize"]);e!==void 0&&l!=null&&s(e,["tuningTask","hyperparameters","batchSize"],l);const h=a(n,["learningRate"]);if(e!==void 0&&h!=null&&s(e,["tuningTask","hyperparameters","learningRate"],h),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");return t}function Jy(n,e){const t={},i=a(n,["validationDataset"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec"],hv(i,t));const o=a(n,["tunedModelDisplayName"]);e!==void 0&&o!=null&&s(e,["tunedModelDisplayName"],o);const r=a(n,["description"]);e!==void 0&&r!=null&&s(e,["description"],r);const l=a(n,["epochCount"]);e!==void 0&&l!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],l);const h=a(n,["learningRateMultiplier"]);e!==void 0&&h!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],h);const c=a(n,["exportLastCheckpointOnly"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","exportLastCheckpointOnly"],c);const d=a(n,["adapterSize"]);if(e!==void 0&&d!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],d),a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const u=a(n,["labels"]);return e!==void 0&&u!=null&&s(e,["labels"],u),t}function qy(n){const e={},t=a(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const i=a(n,["preTunedModel"]);i!=null&&s(e,["preTunedModel"],i);const o=a(n,["trainingDataset"]);o!=null&&s(e,["tuningTask","trainingData"],rv(o));const r=a(n,["config"]);return r!=null&&Wy(r,e),e}function Xy(n){const e={},t=a(n,["baseModel"]);t!=null&&s(e,["baseModel"],t);const i=a(n,["preTunedModel"]);i!=null&&s(e,["preTunedModel"],i);const o=a(n,["trainingDataset"]);o!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],av(o,e));const r=a(n,["config"]);return r!=null&&Jy(r,e),e}function Ky(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","name"],t),e}function Yy(n){const e={},t=a(n,["name"]);return t!=null&&s(e,["_url","name"],t),e}function $y(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);e!==void 0&&o!=null&&s(e,["_query","pageToken"],o);const r=a(n,["filter"]);return e!==void 0&&r!=null&&s(e,["_query","filter"],r),t}function Zy(n,e){const t={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const o=a(n,["pageToken"]);e!==void 0&&o!=null&&s(e,["_query","pageToken"],o);const r=a(n,["filter"]);return e!==void 0&&r!=null&&s(e,["_query","filter"],r),t}function Qy(n){const e={},t=a(n,["config"]);return t!=null&&$y(t,e),e}function jy(n){const e={},t=a(n,["config"]);return t!=null&&Zy(t,e),e}function ev(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["tunedModels"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>Nc(l))),s(e,["tuningJobs"],r)}return e}function tv(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["nextPageToken"]);i!=null&&s(e,["nextPageToken"],i);const o=a(n,["tuningJobs"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>ga(l))),s(e,["tuningJobs"],r)}return e}function nv(n){const e={},t=a(n,["checkpointId"]);t!=null&&s(e,["checkpointId"],t);const i=a(n,["epoch"]);i!=null&&s(e,["epoch"],i);const o=a(n,["step"]);o!=null&&s(e,["step"],o);const r=a(n,["endpoint"]);return r!=null&&s(e,["endpoint"],r),e}function iv(n){const e={},t=a(n,["name"]);t!=null&&s(e,["model"],t);const i=a(n,["name"]);return i!=null&&s(e,["endpoint"],i),e}function ov(n){const e={},t=a(n,["model"]);t!=null&&s(e,["model"],t);const i=a(n,["endpoint"]);i!=null&&s(e,["endpoint"],i);const o=a(n,["checkpoints"]);if(o!=null){let r=o;Array.isArray(r)&&(r=r.map(l=>nv(l))),s(e,["checkpoints"],r)}return e}function rv(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const t=a(n,["examples"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(o=>sv(o))),s(e,["examples","examples"],i)}return e}function av(n,e){const t={},i=a(n,["gcsUri"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i);const o=a(n,["vertexDatasetResource"]);if(e!==void 0&&o!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],o),a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function sv(n){const e={},t=a(n,["textInput"]);t!=null&&s(e,["textInput"],t);const i=a(n,["output"]);return i!=null&&s(e,["output"],i),e}function Nc(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["state"]);o!=null&&s(e,["state"],lc(o));const r=a(n,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(n,["tuningTask","startTime"]);l!=null&&s(e,["startTime"],l);const h=a(n,["tuningTask","completeTime"]);h!=null&&s(e,["endTime"],h);const c=a(n,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=a(n,["description"]);d!=null&&s(e,["description"],d);const u=a(n,["baseModel"]);u!=null&&s(e,["baseModel"],u);const f=a(n,["_self"]);f!=null&&s(e,["tunedModel"],iv(f));const m=a(n,["customBaseModel"]);m!=null&&s(e,["customBaseModel"],m);const p=a(n,["experiment"]);p!=null&&s(e,["experiment"],p);const b=a(n,["labels"]);b!=null&&s(e,["labels"],b);const E=a(n,["outputUri"]);E!=null&&s(e,["outputUri"],E);const g=a(n,["pipelineJob"]);g!=null&&s(e,["pipelineJob"],g);const x=a(n,["serviceAccount"]);x!=null&&s(e,["serviceAccount"],x);const T=a(n,["tunedModelDisplayName"]);T!=null&&s(e,["tunedModelDisplayName"],T);const C=a(n,["veoTuningSpec"]);return C!=null&&s(e,["veoTuningSpec"],C),e}function ga(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["state"]);o!=null&&s(e,["state"],lc(o));const r=a(n,["createTime"]);r!=null&&s(e,["createTime"],r);const l=a(n,["startTime"]);l!=null&&s(e,["startTime"],l);const h=a(n,["endTime"]);h!=null&&s(e,["endTime"],h);const c=a(n,["updateTime"]);c!=null&&s(e,["updateTime"],c);const d=a(n,["error"]);d!=null&&s(e,["error"],d);const u=a(n,["description"]);u!=null&&s(e,["description"],u);const f=a(n,["baseModel"]);f!=null&&s(e,["baseModel"],f);const m=a(n,["tunedModel"]);m!=null&&s(e,["tunedModel"],ov(m));const p=a(n,["preTunedModel"]);p!=null&&s(e,["preTunedModel"],p);const b=a(n,["supervisedTuningSpec"]);b!=null&&s(e,["supervisedTuningSpec"],b);const E=a(n,["tuningDataStats"]);E!=null&&s(e,["tuningDataStats"],E);const g=a(n,["encryptionSpec"]);g!=null&&s(e,["encryptionSpec"],g);const x=a(n,["partnerModelTuningSpec"]);x!=null&&s(e,["partnerModelTuningSpec"],x);const T=a(n,["customBaseModel"]);T!=null&&s(e,["customBaseModel"],T);const C=a(n,["experiment"]);C!=null&&s(e,["experiment"],C);const y=a(n,["labels"]);y!=null&&s(e,["labels"],y);const F=a(n,["outputUri"]);F!=null&&s(e,["outputUri"],F);const _=a(n,["pipelineJob"]);_!=null&&s(e,["pipelineJob"],_);const B=a(n,["serviceAccount"]);B!=null&&s(e,["serviceAccount"],B);const P=a(n,["tunedModelDisplayName"]);P!=null&&s(e,["tunedModelDisplayName"],P);const A=a(n,["veoTuningSpec"]);return A!=null&&s(e,["veoTuningSpec"],A),e}function lv(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&s(e,["sdkHttpResponse"],t);const i=a(n,["name"]);i!=null&&s(e,["name"],i);const o=a(n,["metadata"]);o!=null&&s(e,["metadata"],o);const r=a(n,["done"]);r!=null&&s(e,["done"],r);const l=a(n,["error"]);return l!=null&&s(e,["error"],l),e}function hv(n,e){const t={},i=a(n,["gcsUri"]);i!=null&&s(t,["validationDatasetUri"],i);const o=a(n,["vertexDatasetResource"]);return e!==void 0&&o!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class cv extends li{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new xo(ai.PAGED_ITEM_TUNING_JOBS,i=>this.listInternal(i),await this.listInternal(t),t),this.tune=async t=>{var i;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const o={tunedModelName:t.baseModel};!((i=t.config)===null||i===void 0)&&i.preTunedModelCheckpointId&&(o.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:o});return r.baseModel=void 0,await this.tuneInternal(r)}else{const o=Object.assign({},t);return await this.tuneInternal(o)}else{const o=Object.assign({},t),r=await this.tuneMldevInternal(o);let l="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?l=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(l=r.name.split("/operations/")[0]),{name:l,state:la.JOB_STATE_QUEUED}}}}async getInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=Yy(e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>ga(u))}else{const d=Ky(e);return h=Me("{name}",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>Nc(u))}}async listInternal(e){var t,i,o,r;let l,h="",c={};if(this.apiClient.isVertexAI()){const d=jy(e);return h=Me("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=tv(u),m=new Ml;return Object.assign(m,f),m})}else{const d=Qy(e);return h=Me("tunedModels",d._url),c=d._query,delete d._url,delete d._query,l=this.apiClient.request({path:h,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(f=>{const m=f;return m.sdkHttpResponse={headers:u.headers},m})),l.then(u=>{const f=ev(u),m=new Ml;return Object.assign(m,f),m})}}async cancel(e){var t,i,o,r;let l="",h={};if(this.apiClient.isVertexAI()){const c=Vy(e);l=Me("{name}:cancel",c._url),h=c._query,delete c._url,delete c._query,await this.apiClient.request({path:l,queryParams:h,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal})}else{const c=zy(e);l=Me("{name}:cancel",c._url),h=c._query,delete c._url,delete c._query,await this.apiClient.request({path:l,queryParams:h,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(o=e.config)===null||o===void 0?void 0:o.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async tuneInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI()){const h=Xy(e);return r=Me("tuningJobs",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>ga(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,i;let o,r="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=qy(e);return r=Me("tunedModels",h._url),l=h._query,delete h._url,delete h._query,o=this.apiClient.request({path:r,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(i=e.config)===null||i===void 0?void 0:i.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),o.then(c=>lv(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dv{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const uv=1024*1024*8,fv=3,mv=1e3,pv=2,Fr="x-goog-upload-status";async function xv(n,e,t){var i,o,r;let l=0,h=0,c=new ha(new Response),d="upload";for(l=n.size;h<l;){const f=Math.min(uv,l-h),m=n.slice(h,h+f);h+f>=l&&(d+=", finalize");let p=0,b=mv;for(;p<fv&&(c=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(h),"Content-Length":String(f)}}}),!(!((i=c==null?void 0:c.headers)===null||i===void 0)&&i[Fr]));)p++,await bv(b),b=b*pv;if(h+=f,((o=c==null?void 0:c.headers)===null||o===void 0?void 0:o[Fr])!=="active")break;if(l<=h)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const u=await(c==null?void 0:c.json());if(((r=c==null?void 0:c.headers)===null||r===void 0?void 0:r[Fr])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return u.file}async function gv(n){return{size:n.size,type:n.type}}function bv(n){return new Promise(e=>setTimeout(e,n))}class yv{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await xv(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await gv(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vv{create(e,t,i){return new wv(e,t,i)}}class wv{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const nh="x-goog-api-key";class Ev{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(nh)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(nh,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Cv="gl-node/";class Av{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const i=Bd(e.httpOptions,e.vertexai,void 0,void 0);i&&(e.httpOptions?e.httpOptions.baseUrl=i:e.httpOptions={baseUrl:i}),this.apiVersion=e.apiVersion;const o=new Ev(this.apiKey);this.apiClient=new Ob({auth:o,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Cv+"web",uploader:new yv,downloader:new dv}),this.models=new sy(this.apiClient),this.live=new ey(this.apiClient,o,new vv),this.batches=new yf(this.apiClient),this.chats=new _m(this.models,this.apiClient),this.caches=new Am(this.apiClient),this.files=new Um(this.apiClient),this.operations=new ly(this.apiClient),this.authTokens=new Oy(this.apiClient),this.tunings=new cv(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const Sv=n=>{let e="";const t=n.byteLength;for(let i=0;i<t;i++)e+=String.fromCharCode(n[i]);return btoa(e)},Bv=n=>{const e=atob(n),t=e.length,i=new Uint8Array(t);for(let o=0;o<t;o++)i[o]=e.charCodeAt(o);return i},_v=n=>{const e=n.length,t=new Int16Array(e);for(let i=0;i<e;i++)t[i]=n[i]*32768;return{data:Sv(new Uint8Array(t.buffer)),mimeType:"audio/pcm;rate=16000"}},Tv=async(n,e,t,i)=>{const o=e.createBuffer(i,n.length/2/i,t),r=new Int16Array(n.buffer),l=r.length,h=new Float32Array(l);for(let c=0;c<l;c++)h[c]=r[c]/32768;for(let c=0;c<i;c++){const d=h.filter((u,f)=>f%i===c);o.copyToChannel(d,c)}return o};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/class ih{constructor(e){this.bufferLength=0,this.analyser=e.context.createAnalyser(),this.analyser.fftSize=32,this.bufferLength=this.analyser.frequencyBinCount;const t=new ArrayBuffer(this.bufferLength);this.dataArray=new Uint8Array(t),e.connect(this.analyser)}update(){this.analyser.getByteFrequencyData(this.dataArray)}get data(){return this.dataArray}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const vs="176",Fv=0,oh=1,Dv=2,Lc=1,Mv=2,Sn=3,Xn=0,Gt=1,Bn=2,Mn=0,ki=1,ba=2,rh=3,ah=4,Pv=5,oi=100,kv=101,Iv=102,Rv=103,Nv=104,Lv=200,Hv=201,Gv=202,Uv=203,ya=204,va=205,Ov=206,zv=207,Vv=208,Wv=209,Jv=210,qv=211,Xv=212,Kv=213,Yv=214,wa=0,Ea=1,Ca=2,Ri=3,Aa=4,Sa=5,Ba=6,_a=7,Hc=0,$v=1,Zv=2,qn=0,Qv=1,jv=2,ew=3,tw=4,nw=5,iw=6,ow=7,Gc=300,Ni=301,Li=302,fr=303,Ta=304,Er=306,Fa=1e3,Fn=1001,Da=1002,qt=1003,rw=1004,Fo=1005,Lt=1006,Dr=1007,Jn=1008,kn=1009,Uc=1010,Oc=1011,uo=1012,ws=1013,si=1014,Qt=1015,Jt=1016,Es=1017,Cs=1018,fo=1020,zc=35902,Vc=1021,Wc=1022,jt=1023,mo=1026,po=1027,As=1028,Ss=1029,Jc=1030,Bs=1031,_s=1033,tr=33776,nr=33777,ir=33778,or=33779,Ma=35840,Pa=35841,ka=35842,Ia=35843,Ra=36196,Na=37492,La=37496,Ha=37808,Ga=37809,Ua=37810,Oa=37811,za=37812,Va=37813,Wa=37814,Ja=37815,qa=37816,Xa=37817,Ka=37818,Ya=37819,$a=37820,Za=37821,rr=36492,Qa=36494,ja=36495,qc=36283,es=36284,ts=36285,ns=36286,aw=3200,sw=3201,Xc=0,lw=1,_n="",Yt="srgb",Kn="srgb-linear",mr="linear",mt="srgb",ui=7680,sh=519,hw=512,cw=513,dw=514,Kc=515,uw=516,fw=517,mw=518,pw=519,lh=35044,is="300 es",Dn=2e3,pr=2001;class Wi{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const o=i[e];if(o!==void 0){const r=o.indexOf(t);r!==-1&&o.splice(r,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let r=0,l=o.length;r<l;r++)o[r].call(this,e);e.target=null}}}const Pt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Mr=Math.PI/180,os=180/Math.PI;function go(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Pt[n&255]+Pt[n>>8&255]+Pt[n>>16&255]+Pt[n>>24&255]+"-"+Pt[e&255]+Pt[e>>8&255]+"-"+Pt[e>>16&15|64]+Pt[e>>24&255]+"-"+Pt[t&63|128]+Pt[t>>8&255]+"-"+Pt[t>>16&255]+Pt[t>>24&255]+Pt[i&255]+Pt[i>>8&255]+Pt[i>>16&255]+Pt[i>>24&255]).toLowerCase()}function ot(n,e,t){return Math.max(e,Math.min(t,n))}function xw(n,e){return(n%e+e)%e}function Pr(n,e,t){return(1-t)*n+t*e}function ji(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ot(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}class $e{constructor(e=0,t=0){$e.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6],this.y=o[1]*t+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ot(this.x,e.x,t.x),this.y=ot(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ot(this.x,e,t),this.y=ot(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ot(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ot(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),o=Math.sin(t),r=this.x-e.x,l=this.y-e.y;return this.x=r*i-l*o+e.x,this.y=r*o+l*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class tt{constructor(e,t,i,o,r,l,h,c,d){tt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,o,r,l,h,c,d)}set(e,t,i,o,r,l,h,c,d){const u=this.elements;return u[0]=e,u[1]=o,u[2]=h,u[3]=t,u[4]=r,u[5]=c,u[6]=i,u[7]=l,u[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,r=this.elements,l=i[0],h=i[3],c=i[6],d=i[1],u=i[4],f=i[7],m=i[2],p=i[5],b=i[8],E=o[0],g=o[3],x=o[6],T=o[1],C=o[4],y=o[7],F=o[2],_=o[5],B=o[8];return r[0]=l*E+h*T+c*F,r[3]=l*g+h*C+c*_,r[6]=l*x+h*y+c*B,r[1]=d*E+u*T+f*F,r[4]=d*g+u*C+f*_,r[7]=d*x+u*y+f*B,r[2]=m*E+p*T+b*F,r[5]=m*g+p*C+b*_,r[8]=m*x+p*y+b*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],o=e[2],r=e[3],l=e[4],h=e[5],c=e[6],d=e[7],u=e[8];return t*l*u-t*h*d-i*r*u+i*h*c+o*r*d-o*l*c}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],r=e[3],l=e[4],h=e[5],c=e[6],d=e[7],u=e[8],f=u*l-h*d,m=h*c-u*r,p=d*r-l*c,b=t*f+i*m+o*p;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const E=1/b;return e[0]=f*E,e[1]=(o*d-u*i)*E,e[2]=(h*i-o*l)*E,e[3]=m*E,e[4]=(u*t-o*c)*E,e[5]=(o*r-h*t)*E,e[6]=p*E,e[7]=(i*c-d*t)*E,e[8]=(l*t-i*r)*E,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,o,r,l,h){const c=Math.cos(r),d=Math.sin(r);return this.set(i*c,i*d,-i*(c*l+d*h)+l+e,-o*d,o*c,-o*(-d*l+c*h)+h+t,0,0,1),this}scale(e,t){return this.premultiply(kr.makeScale(e,t)),this}rotate(e){return this.premultiply(kr.makeRotation(-e)),this}translate(e,t){return this.premultiply(kr.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<9;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const kr=new tt;function Yc(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function xr(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function gw(){const n=xr("canvas");return n.style.display="block",n}const hh={};function ar(n){n in hh||(hh[n]=!0,console.warn(n))}function bw(n,e,t){return new Promise(function(i,o){function r(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:o();break;case n.TIMEOUT_EXPIRED:setTimeout(r,t);break;default:i()}}setTimeout(r,t)})}function yw(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function vw(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const ch=new tt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),dh=new tt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ww(){const n={enabled:!0,workingColorSpace:Kn,spaces:{},convert:function(o,r,l){return this.enabled===!1||r===l||!r||!l||(this.spaces[r].transfer===mt&&(o.r=Pn(o.r),o.g=Pn(o.g),o.b=Pn(o.b)),this.spaces[r].primaries!==this.spaces[l].primaries&&(o.applyMatrix3(this.spaces[r].toXYZ),o.applyMatrix3(this.spaces[l].fromXYZ)),this.spaces[l].transfer===mt&&(o.r=Ii(o.r),o.g=Ii(o.g),o.b=Ii(o.b))),o},fromWorkingColorSpace:function(o,r){return this.convert(o,this.workingColorSpace,r)},toWorkingColorSpace:function(o,r){return this.convert(o,r,this.workingColorSpace)},getPrimaries:function(o){return this.spaces[o].primaries},getTransfer:function(o){return o===_n?mr:this.spaces[o].transfer},getLuminanceCoefficients:function(o,r=this.workingColorSpace){return o.fromArray(this.spaces[r].luminanceCoefficients)},define:function(o){Object.assign(this.spaces,o)},_getMatrix:function(o,r,l){return o.copy(this.spaces[r].toXYZ).multiply(this.spaces[l].fromXYZ)},_getDrawingBufferColorSpace:function(o){return this.spaces[o].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(o=this.workingColorSpace){return this.spaces[o].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[Kn]:{primaries:e,whitePoint:i,transfer:mr,toXYZ:ch,fromXYZ:dh,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Yt},outputColorSpaceConfig:{drawingBufferColorSpace:Yt}},[Yt]:{primaries:e,whitePoint:i,transfer:mt,toXYZ:ch,fromXYZ:dh,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Yt}}}),n}const ct=ww();function Pn(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ii(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let fi;class Ew{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{fi===void 0&&(fi=xr("canvas")),fi.width=e.width,fi.height=e.height;const o=fi.getContext("2d");e instanceof ImageData?o.putImageData(e,0,0):o.drawImage(e,0,0,e.width,e.height),i=fi}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=xr("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),r=o.data;for(let l=0;l<r.length;l++)r[l]=Pn(r[l]/255)*255;return i.putImageData(o,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Pn(t[i]/255)*255):t[i]=Pn(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Cw=0;class Ts{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Cw++}),this.uuid=go(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let r;if(Array.isArray(o)){r=[];for(let l=0,h=o.length;l<h;l++)o[l].isDataTexture?r.push(Ir(o[l].image)):r.push(Ir(o[l]))}else r=Ir(o);i.url=r}return t||(e.images[this.uuid]=i),i}}function Ir(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Ew.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Aw=0;class Ut extends Wi{constructor(e=Ut.DEFAULT_IMAGE,t=Ut.DEFAULT_MAPPING,i=Fn,o=Fn,r=Lt,l=Jn,h=jt,c=kn,d=Ut.DEFAULT_ANISOTROPY,u=_n){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Aw++}),this.uuid=go(),this.name="",this.source=new Ts(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=o,this.magFilter=r,this.minFilter=l,this.anisotropy=d,this.format=h,this.internalFormat=null,this.type=c,this.offset=new $e(0,0),this.repeat=new $e(1,1),this.center=new $e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new tt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isTextureArray=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isTextureArray=e.isTextureArray,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Gc)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Fa:e.x=e.x-Math.floor(e.x);break;case Fn:e.x=e.x<0?0:1;break;case Da:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Fa:e.y=e.y-Math.floor(e.y);break;case Fn:e.y=e.y<0?0:1;break;case Da:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ut.DEFAULT_IMAGE=null;Ut.DEFAULT_MAPPING=Gc;Ut.DEFAULT_ANISOTROPY=1;class vt{constructor(e=0,t=0,i=0,o=1){vt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,o){return this.x=e,this.y=t,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,r=this.w,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*o+l[12]*r,this.y=l[1]*t+l[5]*i+l[9]*o+l[13]*r,this.z=l[2]*t+l[6]*i+l[10]*o+l[14]*r,this.w=l[3]*t+l[7]*i+l[11]*o+l[15]*r,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,o,r;const c=e.elements,d=c[0],u=c[4],f=c[8],m=c[1],p=c[5],b=c[9],E=c[2],g=c[6],x=c[10];if(Math.abs(u-m)<.01&&Math.abs(f-E)<.01&&Math.abs(b-g)<.01){if(Math.abs(u+m)<.1&&Math.abs(f+E)<.1&&Math.abs(b+g)<.1&&Math.abs(d+p+x-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const C=(d+1)/2,y=(p+1)/2,F=(x+1)/2,_=(u+m)/4,B=(f+E)/4,P=(b+g)/4;return C>y&&C>F?C<.01?(i=0,o=.707106781,r=.707106781):(i=Math.sqrt(C),o=_/i,r=B/i):y>F?y<.01?(i=.707106781,o=0,r=.707106781):(o=Math.sqrt(y),i=_/o,r=P/o):F<.01?(i=.707106781,o=.707106781,r=0):(r=Math.sqrt(F),i=B/r,o=P/r),this.set(i,o,r,t),this}let T=Math.sqrt((g-b)*(g-b)+(f-E)*(f-E)+(m-u)*(m-u));return Math.abs(T)<.001&&(T=1),this.x=(g-b)/T,this.y=(f-E)/T,this.z=(m-u)/T,this.w=Math.acos((d+p+x-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ot(this.x,e.x,t.x),this.y=ot(this.y,e.y,t.y),this.z=ot(this.z,e.z,t.z),this.w=ot(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ot(this.x,e,t),this.y=ot(this.y,e,t),this.z=ot(this.z,e,t),this.w=ot(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ot(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Sw extends Wi{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth?i.depth:1,this.scissor=new vt(0,0,e,t),this.scissorTest=!1,this.viewport=new vt(0,0,e,t);const o={width:e,height:t,depth:this.depth};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Lt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,multiview:!1},i);const r=new Ut(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const l=i.count;for(let h=0;h<l;h++)this.textures[h]=r.clone(),this.textures[h].isRenderTargetTexture=!0,this.textures[h].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let o=0,r=this.textures.length;o<r;o++)this.textures[o].image.width=e,this.textures[o].image.height=t,this.textures[o].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const o=Object.assign({},e.textures[t].image);this.textures[t].source=new Ts(o)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class dn extends Sw{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class $c extends Ut{constructor(e=null,t=1,i=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=qt,this.minFilter=qt,this.wrapR=Fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Bw extends Ut{constructor(e=null,t=1,i=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=qt,this.minFilter=qt,this.wrapR=Fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ji{constructor(e=0,t=0,i=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=o}static slerpFlat(e,t,i,o,r,l,h){let c=i[o+0],d=i[o+1],u=i[o+2],f=i[o+3];const m=r[l+0],p=r[l+1],b=r[l+2],E=r[l+3];if(h===0){e[t+0]=c,e[t+1]=d,e[t+2]=u,e[t+3]=f;return}if(h===1){e[t+0]=m,e[t+1]=p,e[t+2]=b,e[t+3]=E;return}if(f!==E||c!==m||d!==p||u!==b){let g=1-h;const x=c*m+d*p+u*b+f*E,T=x>=0?1:-1,C=1-x*x;if(C>Number.EPSILON){const F=Math.sqrt(C),_=Math.atan2(F,x*T);g=Math.sin(g*_)/F,h=Math.sin(h*_)/F}const y=h*T;if(c=c*g+m*y,d=d*g+p*y,u=u*g+b*y,f=f*g+E*y,g===1-h){const F=1/Math.sqrt(c*c+d*d+u*u+f*f);c*=F,d*=F,u*=F,f*=F}}e[t]=c,e[t+1]=d,e[t+2]=u,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,o,r,l){const h=i[o],c=i[o+1],d=i[o+2],u=i[o+3],f=r[l],m=r[l+1],p=r[l+2],b=r[l+3];return e[t]=h*b+u*f+c*p-d*m,e[t+1]=c*b+u*m+d*f-h*p,e[t+2]=d*b+u*p+h*m-c*f,e[t+3]=u*b-h*f-c*m-d*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,o){return this._x=e,this._y=t,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,o=e._y,r=e._z,l=e._order,h=Math.cos,c=Math.sin,d=h(i/2),u=h(o/2),f=h(r/2),m=c(i/2),p=c(o/2),b=c(r/2);switch(l){case"XYZ":this._x=m*u*f+d*p*b,this._y=d*p*f-m*u*b,this._z=d*u*b+m*p*f,this._w=d*u*f-m*p*b;break;case"YXZ":this._x=m*u*f+d*p*b,this._y=d*p*f-m*u*b,this._z=d*u*b-m*p*f,this._w=d*u*f+m*p*b;break;case"ZXY":this._x=m*u*f-d*p*b,this._y=d*p*f+m*u*b,this._z=d*u*b+m*p*f,this._w=d*u*f-m*p*b;break;case"ZYX":this._x=m*u*f-d*p*b,this._y=d*p*f+m*u*b,this._z=d*u*b-m*p*f,this._w=d*u*f+m*p*b;break;case"YZX":this._x=m*u*f+d*p*b,this._y=d*p*f+m*u*b,this._z=d*u*b-m*p*f,this._w=d*u*f-m*p*b;break;case"XZY":this._x=m*u*f-d*p*b,this._y=d*p*f-m*u*b,this._z=d*u*b+m*p*f,this._w=d*u*f+m*p*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+l)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],o=t[4],r=t[8],l=t[1],h=t[5],c=t[9],d=t[2],u=t[6],f=t[10],m=i+h+f;if(m>0){const p=.5/Math.sqrt(m+1);this._w=.25/p,this._x=(u-c)*p,this._y=(r-d)*p,this._z=(l-o)*p}else if(i>h&&i>f){const p=2*Math.sqrt(1+i-h-f);this._w=(u-c)/p,this._x=.25*p,this._y=(o+l)/p,this._z=(r+d)/p}else if(h>f){const p=2*Math.sqrt(1+h-i-f);this._w=(r-d)/p,this._x=(o+l)/p,this._y=.25*p,this._z=(c+u)/p}else{const p=2*Math.sqrt(1+f-i-h);this._w=(l-o)/p,this._x=(r+d)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ot(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,t/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,o=e._y,r=e._z,l=e._w,h=t._x,c=t._y,d=t._z,u=t._w;return this._x=i*u+l*h+o*d-r*c,this._y=o*u+l*c+r*h-i*d,this._z=r*u+l*d+i*c-o*h,this._w=l*u-i*h-o*c-r*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,o=this._y,r=this._z,l=this._w;let h=l*e._w+i*e._x+o*e._y+r*e._z;if(h<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,h=-h):this.copy(e),h>=1)return this._w=l,this._x=i,this._y=o,this._z=r,this;const c=1-h*h;if(c<=Number.EPSILON){const p=1-t;return this._w=p*l+t*this._w,this._x=p*i+t*this._x,this._y=p*o+t*this._y,this._z=p*r+t*this._z,this.normalize(),this}const d=Math.sqrt(c),u=Math.atan2(d,h),f=Math.sin((1-t)*u)/d,m=Math.sin(t*u)/d;return this._w=l*f+this._w*m,this._x=i*f+this._x*m,this._y=o*f+this._y*m,this._z=r*f+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),o=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(o*Math.sin(e),o*Math.cos(e),r*Math.sin(t),r*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Q{constructor(e=0,t=0,i=0){Q.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(uh.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(uh.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*o,this.y=r[1]*t+r[4]*i+r[7]*o,this.z=r[2]*t+r[5]*i+r[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,r=e.elements,l=1/(r[3]*t+r[7]*i+r[11]*o+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*o+r[12])*l,this.y=(r[1]*t+r[5]*i+r[9]*o+r[13])*l,this.z=(r[2]*t+r[6]*i+r[10]*o+r[14])*l,this}applyQuaternion(e){const t=this.x,i=this.y,o=this.z,r=e.x,l=e.y,h=e.z,c=e.w,d=2*(l*o-h*i),u=2*(h*t-r*o),f=2*(r*i-l*t);return this.x=t+c*d+l*f-h*u,this.y=i+c*u+h*d-r*f,this.z=o+c*f+r*u-l*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,o=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*o,this.y=r[1]*t+r[5]*i+r[9]*o,this.z=r[2]*t+r[6]*i+r[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ot(this.x,e.x,t.x),this.y=ot(this.y,e.y,t.y),this.z=ot(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ot(this.x,e,t),this.y=ot(this.y,e,t),this.z=ot(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ot(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,o=e.y,r=e.z,l=t.x,h=t.y,c=t.z;return this.x=o*c-r*h,this.y=r*l-i*c,this.z=i*h-o*l,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Rr.copy(this).projectOnVector(e),this.sub(Rr)}reflect(e){return this.sub(Rr.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ot(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return t*t+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const o=Math.sin(t)*e;return this.x=o*Math.sin(i),this.y=Math.cos(t)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Rr=new Q,uh=new Ji;class bo{constructor(e=new Q(1/0,1/0,1/0),t=new Q(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(rn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(rn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=rn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const r=i.getAttribute("position");if(t===!0&&r!==void 0&&e.isInstancedMesh!==!0)for(let l=0,h=r.count;l<h;l++)e.isMesh===!0?e.getVertexPosition(l,rn):rn.fromBufferAttribute(r,l),rn.applyMatrix4(e.matrixWorld),this.expandByPoint(rn);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Do.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Do.copy(i.boundingBox)),Do.applyMatrix4(e.matrixWorld),this.union(Do)}const o=e.children;for(let r=0,l=o.length;r<l;r++)this.expandByObject(o[r],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,rn),rn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(eo),Mo.subVectors(this.max,eo),mi.subVectors(e.a,eo),pi.subVectors(e.b,eo),xi.subVectors(e.c,eo),Ln.subVectors(pi,mi),Hn.subVectors(xi,pi),$n.subVectors(mi,xi);let t=[0,-Ln.z,Ln.y,0,-Hn.z,Hn.y,0,-$n.z,$n.y,Ln.z,0,-Ln.x,Hn.z,0,-Hn.x,$n.z,0,-$n.x,-Ln.y,Ln.x,0,-Hn.y,Hn.x,0,-$n.y,$n.x,0];return!Nr(t,mi,pi,xi,Mo)||(t=[1,0,0,0,1,0,0,0,1],!Nr(t,mi,pi,xi,Mo))?!1:(Po.crossVectors(Ln,Hn),t=[Po.x,Po.y,Po.z],Nr(t,mi,pi,xi,Mo))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,rn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(rn).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(yn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),yn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),yn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),yn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),yn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),yn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),yn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),yn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(yn),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const yn=[new Q,new Q,new Q,new Q,new Q,new Q,new Q,new Q],rn=new Q,Do=new bo,mi=new Q,pi=new Q,xi=new Q,Ln=new Q,Hn=new Q,$n=new Q,eo=new Q,Mo=new Q,Po=new Q,Zn=new Q;function Nr(n,e,t,i,o){for(let r=0,l=n.length-3;r<=l;r+=3){Zn.fromArray(n,r);const h=o.x*Math.abs(Zn.x)+o.y*Math.abs(Zn.y)+o.z*Math.abs(Zn.z),c=e.dot(Zn),d=t.dot(Zn),u=i.dot(Zn);if(Math.max(-Math.max(c,d,u),Math.min(c,d,u))>h)return!1}return!0}const _w=new bo,to=new Q,Lr=new Q;class Fs{constructor(e=new Q,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):_w.setFromPoints(e).getCenter(i);let o=0;for(let r=0,l=e.length;r<l;r++)o=Math.max(o,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;to.subVectors(e,this.center);const t=to.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),o=(i-this.radius)*.5;this.center.addScaledVector(to,o/i),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Lr.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(to.copy(e.center).add(Lr)),this.expandByPoint(to.copy(e.center).sub(Lr))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const vn=new Q,Hr=new Q,ko=new Q,Gn=new Q,Gr=new Q,Io=new Q,Ur=new Q;class Tw{constructor(e=new Q,t=new Q(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,vn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=vn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(vn.copy(this.origin).addScaledVector(this.direction,t),vn.distanceToSquared(e))}distanceSqToSegment(e,t,i,o){Hr.copy(e).add(t).multiplyScalar(.5),ko.copy(t).sub(e).normalize(),Gn.copy(this.origin).sub(Hr);const r=e.distanceTo(t)*.5,l=-this.direction.dot(ko),h=Gn.dot(this.direction),c=-Gn.dot(ko),d=Gn.lengthSq(),u=Math.abs(1-l*l);let f,m,p,b;if(u>0)if(f=l*c-h,m=l*h-c,b=r*u,f>=0)if(m>=-b)if(m<=b){const E=1/u;f*=E,m*=E,p=f*(f+l*m+2*h)+m*(l*f+m+2*c)+d}else m=r,f=Math.max(0,-(l*m+h)),p=-f*f+m*(m+2*c)+d;else m=-r,f=Math.max(0,-(l*m+h)),p=-f*f+m*(m+2*c)+d;else m<=-b?(f=Math.max(0,-(-l*r+h)),m=f>0?-r:Math.min(Math.max(-r,-c),r),p=-f*f+m*(m+2*c)+d):m<=b?(f=0,m=Math.min(Math.max(-r,-c),r),p=m*(m+2*c)+d):(f=Math.max(0,-(l*r+h)),m=f>0?r:Math.min(Math.max(-r,-c),r),p=-f*f+m*(m+2*c)+d);else m=l>0?-r:r,f=Math.max(0,-(l*m+h)),p=-f*f+m*(m+2*c)+d;return i&&i.copy(this.origin).addScaledVector(this.direction,f),o&&o.copy(Hr).addScaledVector(ko,m),p}intersectSphere(e,t){vn.subVectors(e.center,this.origin);const i=vn.dot(this.direction),o=vn.dot(vn)-i*i,r=e.radius*e.radius;if(o>r)return null;const l=Math.sqrt(r-o),h=i-l,c=i+l;return c<0?null:h<0?this.at(c,t):this.at(h,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,o,r,l,h,c;const d=1/this.direction.x,u=1/this.direction.y,f=1/this.direction.z,m=this.origin;return d>=0?(i=(e.min.x-m.x)*d,o=(e.max.x-m.x)*d):(i=(e.max.x-m.x)*d,o=(e.min.x-m.x)*d),u>=0?(r=(e.min.y-m.y)*u,l=(e.max.y-m.y)*u):(r=(e.max.y-m.y)*u,l=(e.min.y-m.y)*u),i>l||r>o||((r>i||isNaN(i))&&(i=r),(l<o||isNaN(o))&&(o=l),f>=0?(h=(e.min.z-m.z)*f,c=(e.max.z-m.z)*f):(h=(e.max.z-m.z)*f,c=(e.min.z-m.z)*f),i>c||h>o)||((h>i||i!==i)&&(i=h),(c<o||o!==o)&&(o=c),o<0)?null:this.at(i>=0?i:o,t)}intersectsBox(e){return this.intersectBox(e,vn)!==null}intersectTriangle(e,t,i,o,r){Gr.subVectors(t,e),Io.subVectors(i,e),Ur.crossVectors(Gr,Io);let l=this.direction.dot(Ur),h;if(l>0){if(o)return null;h=1}else if(l<0)h=-1,l=-l;else return null;Gn.subVectors(this.origin,e);const c=h*this.direction.dot(Io.crossVectors(Gn,Io));if(c<0)return null;const d=h*this.direction.dot(Gr.cross(Gn));if(d<0||c+d>l)return null;const u=-h*Gn.dot(Ur);return u<0?null:this.at(u/l,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ct{constructor(e,t,i,o,r,l,h,c,d,u,f,m,p,b,E,g){Ct.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,o,r,l,h,c,d,u,f,m,p,b,E,g)}set(e,t,i,o,r,l,h,c,d,u,f,m,p,b,E,g){const x=this.elements;return x[0]=e,x[4]=t,x[8]=i,x[12]=o,x[1]=r,x[5]=l,x[9]=h,x[13]=c,x[2]=d,x[6]=u,x[10]=f,x[14]=m,x[3]=p,x[7]=b,x[11]=E,x[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ct().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,o=1/gi.setFromMatrixColumn(e,0).length(),r=1/gi.setFromMatrixColumn(e,1).length(),l=1/gi.setFromMatrixColumn(e,2).length();return t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*l,t[9]=i[9]*l,t[10]=i[10]*l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,o=e.y,r=e.z,l=Math.cos(i),h=Math.sin(i),c=Math.cos(o),d=Math.sin(o),u=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const m=l*u,p=l*f,b=h*u,E=h*f;t[0]=c*u,t[4]=-c*f,t[8]=d,t[1]=p+b*d,t[5]=m-E*d,t[9]=-h*c,t[2]=E-m*d,t[6]=b+p*d,t[10]=l*c}else if(e.order==="YXZ"){const m=c*u,p=c*f,b=d*u,E=d*f;t[0]=m+E*h,t[4]=b*h-p,t[8]=l*d,t[1]=l*f,t[5]=l*u,t[9]=-h,t[2]=p*h-b,t[6]=E+m*h,t[10]=l*c}else if(e.order==="ZXY"){const m=c*u,p=c*f,b=d*u,E=d*f;t[0]=m-E*h,t[4]=-l*f,t[8]=b+p*h,t[1]=p+b*h,t[5]=l*u,t[9]=E-m*h,t[2]=-l*d,t[6]=h,t[10]=l*c}else if(e.order==="ZYX"){const m=l*u,p=l*f,b=h*u,E=h*f;t[0]=c*u,t[4]=b*d-p,t[8]=m*d+E,t[1]=c*f,t[5]=E*d+m,t[9]=p*d-b,t[2]=-d,t[6]=h*c,t[10]=l*c}else if(e.order==="YZX"){const m=l*c,p=l*d,b=h*c,E=h*d;t[0]=c*u,t[4]=E-m*f,t[8]=b*f+p,t[1]=f,t[5]=l*u,t[9]=-h*u,t[2]=-d*u,t[6]=p*f+b,t[10]=m-E*f}else if(e.order==="XZY"){const m=l*c,p=l*d,b=h*c,E=h*d;t[0]=c*u,t[4]=-f,t[8]=d*u,t[1]=m*f+E,t[5]=l*u,t[9]=p*f-b,t[2]=b*f-p,t[6]=h*u,t[10]=E*f+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Fw,e,Dw)}lookAt(e,t,i){const o=this.elements;return Vt.subVectors(e,t),Vt.lengthSq()===0&&(Vt.z=1),Vt.normalize(),Un.crossVectors(i,Vt),Un.lengthSq()===0&&(Math.abs(i.z)===1?Vt.x+=1e-4:Vt.z+=1e-4,Vt.normalize(),Un.crossVectors(i,Vt)),Un.normalize(),Ro.crossVectors(Vt,Un),o[0]=Un.x,o[4]=Ro.x,o[8]=Vt.x,o[1]=Un.y,o[5]=Ro.y,o[9]=Vt.y,o[2]=Un.z,o[6]=Ro.z,o[10]=Vt.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,r=this.elements,l=i[0],h=i[4],c=i[8],d=i[12],u=i[1],f=i[5],m=i[9],p=i[13],b=i[2],E=i[6],g=i[10],x=i[14],T=i[3],C=i[7],y=i[11],F=i[15],_=o[0],B=o[4],P=o[8],A=o[12],S=o[1],R=o[5],U=o[9],z=o[13],J=o[2],Y=o[6],X=o[10],ee=o[14],$=o[3],he=o[7],fe=o[11],re=o[15];return r[0]=l*_+h*S+c*J+d*$,r[4]=l*B+h*R+c*Y+d*he,r[8]=l*P+h*U+c*X+d*fe,r[12]=l*A+h*z+c*ee+d*re,r[1]=u*_+f*S+m*J+p*$,r[5]=u*B+f*R+m*Y+p*he,r[9]=u*P+f*U+m*X+p*fe,r[13]=u*A+f*z+m*ee+p*re,r[2]=b*_+E*S+g*J+x*$,r[6]=b*B+E*R+g*Y+x*he,r[10]=b*P+E*U+g*X+x*fe,r[14]=b*A+E*z+g*ee+x*re,r[3]=T*_+C*S+y*J+F*$,r[7]=T*B+C*R+y*Y+F*he,r[11]=T*P+C*U+y*X+F*fe,r[15]=T*A+C*z+y*ee+F*re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],o=e[8],r=e[12],l=e[1],h=e[5],c=e[9],d=e[13],u=e[2],f=e[6],m=e[10],p=e[14],b=e[3],E=e[7],g=e[11],x=e[15];return b*(+r*c*f-o*d*f-r*h*m+i*d*m+o*h*p-i*c*p)+E*(+t*c*p-t*d*m+r*l*m-o*l*p+o*d*u-r*c*u)+g*(+t*d*f-t*h*p-r*l*f+i*l*p+r*h*u-i*d*u)+x*(-o*h*u-t*c*f+t*h*m+o*l*f-i*l*m+i*c*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],r=e[3],l=e[4],h=e[5],c=e[6],d=e[7],u=e[8],f=e[9],m=e[10],p=e[11],b=e[12],E=e[13],g=e[14],x=e[15],T=f*g*d-E*m*d+E*c*p-h*g*p-f*c*x+h*m*x,C=b*m*d-u*g*d-b*c*p+l*g*p+u*c*x-l*m*x,y=u*E*d-b*f*d+b*h*p-l*E*p-u*h*x+l*f*x,F=b*f*c-u*E*c-b*h*m+l*E*m+u*h*g-l*f*g,_=t*T+i*C+o*y+r*F;if(_===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const B=1/_;return e[0]=T*B,e[1]=(E*m*r-f*g*r-E*o*p+i*g*p+f*o*x-i*m*x)*B,e[2]=(h*g*r-E*c*r+E*o*d-i*g*d-h*o*x+i*c*x)*B,e[3]=(f*c*r-h*m*r-f*o*d+i*m*d+h*o*p-i*c*p)*B,e[4]=C*B,e[5]=(u*g*r-b*m*r+b*o*p-t*g*p-u*o*x+t*m*x)*B,e[6]=(b*c*r-l*g*r-b*o*d+t*g*d+l*o*x-t*c*x)*B,e[7]=(l*m*r-u*c*r+u*o*d-t*m*d-l*o*p+t*c*p)*B,e[8]=y*B,e[9]=(b*f*r-u*E*r-b*i*p+t*E*p+u*i*x-t*f*x)*B,e[10]=(l*E*r-b*h*r+b*i*d-t*E*d-l*i*x+t*h*x)*B,e[11]=(u*h*r-l*f*r-u*i*d+t*f*d+l*i*p-t*h*p)*B,e[12]=F*B,e[13]=(u*E*o-b*f*o+b*i*m-t*E*m-u*i*g+t*f*g)*B,e[14]=(b*h*o-l*E*o-b*i*c+t*E*c+l*i*g-t*h*g)*B,e[15]=(l*f*o-u*h*o+u*i*c-t*f*c-l*i*m+t*h*m)*B,this}scale(e){const t=this.elements,i=e.x,o=e.y,r=e.z;return t[0]*=i,t[4]*=o,t[8]*=r,t[1]*=i,t[5]*=o,t[9]*=r,t[2]*=i,t[6]*=o,t[10]*=r,t[3]*=i,t[7]*=o,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,o))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),o=Math.sin(t),r=1-i,l=e.x,h=e.y,c=e.z,d=r*l,u=r*h;return this.set(d*l+i,d*h-o*c,d*c+o*h,0,d*h+o*c,u*h+i,u*c-o*l,0,d*c-o*h,u*c+o*l,r*c*c+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,o,r,l){return this.set(1,i,r,0,e,1,l,0,t,o,1,0,0,0,0,1),this}compose(e,t,i){const o=this.elements,r=t._x,l=t._y,h=t._z,c=t._w,d=r+r,u=l+l,f=h+h,m=r*d,p=r*u,b=r*f,E=l*u,g=l*f,x=h*f,T=c*d,C=c*u,y=c*f,F=i.x,_=i.y,B=i.z;return o[0]=(1-(E+x))*F,o[1]=(p+y)*F,o[2]=(b-C)*F,o[3]=0,o[4]=(p-y)*_,o[5]=(1-(m+x))*_,o[6]=(g+T)*_,o[7]=0,o[8]=(b+C)*B,o[9]=(g-T)*B,o[10]=(1-(m+E))*B,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,i){const o=this.elements;let r=gi.set(o[0],o[1],o[2]).length();const l=gi.set(o[4],o[5],o[6]).length(),h=gi.set(o[8],o[9],o[10]).length();this.determinant()<0&&(r=-r),e.x=o[12],e.y=o[13],e.z=o[14],an.copy(this);const d=1/r,u=1/l,f=1/h;return an.elements[0]*=d,an.elements[1]*=d,an.elements[2]*=d,an.elements[4]*=u,an.elements[5]*=u,an.elements[6]*=u,an.elements[8]*=f,an.elements[9]*=f,an.elements[10]*=f,t.setFromRotationMatrix(an),i.x=r,i.y=l,i.z=h,this}makePerspective(e,t,i,o,r,l,h=Dn){const c=this.elements,d=2*r/(t-e),u=2*r/(i-o),f=(t+e)/(t-e),m=(i+o)/(i-o);let p,b;if(h===Dn)p=-(l+r)/(l-r),b=-2*l*r/(l-r);else if(h===pr)p=-l/(l-r),b=-l*r/(l-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+h);return c[0]=d,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=u,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=b,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,o,r,l,h=Dn){const c=this.elements,d=1/(t-e),u=1/(i-o),f=1/(l-r),m=(t+e)*d,p=(i+o)*u;let b,E;if(h===Dn)b=(l+r)*f,E=-2*f;else if(h===pr)b=r*f,E=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+h);return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-m,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-p,c[2]=0,c[6]=0,c[10]=E,c[14]=-b,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<16;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const gi=new Q,an=new Ct,Fw=new Q(0,0,0),Dw=new Q(1,1,1),Un=new Q,Ro=new Q,Vt=new Q,fh=new Ct,mh=new Ji;class un{constructor(e=0,t=0,i=0,o=un.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,o=this._order){return this._x=e,this._y=t,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const o=e.elements,r=o[0],l=o[4],h=o[8],c=o[1],d=o[5],u=o[9],f=o[2],m=o[6],p=o[10];switch(t){case"XYZ":this._y=Math.asin(ot(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-l,r)):(this._x=Math.atan2(m,d),this._z=0);break;case"YXZ":this._x=Math.asin(-ot(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(h,p),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(ot(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-l,d)):(this._y=0,this._z=Math.atan2(c,r));break;case"ZYX":this._y=Math.asin(-ot(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,p),this._z=Math.atan2(c,r)):(this._x=0,this._z=Math.atan2(-l,d));break;case"YZX":this._z=Math.asin(ot(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,d),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(h,p));break;case"XZY":this._z=Math.asin(-ot(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(m,d),this._y=Math.atan2(h,r)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return fh.makeRotationFromQuaternion(e),this.setFromRotationMatrix(fh,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return mh.setFromEuler(this),this.setFromQuaternion(mh,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}un.DEFAULT_ORDER="XYZ";class Zc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Mw=0;const ph=new Q,bi=new Ji,wn=new Ct,No=new Q,no=new Q,Pw=new Q,kw=new Ji,xh=new Q(1,0,0),gh=new Q(0,1,0),bh=new Q(0,0,1),yh={type:"added"},Iw={type:"removed"},yi={type:"childadded",child:null},Or={type:"childremoved",child:null};class Xt extends Wi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Mw++}),this.uuid=go(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xt.DEFAULT_UP.clone();const e=new Q,t=new un,i=new Ji,o=new Q(1,1,1);function r(){i.setFromEuler(t,!1)}function l(){t.setFromQuaternion(i,void 0,!1)}t._onChange(r),i._onChange(l),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Ct},normalMatrix:{value:new tt}}),this.matrix=new Ct,this.matrixWorld=new Ct,this.matrixAutoUpdate=Xt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Xt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Zc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return bi.setFromAxisAngle(e,t),this.quaternion.multiply(bi),this}rotateOnWorldAxis(e,t){return bi.setFromAxisAngle(e,t),this.quaternion.premultiply(bi),this}rotateX(e){return this.rotateOnAxis(xh,e)}rotateY(e){return this.rotateOnAxis(gh,e)}rotateZ(e){return this.rotateOnAxis(bh,e)}translateOnAxis(e,t){return ph.copy(e).applyQuaternion(this.quaternion),this.position.add(ph.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(xh,e)}translateY(e){return this.translateOnAxis(gh,e)}translateZ(e){return this.translateOnAxis(bh,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(wn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?No.copy(e):No.set(e,t,i);const o=this.parent;this.updateWorldMatrix(!0,!1),no.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wn.lookAt(no,No,this.up):wn.lookAt(No,no,this.up),this.quaternion.setFromRotationMatrix(wn),o&&(wn.extractRotation(o.matrixWorld),bi.setFromRotationMatrix(wn),this.quaternion.premultiply(bi.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(yh),yi.child=e,this.dispatchEvent(yi),yi.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Iw),Or.child=e,this.dispatchEvent(Or),Or.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),wn.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),wn.multiply(e.parent.matrixWorld)),e.applyMatrix4(wn),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(yh),yi.child=e,this.dispatchEvent(yi),yi.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,o=this.children.length;i<o;i++){const l=this.children[i].getObjectByProperty(e,t);if(l!==void 0)return l}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const o=this.children;for(let r=0,l=o.length;r<l;r++)o[r].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(no,e,Pw),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(no,kw,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const o=this.children;for(let r=0,l=o.length;r<l;r++)o[r].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.geometryInfo=this._geometryInfo.map(h=>({...h,boundingBox:h.boundingBox?{min:h.boundingBox.min.toArray(),max:h.boundingBox.max.toArray()}:void 0,boundingSphere:h.boundingSphere?{radius:h.boundingSphere.radius,center:h.boundingSphere.center.toArray()}:void 0})),o.instanceInfo=this._instanceInfo.map(h=>({...h})),o.availableInstanceIds=this._availableInstanceIds.slice(),o.availableGeometryIds=this._availableGeometryIds.slice(),o.nextIndexStart=this._nextIndexStart,o.nextVertexStart=this._nextVertexStart,o.geometryCount=this._geometryCount,o.maxInstanceCount=this._maxInstanceCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.matricesTexture=this._matricesTexture.toJSON(e),o.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(o.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(o.boundingSphere={center:this.boundingSphere.center.toArray(),radius:this.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:this.boundingBox.min.toArray(),max:this.boundingBox.max.toArray()}));function r(h,c){return h[c.uuid]===void 0&&(h[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=r(e.geometries,this.geometry);const h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){const c=h.shapes;if(Array.isArray(c))for(let d=0,u=c.length;d<u;d++){const f=c[d];r(e.shapes,f)}else r(e.shapes,c)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const h=[];for(let c=0,d=this.material.length;c<d;c++)h.push(r(e.materials,this.material[c]));o.material=h}else o.material=r(e.materials,this.material);if(this.children.length>0){o.children=[];for(let h=0;h<this.children.length;h++)o.children.push(this.children[h].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let h=0;h<this.animations.length;h++){const c=this.animations[h];o.animations.push(r(e.animations,c))}}if(t){const h=l(e.geometries),c=l(e.materials),d=l(e.textures),u=l(e.images),f=l(e.shapes),m=l(e.skeletons),p=l(e.animations),b=l(e.nodes);h.length>0&&(i.geometries=h),c.length>0&&(i.materials=c),d.length>0&&(i.textures=d),u.length>0&&(i.images=u),f.length>0&&(i.shapes=f),m.length>0&&(i.skeletons=m),p.length>0&&(i.animations=p),b.length>0&&(i.nodes=b)}return i.object=o,i;function l(h){const c=[];for(const d in h){const u=h[d];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}}Xt.DEFAULT_UP=new Q(0,1,0);Xt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Xt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const sn=new Q,En=new Q,zr=new Q,Cn=new Q,vi=new Q,wi=new Q,vh=new Q,Vr=new Q,Wr=new Q,Jr=new Q,qr=new vt,Xr=new vt,Kr=new vt;class cn{constructor(e=new Q,t=new Q,i=new Q){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,o){o.subVectors(i,t),sn.subVectors(e,t),o.cross(sn);const r=o.lengthSq();return r>0?o.multiplyScalar(1/Math.sqrt(r)):o.set(0,0,0)}static getBarycoord(e,t,i,o,r){sn.subVectors(o,t),En.subVectors(i,t),zr.subVectors(e,t);const l=sn.dot(sn),h=sn.dot(En),c=sn.dot(zr),d=En.dot(En),u=En.dot(zr),f=l*d-h*h;if(f===0)return r.set(0,0,0),null;const m=1/f,p=(d*c-h*u)*m,b=(l*u-h*c)*m;return r.set(1-p-b,b,p)}static containsPoint(e,t,i,o){return this.getBarycoord(e,t,i,o,Cn)===null?!1:Cn.x>=0&&Cn.y>=0&&Cn.x+Cn.y<=1}static getInterpolation(e,t,i,o,r,l,h,c){return this.getBarycoord(e,t,i,o,Cn)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(r,Cn.x),c.addScaledVector(l,Cn.y),c.addScaledVector(h,Cn.z),c)}static getInterpolatedAttribute(e,t,i,o,r,l){return qr.setScalar(0),Xr.setScalar(0),Kr.setScalar(0),qr.fromBufferAttribute(e,t),Xr.fromBufferAttribute(e,i),Kr.fromBufferAttribute(e,o),l.setScalar(0),l.addScaledVector(qr,r.x),l.addScaledVector(Xr,r.y),l.addScaledVector(Kr,r.z),l}static isFrontFacing(e,t,i,o){return sn.subVectors(i,t),En.subVectors(e,t),sn.cross(En).dot(o)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,o){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,i,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return sn.subVectors(this.c,this.b),En.subVectors(this.a,this.b),sn.cross(En).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cn.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,o,r){return cn.getInterpolation(e,this.a,this.b,this.c,t,i,o,r)}containsPoint(e){return cn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,o=this.b,r=this.c;let l,h;vi.subVectors(o,i),wi.subVectors(r,i),Vr.subVectors(e,i);const c=vi.dot(Vr),d=wi.dot(Vr);if(c<=0&&d<=0)return t.copy(i);Wr.subVectors(e,o);const u=vi.dot(Wr),f=wi.dot(Wr);if(u>=0&&f<=u)return t.copy(o);const m=c*f-u*d;if(m<=0&&c>=0&&u<=0)return l=c/(c-u),t.copy(i).addScaledVector(vi,l);Jr.subVectors(e,r);const p=vi.dot(Jr),b=wi.dot(Jr);if(b>=0&&p<=b)return t.copy(r);const E=p*d-c*b;if(E<=0&&d>=0&&b<=0)return h=d/(d-b),t.copy(i).addScaledVector(wi,h);const g=u*b-p*f;if(g<=0&&f-u>=0&&p-b>=0)return vh.subVectors(r,o),h=(f-u)/(f-u+(p-b)),t.copy(o).addScaledVector(vh,h);const x=1/(g+E+m);return l=E*x,h=m*x,t.copy(i).addScaledVector(vi,l).addScaledVector(wi,h)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Qc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},On={h:0,s:0,l:0},Lo={h:0,s:0,l:0};function Yr(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class st{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const o=e;o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Yt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ct.toWorkingColorSpace(this,t),this}setRGB(e,t,i,o=ct.workingColorSpace){return this.r=e,this.g=t,this.b=i,ct.toWorkingColorSpace(this,o),this}setHSL(e,t,i,o=ct.workingColorSpace){if(e=xw(e,1),t=ot(t,0,1),i=ot(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,l=2*i-r;this.r=Yr(l,r,e+1/3),this.g=Yr(l,r,e),this.b=Yr(l,r,e-1/3)}return ct.toWorkingColorSpace(this,o),this}setStyle(e,t=Yt){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let r;const l=o[1],h=o[2];switch(l){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,t);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,t);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(h))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=o[1],l=r.length;if(l===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(l===6)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Yt){const i=Qc[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Pn(e.r),this.g=Pn(e.g),this.b=Pn(e.b),this}copyLinearToSRGB(e){return this.r=Ii(e.r),this.g=Ii(e.g),this.b=Ii(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Yt){return ct.fromWorkingColorSpace(kt.copy(this),e),Math.round(ot(kt.r*255,0,255))*65536+Math.round(ot(kt.g*255,0,255))*256+Math.round(ot(kt.b*255,0,255))}getHexString(e=Yt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ct.workingColorSpace){ct.fromWorkingColorSpace(kt.copy(this),t);const i=kt.r,o=kt.g,r=kt.b,l=Math.max(i,o,r),h=Math.min(i,o,r);let c,d;const u=(h+l)/2;if(h===l)c=0,d=0;else{const f=l-h;switch(d=u<=.5?f/(l+h):f/(2-l-h),l){case i:c=(o-r)/f+(o<r?6:0);break;case o:c=(r-i)/f+2;break;case r:c=(i-o)/f+4;break}c/=6}return e.h=c,e.s=d,e.l=u,e}getRGB(e,t=ct.workingColorSpace){return ct.fromWorkingColorSpace(kt.copy(this),t),e.r=kt.r,e.g=kt.g,e.b=kt.b,e}getStyle(e=Yt){ct.fromWorkingColorSpace(kt.copy(this),e);const t=kt.r,i=kt.g,o=kt.b;return e!==Yt?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(o*255)})`}offsetHSL(e,t,i){return this.getHSL(On),this.setHSL(On.h+e,On.s+t,On.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(On),e.getHSL(Lo);const i=Pr(On.h,Lo.h,t),o=Pr(On.s,Lo.s,t),r=Pr(On.l,Lo.l,t);return this.setHSL(i,o,r),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,o=this.b,r=e.elements;return this.r=r[0]*t+r[3]*i+r[6]*o,this.g=r[1]*t+r[4]*i+r[7]*o,this.b=r[2]*t+r[5]*i+r[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const kt=new st;st.NAMES=Qc;let Rw=0;class yo extends Wi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Rw++}),this.uuid=go(),this.name="",this.type="Material",this.blending=ki,this.side=Xn,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=ya,this.blendDst=va,this.blendEquation=oi,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new st(0,0,0),this.blendAlpha=0,this.depthFunc=Ri,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=sh,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ui,this.stencilZFail=ui,this.stencilZPass=ui,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const o=this[t];if(o===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ki&&(i.blending=this.blending),this.side!==Xn&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==ya&&(i.blendSrc=this.blendSrc),this.blendDst!==va&&(i.blendDst=this.blendDst),this.blendEquation!==oi&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Ri&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==sh&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==ui&&(i.stencilFail=this.stencilFail),this.stencilZFail!==ui&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==ui&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function o(r){const l=[];for(const h in r){const c=r[h];delete c.metadata,l.push(c)}return l}if(t){const r=o(e.textures),l=o(e.images);r.length>0&&(i.textures=r),l.length>0&&(i.images=l)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const o=t.length;i=new Array(o);for(let r=0;r!==o;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Ds extends yo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new st(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new un,this.combine=Hc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Tn=Nw();function Nw(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),o=new Uint32Array(512);for(let c=0;c<256;++c){const d=c-127;d<-27?(i[c]=0,i[c|256]=32768,o[c]=24,o[c|256]=24):d<-14?(i[c]=1024>>-d-14,i[c|256]=1024>>-d-14|32768,o[c]=-d-1,o[c|256]=-d-1):d<=15?(i[c]=d+15<<10,i[c|256]=d+15<<10|32768,o[c]=13,o[c|256]=13):d<128?(i[c]=31744,i[c|256]=64512,o[c]=24,o[c|256]=24):(i[c]=31744,i[c|256]=64512,o[c]=13,o[c|256]=13)}const r=new Uint32Array(2048),l=new Uint32Array(64),h=new Uint32Array(64);for(let c=1;c<1024;++c){let d=c<<13,u=0;for(;(d&8388608)===0;)d<<=1,u-=8388608;d&=-8388609,u+=947912704,r[c]=d|u}for(let c=1024;c<2048;++c)r[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)l[c]=c<<23;l[31]=1199570944,l[32]=2147483648;for(let c=33;c<63;++c)l[c]=2147483648+(c-32<<23);l[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(h[c]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:o,mantissaTable:r,exponentTable:l,offsetTable:h}}function Lw(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=ot(n,-65504,65504),Tn.floatView[0]=n;const e=Tn.uint32View[0],t=e>>23&511;return Tn.baseTable[t]+((e&8388607)>>Tn.shiftTable[t])}function Hw(n){const e=n>>10;return Tn.uint32View[0]=Tn.mantissaTable[Tn.offsetTable[e]+(n&1023)]+Tn.exponentTable[e],Tn.floatView[0]}class wh{static toHalfFloat(e){return Lw(e)}static fromHalfFloat(e){return Hw(e)}}const Et=new Q,Ho=new $e;let Gw=0;class xn{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Gw++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=lh,this.updateRanges=[],this.gpuType=Qt,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let o=0,r=this.itemSize;o<r;o++)this.array[e+o]=t.array[i+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Ho.fromBufferAttribute(this,t),Ho.applyMatrix3(e),this.setXY(t,Ho.x,Ho.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Et.fromBufferAttribute(this,t),Et.applyMatrix3(e),this.setXYZ(t,Et.x,Et.y,Et.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Et.fromBufferAttribute(this,t),Et.applyMatrix4(e),this.setXYZ(t,Et.x,Et.y,Et.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Et.fromBufferAttribute(this,t),Et.applyNormalMatrix(e),this.setXYZ(t,Et.x,Et.y,Et.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Et.fromBufferAttribute(this,t),Et.transformDirection(e),this.setXYZ(t,Et.x,Et.y,Et.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ji(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Ot(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ji(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ji(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ji(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ji(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ot(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),i=Ot(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,o){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),i=Ot(i,this.array),o=Ot(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,t,i,o,r){return e*=this.itemSize,this.normalized&&(t=Ot(t,this.array),i=Ot(i,this.array),o=Ot(o,this.array),r=Ot(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==lh&&(e.usage=this.usage),e}}class jc extends xn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class ed extends xn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class nn extends xn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Uw=0;const Kt=new Ct,$r=new Xt,Ei=new Q,Wt=new bo,io=new bo,Dt=new Q;class Rn extends Wi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Uw++}),this.uuid=go(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Yc(e)?ed:jc)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new tt().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Kt.makeRotationFromQuaternion(e),this.applyMatrix4(Kt),this}rotateX(e){return Kt.makeRotationX(e),this.applyMatrix4(Kt),this}rotateY(e){return Kt.makeRotationY(e),this.applyMatrix4(Kt),this}rotateZ(e){return Kt.makeRotationZ(e),this.applyMatrix4(Kt),this}translate(e,t,i){return Kt.makeTranslation(e,t,i),this.applyMatrix4(Kt),this}scale(e,t,i){return Kt.makeScale(e,t,i),this.applyMatrix4(Kt),this}lookAt(e){return $r.lookAt(e),$r.updateMatrix(),this.applyMatrix4($r.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ei).negate(),this.translate(Ei.x,Ei.y,Ei.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let o=0,r=e.length;o<r;o++){const l=e[o];i.push(l.x,l.y,l.z||0)}this.setAttribute("position",new nn(i,3))}else{const i=Math.min(e.length,t.count);for(let o=0;o<i;o++){const r=e[o];t.setXYZ(o,r.x,r.y,r.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new bo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Q(-1/0,-1/0,-1/0),new Q(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const r=t[i];Wt.setFromBufferAttribute(r),this.morphTargetsRelative?(Dt.addVectors(this.boundingBox.min,Wt.min),this.boundingBox.expandByPoint(Dt),Dt.addVectors(this.boundingBox.max,Wt.max),this.boundingBox.expandByPoint(Dt)):(this.boundingBox.expandByPoint(Wt.min),this.boundingBox.expandByPoint(Wt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fs);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Q,1/0);return}if(e){const i=this.boundingSphere.center;if(Wt.setFromBufferAttribute(e),t)for(let r=0,l=t.length;r<l;r++){const h=t[r];io.setFromBufferAttribute(h),this.morphTargetsRelative?(Dt.addVectors(Wt.min,io.min),Wt.expandByPoint(Dt),Dt.addVectors(Wt.max,io.max),Wt.expandByPoint(Dt)):(Wt.expandByPoint(io.min),Wt.expandByPoint(io.max))}Wt.getCenter(i);let o=0;for(let r=0,l=e.count;r<l;r++)Dt.fromBufferAttribute(e,r),o=Math.max(o,i.distanceToSquared(Dt));if(t)for(let r=0,l=t.length;r<l;r++){const h=t[r],c=this.morphTargetsRelative;for(let d=0,u=h.count;d<u;d++)Dt.fromBufferAttribute(h,d),c&&(Ei.fromBufferAttribute(e,d),Dt.add(Ei)),o=Math.max(o,i.distanceToSquared(Dt))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,o=t.normal,r=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xn(new Float32Array(4*i.count),4));const l=this.getAttribute("tangent"),h=[],c=[];for(let P=0;P<i.count;P++)h[P]=new Q,c[P]=new Q;const d=new Q,u=new Q,f=new Q,m=new $e,p=new $e,b=new $e,E=new Q,g=new Q;function x(P,A,S){d.fromBufferAttribute(i,P),u.fromBufferAttribute(i,A),f.fromBufferAttribute(i,S),m.fromBufferAttribute(r,P),p.fromBufferAttribute(r,A),b.fromBufferAttribute(r,S),u.sub(d),f.sub(d),p.sub(m),b.sub(m);const R=1/(p.x*b.y-b.x*p.y);isFinite(R)&&(E.copy(u).multiplyScalar(b.y).addScaledVector(f,-p.y).multiplyScalar(R),g.copy(f).multiplyScalar(p.x).addScaledVector(u,-b.x).multiplyScalar(R),h[P].add(E),h[A].add(E),h[S].add(E),c[P].add(g),c[A].add(g),c[S].add(g))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let P=0,A=T.length;P<A;++P){const S=T[P],R=S.start,U=S.count;for(let z=R,J=R+U;z<J;z+=3)x(e.getX(z+0),e.getX(z+1),e.getX(z+2))}const C=new Q,y=new Q,F=new Q,_=new Q;function B(P){F.fromBufferAttribute(o,P),_.copy(F);const A=h[P];C.copy(A),C.sub(F.multiplyScalar(F.dot(A))).normalize(),y.crossVectors(_,A);const R=y.dot(c[P])<0?-1:1;l.setXYZW(P,C.x,C.y,C.z,R)}for(let P=0,A=T.length;P<A;++P){const S=T[P],R=S.start,U=S.count;for(let z=R,J=R+U;z<J;z+=3)B(e.getX(z+0)),B(e.getX(z+1)),B(e.getX(z+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new xn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let m=0,p=i.count;m<p;m++)i.setXYZ(m,0,0,0);const o=new Q,r=new Q,l=new Q,h=new Q,c=new Q,d=new Q,u=new Q,f=new Q;if(e)for(let m=0,p=e.count;m<p;m+=3){const b=e.getX(m+0),E=e.getX(m+1),g=e.getX(m+2);o.fromBufferAttribute(t,b),r.fromBufferAttribute(t,E),l.fromBufferAttribute(t,g),u.subVectors(l,r),f.subVectors(o,r),u.cross(f),h.fromBufferAttribute(i,b),c.fromBufferAttribute(i,E),d.fromBufferAttribute(i,g),h.add(u),c.add(u),d.add(u),i.setXYZ(b,h.x,h.y,h.z),i.setXYZ(E,c.x,c.y,c.z),i.setXYZ(g,d.x,d.y,d.z)}else for(let m=0,p=t.count;m<p;m+=3)o.fromBufferAttribute(t,m+0),r.fromBufferAttribute(t,m+1),l.fromBufferAttribute(t,m+2),u.subVectors(l,r),f.subVectors(o,r),u.cross(f),i.setXYZ(m+0,u.x,u.y,u.z),i.setXYZ(m+1,u.x,u.y,u.z),i.setXYZ(m+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Dt.fromBufferAttribute(e,t),Dt.normalize(),e.setXYZ(t,Dt.x,Dt.y,Dt.z)}toNonIndexed(){function e(h,c){const d=h.array,u=h.itemSize,f=h.normalized,m=new d.constructor(c.length*u);let p=0,b=0;for(let E=0,g=c.length;E<g;E++){h.isInterleavedBufferAttribute?p=c[E]*h.data.stride+h.offset:p=c[E]*u;for(let x=0;x<u;x++)m[b++]=d[p++]}return new xn(m,u,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Rn,i=this.index.array,o=this.attributes;for(const h in o){const c=o[h],d=e(c,i);t.setAttribute(h,d)}const r=this.morphAttributes;for(const h in r){const c=[],d=r[h];for(let u=0,f=d.length;u<f;u++){const m=d[u],p=e(m,i);c.push(p)}t.morphAttributes[h]=c}t.morphTargetsRelative=this.morphTargetsRelative;const l=this.groups;for(let h=0,c=l.length;h<c;h++){const d=l[h];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const c in i){const d=i[c];e.data.attributes[c]=d.toJSON(e.data)}const o={};let r=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],u=[];for(let f=0,m=d.length;f<m;f++){const p=d[f];u.push(p.toJSON(e.data))}u.length>0&&(o[c]=u,r=!0)}r&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const l=this.groups;l.length>0&&(e.data.groups=JSON.parse(JSON.stringify(l)));const h=this.boundingSphere;return h!==null&&(e.data.boundingSphere={center:h.center.toArray(),radius:h.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const o=e.attributes;for(const d in o){const u=o[d];this.setAttribute(d,u.clone(t))}const r=e.morphAttributes;for(const d in r){const u=[],f=r[d];for(let m=0,p=f.length;m<p;m++)u.push(f[m].clone(t));this.morphAttributes[d]=u}this.morphTargetsRelative=e.morphTargetsRelative;const l=e.groups;for(let d=0,u=l.length;d<u;d++){const f=l[d];this.addGroup(f.start,f.count,f.materialIndex)}const h=e.boundingBox;h!==null&&(this.boundingBox=h.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Eh=new Ct,Qn=new Tw,Go=new Fs,Ch=new Q,Uo=new Q,Oo=new Q,zo=new Q,Zr=new Q,Vo=new Q,Ah=new Q,Wo=new Q;class en extends Xt{constructor(e=new Rn,t=new Ds){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,l=o.length;r<l;r++){const h=o[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[h]=r}}}}getVertexPosition(e,t){const i=this.geometry,o=i.attributes.position,r=i.morphAttributes.position,l=i.morphTargetsRelative;t.fromBufferAttribute(o,e);const h=this.morphTargetInfluences;if(r&&h){Vo.set(0,0,0);for(let c=0,d=r.length;c<d;c++){const u=h[c],f=r[c];u!==0&&(Zr.fromBufferAttribute(f,e),l?Vo.addScaledVector(Zr,u):Vo.addScaledVector(Zr.sub(t),u))}t.add(Vo)}return t}raycast(e,t){const i=this.geometry,o=this.material,r=this.matrixWorld;o!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Go.copy(i.boundingSphere),Go.applyMatrix4(r),Qn.copy(e.ray).recast(e.near),!(Go.containsPoint(Qn.origin)===!1&&(Qn.intersectSphere(Go,Ch)===null||Qn.origin.distanceToSquared(Ch)>(e.far-e.near)**2))&&(Eh.copy(r).invert(),Qn.copy(e.ray).applyMatrix4(Eh),!(i.boundingBox!==null&&Qn.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Qn)))}_computeIntersections(e,t,i){let o;const r=this.geometry,l=this.material,h=r.index,c=r.attributes.position,d=r.attributes.uv,u=r.attributes.uv1,f=r.attributes.normal,m=r.groups,p=r.drawRange;if(h!==null)if(Array.isArray(l))for(let b=0,E=m.length;b<E;b++){const g=m[b],x=l[g.materialIndex],T=Math.max(g.start,p.start),C=Math.min(h.count,Math.min(g.start+g.count,p.start+p.count));for(let y=T,F=C;y<F;y+=3){const _=h.getX(y),B=h.getX(y+1),P=h.getX(y+2);o=Jo(this,x,e,i,d,u,f,_,B,P),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=g.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),E=Math.min(h.count,p.start+p.count);for(let g=b,x=E;g<x;g+=3){const T=h.getX(g),C=h.getX(g+1),y=h.getX(g+2);o=Jo(this,l,e,i,d,u,f,T,C,y),o&&(o.faceIndex=Math.floor(g/3),t.push(o))}}else if(c!==void 0)if(Array.isArray(l))for(let b=0,E=m.length;b<E;b++){const g=m[b],x=l[g.materialIndex],T=Math.max(g.start,p.start),C=Math.min(c.count,Math.min(g.start+g.count,p.start+p.count));for(let y=T,F=C;y<F;y+=3){const _=y,B=y+1,P=y+2;o=Jo(this,x,e,i,d,u,f,_,B,P),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=g.materialIndex,t.push(o))}}else{const b=Math.max(0,p.start),E=Math.min(c.count,p.start+p.count);for(let g=b,x=E;g<x;g+=3){const T=g,C=g+1,y=g+2;o=Jo(this,l,e,i,d,u,f,T,C,y),o&&(o.faceIndex=Math.floor(g/3),t.push(o))}}}}function Ow(n,e,t,i,o,r,l,h){let c;if(e.side===Gt?c=i.intersectTriangle(l,r,o,!0,h):c=i.intersectTriangle(o,r,l,e.side===Xn,h),c===null)return null;Wo.copy(h),Wo.applyMatrix4(n.matrixWorld);const d=t.ray.origin.distanceTo(Wo);return d<t.near||d>t.far?null:{distance:d,point:Wo.clone(),object:n}}function Jo(n,e,t,i,o,r,l,h,c,d){n.getVertexPosition(h,Uo),n.getVertexPosition(c,Oo),n.getVertexPosition(d,zo);const u=Ow(n,e,t,i,Uo,Oo,zo,Ah);if(u){const f=new Q;cn.getBarycoord(Ah,Uo,Oo,zo,f),o&&(u.uv=cn.getInterpolatedAttribute(o,h,c,d,f,new $e)),r&&(u.uv1=cn.getInterpolatedAttribute(r,h,c,d,f,new $e)),l&&(u.normal=cn.getInterpolatedAttribute(l,h,c,d,f,new Q),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const m={a:h,b:c,c:d,normal:new Q,materialIndex:0};cn.getNormal(Uo,Oo,zo,m.normal),u.face=m,u.barycoord=f}return u}class vo extends Rn{constructor(e=1,t=1,i=1,o=1,r=1,l=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:o,heightSegments:r,depthSegments:l};const h=this;o=Math.floor(o),r=Math.floor(r),l=Math.floor(l);const c=[],d=[],u=[],f=[];let m=0,p=0;b("z","y","x",-1,-1,i,t,e,l,r,0),b("z","y","x",1,-1,i,t,-e,l,r,1),b("x","z","y",1,1,e,i,t,o,l,2),b("x","z","y",1,-1,e,i,-t,o,l,3),b("x","y","z",1,-1,e,t,i,o,r,4),b("x","y","z",-1,-1,e,t,-i,o,r,5),this.setIndex(c),this.setAttribute("position",new nn(d,3)),this.setAttribute("normal",new nn(u,3)),this.setAttribute("uv",new nn(f,2));function b(E,g,x,T,C,y,F,_,B,P,A){const S=y/B,R=F/P,U=y/2,z=F/2,J=_/2,Y=B+1,X=P+1;let ee=0,$=0;const he=new Q;for(let fe=0;fe<X;fe++){const re=fe*R-z;for(let ve=0;ve<Y;ve++){const Ge=ve*S-U;he[E]=Ge*T,he[g]=re*C,he[x]=J,d.push(he.x,he.y,he.z),he[E]=0,he[g]=0,he[x]=_>0?1:-1,u.push(he.x,he.y,he.z),f.push(ve/B),f.push(1-fe/P),ee+=1}}for(let fe=0;fe<P;fe++)for(let re=0;re<B;re++){const ve=m+re+Y*fe,Ge=m+re+Y*(fe+1),Z=m+(re+1)+Y*(fe+1),ge=m+(re+1)+Y*fe;c.push(ve,Ge,ge),c.push(Ge,Z,ge),$+=6}h.addGroup(p,$,A),p+=$,m+=ee}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vo(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Hi(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const o=n[t][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=o.clone():Array.isArray(o)?e[t][i]=o.slice():e[t][i]=o}}return e}function Rt(n){const e={};for(let t=0;t<n.length;t++){const i=Hi(n[t]);for(const o in i)e[o]=i[o]}return e}function zw(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function td(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ct.workingColorSpace}const gr={clone:Hi,merge:Rt};var Vw=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Ww=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ht extends yo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Vw,this.fragmentShader=Ww,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Hi(e.uniforms),this.uniformsGroups=zw(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const o in this.uniforms){const l=this.uniforms[o].value;l&&l.isTexture?t.uniforms[o]={type:"t",value:l.toJSON(e).uuid}:l&&l.isColor?t.uniforms[o]={type:"c",value:l.getHex()}:l&&l.isVector2?t.uniforms[o]={type:"v2",value:l.toArray()}:l&&l.isVector3?t.uniforms[o]={type:"v3",value:l.toArray()}:l&&l.isVector4?t.uniforms[o]={type:"v4",value:l.toArray()}:l&&l.isMatrix3?t.uniforms[o]={type:"m3",value:l.toArray()}:l&&l.isMatrix4?t.uniforms[o]={type:"m4",value:l.toArray()}:t.uniforms[o]={value:l}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}let nd=class extends Xt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ct,this.projectionMatrix=new Ct,this.projectionMatrixInverse=new Ct,this.coordinateSystem=Dn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const zn=new Q,Sh=new $e,Bh=new $e;class $t extends nd{constructor(e=50,t=1,i=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=os*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Mr*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return os*2*Math.atan(Math.tan(Mr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){zn.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(zn.x,zn.y).multiplyScalar(-e/zn.z),zn.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(zn.x,zn.y).multiplyScalar(-e/zn.z)}getViewSize(e,t){return this.getViewBounds(e,Sh,Bh),t.subVectors(Bh,Sh)}setViewOffset(e,t,i,o,r,l){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=r,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Mr*.5*this.fov)/this.zoom,i=2*t,o=this.aspect*i,r=-.5*o;const l=this.view;if(this.view!==null&&this.view.enabled){const c=l.fullWidth,d=l.fullHeight;r+=l.offsetX*o/c,t-=l.offsetY*i/d,o*=l.width/c,i*=l.height/d}const h=this.filmOffset;h!==0&&(r+=e*h/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+o,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Ci=-90,Ai=1;class Jw extends Xt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const o=new $t(Ci,Ai,e,t);o.layers=this.layers,this.add(o);const r=new $t(Ci,Ai,e,t);r.layers=this.layers,this.add(r);const l=new $t(Ci,Ai,e,t);l.layers=this.layers,this.add(l);const h=new $t(Ci,Ai,e,t);h.layers=this.layers,this.add(h);const c=new $t(Ci,Ai,e,t);c.layers=this.layers,this.add(c);const d=new $t(Ci,Ai,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,o,r,l,h,c]=t;for(const d of t)this.remove(d);if(e===Dn)i.up.set(0,1,0),i.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),l.up.set(0,0,1),l.lookAt(0,-1,0),h.up.set(0,1,0),h.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===pr)i.up.set(0,-1,0),i.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),l.up.set(0,0,-1),l.lookAt(0,-1,0),h.up.set(0,-1,0),h.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:o}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[r,l,h,c,d,u]=this.children,f=e.getRenderTarget(),m=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),b=e.xr.enabled;e.xr.enabled=!1;const E=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,o),e.render(t,r),e.setRenderTarget(i,1,o),e.render(t,l),e.setRenderTarget(i,2,o),e.render(t,h),e.setRenderTarget(i,3,o),e.render(t,c),e.setRenderTarget(i,4,o),e.render(t,d),i.texture.generateMipmaps=E,e.setRenderTarget(i,5,o),e.render(t,u),e.setRenderTarget(f,m,p),e.xr.enabled=b,i.texture.needsPMREMUpdate=!0}}class id extends Ut{constructor(e=[],t=Ni,i,o,r,l,h,c,d,u){super(e,t,i,o,r,l,h,c,d,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class qw extends dn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];this.texture=new id(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Lt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new vo(5,5,5),r=new Ht({name:"CubemapFromEquirect",uniforms:Hi(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Gt,blending:Mn});r.uniforms.tEquirect.value=t;const l=new en(o,r),h=t.minFilter;return t.minFilter===Jn&&(t.minFilter=Lt),new Jw(1,10,this).update(e,l),t.minFilter=h,l.geometry.dispose(),l.material.dispose(),this}clear(e,t=!0,i=!0,o=!0){const r=e.getRenderTarget();for(let l=0;l<6;l++)e.setRenderTarget(this,l),e.clear(t,i,o);e.setRenderTarget(r)}}class qo extends Xt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Xw={type:"move"};class Qr{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new qo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new qo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Q,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Q),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new qo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Q,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Q),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let o=null,r=null,l=null;const h=this._targetRay,c=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){l=!0;for(const E of e.hand.values()){const g=t.getJointPose(E,i),x=this._getHandJoint(d,E);g!==null&&(x.matrix.fromArray(g.transform.matrix),x.matrix.decompose(x.position,x.rotation,x.scale),x.matrixWorldNeedsUpdate=!0,x.jointRadius=g.radius),x.visible=g!==null}const u=d.joints["index-finger-tip"],f=d.joints["thumb-tip"],m=u.position.distanceTo(f.position),p=.02,b=.005;d.inputState.pinching&&m>p+b?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&m<=p-b&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,r.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(r.linearVelocity)):c.hasLinearVelocity=!1,r.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(r.angularVelocity)):c.hasAngularVelocity=!1));h!==null&&(o=t.getPose(e.targetRaySpace,i),o===null&&r!==null&&(o=r),o!==null&&(h.matrix.fromArray(o.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.matrixWorldNeedsUpdate=!0,o.linearVelocity?(h.hasLinearVelocity=!0,h.linearVelocity.copy(o.linearVelocity)):h.hasLinearVelocity=!1,o.angularVelocity?(h.hasAngularVelocity=!0,h.angularVelocity.copy(o.angularVelocity)):h.hasAngularVelocity=!1,this.dispatchEvent(Xw)))}return h!==null&&(h.visible=o!==null),c!==null&&(c.visible=r!==null),d!==null&&(d.visible=l!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new qo;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class Kw extends Xt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new un,this.environmentIntensity=1,this.environmentRotation=new un,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Yw extends Ut{constructor(e=null,t=1,i=1,o,r,l,h,c,d=qt,u=qt,f,m){super(null,l,h,c,d,u,o,r,f,m),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const jr=new Q,$w=new Q,Zw=new tt;class ni{constructor(e=new Q(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,o){return this.normal.set(e,t,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const o=jr.subVectors(i,t).cross($w.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(jr),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/o;return r<0||r>1?null:t.copy(e.start).addScaledVector(i,r)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Zw.getNormalMatrix(e),o=this.coplanarPoint(jr).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const jn=new Fs,Xo=new Q;class od{constructor(e=new ni,t=new ni,i=new ni,o=new ni,r=new ni,l=new ni){this.planes=[e,t,i,o,r,l]}set(e,t,i,o,r,l){const h=this.planes;return h[0].copy(e),h[1].copy(t),h[2].copy(i),h[3].copy(o),h[4].copy(r),h[5].copy(l),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Dn){const i=this.planes,o=e.elements,r=o[0],l=o[1],h=o[2],c=o[3],d=o[4],u=o[5],f=o[6],m=o[7],p=o[8],b=o[9],E=o[10],g=o[11],x=o[12],T=o[13],C=o[14],y=o[15];if(i[0].setComponents(c-r,m-d,g-p,y-x).normalize(),i[1].setComponents(c+r,m+d,g+p,y+x).normalize(),i[2].setComponents(c+l,m+u,g+b,y+T).normalize(),i[3].setComponents(c-l,m-u,g-b,y-T).normalize(),i[4].setComponents(c-h,m-f,g-E,y-C).normalize(),t===Dn)i[5].setComponents(c+h,m+f,g+E,y+C).normalize();else if(t===pr)i[5].setComponents(h,f,E,C).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),jn.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),jn.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(jn)}intersectsSprite(e){return jn.center.set(0,0,0),jn.radius=.7071067811865476,jn.applyMatrix4(e.matrixWorld),this.intersectsSphere(jn)}intersectsSphere(e){const t=this.planes,i=e.center,o=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const o=t[i];if(Xo.x=o.normal.x>0?e.max.x:e.min.x,Xo.y=o.normal.y>0?e.max.y:e.min.y,Xo.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(Xo)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class rd extends Ut{constructor(e,t,i=si,o,r,l,h=qt,c=qt,d,u=mo){if(u!==mo&&u!==po)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,o,r,l,h,c,u,i,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Ts(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class Ms extends Rn{constructor(e=[],t=[],i=1,o=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:o};const r=[],l=[];h(o),d(i),u(),this.setAttribute("position",new nn(r,3)),this.setAttribute("normal",new nn(r.slice(),3)),this.setAttribute("uv",new nn(l,2)),o===0?this.computeVertexNormals():this.normalizeNormals();function h(T){const C=new Q,y=new Q,F=new Q;for(let _=0;_<t.length;_+=3)p(t[_+0],C),p(t[_+1],y),p(t[_+2],F),c(C,y,F,T)}function c(T,C,y,F){const _=F+1,B=[];for(let P=0;P<=_;P++){B[P]=[];const A=T.clone().lerp(y,P/_),S=C.clone().lerp(y,P/_),R=_-P;for(let U=0;U<=R;U++)U===0&&P===_?B[P][U]=A:B[P][U]=A.clone().lerp(S,U/R)}for(let P=0;P<_;P++)for(let A=0;A<2*(_-P)-1;A++){const S=Math.floor(A/2);A%2===0?(m(B[P][S+1]),m(B[P+1][S]),m(B[P][S])):(m(B[P][S+1]),m(B[P+1][S+1]),m(B[P+1][S]))}}function d(T){const C=new Q;for(let y=0;y<r.length;y+=3)C.x=r[y+0],C.y=r[y+1],C.z=r[y+2],C.normalize().multiplyScalar(T),r[y+0]=C.x,r[y+1]=C.y,r[y+2]=C.z}function u(){const T=new Q;for(let C=0;C<r.length;C+=3){T.x=r[C+0],T.y=r[C+1],T.z=r[C+2];const y=g(T)/2/Math.PI+.5,F=x(T)/Math.PI+.5;l.push(y,1-F)}b(),f()}function f(){for(let T=0;T<l.length;T+=6){const C=l[T+0],y=l[T+2],F=l[T+4],_=Math.max(C,y,F),B=Math.min(C,y,F);_>.9&&B<.1&&(C<.2&&(l[T+0]+=1),y<.2&&(l[T+2]+=1),F<.2&&(l[T+4]+=1))}}function m(T){r.push(T.x,T.y,T.z)}function p(T,C){const y=T*3;C.x=e[y+0],C.y=e[y+1],C.z=e[y+2]}function b(){const T=new Q,C=new Q,y=new Q,F=new Q,_=new $e,B=new $e,P=new $e;for(let A=0,S=0;A<r.length;A+=9,S+=6){T.set(r[A+0],r[A+1],r[A+2]),C.set(r[A+3],r[A+4],r[A+5]),y.set(r[A+6],r[A+7],r[A+8]),_.set(l[S+0],l[S+1]),B.set(l[S+2],l[S+3]),P.set(l[S+4],l[S+5]),F.copy(T).add(C).add(y).divideScalar(3);const R=g(F);E(_,S+0,T,R),E(B,S+2,C,R),E(P,S+4,y,R)}}function E(T,C,y,F){F<0&&T.x===1&&(l[C]=T.x-1),y.x===0&&y.z===0&&(l[C]=F/2/Math.PI+.5)}function g(T){return Math.atan2(T.z,-T.x)}function x(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ms(e.vertices,e.indices,e.radius,e.details)}}class br extends Ms{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(o,r,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new br(e.radius,e.detail)}}class Cr extends Rn{constructor(e=1,t=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:o};const r=e/2,l=t/2,h=Math.floor(i),c=Math.floor(o),d=h+1,u=c+1,f=e/h,m=t/c,p=[],b=[],E=[],g=[];for(let x=0;x<u;x++){const T=x*m-l;for(let C=0;C<d;C++){const y=C*f-r;b.push(y,-T,0),E.push(0,0,1),g.push(C/h),g.push(1-x/c)}}for(let x=0;x<c;x++)for(let T=0;T<h;T++){const C=T+d*x,y=T+d*(x+1),F=T+1+d*(x+1),_=T+1+d*x;p.push(C,y,_),p.push(y,F,_)}this.setIndex(p),this.setAttribute("position",new nn(b,3)),this.setAttribute("normal",new nn(E,3)),this.setAttribute("uv",new nn(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cr(e.width,e.height,e.widthSegments,e.heightSegments)}}class Qw extends Ht{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class jw extends yo{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new st(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new st(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xc,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new un,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class e1 extends yo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=aw,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class t1 extends yo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const _h={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class n1{constructor(e,t,i){const o=this;let r=!1,l=0,h=0,c;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){h++,r===!1&&o.onStart!==void 0&&o.onStart(u,l,h),r=!0},this.itemEnd=function(u){l++,o.onProgress!==void 0&&o.onProgress(u,l,h),l===h&&(r=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(u){o.onError!==void 0&&o.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,f){return d.push(u,f),this},this.removeHandler=function(u){const f=d.indexOf(u);return f!==-1&&d.splice(f,2),this},this.getHandler=function(u){for(let f=0,m=d.length;f<m;f+=2){const p=d[f],b=d[f+1];if(p.global&&(p.lastIndex=0),p.test(u))return b}return null}}}const i1=new n1;class Ps{constructor(e){this.manager=e!==void 0?e:i1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(o,r){i.load(e,o,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ps.DEFAULT_MATERIAL_NAME="__DEFAULT";const An={};class o1 extends Error{constructor(e,t){super(e),this.response=t}}class r1 extends Ps{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,i,o){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=_h.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(An[e]!==void 0){An[e].push({onLoad:t,onProgress:i,onError:o});return}An[e]=[],An[e].push({onLoad:t,onProgress:i,onError:o});const l=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),h=this.mimeType,c=this.responseType;fetch(l).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const u=An[e],f=d.body.getReader(),m=d.headers.get("X-File-Size")||d.headers.get("Content-Length"),p=m?parseInt(m):0,b=p!==0;let E=0;const g=new ReadableStream({start(x){T();function T(){f.read().then(({done:C,value:y})=>{if(C)x.close();else{E+=y.byteLength;const F=new ProgressEvent("progress",{lengthComputable:b,loaded:E,total:p});for(let _=0,B=u.length;_<B;_++){const P=u[_];P.onProgress&&P.onProgress(F)}x.enqueue(y),T()}},C=>{x.error(C)})}}});return new Response(g)}else throw new o1(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(c){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(u=>new DOMParser().parseFromString(u,h));case"json":return d.json();default:if(h==="")return d.text();{const f=/charset="?([^;"\s]*)"?/i.exec(h),m=f&&f[1]?f[1].toLowerCase():void 0,p=new TextDecoder(m);return d.arrayBuffer().then(b=>p.decode(b))}}}).then(d=>{_h.add(e,d);const u=An[e];delete An[e];for(let f=0,m=u.length;f<m;f++){const p=u[f];p.onLoad&&p.onLoad(d)}}).catch(d=>{const u=An[e];if(u===void 0)throw this.manager.itemError(e),d;delete An[e];for(let f=0,m=u.length;f<m;f++){const p=u[f];p.onError&&p.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class a1 extends Ps{constructor(e){super(e)}load(e,t,i,o){const r=this,l=new Yw,h=new r1(this.manager);return h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(r.withCredentials),h.load(e,function(c){let d;try{d=r.parse(c)}catch(u){if(o!==void 0)o(u);else{console.error(u);return}}d.image!==void 0?l.image=d.image:d.data!==void 0&&(l.image.width=d.width,l.image.height=d.height,l.image.data=d.data),l.wrapS=d.wrapS!==void 0?d.wrapS:Fn,l.wrapT=d.wrapT!==void 0?d.wrapT:Fn,l.magFilter=d.magFilter!==void 0?d.magFilter:Lt,l.minFilter=d.minFilter!==void 0?d.minFilter:Lt,l.anisotropy=d.anisotropy!==void 0?d.anisotropy:1,d.colorSpace!==void 0&&(l.colorSpace=d.colorSpace),d.flipY!==void 0&&(l.flipY=d.flipY),d.format!==void 0&&(l.format=d.format),d.type!==void 0&&(l.type=d.type),d.mipmaps!==void 0&&(l.mipmaps=d.mipmaps,l.minFilter=Jn),d.mipmapCount===1&&(l.minFilter=Lt),d.generateMipmaps!==void 0&&(l.generateMipmaps=d.generateMipmaps),l.needsUpdate=!0,t&&t(l,d)},i,o),l}}class ad extends nd{constructor(e=-1,t=1,i=1,o=-1,r=.1,l=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=o,this.near=r,this.far=l,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,o,r,l){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=r,this.view.height=l,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let r=i-e,l=i+e,h=o+t,c=o-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=d*this.view.offsetX,l=r+d*this.view.width,h-=u*this.view.offsetY,c=h-u*this.view.height}this.projectionMatrix.makeOrthographic(r,l,h,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class s1 extends $t{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class l1{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Th(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Th();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Th(){return performance.now()}function Fh(n,e,t,i){const o=h1(i);switch(t){case Vc:return n*e;case As:return n*e/o.components*o.byteLength;case Ss:return n*e/o.components*o.byteLength;case Jc:return n*e*2/o.components*o.byteLength;case Bs:return n*e*2/o.components*o.byteLength;case Wc:return n*e*3/o.components*o.byteLength;case jt:return n*e*4/o.components*o.byteLength;case _s:return n*e*4/o.components*o.byteLength;case tr:case nr:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case ir:case or:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Pa:case Ia:return Math.max(n,16)*Math.max(e,8)/4;case Ma:case ka:return Math.max(n,8)*Math.max(e,8)/2;case Ra:case Na:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case La:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Ha:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Ga:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Ua:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Oa:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case za:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Va:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Wa:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case Ja:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case qa:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Xa:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Ka:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case Ya:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case $a:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case Za:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case rr:case Qa:case ja:return Math.ceil(n/4)*Math.ceil(e/4)*16;case qc:case es:return Math.ceil(n/4)*Math.ceil(e/4)*8;case ts:case ns:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function h1(n){switch(n){case kn:case Uc:return{byteLength:1,components:1};case uo:case Oc:case Jt:return{byteLength:2,components:1};case Es:case Cs:return{byteLength:2,components:4};case si:case ws:case Qt:return{byteLength:4,components:1};case zc:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:vs}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=vs);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function sd(){let n=null,e=!1,t=null,i=null;function o(r,l){t(r,l),i=n.requestAnimationFrame(o)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(o),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}function c1(n){const e=new WeakMap;function t(h,c){const d=h.array,u=h.usage,f=d.byteLength,m=n.createBuffer();n.bindBuffer(c,m),n.bufferData(c,d,u),h.onUploadCallback();let p;if(d instanceof Float32Array)p=n.FLOAT;else if(d instanceof Uint16Array)h.isFloat16BufferAttribute?p=n.HALF_FLOAT:p=n.UNSIGNED_SHORT;else if(d instanceof Int16Array)p=n.SHORT;else if(d instanceof Uint32Array)p=n.UNSIGNED_INT;else if(d instanceof Int32Array)p=n.INT;else if(d instanceof Int8Array)p=n.BYTE;else if(d instanceof Uint8Array)p=n.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)p=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:m,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:h.version,size:f}}function i(h,c,d){const u=c.array,f=c.updateRanges;if(n.bindBuffer(d,h),f.length===0)n.bufferSubData(d,0,u);else{f.sort((p,b)=>p.start-b.start);let m=0;for(let p=1;p<f.length;p++){const b=f[m],E=f[p];E.start<=b.start+b.count+1?b.count=Math.max(b.count,E.start+E.count-b.start):(++m,f[m]=E)}f.length=m+1;for(let p=0,b=f.length;p<b;p++){const E=f[p];n.bufferSubData(d,E.start*u.BYTES_PER_ELEMENT,u,E.start,E.count)}c.clearUpdateRanges()}c.onUploadCallback()}function o(h){return h.isInterleavedBufferAttribute&&(h=h.data),e.get(h)}function r(h){h.isInterleavedBufferAttribute&&(h=h.data);const c=e.get(h);c&&(n.deleteBuffer(c.buffer),e.delete(h))}function l(h,c){if(h.isInterleavedBufferAttribute&&(h=h.data),h.isGLBufferAttribute){const u=e.get(h);(!u||u.version<h.version)&&e.set(h,{buffer:h.buffer,type:h.type,bytesPerElement:h.elementSize,version:h.version});return}const d=e.get(h);if(d===void 0)e.set(h,t(h,c));else if(d.version<h.version){if(d.size!==h.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(d.buffer,h,c),d.version=h.version}}return{get:o,remove:r,update:l}}var d1=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,u1=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,f1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,m1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,p1=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,x1=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,g1=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,b1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,y1=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,v1=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,w1=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,E1=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,C1=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,A1=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,S1=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,B1=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,_1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,T1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,F1=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,D1=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,M1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,P1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,k1=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,I1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,R1=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,N1=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,L1=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,H1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,G1=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,U1=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,O1="gl_FragColor = linearToOutputTexel( gl_FragColor );",z1=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,V1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,W1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,J1=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,q1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,X1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,K1=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Y1=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,$1=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Z1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Q1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,j1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,eE=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,tE=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,nE=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,iE=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,oE=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,rE=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,aE=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,sE=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lE=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,hE=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,cE=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,dE=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,uE=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,fE=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,mE=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pE=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xE=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,gE=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,bE=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yE=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,vE=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wE=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,EE=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,CE=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,AE=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,SE=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,BE=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,_E=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,TE=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,FE=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,DE=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,ME=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PE=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,kE=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,IE=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,RE=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,NE=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,LE=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,HE=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,GE=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,UE=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,OE=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,zE=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,VE=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,WE=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,JE=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qE=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,XE=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,KE=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,YE=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,$E=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,ZE=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,QE=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,jE=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,eC=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,tC=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,nC=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,iC=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,oC=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,rC=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,aC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,sC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,lC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,hC=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cC=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dC=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fC=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,pC=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xC=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,gC=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,bC=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,yC=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wC=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,EC=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,CC=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,AC=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,SC=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BC=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_C=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TC=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,FC=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DC=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,MC=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,PC=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kC=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IC=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,RC=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,NC=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LC=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HC=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,GC=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UC=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OC=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,zC=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VC=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,nt={alphahash_fragment:d1,alphahash_pars_fragment:u1,alphamap_fragment:f1,alphamap_pars_fragment:m1,alphatest_fragment:p1,alphatest_pars_fragment:x1,aomap_fragment:g1,aomap_pars_fragment:b1,batching_pars_vertex:y1,batching_vertex:v1,begin_vertex:w1,beginnormal_vertex:E1,bsdfs:C1,iridescence_fragment:A1,bumpmap_pars_fragment:S1,clipping_planes_fragment:B1,clipping_planes_pars_fragment:_1,clipping_planes_pars_vertex:T1,clipping_planes_vertex:F1,color_fragment:D1,color_pars_fragment:M1,color_pars_vertex:P1,color_vertex:k1,common:I1,cube_uv_reflection_fragment:R1,defaultnormal_vertex:N1,displacementmap_pars_vertex:L1,displacementmap_vertex:H1,emissivemap_fragment:G1,emissivemap_pars_fragment:U1,colorspace_fragment:O1,colorspace_pars_fragment:z1,envmap_fragment:V1,envmap_common_pars_fragment:W1,envmap_pars_fragment:J1,envmap_pars_vertex:q1,envmap_physical_pars_fragment:iE,envmap_vertex:X1,fog_vertex:K1,fog_pars_vertex:Y1,fog_fragment:$1,fog_pars_fragment:Z1,gradientmap_pars_fragment:Q1,lightmap_pars_fragment:j1,lights_lambert_fragment:eE,lights_lambert_pars_fragment:tE,lights_pars_begin:nE,lights_toon_fragment:oE,lights_toon_pars_fragment:rE,lights_phong_fragment:aE,lights_phong_pars_fragment:sE,lights_physical_fragment:lE,lights_physical_pars_fragment:hE,lights_fragment_begin:cE,lights_fragment_maps:dE,lights_fragment_end:uE,logdepthbuf_fragment:fE,logdepthbuf_pars_fragment:mE,logdepthbuf_pars_vertex:pE,logdepthbuf_vertex:xE,map_fragment:gE,map_pars_fragment:bE,map_particle_fragment:yE,map_particle_pars_fragment:vE,metalnessmap_fragment:wE,metalnessmap_pars_fragment:EE,morphinstance_vertex:CE,morphcolor_vertex:AE,morphnormal_vertex:SE,morphtarget_pars_vertex:BE,morphtarget_vertex:_E,normal_fragment_begin:TE,normal_fragment_maps:FE,normal_pars_fragment:DE,normal_pars_vertex:ME,normal_vertex:PE,normalmap_pars_fragment:kE,clearcoat_normal_fragment_begin:IE,clearcoat_normal_fragment_maps:RE,clearcoat_pars_fragment:NE,iridescence_pars_fragment:LE,opaque_fragment:HE,packing:GE,premultiplied_alpha_fragment:UE,project_vertex:OE,dithering_fragment:zE,dithering_pars_fragment:VE,roughnessmap_fragment:WE,roughnessmap_pars_fragment:JE,shadowmap_pars_fragment:qE,shadowmap_pars_vertex:XE,shadowmap_vertex:KE,shadowmask_pars_fragment:YE,skinbase_vertex:$E,skinning_pars_vertex:ZE,skinning_vertex:QE,skinnormal_vertex:jE,specularmap_fragment:eC,specularmap_pars_fragment:tC,tonemapping_fragment:nC,tonemapping_pars_fragment:iC,transmission_fragment:oC,transmission_pars_fragment:rC,uv_pars_fragment:aC,uv_pars_vertex:sC,uv_vertex:lC,worldpos_vertex:hC,background_vert:cC,background_frag:dC,backgroundCube_vert:uC,backgroundCube_frag:fC,cube_vert:mC,cube_frag:pC,depth_vert:xC,depth_frag:gC,distanceRGBA_vert:bC,distanceRGBA_frag:yC,equirect_vert:vC,equirect_frag:wC,linedashed_vert:EC,linedashed_frag:CC,meshbasic_vert:AC,meshbasic_frag:SC,meshlambert_vert:BC,meshlambert_frag:_C,meshmatcap_vert:TC,meshmatcap_frag:FC,meshnormal_vert:DC,meshnormal_frag:MC,meshphong_vert:PC,meshphong_frag:kC,meshphysical_vert:IC,meshphysical_frag:RC,meshtoon_vert:NC,meshtoon_frag:LC,points_vert:HC,points_frag:GC,shadow_vert:UC,shadow_frag:OC,sprite_vert:zC,sprite_frag:VC},Ee={common:{diffuse:{value:new st(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new tt},alphaMap:{value:null},alphaMapTransform:{value:new tt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new tt}},envmap:{envMap:{value:null},envMapRotation:{value:new tt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new tt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new tt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new tt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new tt},normalScale:{value:new $e(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new tt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new tt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new tt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new tt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new st(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new st(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new tt},alphaTest:{value:0},uvTransform:{value:new tt}},sprite:{diffuse:{value:new st(16777215)},opacity:{value:1},center:{value:new $e(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new tt},alphaMap:{value:null},alphaMapTransform:{value:new tt},alphaTest:{value:0}}},pn={basic:{uniforms:Rt([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.fog]),vertexShader:nt.meshbasic_vert,fragmentShader:nt.meshbasic_frag},lambert:{uniforms:Rt([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,Ee.lights,{emissive:{value:new st(0)}}]),vertexShader:nt.meshlambert_vert,fragmentShader:nt.meshlambert_frag},phong:{uniforms:Rt([Ee.common,Ee.specularmap,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,Ee.lights,{emissive:{value:new st(0)},specular:{value:new st(1118481)},shininess:{value:30}}]),vertexShader:nt.meshphong_vert,fragmentShader:nt.meshphong_frag},standard:{uniforms:Rt([Ee.common,Ee.envmap,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.roughnessmap,Ee.metalnessmap,Ee.fog,Ee.lights,{emissive:{value:new st(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:nt.meshphysical_vert,fragmentShader:nt.meshphysical_frag},toon:{uniforms:Rt([Ee.common,Ee.aomap,Ee.lightmap,Ee.emissivemap,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.gradientmap,Ee.fog,Ee.lights,{emissive:{value:new st(0)}}]),vertexShader:nt.meshtoon_vert,fragmentShader:nt.meshtoon_frag},matcap:{uniforms:Rt([Ee.common,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,Ee.fog,{matcap:{value:null}}]),vertexShader:nt.meshmatcap_vert,fragmentShader:nt.meshmatcap_frag},points:{uniforms:Rt([Ee.points,Ee.fog]),vertexShader:nt.points_vert,fragmentShader:nt.points_frag},dashed:{uniforms:Rt([Ee.common,Ee.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nt.linedashed_vert,fragmentShader:nt.linedashed_frag},depth:{uniforms:Rt([Ee.common,Ee.displacementmap]),vertexShader:nt.depth_vert,fragmentShader:nt.depth_frag},normal:{uniforms:Rt([Ee.common,Ee.bumpmap,Ee.normalmap,Ee.displacementmap,{opacity:{value:1}}]),vertexShader:nt.meshnormal_vert,fragmentShader:nt.meshnormal_frag},sprite:{uniforms:Rt([Ee.sprite,Ee.fog]),vertexShader:nt.sprite_vert,fragmentShader:nt.sprite_frag},background:{uniforms:{uvTransform:{value:new tt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:nt.background_vert,fragmentShader:nt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new tt}},vertexShader:nt.backgroundCube_vert,fragmentShader:nt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nt.cube_vert,fragmentShader:nt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:nt.equirect_vert,fragmentShader:nt.equirect_frag},distanceRGBA:{uniforms:Rt([Ee.common,Ee.displacementmap,{referencePosition:{value:new Q},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:nt.distanceRGBA_vert,fragmentShader:nt.distanceRGBA_frag},shadow:{uniforms:Rt([Ee.lights,Ee.fog,{color:{value:new st(0)},opacity:{value:1}}]),vertexShader:nt.shadow_vert,fragmentShader:nt.shadow_frag}};pn.physical={uniforms:Rt([pn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new tt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new tt},clearcoatNormalScale:{value:new $e(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new tt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new tt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new tt},sheen:{value:0},sheenColor:{value:new st(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new tt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new tt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new tt},transmissionSamplerSize:{value:new $e},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new tt},attenuationDistance:{value:0},attenuationColor:{value:new st(0)},specularColor:{value:new st(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new tt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new tt},anisotropyVector:{value:new $e},anisotropyMap:{value:null},anisotropyMapTransform:{value:new tt}}]),vertexShader:nt.meshphysical_vert,fragmentShader:nt.meshphysical_frag};const Ko={r:0,b:0,g:0},ei=new un,WC=new Ct;function JC(n,e,t,i,o,r,l){const h=new st(0);let c=r===!0?0:1,d,u,f=null,m=0,p=null;function b(C){let y=C.isScene===!0?C.background:null;return y&&y.isTexture&&(y=(C.backgroundBlurriness>0?t:e).get(y)),y}function E(C){let y=!1;const F=b(C);F===null?x(h,c):F&&F.isColor&&(x(F,1),y=!0);const _=n.xr.getEnvironmentBlendMode();_==="additive"?i.buffers.color.setClear(0,0,0,1,l):_==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,l),(n.autoClear||y)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(C,y){const F=b(y);F&&(F.isCubeTexture||F.mapping===Er)?(u===void 0&&(u=new en(new vo(1,1,1),new Ht({name:"BackgroundCubeMaterial",uniforms:Hi(pn.backgroundCube.uniforms),vertexShader:pn.backgroundCube.vertexShader,fragmentShader:pn.backgroundCube.fragmentShader,side:Gt,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(_,B,P){this.matrixWorld.copyPosition(P.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(u)),ei.copy(y.backgroundRotation),ei.x*=-1,ei.y*=-1,ei.z*=-1,F.isCubeTexture&&F.isRenderTargetTexture===!1&&(ei.y*=-1,ei.z*=-1),u.material.uniforms.envMap.value=F,u.material.uniforms.flipEnvMap.value=F.isCubeTexture&&F.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(WC.makeRotationFromEuler(ei)),u.material.toneMapped=ct.getTransfer(F.colorSpace)!==mt,(f!==F||m!==F.version||p!==n.toneMapping)&&(u.material.needsUpdate=!0,f=F,m=F.version,p=n.toneMapping),u.layers.enableAll(),C.unshift(u,u.geometry,u.material,0,0,null)):F&&F.isTexture&&(d===void 0&&(d=new en(new Cr(2,2),new Ht({name:"BackgroundMaterial",uniforms:Hi(pn.background.uniforms),vertexShader:pn.background.vertexShader,fragmentShader:pn.background.fragmentShader,side:Xn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(d)),d.material.uniforms.t2D.value=F,d.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,d.material.toneMapped=ct.getTransfer(F.colorSpace)!==mt,F.matrixAutoUpdate===!0&&F.updateMatrix(),d.material.uniforms.uvTransform.value.copy(F.matrix),(f!==F||m!==F.version||p!==n.toneMapping)&&(d.material.needsUpdate=!0,f=F,m=F.version,p=n.toneMapping),d.layers.enableAll(),C.unshift(d,d.geometry,d.material,0,0,null))}function x(C,y){C.getRGB(Ko,td(n)),i.buffers.color.setClear(Ko.r,Ko.g,Ko.b,y,l)}function T(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0)}return{getClearColor:function(){return h},setClearColor:function(C,y=1){h.set(C),c=y,x(h,c)},getClearAlpha:function(){return c},setClearAlpha:function(C){c=C,x(h,c)},render:E,addToRenderList:g,dispose:T}}function qC(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},o=m(null);let r=o,l=!1;function h(S,R,U,z,J){let Y=!1;const X=f(z,U,R);r!==X&&(r=X,d(r.object)),Y=p(S,z,U,J),Y&&b(S,z,U,J),J!==null&&e.update(J,n.ELEMENT_ARRAY_BUFFER),(Y||l)&&(l=!1,y(S,R,U,z),J!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(J).buffer))}function c(){return n.createVertexArray()}function d(S){return n.bindVertexArray(S)}function u(S){return n.deleteVertexArray(S)}function f(S,R,U){const z=U.wireframe===!0;let J=i[S.id];J===void 0&&(J={},i[S.id]=J);let Y=J[R.id];Y===void 0&&(Y={},J[R.id]=Y);let X=Y[z];return X===void 0&&(X=m(c()),Y[z]=X),X}function m(S){const R=[],U=[],z=[];for(let J=0;J<t;J++)R[J]=0,U[J]=0,z[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:R,enabledAttributes:U,attributeDivisors:z,object:S,attributes:{},index:null}}function p(S,R,U,z){const J=r.attributes,Y=R.attributes;let X=0;const ee=U.getAttributes();for(const $ in ee)if(ee[$].location>=0){const fe=J[$];let re=Y[$];if(re===void 0&&($==="instanceMatrix"&&S.instanceMatrix&&(re=S.instanceMatrix),$==="instanceColor"&&S.instanceColor&&(re=S.instanceColor)),fe===void 0||fe.attribute!==re||re&&fe.data!==re.data)return!0;X++}return r.attributesNum!==X||r.index!==z}function b(S,R,U,z){const J={},Y=R.attributes;let X=0;const ee=U.getAttributes();for(const $ in ee)if(ee[$].location>=0){let fe=Y[$];fe===void 0&&($==="instanceMatrix"&&S.instanceMatrix&&(fe=S.instanceMatrix),$==="instanceColor"&&S.instanceColor&&(fe=S.instanceColor));const re={};re.attribute=fe,fe&&fe.data&&(re.data=fe.data),J[$]=re,X++}r.attributes=J,r.attributesNum=X,r.index=z}function E(){const S=r.newAttributes;for(let R=0,U=S.length;R<U;R++)S[R]=0}function g(S){x(S,0)}function x(S,R){const U=r.newAttributes,z=r.enabledAttributes,J=r.attributeDivisors;U[S]=1,z[S]===0&&(n.enableVertexAttribArray(S),z[S]=1),J[S]!==R&&(n.vertexAttribDivisor(S,R),J[S]=R)}function T(){const S=r.newAttributes,R=r.enabledAttributes;for(let U=0,z=R.length;U<z;U++)R[U]!==S[U]&&(n.disableVertexAttribArray(U),R[U]=0)}function C(S,R,U,z,J,Y,X){X===!0?n.vertexAttribIPointer(S,R,U,J,Y):n.vertexAttribPointer(S,R,U,z,J,Y)}function y(S,R,U,z){E();const J=z.attributes,Y=U.getAttributes(),X=R.defaultAttributeValues;for(const ee in Y){const $=Y[ee];if($.location>=0){let he=J[ee];if(he===void 0&&(ee==="instanceMatrix"&&S.instanceMatrix&&(he=S.instanceMatrix),ee==="instanceColor"&&S.instanceColor&&(he=S.instanceColor)),he!==void 0){const fe=he.normalized,re=he.itemSize,ve=e.get(he);if(ve===void 0)continue;const Ge=ve.buffer,Z=ve.type,ge=ve.bytesPerElement,ce=Z===n.INT||Z===n.UNSIGNED_INT||he.gpuType===ws;if(he.isInterleavedBufferAttribute){const me=he.data,_e=me.stride,we=he.offset;if(me.isInstancedInterleavedBuffer){for(let Ne=0;Ne<$.locationSize;Ne++)x($.location+Ne,me.meshPerAttribute);S.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=me.meshPerAttribute*me.count)}else for(let Ne=0;Ne<$.locationSize;Ne++)g($.location+Ne);n.bindBuffer(n.ARRAY_BUFFER,Ge);for(let Ne=0;Ne<$.locationSize;Ne++)C($.location+Ne,re/$.locationSize,Z,fe,_e*ge,(we+re/$.locationSize*Ne)*ge,ce)}else{if(he.isInstancedBufferAttribute){for(let me=0;me<$.locationSize;me++)x($.location+me,he.meshPerAttribute);S.isInstancedMesh!==!0&&z._maxInstanceCount===void 0&&(z._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let me=0;me<$.locationSize;me++)g($.location+me);n.bindBuffer(n.ARRAY_BUFFER,Ge);for(let me=0;me<$.locationSize;me++)C($.location+me,re/$.locationSize,Z,fe,re*ge,re/$.locationSize*me*ge,ce)}}else if(X!==void 0){const fe=X[ee];if(fe!==void 0)switch(fe.length){case 2:n.vertexAttrib2fv($.location,fe);break;case 3:n.vertexAttrib3fv($.location,fe);break;case 4:n.vertexAttrib4fv($.location,fe);break;default:n.vertexAttrib1fv($.location,fe)}}}}T()}function F(){P();for(const S in i){const R=i[S];for(const U in R){const z=R[U];for(const J in z)u(z[J].object),delete z[J];delete R[U]}delete i[S]}}function _(S){if(i[S.id]===void 0)return;const R=i[S.id];for(const U in R){const z=R[U];for(const J in z)u(z[J].object),delete z[J];delete R[U]}delete i[S.id]}function B(S){for(const R in i){const U=i[R];if(U[S.id]===void 0)continue;const z=U[S.id];for(const J in z)u(z[J].object),delete z[J];delete U[S.id]}}function P(){A(),l=!0,r!==o&&(r=o,d(r.object))}function A(){o.geometry=null,o.program=null,o.wireframe=!1}return{setup:h,reset:P,resetDefaultState:A,dispose:F,releaseStatesOfGeometry:_,releaseStatesOfProgram:B,initAttributes:E,enableAttribute:g,disableUnusedAttributes:T}}function XC(n,e,t){let i;function o(d){i=d}function r(d,u){n.drawArrays(i,d,u),t.update(u,i,1)}function l(d,u,f){f!==0&&(n.drawArraysInstanced(i,d,u,f),t.update(u,i,f))}function h(d,u,f){if(f===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,d,0,u,0,f);let p=0;for(let b=0;b<f;b++)p+=u[b];t.update(p,i,1)}function c(d,u,f,m){if(f===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let b=0;b<d.length;b++)l(d[b],u[b],m[b]);else{p.multiDrawArraysInstancedWEBGL(i,d,0,u,0,m,0,f);let b=0;for(let E=0;E<f;E++)b+=u[E]*m[E];t.update(b,i,1)}}this.setMode=o,this.render=r,this.renderInstances=l,this.renderMultiDraw=h,this.renderMultiDrawInstances=c}function KC(n,e,t,i){let o;function r(){if(o!==void 0)return o;if(e.has("EXT_texture_filter_anisotropic")===!0){const B=e.get("EXT_texture_filter_anisotropic");o=n.getParameter(B.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else o=0;return o}function l(B){return!(B!==jt&&i.convert(B)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function h(B){const P=B===Jt&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(B!==kn&&i.convert(B)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&B!==Qt&&!P)}function c(B){if(B==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";B="mediump"}return B==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=t.precision!==void 0?t.precision:"highp";const u=c(d);u!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",u,"instead."),d=u);const f=t.logarithmicDepthBuffer===!0,m=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),p=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),b=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),E=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),x=n.getParameter(n.MAX_VERTEX_ATTRIBS),T=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),C=n.getParameter(n.MAX_VARYING_VECTORS),y=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),F=b>0,_=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:c,textureFormatReadable:l,textureTypeReadable:h,precision:d,logarithmicDepthBuffer:f,reverseDepthBuffer:m,maxTextures:p,maxVertexTextures:b,maxTextureSize:E,maxCubemapSize:g,maxAttributes:x,maxVertexUniforms:T,maxVaryings:C,maxFragmentUniforms:y,vertexTextures:F,maxSamples:_}}function YC(n){const e=this;let t=null,i=0,o=!1,r=!1;const l=new ni,h=new tt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,m){const p=f.length!==0||m||i!==0||o;return o=m,i=f.length,p},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(f,m){t=u(f,m,0)},this.setState=function(f,m,p){const b=f.clippingPlanes,E=f.clipIntersection,g=f.clipShadows,x=n.get(f);if(!o||b===null||b.length===0||r&&!g)r?u(null):d();else{const T=r?0:i,C=T*4;let y=x.clippingState||null;c.value=y,y=u(b,m,C,p);for(let F=0;F!==C;++F)y[F]=t[F];x.clippingState=y,this.numIntersection=E?this.numPlanes:0,this.numPlanes+=T}};function d(){c.value!==t&&(c.value=t,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(f,m,p,b){const E=f!==null?f.length:0;let g=null;if(E!==0){if(g=c.value,b!==!0||g===null){const x=p+E*4,T=m.matrixWorldInverse;h.getNormalMatrix(T),(g===null||g.length<x)&&(g=new Float32Array(x));for(let C=0,y=p;C!==E;++C,y+=4)l.copy(f[C]).applyMatrix4(T,h),l.normal.toArray(g,y),g[y+3]=l.constant}c.value=g,c.needsUpdate=!0}return e.numPlanes=E,e.numIntersection=0,g}}function $C(n){let e=new WeakMap;function t(l,h){return h===fr?l.mapping=Ni:h===Ta&&(l.mapping=Li),l}function i(l){if(l&&l.isTexture){const h=l.mapping;if(h===fr||h===Ta)if(e.has(l)){const c=e.get(l).texture;return t(c,l.mapping)}else{const c=l.image;if(c&&c.height>0){const d=new qw(c.height);return d.fromEquirectangularTexture(n,l),e.set(l,d),l.addEventListener("dispose",o),t(d.texture,l.mapping)}else return null}}return l}function o(l){const h=l.target;h.removeEventListener("dispose",o);const c=e.get(h);c!==void 0&&(e.delete(h),c.dispose())}function r(){e=new WeakMap}return{get:i,dispose:r}}const Ti=4,Dh=[.125,.215,.35,.446,.526,.582],ri=20,ea=new ad,Mh=new st;let ta=null,na=0,ia=0,oa=!1;const ii=(1+Math.sqrt(5))/2,Si=1/ii,Ph=[new Q(-ii,Si,0),new Q(ii,Si,0),new Q(-Si,0,ii),new Q(Si,0,ii),new Q(0,ii,-Si),new Q(0,ii,Si),new Q(-1,1,-1),new Q(1,1,-1),new Q(-1,1,1),new Q(1,1,1)],ZC=new Q;class rs{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,o=100,r={}){const{size:l=256,position:h=ZC}=r;ta=this._renderer.getRenderTarget(),na=this._renderer.getActiveCubeFace(),ia=this._renderer.getActiveMipmapLevel(),oa=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(l);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,i,o,c,h),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Rh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Ih(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(ta,na,ia),this._renderer.xr.enabled=oa,e.scissorTest=!1,Yo(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ni||e.mapping===Li?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),ta=this._renderer.getRenderTarget(),na=this._renderer.getActiveCubeFace(),ia=this._renderer.getActiveMipmapLevel(),oa=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Lt,minFilter:Lt,generateMipmaps:!1,type:Jt,format:jt,colorSpace:Kn,depthBuffer:!1},o=kh(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kh(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=QC(r)),this._blurMaterial=jC(r,e,t)}return o}_compileMaterial(e){const t=new en(this._lodPlanes[0],e);this._renderer.compile(t,ea)}_sceneToCubeUV(e,t,i,o,r){const c=new $t(90,1,t,i),d=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],f=this._renderer,m=f.autoClear,p=f.toneMapping;f.getClearColor(Mh),f.toneMapping=qn,f.autoClear=!1;const b=new Ds({name:"PMREM.Background",side:Gt,depthWrite:!1,depthTest:!1}),E=new en(new vo,b);let g=!1;const x=e.background;x?x.isColor&&(b.color.copy(x),e.background=null,g=!0):(b.color.copy(Mh),g=!0);for(let T=0;T<6;T++){const C=T%3;C===0?(c.up.set(0,d[T],0),c.position.set(r.x,r.y,r.z),c.lookAt(r.x+u[T],r.y,r.z)):C===1?(c.up.set(0,0,d[T]),c.position.set(r.x,r.y,r.z),c.lookAt(r.x,r.y+u[T],r.z)):(c.up.set(0,d[T],0),c.position.set(r.x,r.y,r.z),c.lookAt(r.x,r.y,r.z+u[T]));const y=this._cubeSize;Yo(o,C*y,T>2?y:0,y,y),f.setRenderTarget(o),g&&f.render(E,c),f.render(e,c)}E.geometry.dispose(),E.material.dispose(),f.toneMapping=p,f.autoClear=m,e.background=x}_textureToCubeUV(e,t){const i=this._renderer,o=e.mapping===Ni||e.mapping===Li;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=Rh()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Ih());const r=o?this._cubemapMaterial:this._equirectMaterial,l=new en(this._lodPlanes[0],r),h=r.uniforms;h.envMap.value=e;const c=this._cubeSize;Yo(t,0,0,3*c,2*c),i.setRenderTarget(t),i.render(l,ea)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const o=this._lodPlanes.length;for(let r=1;r<o;r++){const l=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),h=Ph[(o-r-1)%Ph.length];this._blur(e,r-1,r,l,h)}t.autoClear=i}_blur(e,t,i,o,r){const l=this._pingPongRenderTarget;this._halfBlur(e,l,t,i,o,"latitudinal",r),this._halfBlur(l,e,i,i,o,"longitudinal",r)}_halfBlur(e,t,i,o,r,l,h){const c=this._renderer,d=this._blurMaterial;l!=="latitudinal"&&l!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,f=new en(this._lodPlanes[o],d),m=d.uniforms,p=this._sizeLods[i]-1,b=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*ri-1),E=r/b,g=isFinite(r)?1+Math.floor(u*E):ri;g>ri&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${ri}`);const x=[];let T=0;for(let B=0;B<ri;++B){const P=B/E,A=Math.exp(-P*P/2);x.push(A),B===0?T+=A:B<g&&(T+=2*A)}for(let B=0;B<x.length;B++)x[B]=x[B]/T;m.envMap.value=e.texture,m.samples.value=g,m.weights.value=x,m.latitudinal.value=l==="latitudinal",h&&(m.poleAxis.value=h);const{_lodMax:C}=this;m.dTheta.value=b,m.mipInt.value=C-i;const y=this._sizeLods[o],F=3*y*(o>C-Ti?o-C+Ti:0),_=4*(this._cubeSize-y);Yo(t,F,_,3*y,2*y),c.setRenderTarget(t),c.render(f,ea)}}function QC(n){const e=[],t=[],i=[];let o=n;const r=n-Ti+1+Dh.length;for(let l=0;l<r;l++){const h=Math.pow(2,o);t.push(h);let c=1/h;l>n-Ti?c=Dh[l-n+Ti-1]:l===0&&(c=0),i.push(c);const d=1/(h-2),u=-d,f=1+d,m=[u,u,f,u,f,f,u,u,f,f,u,f],p=6,b=6,E=3,g=2,x=1,T=new Float32Array(E*b*p),C=new Float32Array(g*b*p),y=new Float32Array(x*b*p);for(let _=0;_<p;_++){const B=_%3*2/3-1,P=_>2?0:-1,A=[B,P,0,B+2/3,P,0,B+2/3,P+1,0,B,P,0,B+2/3,P+1,0,B,P+1,0];T.set(A,E*b*_),C.set(m,g*b*_);const S=[_,_,_,_,_,_];y.set(S,x*b*_)}const F=new Rn;F.setAttribute("position",new xn(T,E)),F.setAttribute("uv",new xn(C,g)),F.setAttribute("faceIndex",new xn(y,x)),e.push(F),o>Ti&&o--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function kh(n,e,t){const i=new dn(n,e,t);return i.texture.mapping=Er,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Yo(n,e,t,i,o){n.viewport.set(e,t,i,o),n.scissor.set(e,t,i,o)}function jC(n,e,t){const i=new Float32Array(ri),o=new Q(0,1,0);return new Ht({name:"SphericalGaussianBlur",defines:{n:ri,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:ks(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Mn,depthTest:!1,depthWrite:!1})}function Ih(){return new Ht({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ks(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Mn,depthTest:!1,depthWrite:!1})}function Rh(){return new Ht({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ks(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Mn,depthTest:!1,depthWrite:!1})}function ks(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function eA(n){let e=new WeakMap,t=null;function i(h){if(h&&h.isTexture){const c=h.mapping,d=c===fr||c===Ta,u=c===Ni||c===Li;if(d||u){let f=e.get(h);const m=f!==void 0?f.texture.pmremVersion:0;if(h.isRenderTargetTexture&&h.pmremVersion!==m)return t===null&&(t=new rs(n)),f=d?t.fromEquirectangular(h,f):t.fromCubemap(h,f),f.texture.pmremVersion=h.pmremVersion,e.set(h,f),f.texture;if(f!==void 0)return f.texture;{const p=h.image;return d&&p&&p.height>0||u&&p&&o(p)?(t===null&&(t=new rs(n)),f=d?t.fromEquirectangular(h):t.fromCubemap(h),f.texture.pmremVersion=h.pmremVersion,e.set(h,f),h.addEventListener("dispose",r),f.texture):null}}}return h}function o(h){let c=0;const d=6;for(let u=0;u<d;u++)h[u]!==void 0&&c++;return c===d}function r(h){const c=h.target;c.removeEventListener("dispose",r);const d=e.get(c);d!==void 0&&(e.delete(c),d.dispose())}function l(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:l}}function tA(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=n.getExtension(i)}return e[i]=o,o}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const o=t(i);return o===null&&ar("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function nA(n,e,t,i){const o={},r=new WeakMap;function l(f){const m=f.target;m.index!==null&&e.remove(m.index);for(const b in m.attributes)e.remove(m.attributes[b]);m.removeEventListener("dispose",l),delete o[m.id];const p=r.get(m);p&&(e.remove(p),r.delete(m)),i.releaseStatesOfGeometry(m),m.isInstancedBufferGeometry===!0&&delete m._maxInstanceCount,t.memory.geometries--}function h(f,m){return o[m.id]===!0||(m.addEventListener("dispose",l),o[m.id]=!0,t.memory.geometries++),m}function c(f){const m=f.attributes;for(const p in m)e.update(m[p],n.ARRAY_BUFFER)}function d(f){const m=[],p=f.index,b=f.attributes.position;let E=0;if(p!==null){const T=p.array;E=p.version;for(let C=0,y=T.length;C<y;C+=3){const F=T[C+0],_=T[C+1],B=T[C+2];m.push(F,_,_,B,B,F)}}else if(b!==void 0){const T=b.array;E=b.version;for(let C=0,y=T.length/3-1;C<y;C+=3){const F=C+0,_=C+1,B=C+2;m.push(F,_,_,B,B,F)}}else return;const g=new(Yc(m)?ed:jc)(m,1);g.version=E;const x=r.get(f);x&&e.remove(x),r.set(f,g)}function u(f){const m=r.get(f);if(m){const p=f.index;p!==null&&m.version<p.version&&d(f)}else d(f);return r.get(f)}return{get:h,update:c,getWireframeAttribute:u}}function iA(n,e,t){let i;function o(m){i=m}let r,l;function h(m){r=m.type,l=m.bytesPerElement}function c(m,p){n.drawElements(i,p,r,m*l),t.update(p,i,1)}function d(m,p,b){b!==0&&(n.drawElementsInstanced(i,p,r,m*l,b),t.update(p,i,b))}function u(m,p,b){if(b===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,p,0,r,m,0,b);let g=0;for(let x=0;x<b;x++)g+=p[x];t.update(g,i,1)}function f(m,p,b,E){if(b===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let x=0;x<m.length;x++)d(m[x]/l,p[x],E[x]);else{g.multiDrawElementsInstancedWEBGL(i,p,0,r,m,0,E,0,b);let x=0;for(let T=0;T<b;T++)x+=p[T]*E[T];t.update(x,i,1)}}this.setMode=o,this.setIndex=h,this.render=c,this.renderInstances=d,this.renderMultiDraw=u,this.renderMultiDrawInstances=f}function oA(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,l,h){switch(t.calls++,l){case n.TRIANGLES:t.triangles+=h*(r/3);break;case n.LINES:t.lines+=h*(r/2);break;case n.LINE_STRIP:t.lines+=h*(r-1);break;case n.LINE_LOOP:t.lines+=h*r;break;case n.POINTS:t.points+=h*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",l);break}}function o(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:o,update:i}}function rA(n,e,t){const i=new WeakMap,o=new vt;function r(l,h,c){const d=l.morphTargetInfluences,u=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,f=u!==void 0?u.length:0;let m=i.get(h);if(m===void 0||m.count!==f){let A=function(){B.dispose(),i.delete(h),h.removeEventListener("dispose",A)};m!==void 0&&m.texture.dispose();const p=h.morphAttributes.position!==void 0,b=h.morphAttributes.normal!==void 0,E=h.morphAttributes.color!==void 0,g=h.morphAttributes.position||[],x=h.morphAttributes.normal||[],T=h.morphAttributes.color||[];let C=0;p===!0&&(C=1),b===!0&&(C=2),E===!0&&(C=3);let y=h.attributes.position.count*C,F=1;y>e.maxTextureSize&&(F=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const _=new Float32Array(y*F*4*f),B=new $c(_,y,F,f);B.type=Qt,B.needsUpdate=!0;const P=C*4;for(let S=0;S<f;S++){const R=g[S],U=x[S],z=T[S],J=y*F*4*S;for(let Y=0;Y<R.count;Y++){const X=Y*P;p===!0&&(o.fromBufferAttribute(R,Y),_[J+X+0]=o.x,_[J+X+1]=o.y,_[J+X+2]=o.z,_[J+X+3]=0),b===!0&&(o.fromBufferAttribute(U,Y),_[J+X+4]=o.x,_[J+X+5]=o.y,_[J+X+6]=o.z,_[J+X+7]=0),E===!0&&(o.fromBufferAttribute(z,Y),_[J+X+8]=o.x,_[J+X+9]=o.y,_[J+X+10]=o.z,_[J+X+11]=z.itemSize===4?o.w:1)}}m={count:f,texture:B,size:new $e(y,F)},i.set(h,m),h.addEventListener("dispose",A)}if(l.isInstancedMesh===!0&&l.morphTexture!==null)c.getUniforms().setValue(n,"morphTexture",l.morphTexture,t);else{let p=0;for(let E=0;E<d.length;E++)p+=d[E];const b=h.morphTargetsRelative?1:1-p;c.getUniforms().setValue(n,"morphTargetBaseInfluence",b),c.getUniforms().setValue(n,"morphTargetInfluences",d)}c.getUniforms().setValue(n,"morphTargetsTexture",m.texture,t),c.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}return{update:r}}function aA(n,e,t,i){let o=new WeakMap;function r(c){const d=i.render.frame,u=c.geometry,f=e.get(c,u);if(o.get(f)!==d&&(e.update(f),o.set(f,d)),c.isInstancedMesh&&(c.hasEventListener("dispose",h)===!1&&c.addEventListener("dispose",h),o.get(c)!==d&&(t.update(c.instanceMatrix,n.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,n.ARRAY_BUFFER),o.set(c,d))),c.isSkinnedMesh){const m=c.skeleton;o.get(m)!==d&&(m.update(),o.set(m,d))}return f}function l(){o=new WeakMap}function h(c){const d=c.target;d.removeEventListener("dispose",h),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:r,dispose:l}}const ld=new Ut,Nh=new rd(1,1),hd=new $c,cd=new Bw,dd=new id,Lh=[],Hh=[],Gh=new Float32Array(16),Uh=new Float32Array(9),Oh=new Float32Array(4);function qi(n,e,t){const i=n[0];if(i<=0||i>0)return n;const o=e*t;let r=Lh[o];if(r===void 0&&(r=new Float32Array(o),Lh[o]=r),e!==0){i.toArray(r,0);for(let l=1,h=0;l!==e;++l)h+=t,n[l].toArray(r,h)}return r}function Bt(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function _t(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Ar(n,e){let t=Hh[e];t===void 0&&(t=new Int32Array(e),Hh[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function sA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function lA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Bt(t,e))return;n.uniform2fv(this.addr,e),_t(t,e)}}function hA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Bt(t,e))return;n.uniform3fv(this.addr,e),_t(t,e)}}function cA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Bt(t,e))return;n.uniform4fv(this.addr,e),_t(t,e)}}function dA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bt(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),_t(t,e)}else{if(Bt(t,i))return;Oh.set(i),n.uniformMatrix2fv(this.addr,!1,Oh),_t(t,i)}}function uA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bt(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),_t(t,e)}else{if(Bt(t,i))return;Uh.set(i),n.uniformMatrix3fv(this.addr,!1,Uh),_t(t,i)}}function fA(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Bt(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),_t(t,e)}else{if(Bt(t,i))return;Gh.set(i),n.uniformMatrix4fv(this.addr,!1,Gh),_t(t,i)}}function mA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function pA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Bt(t,e))return;n.uniform2iv(this.addr,e),_t(t,e)}}function xA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Bt(t,e))return;n.uniform3iv(this.addr,e),_t(t,e)}}function gA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Bt(t,e))return;n.uniform4iv(this.addr,e),_t(t,e)}}function bA(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function yA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Bt(t,e))return;n.uniform2uiv(this.addr,e),_t(t,e)}}function vA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Bt(t,e))return;n.uniform3uiv(this.addr,e),_t(t,e)}}function wA(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Bt(t,e))return;n.uniform4uiv(this.addr,e),_t(t,e)}}function EA(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o);let r;this.type===n.SAMPLER_2D_SHADOW?(Nh.compareFunction=Kc,r=Nh):r=ld,t.setTexture2D(e||r,o)}function CA(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture3D(e||cd,o)}function AA(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTextureCube(e||dd,o)}function SA(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture2DArray(e||hd,o)}function BA(n){switch(n){case 5126:return sA;case 35664:return lA;case 35665:return hA;case 35666:return cA;case 35674:return dA;case 35675:return uA;case 35676:return fA;case 5124:case 35670:return mA;case 35667:case 35671:return pA;case 35668:case 35672:return xA;case 35669:case 35673:return gA;case 5125:return bA;case 36294:return yA;case 36295:return vA;case 36296:return wA;case 35678:case 36198:case 36298:case 36306:case 35682:return EA;case 35679:case 36299:case 36307:return CA;case 35680:case 36300:case 36308:case 36293:return AA;case 36289:case 36303:case 36311:case 36292:return SA}}function _A(n,e){n.uniform1fv(this.addr,e)}function TA(n,e){const t=qi(e,this.size,2);n.uniform2fv(this.addr,t)}function FA(n,e){const t=qi(e,this.size,3);n.uniform3fv(this.addr,t)}function DA(n,e){const t=qi(e,this.size,4);n.uniform4fv(this.addr,t)}function MA(n,e){const t=qi(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function PA(n,e){const t=qi(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function kA(n,e){const t=qi(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function IA(n,e){n.uniform1iv(this.addr,e)}function RA(n,e){n.uniform2iv(this.addr,e)}function NA(n,e){n.uniform3iv(this.addr,e)}function LA(n,e){n.uniform4iv(this.addr,e)}function HA(n,e){n.uniform1uiv(this.addr,e)}function GA(n,e){n.uniform2uiv(this.addr,e)}function UA(n,e){n.uniform3uiv(this.addr,e)}function OA(n,e){n.uniform4uiv(this.addr,e)}function zA(n,e,t){const i=this.cache,o=e.length,r=Ar(t,o);Bt(i,r)||(n.uniform1iv(this.addr,r),_t(i,r));for(let l=0;l!==o;++l)t.setTexture2D(e[l]||ld,r[l])}function VA(n,e,t){const i=this.cache,o=e.length,r=Ar(t,o);Bt(i,r)||(n.uniform1iv(this.addr,r),_t(i,r));for(let l=0;l!==o;++l)t.setTexture3D(e[l]||cd,r[l])}function WA(n,e,t){const i=this.cache,o=e.length,r=Ar(t,o);Bt(i,r)||(n.uniform1iv(this.addr,r),_t(i,r));for(let l=0;l!==o;++l)t.setTextureCube(e[l]||dd,r[l])}function JA(n,e,t){const i=this.cache,o=e.length,r=Ar(t,o);Bt(i,r)||(n.uniform1iv(this.addr,r),_t(i,r));for(let l=0;l!==o;++l)t.setTexture2DArray(e[l]||hd,r[l])}function qA(n){switch(n){case 5126:return _A;case 35664:return TA;case 35665:return FA;case 35666:return DA;case 35674:return MA;case 35675:return PA;case 35676:return kA;case 5124:case 35670:return IA;case 35667:case 35671:return RA;case 35668:case 35672:return NA;case 35669:case 35673:return LA;case 5125:return HA;case 36294:return GA;case 36295:return UA;case 36296:return OA;case 35678:case 36198:case 36298:case 36306:case 35682:return zA;case 35679:case 36299:case 36307:return VA;case 35680:case 36300:case 36308:case 36293:return WA;case 36289:case 36303:case 36311:case 36292:return JA}}class XA{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=BA(t.type)}}class KA{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=qA(t.type)}}class YA{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const o=this.seq;for(let r=0,l=o.length;r!==l;++r){const h=o[r];h.setValue(e,t[h.id],i)}}}const ra=/(\w+)(\])?(\[|\.)?/g;function zh(n,e){n.seq.push(e),n.map[e.id]=e}function $A(n,e,t){const i=n.name,o=i.length;for(ra.lastIndex=0;;){const r=ra.exec(i),l=ra.lastIndex;let h=r[1];const c=r[2]==="]",d=r[3];if(c&&(h=h|0),d===void 0||d==="["&&l+2===o){zh(t,d===void 0?new XA(h,n,e):new KA(h,n,e));break}else{let f=t.map[h];f===void 0&&(f=new YA(h),zh(t,f)),t=f}}}class sr{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const r=e.getActiveUniform(t,o),l=e.getUniformLocation(t,r.name);$A(r,l,this)}}setValue(e,t,i,o){const r=this.map[t];r!==void 0&&r.setValue(e,i,o)}setOptional(e,t,i){const o=t[i];o!==void 0&&this.setValue(e,i,o)}static upload(e,t,i,o){for(let r=0,l=t.length;r!==l;++r){const h=t[r],c=i[h.id];c.needsUpdate!==!1&&h.setValue(e,c.value,o)}}static seqWithValue(e,t){const i=[];for(let o=0,r=e.length;o!==r;++o){const l=e[o];l.id in t&&i.push(l)}return i}}function Vh(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const ZA=37297;let QA=0;function jA(n,e){const t=n.split(`
`),i=[],o=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let l=o;l<r;l++){const h=l+1;i.push(`${h===e?">":" "} ${h}: ${t[l]}`)}return i.join(`
`)}const Wh=new tt;function eS(n){ct._getMatrix(Wh,ct.workingColorSpace,n);const e=`mat3( ${Wh.elements.map(t=>t.toFixed(4))} )`;switch(ct.getTransfer(n)){case mr:return[e,"LinearTransferOETF"];case mt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function Jh(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),o=n.getShaderInfoLog(e).trim();if(i&&o==="")return"";const r=/ERROR: 0:(\d+)/.exec(o);if(r){const l=parseInt(r[1]);return t.toUpperCase()+`

`+o+`

`+jA(n.getShaderSource(e),l)}else return o}function tS(n,e){const t=eS(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function nS(n,e){let t;switch(e){case Qv:t="Linear";break;case jv:t="Reinhard";break;case ew:t="Cineon";break;case tw:t="ACESFilmic";break;case iw:t="AgX";break;case ow:t="Neutral";break;case nw:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const $o=new Q;function iS(){ct.getLuminanceCoefficients($o);const n=$o.x.toFixed(4),e=$o.y.toFixed(4),t=$o.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function oS(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ao).join(`
`)}function rS(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function aS(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let o=0;o<i;o++){const r=n.getActiveAttrib(e,o),l=r.name;let h=1;r.type===n.FLOAT_MAT2&&(h=2),r.type===n.FLOAT_MAT3&&(h=3),r.type===n.FLOAT_MAT4&&(h=4),t[l]={type:r.type,location:n.getAttribLocation(e,l),locationSize:h}}return t}function ao(n){return n!==""}function qh(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Xh(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const sS=/^[ \t]*#include +<([\w\d./]+)>/gm;function as(n){return n.replace(sS,hS)}const lS=new Map;function hS(n,e){let t=nt[e];if(t===void 0){const i=lS.get(e);if(i!==void 0)t=nt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return as(t)}const cS=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Kh(n){return n.replace(cS,dS)}function dS(n,e,t,i){let o="";for(let r=parseInt(e);r<parseInt(t);r++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return o}function Yh(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function uS(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===Lc?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===Mv?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Sn&&(e="SHADOWMAP_TYPE_VSM"),e}function fS(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ni:case Li:e="ENVMAP_TYPE_CUBE";break;case Er:e="ENVMAP_TYPE_CUBE_UV";break}return e}function mS(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Li:e="ENVMAP_MODE_REFRACTION";break}return e}function pS(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case Hc:e="ENVMAP_BLENDING_MULTIPLY";break;case $v:e="ENVMAP_BLENDING_MIX";break;case Zv:e="ENVMAP_BLENDING_ADD";break}return e}function xS(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}function gS(n,e,t,i){const o=n.getContext(),r=t.defines;let l=t.vertexShader,h=t.fragmentShader;const c=uS(t),d=fS(t),u=mS(t),f=pS(t),m=xS(t),p=oS(t),b=rS(r),E=o.createProgram();let g,x,T=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(ao).join(`
`),g.length>0&&(g+=`
`),x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(ao).join(`
`),x.length>0&&(x+=`
`)):(g=[Yh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ao).join(`
`),x=[Yh(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+u:"",t.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==qn?"#define TONE_MAPPING":"",t.toneMapping!==qn?nt.tonemapping_pars_fragment:"",t.toneMapping!==qn?nS("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",nt.colorspace_pars_fragment,tS("linearToOutputTexel",t.outputColorSpace),iS(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ao).join(`
`)),l=as(l),l=qh(l,t),l=Xh(l,t),h=as(h),h=qh(h,t),h=Xh(h,t),l=Kh(l),h=Kh(h),t.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,x=["#define varying in",t.glslVersion===is?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===is?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const C=T+g+l,y=T+x+h,F=Vh(o,o.VERTEX_SHADER,C),_=Vh(o,o.FRAGMENT_SHADER,y);o.attachShader(E,F),o.attachShader(E,_),t.index0AttributeName!==void 0?o.bindAttribLocation(E,0,t.index0AttributeName):t.morphTargets===!0&&o.bindAttribLocation(E,0,"position"),o.linkProgram(E);function B(R){if(n.debug.checkShaderErrors){const U=o.getProgramInfoLog(E).trim(),z=o.getShaderInfoLog(F).trim(),J=o.getShaderInfoLog(_).trim();let Y=!0,X=!0;if(o.getProgramParameter(E,o.LINK_STATUS)===!1)if(Y=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(o,E,F,_);else{const ee=Jh(o,F,"vertex"),$=Jh(o,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(E,o.VALIDATE_STATUS)+`

Material Name: `+R.name+`
Material Type: `+R.type+`

Program Info Log: `+U+`
`+ee+`
`+$)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):(z===""||J==="")&&(X=!1);X&&(R.diagnostics={runnable:Y,programLog:U,vertexShader:{log:z,prefix:g},fragmentShader:{log:J,prefix:x}})}o.deleteShader(F),o.deleteShader(_),P=new sr(o,E),A=aS(o,E)}let P;this.getUniforms=function(){return P===void 0&&B(this),P};let A;this.getAttributes=function(){return A===void 0&&B(this),A};let S=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=o.getProgramParameter(E,ZA)),S},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(E),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=QA++,this.cacheKey=e,this.usedTimes=1,this.program=E,this.vertexShader=F,this.fragmentShader=_,this}let bS=0;class yS{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,o=this._getShaderStage(t),r=this._getShaderStage(i),l=this._getShaderCacheForMaterial(e);return l.has(o)===!1&&(l.add(o),o.usedTimes++),l.has(r)===!1&&(l.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new vS(e),t.set(e,i)),i}}class vS{constructor(e){this.id=bS++,this.code=e,this.usedTimes=0}}function wS(n,e,t,i,o,r,l){const h=new Zc,c=new yS,d=new Set,u=[],f=o.logarithmicDepthBuffer,m=o.vertexTextures;let p=o.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function E(A){return d.add(A),A===0?"uv":`uv${A}`}function g(A,S,R,U,z){const J=U.fog,Y=z.geometry,X=A.isMeshStandardMaterial?U.environment:null,ee=(A.isMeshStandardMaterial?t:e).get(A.envMap||X),$=ee&&ee.mapping===Er?ee.image.height:null,he=b[A.type];A.precision!==null&&(p=o.getMaxPrecision(A.precision),p!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",p,"instead."));const fe=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,re=fe!==void 0?fe.length:0;let ve=0;Y.morphAttributes.position!==void 0&&(ve=1),Y.morphAttributes.normal!==void 0&&(ve=2),Y.morphAttributes.color!==void 0&&(ve=3);let Ge,Z,ge,ce;if(he){const ut=pn[he];Ge=ut.vertexShader,Z=ut.fragmentShader}else Ge=A.vertexShader,Z=A.fragmentShader,c.update(A),ge=c.getVertexShaderID(A),ce=c.getFragmentShaderID(A);const me=n.getRenderTarget(),_e=n.state.buffers.depth.getReversed(),we=z.isInstancedMesh===!0,Ne=z.isBatchedMesh===!0,rt=!!A.map,lt=!!A.matcap,Xe=!!ee,O=!!A.aoMap,pt=!!A.lightMap,Ye=!!A.bumpMap,Ke=!!A.normalMap,Ie=!!A.displacementMap,it=!!A.emissiveMap,Ue=!!A.metalnessMap,N=!!A.roughnessMap,D=A.anisotropy>0,j=A.clearcoat>0,se=A.dispersion>0,pe=A.iridescence>0,oe=A.sheen>0,Le=A.transmission>0,Ce=D&&!!A.anisotropyMap,ze=j&&!!A.clearcoatMap,qe=j&&!!A.clearcoatNormalMap,be=j&&!!A.clearcoatRoughnessMap,Fe=pe&&!!A.iridescenceMap,Re=pe&&!!A.iridescenceThicknessMap,He=oe&&!!A.sheenColorMap,Te=oe&&!!A.sheenRoughnessMap,Ze=!!A.specularMap,Ve=!!A.specularColorMap,Qe=!!A.specularIntensityMap,W=Le&&!!A.transmissionMap,te=Le&&!!A.thicknessMap,ie=!!A.gradientMap,de=!!A.alphaMap,Be=A.alphaTest>0,Ae=!!A.alphaHash,je=!!A.extensions;let yt=qn;A.toneMapped&&(me===null||me.isXRRenderTarget===!0)&&(yt=n.toneMapping);const Tt={shaderID:he,shaderType:A.type,shaderName:A.name,vertexShader:Ge,fragmentShader:Z,defines:A.defines,customVertexShaderID:ge,customFragmentShaderID:ce,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:p,batching:Ne,batchingColor:Ne&&z._colorsTexture!==null,instancing:we,instancingColor:we&&z.instanceColor!==null,instancingMorph:we&&z.morphTexture!==null,supportsVertexTextures:m,outputColorSpace:me===null?n.outputColorSpace:me.isXRRenderTarget===!0?me.texture.colorSpace:Kn,alphaToCoverage:!!A.alphaToCoverage,map:rt,matcap:lt,envMap:Xe,envMapMode:Xe&&ee.mapping,envMapCubeUVHeight:$,aoMap:O,lightMap:pt,bumpMap:Ye,normalMap:Ke,displacementMap:m&&Ie,emissiveMap:it,normalMapObjectSpace:Ke&&A.normalMapType===lw,normalMapTangentSpace:Ke&&A.normalMapType===Xc,metalnessMap:Ue,roughnessMap:N,anisotropy:D,anisotropyMap:Ce,clearcoat:j,clearcoatMap:ze,clearcoatNormalMap:qe,clearcoatRoughnessMap:be,dispersion:se,iridescence:pe,iridescenceMap:Fe,iridescenceThicknessMap:Re,sheen:oe,sheenColorMap:He,sheenRoughnessMap:Te,specularMap:Ze,specularColorMap:Ve,specularIntensityMap:Qe,transmission:Le,transmissionMap:W,thicknessMap:te,gradientMap:ie,opaque:A.transparent===!1&&A.blending===ki&&A.alphaToCoverage===!1,alphaMap:de,alphaTest:Be,alphaHash:Ae,combine:A.combine,mapUv:rt&&E(A.map.channel),aoMapUv:O&&E(A.aoMap.channel),lightMapUv:pt&&E(A.lightMap.channel),bumpMapUv:Ye&&E(A.bumpMap.channel),normalMapUv:Ke&&E(A.normalMap.channel),displacementMapUv:Ie&&E(A.displacementMap.channel),emissiveMapUv:it&&E(A.emissiveMap.channel),metalnessMapUv:Ue&&E(A.metalnessMap.channel),roughnessMapUv:N&&E(A.roughnessMap.channel),anisotropyMapUv:Ce&&E(A.anisotropyMap.channel),clearcoatMapUv:ze&&E(A.clearcoatMap.channel),clearcoatNormalMapUv:qe&&E(A.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:be&&E(A.clearcoatRoughnessMap.channel),iridescenceMapUv:Fe&&E(A.iridescenceMap.channel),iridescenceThicknessMapUv:Re&&E(A.iridescenceThicknessMap.channel),sheenColorMapUv:He&&E(A.sheenColorMap.channel),sheenRoughnessMapUv:Te&&E(A.sheenRoughnessMap.channel),specularMapUv:Ze&&E(A.specularMap.channel),specularColorMapUv:Ve&&E(A.specularColorMap.channel),specularIntensityMapUv:Qe&&E(A.specularIntensityMap.channel),transmissionMapUv:W&&E(A.transmissionMap.channel),thicknessMapUv:te&&E(A.thicknessMap.channel),alphaMapUv:de&&E(A.alphaMap.channel),vertexTangents:!!Y.attributes.tangent&&(Ke||D),vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,pointsUvs:z.isPoints===!0&&!!Y.attributes.uv&&(rt||de),fog:!!J,useFog:A.fog===!0,fogExp2:!!J&&J.isFogExp2,flatShading:A.flatShading===!0,sizeAttenuation:A.sizeAttenuation===!0,logarithmicDepthBuffer:f,reverseDepthBuffer:_e,skinning:z.isSkinnedMesh===!0,morphTargets:Y.morphAttributes.position!==void 0,morphNormals:Y.morphAttributes.normal!==void 0,morphColors:Y.morphAttributes.color!==void 0,morphTargetsCount:re,morphTextureStride:ve,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:l.numPlanes,numClipIntersection:l.numIntersection,dithering:A.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:yt,decodeVideoTexture:rt&&A.map.isVideoTexture===!0&&ct.getTransfer(A.map.colorSpace)===mt,decodeVideoTextureEmissive:it&&A.emissiveMap.isVideoTexture===!0&&ct.getTransfer(A.emissiveMap.colorSpace)===mt,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===Bn,flipSided:A.side===Gt,useDepthPacking:A.depthPacking>=0,depthPacking:A.depthPacking||0,index0AttributeName:A.index0AttributeName,extensionClipCullDistance:je&&A.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(je&&A.extensions.multiDraw===!0||Ne)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:A.customProgramCacheKey()};return Tt.vertexUv1s=d.has(1),Tt.vertexUv2s=d.has(2),Tt.vertexUv3s=d.has(3),d.clear(),Tt}function x(A){const S=[];if(A.shaderID?S.push(A.shaderID):(S.push(A.customVertexShaderID),S.push(A.customFragmentShaderID)),A.defines!==void 0)for(const R in A.defines)S.push(R),S.push(A.defines[R]);return A.isRawShaderMaterial===!1&&(T(S,A),C(S,A),S.push(n.outputColorSpace)),S.push(A.customProgramCacheKey),S.join()}function T(A,S){A.push(S.precision),A.push(S.outputColorSpace),A.push(S.envMapMode),A.push(S.envMapCubeUVHeight),A.push(S.mapUv),A.push(S.alphaMapUv),A.push(S.lightMapUv),A.push(S.aoMapUv),A.push(S.bumpMapUv),A.push(S.normalMapUv),A.push(S.displacementMapUv),A.push(S.emissiveMapUv),A.push(S.metalnessMapUv),A.push(S.roughnessMapUv),A.push(S.anisotropyMapUv),A.push(S.clearcoatMapUv),A.push(S.clearcoatNormalMapUv),A.push(S.clearcoatRoughnessMapUv),A.push(S.iridescenceMapUv),A.push(S.iridescenceThicknessMapUv),A.push(S.sheenColorMapUv),A.push(S.sheenRoughnessMapUv),A.push(S.specularMapUv),A.push(S.specularColorMapUv),A.push(S.specularIntensityMapUv),A.push(S.transmissionMapUv),A.push(S.thicknessMapUv),A.push(S.combine),A.push(S.fogExp2),A.push(S.sizeAttenuation),A.push(S.morphTargetsCount),A.push(S.morphAttributeCount),A.push(S.numDirLights),A.push(S.numPointLights),A.push(S.numSpotLights),A.push(S.numSpotLightMaps),A.push(S.numHemiLights),A.push(S.numRectAreaLights),A.push(S.numDirLightShadows),A.push(S.numPointLightShadows),A.push(S.numSpotLightShadows),A.push(S.numSpotLightShadowsWithMaps),A.push(S.numLightProbes),A.push(S.shadowMapType),A.push(S.toneMapping),A.push(S.numClippingPlanes),A.push(S.numClipIntersection),A.push(S.depthPacking)}function C(A,S){h.disableAll(),S.supportsVertexTextures&&h.enable(0),S.instancing&&h.enable(1),S.instancingColor&&h.enable(2),S.instancingMorph&&h.enable(3),S.matcap&&h.enable(4),S.envMap&&h.enable(5),S.normalMapObjectSpace&&h.enable(6),S.normalMapTangentSpace&&h.enable(7),S.clearcoat&&h.enable(8),S.iridescence&&h.enable(9),S.alphaTest&&h.enable(10),S.vertexColors&&h.enable(11),S.vertexAlphas&&h.enable(12),S.vertexUv1s&&h.enable(13),S.vertexUv2s&&h.enable(14),S.vertexUv3s&&h.enable(15),S.vertexTangents&&h.enable(16),S.anisotropy&&h.enable(17),S.alphaHash&&h.enable(18),S.batching&&h.enable(19),S.dispersion&&h.enable(20),S.batchingColor&&h.enable(21),A.push(h.mask),h.disableAll(),S.fog&&h.enable(0),S.useFog&&h.enable(1),S.flatShading&&h.enable(2),S.logarithmicDepthBuffer&&h.enable(3),S.reverseDepthBuffer&&h.enable(4),S.skinning&&h.enable(5),S.morphTargets&&h.enable(6),S.morphNormals&&h.enable(7),S.morphColors&&h.enable(8),S.premultipliedAlpha&&h.enable(9),S.shadowMapEnabled&&h.enable(10),S.doubleSided&&h.enable(11),S.flipSided&&h.enable(12),S.useDepthPacking&&h.enable(13),S.dithering&&h.enable(14),S.transmission&&h.enable(15),S.sheen&&h.enable(16),S.opaque&&h.enable(17),S.pointsUvs&&h.enable(18),S.decodeVideoTexture&&h.enable(19),S.decodeVideoTextureEmissive&&h.enable(20),S.alphaToCoverage&&h.enable(21),A.push(h.mask)}function y(A){const S=b[A.type];let R;if(S){const U=pn[S];R=gr.clone(U.uniforms)}else R=A.uniforms;return R}function F(A,S){let R;for(let U=0,z=u.length;U<z;U++){const J=u[U];if(J.cacheKey===S){R=J,++R.usedTimes;break}}return R===void 0&&(R=new gS(n,S,A,r),u.push(R)),R}function _(A){if(--A.usedTimes===0){const S=u.indexOf(A);u[S]=u[u.length-1],u.pop(),A.destroy()}}function B(A){c.remove(A)}function P(){c.dispose()}return{getParameters:g,getProgramCacheKey:x,getUniforms:y,acquireProgram:F,releaseProgram:_,releaseShaderCache:B,programs:u,dispose:P}}function ES(){let n=new WeakMap;function e(l){return n.has(l)}function t(l){let h=n.get(l);return h===void 0&&(h={},n.set(l,h)),h}function i(l){n.delete(l)}function o(l,h,c){n.get(l)[h]=c}function r(){n=new WeakMap}return{has:e,get:t,remove:i,update:o,dispose:r}}function CS(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function $h(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Zh(){const n=[];let e=0;const t=[],i=[],o=[];function r(){e=0,t.length=0,i.length=0,o.length=0}function l(f,m,p,b,E,g){let x=n[e];return x===void 0?(x={id:f.id,object:f,geometry:m,material:p,groupOrder:b,renderOrder:f.renderOrder,z:E,group:g},n[e]=x):(x.id=f.id,x.object=f,x.geometry=m,x.material=p,x.groupOrder=b,x.renderOrder=f.renderOrder,x.z=E,x.group=g),e++,x}function h(f,m,p,b,E,g){const x=l(f,m,p,b,E,g);p.transmission>0?i.push(x):p.transparent===!0?o.push(x):t.push(x)}function c(f,m,p,b,E,g){const x=l(f,m,p,b,E,g);p.transmission>0?i.unshift(x):p.transparent===!0?o.unshift(x):t.unshift(x)}function d(f,m){t.length>1&&t.sort(f||CS),i.length>1&&i.sort(m||$h),o.length>1&&o.sort(m||$h)}function u(){for(let f=e,m=n.length;f<m;f++){const p=n[f];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:i,transparent:o,init:r,push:h,unshift:c,finish:u,sort:d}}function AS(){let n=new WeakMap;function e(i,o){const r=n.get(i);let l;return r===void 0?(l=new Zh,n.set(i,[l])):o>=r.length?(l=new Zh,r.push(l)):l=r[o],l}function t(){n=new WeakMap}return{get:e,dispose:t}}function SS(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Q,color:new st};break;case"SpotLight":t={position:new Q,direction:new Q,color:new st,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Q,color:new st,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Q,skyColor:new st,groundColor:new st};break;case"RectAreaLight":t={color:new st,position:new Q,halfWidth:new Q,halfHeight:new Q};break}return n[e.id]=t,t}}}function BS(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let _S=0;function TS(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function FS(n){const e=new SS,t=BS(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let d=0;d<9;d++)i.probe.push(new Q);const o=new Q,r=new Ct,l=new Ct;function h(d){let u=0,f=0,m=0;for(let A=0;A<9;A++)i.probe[A].set(0,0,0);let p=0,b=0,E=0,g=0,x=0,T=0,C=0,y=0,F=0,_=0,B=0;d.sort(TS);for(let A=0,S=d.length;A<S;A++){const R=d[A],U=R.color,z=R.intensity,J=R.distance,Y=R.shadow&&R.shadow.map?R.shadow.map.texture:null;if(R.isAmbientLight)u+=U.r*z,f+=U.g*z,m+=U.b*z;else if(R.isLightProbe){for(let X=0;X<9;X++)i.probe[X].addScaledVector(R.sh.coefficients[X],z);B++}else if(R.isDirectionalLight){const X=e.get(R);if(X.color.copy(R.color).multiplyScalar(R.intensity),R.castShadow){const ee=R.shadow,$=t.get(R);$.shadowIntensity=ee.intensity,$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,i.directionalShadow[p]=$,i.directionalShadowMap[p]=Y,i.directionalShadowMatrix[p]=R.shadow.matrix,T++}i.directional[p]=X,p++}else if(R.isSpotLight){const X=e.get(R);X.position.setFromMatrixPosition(R.matrixWorld),X.color.copy(U).multiplyScalar(z),X.distance=J,X.coneCos=Math.cos(R.angle),X.penumbraCos=Math.cos(R.angle*(1-R.penumbra)),X.decay=R.decay,i.spot[E]=X;const ee=R.shadow;if(R.map&&(i.spotLightMap[F]=R.map,F++,ee.updateMatrices(R),R.castShadow&&_++),i.spotLightMatrix[E]=ee.matrix,R.castShadow){const $=t.get(R);$.shadowIntensity=ee.intensity,$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,i.spotShadow[E]=$,i.spotShadowMap[E]=Y,y++}E++}else if(R.isRectAreaLight){const X=e.get(R);X.color.copy(U).multiplyScalar(z),X.halfWidth.set(R.width*.5,0,0),X.halfHeight.set(0,R.height*.5,0),i.rectArea[g]=X,g++}else if(R.isPointLight){const X=e.get(R);if(X.color.copy(R.color).multiplyScalar(R.intensity),X.distance=R.distance,X.decay=R.decay,R.castShadow){const ee=R.shadow,$=t.get(R);$.shadowIntensity=ee.intensity,$.shadowBias=ee.bias,$.shadowNormalBias=ee.normalBias,$.shadowRadius=ee.radius,$.shadowMapSize=ee.mapSize,$.shadowCameraNear=ee.camera.near,$.shadowCameraFar=ee.camera.far,i.pointShadow[b]=$,i.pointShadowMap[b]=Y,i.pointShadowMatrix[b]=R.shadow.matrix,C++}i.point[b]=X,b++}else if(R.isHemisphereLight){const X=e.get(R);X.skyColor.copy(R.color).multiplyScalar(z),X.groundColor.copy(R.groundColor).multiplyScalar(z),i.hemi[x]=X,x++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ee.LTC_FLOAT_1,i.rectAreaLTC2=Ee.LTC_FLOAT_2):(i.rectAreaLTC1=Ee.LTC_HALF_1,i.rectAreaLTC2=Ee.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=f,i.ambient[2]=m;const P=i.hash;(P.directionalLength!==p||P.pointLength!==b||P.spotLength!==E||P.rectAreaLength!==g||P.hemiLength!==x||P.numDirectionalShadows!==T||P.numPointShadows!==C||P.numSpotShadows!==y||P.numSpotMaps!==F||P.numLightProbes!==B)&&(i.directional.length=p,i.spot.length=E,i.rectArea.length=g,i.point.length=b,i.hemi.length=x,i.directionalShadow.length=T,i.directionalShadowMap.length=T,i.pointShadow.length=C,i.pointShadowMap.length=C,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=T,i.pointShadowMatrix.length=C,i.spotLightMatrix.length=y+F-_,i.spotLightMap.length=F,i.numSpotLightShadowsWithMaps=_,i.numLightProbes=B,P.directionalLength=p,P.pointLength=b,P.spotLength=E,P.rectAreaLength=g,P.hemiLength=x,P.numDirectionalShadows=T,P.numPointShadows=C,P.numSpotShadows=y,P.numSpotMaps=F,P.numLightProbes=B,i.version=_S++)}function c(d,u){let f=0,m=0,p=0,b=0,E=0;const g=u.matrixWorldInverse;for(let x=0,T=d.length;x<T;x++){const C=d[x];if(C.isDirectionalLight){const y=i.directional[f];y.direction.setFromMatrixPosition(C.matrixWorld),o.setFromMatrixPosition(C.target.matrixWorld),y.direction.sub(o),y.direction.transformDirection(g),f++}else if(C.isSpotLight){const y=i.spot[p];y.position.setFromMatrixPosition(C.matrixWorld),y.position.applyMatrix4(g),y.direction.setFromMatrixPosition(C.matrixWorld),o.setFromMatrixPosition(C.target.matrixWorld),y.direction.sub(o),y.direction.transformDirection(g),p++}else if(C.isRectAreaLight){const y=i.rectArea[b];y.position.setFromMatrixPosition(C.matrixWorld),y.position.applyMatrix4(g),l.identity(),r.copy(C.matrixWorld),r.premultiply(g),l.extractRotation(r),y.halfWidth.set(C.width*.5,0,0),y.halfHeight.set(0,C.height*.5,0),y.halfWidth.applyMatrix4(l),y.halfHeight.applyMatrix4(l),b++}else if(C.isPointLight){const y=i.point[m];y.position.setFromMatrixPosition(C.matrixWorld),y.position.applyMatrix4(g),m++}else if(C.isHemisphereLight){const y=i.hemi[E];y.direction.setFromMatrixPosition(C.matrixWorld),y.direction.transformDirection(g),E++}}}return{setup:h,setupView:c,state:i}}function Qh(n){const e=new FS(n),t=[],i=[];function o(u){d.camera=u,t.length=0,i.length=0}function r(u){t.push(u)}function l(u){i.push(u)}function h(){e.setup(t)}function c(u){e.setupView(t,u)}const d={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:o,state:d,setupLights:h,setupLightsView:c,pushLight:r,pushShadow:l}}function DS(n){let e=new WeakMap;function t(o,r=0){const l=e.get(o);let h;return l===void 0?(h=new Qh(n),e.set(o,[h])):r>=l.length?(h=new Qh(n),l.push(h)):h=l[r],h}function i(){e=new WeakMap}return{get:t,dispose:i}}const MS=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,PS=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function kS(n,e,t){let i=new od;const o=new $e,r=new $e,l=new vt,h=new e1({depthPacking:sw}),c=new t1,d={},u=t.maxTextureSize,f={[Xn]:Gt,[Gt]:Xn,[Bn]:Bn},m=new Ht({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $e},radius:{value:4}},vertexShader:MS,fragmentShader:PS}),p=m.clone();p.defines.HORIZONTAL_PASS=1;const b=new Rn;b.setAttribute("position",new xn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new en(b,m),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Lc;let x=this.type;this.render=function(_,B,P){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||_.length===0)return;const A=n.getRenderTarget(),S=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),U=n.state;U.setBlending(Mn),U.buffers.color.setClear(1,1,1,1),U.buffers.depth.setTest(!0),U.setScissorTest(!1);const z=x!==Sn&&this.type===Sn,J=x===Sn&&this.type!==Sn;for(let Y=0,X=_.length;Y<X;Y++){const ee=_[Y],$=ee.shadow;if($===void 0){console.warn("THREE.WebGLShadowMap:",ee,"has no shadow.");continue}if($.autoUpdate===!1&&$.needsUpdate===!1)continue;o.copy($.mapSize);const he=$.getFrameExtents();if(o.multiply(he),r.copy($.mapSize),(o.x>u||o.y>u)&&(o.x>u&&(r.x=Math.floor(u/he.x),o.x=r.x*he.x,$.mapSize.x=r.x),o.y>u&&(r.y=Math.floor(u/he.y),o.y=r.y*he.y,$.mapSize.y=r.y)),$.map===null||z===!0||J===!0){const re=this.type!==Sn?{minFilter:qt,magFilter:qt}:{};$.map!==null&&$.map.dispose(),$.map=new dn(o.x,o.y,re),$.map.texture.name=ee.name+".shadowMap",$.camera.updateProjectionMatrix()}n.setRenderTarget($.map),n.clear();const fe=$.getViewportCount();for(let re=0;re<fe;re++){const ve=$.getViewport(re);l.set(r.x*ve.x,r.y*ve.y,r.x*ve.z,r.y*ve.w),U.viewport(l),$.updateMatrices(ee,re),i=$.getFrustum(),y(B,P,$.camera,ee,this.type)}$.isPointLightShadow!==!0&&this.type===Sn&&T($,P),$.needsUpdate=!1}x=this.type,g.needsUpdate=!1,n.setRenderTarget(A,S,R)};function T(_,B){const P=e.update(E);m.defines.VSM_SAMPLES!==_.blurSamples&&(m.defines.VSM_SAMPLES=_.blurSamples,p.defines.VSM_SAMPLES=_.blurSamples,m.needsUpdate=!0,p.needsUpdate=!0),_.mapPass===null&&(_.mapPass=new dn(o.x,o.y)),m.uniforms.shadow_pass.value=_.map.texture,m.uniforms.resolution.value=_.mapSize,m.uniforms.radius.value=_.radius,n.setRenderTarget(_.mapPass),n.clear(),n.renderBufferDirect(B,null,P,m,E,null),p.uniforms.shadow_pass.value=_.mapPass.texture,p.uniforms.resolution.value=_.mapSize,p.uniforms.radius.value=_.radius,n.setRenderTarget(_.map),n.clear(),n.renderBufferDirect(B,null,P,p,E,null)}function C(_,B,P,A){let S=null;const R=P.isPointLight===!0?_.customDistanceMaterial:_.customDepthMaterial;if(R!==void 0)S=R;else if(S=P.isPointLight===!0?c:h,n.localClippingEnabled&&B.clipShadows===!0&&Array.isArray(B.clippingPlanes)&&B.clippingPlanes.length!==0||B.displacementMap&&B.displacementScale!==0||B.alphaMap&&B.alphaTest>0||B.map&&B.alphaTest>0||B.alphaToCoverage===!0){const U=S.uuid,z=B.uuid;let J=d[U];J===void 0&&(J={},d[U]=J);let Y=J[z];Y===void 0&&(Y=S.clone(),J[z]=Y,B.addEventListener("dispose",F)),S=Y}if(S.visible=B.visible,S.wireframe=B.wireframe,A===Sn?S.side=B.shadowSide!==null?B.shadowSide:B.side:S.side=B.shadowSide!==null?B.shadowSide:f[B.side],S.alphaMap=B.alphaMap,S.alphaTest=B.alphaToCoverage===!0?.5:B.alphaTest,S.map=B.map,S.clipShadows=B.clipShadows,S.clippingPlanes=B.clippingPlanes,S.clipIntersection=B.clipIntersection,S.displacementMap=B.displacementMap,S.displacementScale=B.displacementScale,S.displacementBias=B.displacementBias,S.wireframeLinewidth=B.wireframeLinewidth,S.linewidth=B.linewidth,P.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const U=n.properties.get(S);U.light=P}return S}function y(_,B,P,A,S){if(_.visible===!1)return;if(_.layers.test(B.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&S===Sn)&&(!_.frustumCulled||i.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,_.matrixWorld);const z=e.update(_),J=_.material;if(Array.isArray(J)){const Y=z.groups;for(let X=0,ee=Y.length;X<ee;X++){const $=Y[X],he=J[$.materialIndex];if(he&&he.visible){const fe=C(_,he,A,S);_.onBeforeShadow(n,_,B,P,z,fe,$),n.renderBufferDirect(P,null,z,fe,_,$),_.onAfterShadow(n,_,B,P,z,fe,$)}}}else if(J.visible){const Y=C(_,J,A,S);_.onBeforeShadow(n,_,B,P,z,Y,null),n.renderBufferDirect(P,null,z,Y,_,null),_.onAfterShadow(n,_,B,P,z,Y,null)}}const U=_.children;for(let z=0,J=U.length;z<J;z++)y(U[z],B,P,A,S)}function F(_){_.target.removeEventListener("dispose",F);for(const P in d){const A=d[P],S=_.target.uuid;S in A&&(A[S].dispose(),delete A[S])}}}const IS={[wa]:Ea,[Ca]:Ba,[Aa]:_a,[Ri]:Sa,[Ea]:wa,[Ba]:Ca,[_a]:Aa,[Sa]:Ri};function RS(n,e){function t(){let W=!1;const te=new vt;let ie=null;const de=new vt(0,0,0,0);return{setMask:function(Be){ie!==Be&&!W&&(n.colorMask(Be,Be,Be,Be),ie=Be)},setLocked:function(Be){W=Be},setClear:function(Be,Ae,je,yt,Tt){Tt===!0&&(Be*=yt,Ae*=yt,je*=yt),te.set(Be,Ae,je,yt),de.equals(te)===!1&&(n.clearColor(Be,Ae,je,yt),de.copy(te))},reset:function(){W=!1,ie=null,de.set(-1,0,0,0)}}}function i(){let W=!1,te=!1,ie=null,de=null,Be=null;return{setReversed:function(Ae){if(te!==Ae){const je=e.get("EXT_clip_control");Ae?je.clipControlEXT(je.LOWER_LEFT_EXT,je.ZERO_TO_ONE_EXT):je.clipControlEXT(je.LOWER_LEFT_EXT,je.NEGATIVE_ONE_TO_ONE_EXT),te=Ae;const yt=Be;Be=null,this.setClear(yt)}},getReversed:function(){return te},setTest:function(Ae){Ae?me(n.DEPTH_TEST):_e(n.DEPTH_TEST)},setMask:function(Ae){ie!==Ae&&!W&&(n.depthMask(Ae),ie=Ae)},setFunc:function(Ae){if(te&&(Ae=IS[Ae]),de!==Ae){switch(Ae){case wa:n.depthFunc(n.NEVER);break;case Ea:n.depthFunc(n.ALWAYS);break;case Ca:n.depthFunc(n.LESS);break;case Ri:n.depthFunc(n.LEQUAL);break;case Aa:n.depthFunc(n.EQUAL);break;case Sa:n.depthFunc(n.GEQUAL);break;case Ba:n.depthFunc(n.GREATER);break;case _a:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}de=Ae}},setLocked:function(Ae){W=Ae},setClear:function(Ae){Be!==Ae&&(te&&(Ae=1-Ae),n.clearDepth(Ae),Be=Ae)},reset:function(){W=!1,ie=null,de=null,Be=null,te=!1}}}function o(){let W=!1,te=null,ie=null,de=null,Be=null,Ae=null,je=null,yt=null,Tt=null;return{setTest:function(ut){W||(ut?me(n.STENCIL_TEST):_e(n.STENCIL_TEST))},setMask:function(ut){te!==ut&&!W&&(n.stencilMask(ut),te=ut)},setFunc:function(ut,zt,on){(ie!==ut||de!==zt||Be!==on)&&(n.stencilFunc(ut,zt,on),ie=ut,de=zt,Be=on)},setOp:function(ut,zt,on){(Ae!==ut||je!==zt||yt!==on)&&(n.stencilOp(ut,zt,on),Ae=ut,je=zt,yt=on)},setLocked:function(ut){W=ut},setClear:function(ut){Tt!==ut&&(n.clearStencil(ut),Tt=ut)},reset:function(){W=!1,te=null,ie=null,de=null,Be=null,Ae=null,je=null,yt=null,Tt=null}}}const r=new t,l=new i,h=new o,c=new WeakMap,d=new WeakMap;let u={},f={},m=new WeakMap,p=[],b=null,E=!1,g=null,x=null,T=null,C=null,y=null,F=null,_=null,B=new st(0,0,0),P=0,A=!1,S=null,R=null,U=null,z=null,J=null;const Y=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,ee=0;const $=n.getParameter(n.VERSION);$.indexOf("WebGL")!==-1?(ee=parseFloat(/^WebGL (\d)/.exec($)[1]),X=ee>=1):$.indexOf("OpenGL ES")!==-1&&(ee=parseFloat(/^OpenGL ES (\d)/.exec($)[1]),X=ee>=2);let he=null,fe={};const re=n.getParameter(n.SCISSOR_BOX),ve=n.getParameter(n.VIEWPORT),Ge=new vt().fromArray(re),Z=new vt().fromArray(ve);function ge(W,te,ie,de){const Be=new Uint8Array(4),Ae=n.createTexture();n.bindTexture(W,Ae),n.texParameteri(W,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(W,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let je=0;je<ie;je++)W===n.TEXTURE_3D||W===n.TEXTURE_2D_ARRAY?n.texImage3D(te,0,n.RGBA,1,1,de,0,n.RGBA,n.UNSIGNED_BYTE,Be):n.texImage2D(te+je,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Be);return Ae}const ce={};ce[n.TEXTURE_2D]=ge(n.TEXTURE_2D,n.TEXTURE_2D,1),ce[n.TEXTURE_CUBE_MAP]=ge(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),ce[n.TEXTURE_2D_ARRAY]=ge(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),ce[n.TEXTURE_3D]=ge(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),l.setClear(1),h.setClear(0),me(n.DEPTH_TEST),l.setFunc(Ri),Ye(!1),Ke(oh),me(n.CULL_FACE),O(Mn);function me(W){u[W]!==!0&&(n.enable(W),u[W]=!0)}function _e(W){u[W]!==!1&&(n.disable(W),u[W]=!1)}function we(W,te){return f[W]!==te?(n.bindFramebuffer(W,te),f[W]=te,W===n.DRAW_FRAMEBUFFER&&(f[n.FRAMEBUFFER]=te),W===n.FRAMEBUFFER&&(f[n.DRAW_FRAMEBUFFER]=te),!0):!1}function Ne(W,te){let ie=p,de=!1;if(W){ie=m.get(te),ie===void 0&&(ie=[],m.set(te,ie));const Be=W.textures;if(ie.length!==Be.length||ie[0]!==n.COLOR_ATTACHMENT0){for(let Ae=0,je=Be.length;Ae<je;Ae++)ie[Ae]=n.COLOR_ATTACHMENT0+Ae;ie.length=Be.length,de=!0}}else ie[0]!==n.BACK&&(ie[0]=n.BACK,de=!0);de&&n.drawBuffers(ie)}function rt(W){return b!==W?(n.useProgram(W),b=W,!0):!1}const lt={[oi]:n.FUNC_ADD,[kv]:n.FUNC_SUBTRACT,[Iv]:n.FUNC_REVERSE_SUBTRACT};lt[Rv]=n.MIN,lt[Nv]=n.MAX;const Xe={[Lv]:n.ZERO,[Hv]:n.ONE,[Gv]:n.SRC_COLOR,[ya]:n.SRC_ALPHA,[Jv]:n.SRC_ALPHA_SATURATE,[Vv]:n.DST_COLOR,[Ov]:n.DST_ALPHA,[Uv]:n.ONE_MINUS_SRC_COLOR,[va]:n.ONE_MINUS_SRC_ALPHA,[Wv]:n.ONE_MINUS_DST_COLOR,[zv]:n.ONE_MINUS_DST_ALPHA,[qv]:n.CONSTANT_COLOR,[Xv]:n.ONE_MINUS_CONSTANT_COLOR,[Kv]:n.CONSTANT_ALPHA,[Yv]:n.ONE_MINUS_CONSTANT_ALPHA};function O(W,te,ie,de,Be,Ae,je,yt,Tt,ut){if(W===Mn){E===!0&&(_e(n.BLEND),E=!1);return}if(E===!1&&(me(n.BLEND),E=!0),W!==Pv){if(W!==g||ut!==A){if((x!==oi||y!==oi)&&(n.blendEquation(n.FUNC_ADD),x=oi,y=oi),ut)switch(W){case ki:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case ba:n.blendFunc(n.ONE,n.ONE);break;case rh:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ah:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}else switch(W){case ki:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case ba:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case rh:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ah:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}T=null,C=null,F=null,_=null,B.set(0,0,0),P=0,g=W,A=ut}return}Be=Be||te,Ae=Ae||ie,je=je||de,(te!==x||Be!==y)&&(n.blendEquationSeparate(lt[te],lt[Be]),x=te,y=Be),(ie!==T||de!==C||Ae!==F||je!==_)&&(n.blendFuncSeparate(Xe[ie],Xe[de],Xe[Ae],Xe[je]),T=ie,C=de,F=Ae,_=je),(yt.equals(B)===!1||Tt!==P)&&(n.blendColor(yt.r,yt.g,yt.b,Tt),B.copy(yt),P=Tt),g=W,A=!1}function pt(W,te){W.side===Bn?_e(n.CULL_FACE):me(n.CULL_FACE);let ie=W.side===Gt;te&&(ie=!ie),Ye(ie),W.blending===ki&&W.transparent===!1?O(Mn):O(W.blending,W.blendEquation,W.blendSrc,W.blendDst,W.blendEquationAlpha,W.blendSrcAlpha,W.blendDstAlpha,W.blendColor,W.blendAlpha,W.premultipliedAlpha),l.setFunc(W.depthFunc),l.setTest(W.depthTest),l.setMask(W.depthWrite),r.setMask(W.colorWrite);const de=W.stencilWrite;h.setTest(de),de&&(h.setMask(W.stencilWriteMask),h.setFunc(W.stencilFunc,W.stencilRef,W.stencilFuncMask),h.setOp(W.stencilFail,W.stencilZFail,W.stencilZPass)),it(W.polygonOffset,W.polygonOffsetFactor,W.polygonOffsetUnits),W.alphaToCoverage===!0?me(n.SAMPLE_ALPHA_TO_COVERAGE):_e(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ye(W){S!==W&&(W?n.frontFace(n.CW):n.frontFace(n.CCW),S=W)}function Ke(W){W!==Fv?(me(n.CULL_FACE),W!==R&&(W===oh?n.cullFace(n.BACK):W===Dv?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):_e(n.CULL_FACE),R=W}function Ie(W){W!==U&&(X&&n.lineWidth(W),U=W)}function it(W,te,ie){W?(me(n.POLYGON_OFFSET_FILL),(z!==te||J!==ie)&&(n.polygonOffset(te,ie),z=te,J=ie)):_e(n.POLYGON_OFFSET_FILL)}function Ue(W){W?me(n.SCISSOR_TEST):_e(n.SCISSOR_TEST)}function N(W){W===void 0&&(W=n.TEXTURE0+Y-1),he!==W&&(n.activeTexture(W),he=W)}function D(W,te,ie){ie===void 0&&(he===null?ie=n.TEXTURE0+Y-1:ie=he);let de=fe[ie];de===void 0&&(de={type:void 0,texture:void 0},fe[ie]=de),(de.type!==W||de.texture!==te)&&(he!==ie&&(n.activeTexture(ie),he=ie),n.bindTexture(W,te||ce[W]),de.type=W,de.texture=te)}function j(){const W=fe[he];W!==void 0&&W.type!==void 0&&(n.bindTexture(W.type,null),W.type=void 0,W.texture=void 0)}function se(){try{n.compressedTexImage2D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function pe(){try{n.compressedTexImage3D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function oe(){try{n.texSubImage2D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function Le(){try{n.texSubImage3D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function Ce(){try{n.compressedTexSubImage2D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function ze(){try{n.compressedTexSubImage3D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function qe(){try{n.texStorage2D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function be(){try{n.texStorage3D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function Fe(){try{n.texImage2D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function Re(){try{n.texImage3D(...arguments)}catch(W){console.error("THREE.WebGLState:",W)}}function He(W){Ge.equals(W)===!1&&(n.scissor(W.x,W.y,W.z,W.w),Ge.copy(W))}function Te(W){Z.equals(W)===!1&&(n.viewport(W.x,W.y,W.z,W.w),Z.copy(W))}function Ze(W,te){let ie=d.get(te);ie===void 0&&(ie=new WeakMap,d.set(te,ie));let de=ie.get(W);de===void 0&&(de=n.getUniformBlockIndex(te,W.name),ie.set(W,de))}function Ve(W,te){const de=d.get(te).get(W);c.get(te)!==de&&(n.uniformBlockBinding(te,de,W.__bindingPointIndex),c.set(te,de))}function Qe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),l.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},he=null,fe={},f={},m=new WeakMap,p=[],b=null,E=!1,g=null,x=null,T=null,C=null,y=null,F=null,_=null,B=new st(0,0,0),P=0,A=!1,S=null,R=null,U=null,z=null,J=null,Ge.set(0,0,n.canvas.width,n.canvas.height),Z.set(0,0,n.canvas.width,n.canvas.height),r.reset(),l.reset(),h.reset()}return{buffers:{color:r,depth:l,stencil:h},enable:me,disable:_e,bindFramebuffer:we,drawBuffers:Ne,useProgram:rt,setBlending:O,setMaterial:pt,setFlipSided:Ye,setCullFace:Ke,setLineWidth:Ie,setPolygonOffset:it,setScissorTest:Ue,activeTexture:N,bindTexture:D,unbindTexture:j,compressedTexImage2D:se,compressedTexImage3D:pe,texImage2D:Fe,texImage3D:Re,updateUBOMapping:Ze,uniformBlockBinding:Ve,texStorage2D:qe,texStorage3D:be,texSubImage2D:oe,texSubImage3D:Le,compressedTexSubImage2D:Ce,compressedTexSubImage3D:ze,scissor:He,viewport:Te,reset:Qe}}function NS(n,e,t,i,o,r,l){const h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),d=new $e,u=new WeakMap;let f;const m=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(N,D){return p?new OffscreenCanvas(N,D):xr("canvas")}function E(N,D,j){let se=1;const pe=Ue(N);if((pe.width>j||pe.height>j)&&(se=j/Math.max(pe.width,pe.height)),se<1)if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap||typeof VideoFrame<"u"&&N instanceof VideoFrame){const oe=Math.floor(se*pe.width),Le=Math.floor(se*pe.height);f===void 0&&(f=b(oe,Le));const Ce=D?b(oe,Le):f;return Ce.width=oe,Ce.height=Le,Ce.getContext("2d").drawImage(N,0,0,oe,Le),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+pe.width+"x"+pe.height+") to ("+oe+"x"+Le+")."),Ce}else return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+pe.width+"x"+pe.height+")."),N;return N}function g(N){return N.generateMipmaps}function x(N){n.generateMipmap(N)}function T(N){return N.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:N.isWebGL3DRenderTarget?n.TEXTURE_3D:N.isWebGLArrayRenderTarget||N.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function C(N,D,j,se,pe=!1){if(N!==null){if(n[N]!==void 0)return n[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let oe=D;if(D===n.RED&&(j===n.FLOAT&&(oe=n.R32F),j===n.HALF_FLOAT&&(oe=n.R16F),j===n.UNSIGNED_BYTE&&(oe=n.R8)),D===n.RED_INTEGER&&(j===n.UNSIGNED_BYTE&&(oe=n.R8UI),j===n.UNSIGNED_SHORT&&(oe=n.R16UI),j===n.UNSIGNED_INT&&(oe=n.R32UI),j===n.BYTE&&(oe=n.R8I),j===n.SHORT&&(oe=n.R16I),j===n.INT&&(oe=n.R32I)),D===n.RG&&(j===n.FLOAT&&(oe=n.RG32F),j===n.HALF_FLOAT&&(oe=n.RG16F),j===n.UNSIGNED_BYTE&&(oe=n.RG8)),D===n.RG_INTEGER&&(j===n.UNSIGNED_BYTE&&(oe=n.RG8UI),j===n.UNSIGNED_SHORT&&(oe=n.RG16UI),j===n.UNSIGNED_INT&&(oe=n.RG32UI),j===n.BYTE&&(oe=n.RG8I),j===n.SHORT&&(oe=n.RG16I),j===n.INT&&(oe=n.RG32I)),D===n.RGB_INTEGER&&(j===n.UNSIGNED_BYTE&&(oe=n.RGB8UI),j===n.UNSIGNED_SHORT&&(oe=n.RGB16UI),j===n.UNSIGNED_INT&&(oe=n.RGB32UI),j===n.BYTE&&(oe=n.RGB8I),j===n.SHORT&&(oe=n.RGB16I),j===n.INT&&(oe=n.RGB32I)),D===n.RGBA_INTEGER&&(j===n.UNSIGNED_BYTE&&(oe=n.RGBA8UI),j===n.UNSIGNED_SHORT&&(oe=n.RGBA16UI),j===n.UNSIGNED_INT&&(oe=n.RGBA32UI),j===n.BYTE&&(oe=n.RGBA8I),j===n.SHORT&&(oe=n.RGBA16I),j===n.INT&&(oe=n.RGBA32I)),D===n.RGB&&j===n.UNSIGNED_INT_5_9_9_9_REV&&(oe=n.RGB9_E5),D===n.RGBA){const Le=pe?mr:ct.getTransfer(se);j===n.FLOAT&&(oe=n.RGBA32F),j===n.HALF_FLOAT&&(oe=n.RGBA16F),j===n.UNSIGNED_BYTE&&(oe=Le===mt?n.SRGB8_ALPHA8:n.RGBA8),j===n.UNSIGNED_SHORT_4_4_4_4&&(oe=n.RGBA4),j===n.UNSIGNED_SHORT_5_5_5_1&&(oe=n.RGB5_A1)}return(oe===n.R16F||oe===n.R32F||oe===n.RG16F||oe===n.RG32F||oe===n.RGBA16F||oe===n.RGBA32F)&&e.get("EXT_color_buffer_float"),oe}function y(N,D){let j;return N?D===null||D===si||D===fo?j=n.DEPTH24_STENCIL8:D===Qt?j=n.DEPTH32F_STENCIL8:D===uo&&(j=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):D===null||D===si||D===fo?j=n.DEPTH_COMPONENT24:D===Qt?j=n.DEPTH_COMPONENT32F:D===uo&&(j=n.DEPTH_COMPONENT16),j}function F(N,D){return g(N)===!0||N.isFramebufferTexture&&N.minFilter!==qt&&N.minFilter!==Lt?Math.log2(Math.max(D.width,D.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?D.mipmaps.length:1}function _(N){const D=N.target;D.removeEventListener("dispose",_),P(D),D.isVideoTexture&&u.delete(D)}function B(N){const D=N.target;D.removeEventListener("dispose",B),S(D)}function P(N){const D=i.get(N);if(D.__webglInit===void 0)return;const j=N.source,se=m.get(j);if(se){const pe=se[D.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&A(N),Object.keys(se).length===0&&m.delete(j)}i.remove(N)}function A(N){const D=i.get(N);n.deleteTexture(D.__webglTexture);const j=N.source,se=m.get(j);delete se[D.__cacheKey],l.memory.textures--}function S(N){const D=i.get(N);if(N.depthTexture&&(N.depthTexture.dispose(),i.remove(N.depthTexture)),N.isWebGLCubeRenderTarget)for(let se=0;se<6;se++){if(Array.isArray(D.__webglFramebuffer[se]))for(let pe=0;pe<D.__webglFramebuffer[se].length;pe++)n.deleteFramebuffer(D.__webglFramebuffer[se][pe]);else n.deleteFramebuffer(D.__webglFramebuffer[se]);D.__webglDepthbuffer&&n.deleteRenderbuffer(D.__webglDepthbuffer[se])}else{if(Array.isArray(D.__webglFramebuffer))for(let se=0;se<D.__webglFramebuffer.length;se++)n.deleteFramebuffer(D.__webglFramebuffer[se]);else n.deleteFramebuffer(D.__webglFramebuffer);if(D.__webglDepthbuffer&&n.deleteRenderbuffer(D.__webglDepthbuffer),D.__webglMultisampledFramebuffer&&n.deleteFramebuffer(D.__webglMultisampledFramebuffer),D.__webglColorRenderbuffer)for(let se=0;se<D.__webglColorRenderbuffer.length;se++)D.__webglColorRenderbuffer[se]&&n.deleteRenderbuffer(D.__webglColorRenderbuffer[se]);D.__webglDepthRenderbuffer&&n.deleteRenderbuffer(D.__webglDepthRenderbuffer)}const j=N.textures;for(let se=0,pe=j.length;se<pe;se++){const oe=i.get(j[se]);oe.__webglTexture&&(n.deleteTexture(oe.__webglTexture),l.memory.textures--),i.remove(j[se])}i.remove(N)}let R=0;function U(){R=0}function z(){const N=R;return N>=o.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+o.maxTextures),R+=1,N}function J(N){const D=[];return D.push(N.wrapS),D.push(N.wrapT),D.push(N.wrapR||0),D.push(N.magFilter),D.push(N.minFilter),D.push(N.anisotropy),D.push(N.internalFormat),D.push(N.format),D.push(N.type),D.push(N.generateMipmaps),D.push(N.premultiplyAlpha),D.push(N.flipY),D.push(N.unpackAlignment),D.push(N.colorSpace),D.join()}function Y(N,D){const j=i.get(N);if(N.isVideoTexture&&Ie(N),N.isRenderTargetTexture===!1&&N.version>0&&j.__version!==N.version){const se=N.image;if(se===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(se.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Z(j,N,D);return}}t.bindTexture(n.TEXTURE_2D,j.__webglTexture,n.TEXTURE0+D)}function X(N,D){const j=i.get(N);if(N.version>0&&j.__version!==N.version){Z(j,N,D);return}t.bindTexture(n.TEXTURE_2D_ARRAY,j.__webglTexture,n.TEXTURE0+D)}function ee(N,D){const j=i.get(N);if(N.version>0&&j.__version!==N.version){Z(j,N,D);return}t.bindTexture(n.TEXTURE_3D,j.__webglTexture,n.TEXTURE0+D)}function $(N,D){const j=i.get(N);if(N.version>0&&j.__version!==N.version){ge(j,N,D);return}t.bindTexture(n.TEXTURE_CUBE_MAP,j.__webglTexture,n.TEXTURE0+D)}const he={[Fa]:n.REPEAT,[Fn]:n.CLAMP_TO_EDGE,[Da]:n.MIRRORED_REPEAT},fe={[qt]:n.NEAREST,[rw]:n.NEAREST_MIPMAP_NEAREST,[Fo]:n.NEAREST_MIPMAP_LINEAR,[Lt]:n.LINEAR,[Dr]:n.LINEAR_MIPMAP_NEAREST,[Jn]:n.LINEAR_MIPMAP_LINEAR},re={[hw]:n.NEVER,[pw]:n.ALWAYS,[cw]:n.LESS,[Kc]:n.LEQUAL,[dw]:n.EQUAL,[mw]:n.GEQUAL,[uw]:n.GREATER,[fw]:n.NOTEQUAL};function ve(N,D){if(D.type===Qt&&e.has("OES_texture_float_linear")===!1&&(D.magFilter===Lt||D.magFilter===Dr||D.magFilter===Fo||D.magFilter===Jn||D.minFilter===Lt||D.minFilter===Dr||D.minFilter===Fo||D.minFilter===Jn)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(N,n.TEXTURE_WRAP_S,he[D.wrapS]),n.texParameteri(N,n.TEXTURE_WRAP_T,he[D.wrapT]),(N===n.TEXTURE_3D||N===n.TEXTURE_2D_ARRAY)&&n.texParameteri(N,n.TEXTURE_WRAP_R,he[D.wrapR]),n.texParameteri(N,n.TEXTURE_MAG_FILTER,fe[D.magFilter]),n.texParameteri(N,n.TEXTURE_MIN_FILTER,fe[D.minFilter]),D.compareFunction&&(n.texParameteri(N,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(N,n.TEXTURE_COMPARE_FUNC,re[D.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(D.magFilter===qt||D.minFilter!==Fo&&D.minFilter!==Jn||D.type===Qt&&e.has("OES_texture_float_linear")===!1)return;if(D.anisotropy>1||i.get(D).__currentAnisotropy){const j=e.get("EXT_texture_filter_anisotropic");n.texParameterf(N,j.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,o.getMaxAnisotropy())),i.get(D).__currentAnisotropy=D.anisotropy}}}function Ge(N,D){let j=!1;N.__webglInit===void 0&&(N.__webglInit=!0,D.addEventListener("dispose",_));const se=D.source;let pe=m.get(se);pe===void 0&&(pe={},m.set(se,pe));const oe=J(D);if(oe!==N.__cacheKey){pe[oe]===void 0&&(pe[oe]={texture:n.createTexture(),usedTimes:0},l.memory.textures++,j=!0),pe[oe].usedTimes++;const Le=pe[N.__cacheKey];Le!==void 0&&(pe[N.__cacheKey].usedTimes--,Le.usedTimes===0&&A(D)),N.__cacheKey=oe,N.__webglTexture=pe[oe].texture}return j}function Z(N,D,j){let se=n.TEXTURE_2D;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(se=n.TEXTURE_2D_ARRAY),D.isData3DTexture&&(se=n.TEXTURE_3D);const pe=Ge(N,D),oe=D.source;t.bindTexture(se,N.__webglTexture,n.TEXTURE0+j);const Le=i.get(oe);if(oe.version!==Le.__version||pe===!0){t.activeTexture(n.TEXTURE0+j);const Ce=ct.getPrimaries(ct.workingColorSpace),ze=D.colorSpace===_n?null:ct.getPrimaries(D.colorSpace),qe=D.colorSpace===_n||Ce===ze?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,qe);let be=E(D.image,!1,o.maxTextureSize);be=it(D,be);const Fe=r.convert(D.format,D.colorSpace),Re=r.convert(D.type);let He=C(D.internalFormat,Fe,Re,D.colorSpace,D.isVideoTexture);ve(se,D);let Te;const Ze=D.mipmaps,Ve=D.isVideoTexture!==!0,Qe=Le.__version===void 0||pe===!0,W=oe.dataReady,te=F(D,be);if(D.isDepthTexture)He=y(D.format===po,D.type),Qe&&(Ve?t.texStorage2D(n.TEXTURE_2D,1,He,be.width,be.height):t.texImage2D(n.TEXTURE_2D,0,He,be.width,be.height,0,Fe,Re,null));else if(D.isDataTexture)if(Ze.length>0){Ve&&Qe&&t.texStorage2D(n.TEXTURE_2D,te,He,Ze[0].width,Ze[0].height);for(let ie=0,de=Ze.length;ie<de;ie++)Te=Ze[ie],Ve?W&&t.texSubImage2D(n.TEXTURE_2D,ie,0,0,Te.width,Te.height,Fe,Re,Te.data):t.texImage2D(n.TEXTURE_2D,ie,He,Te.width,Te.height,0,Fe,Re,Te.data);D.generateMipmaps=!1}else Ve?(Qe&&t.texStorage2D(n.TEXTURE_2D,te,He,be.width,be.height),W&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,be.width,be.height,Fe,Re,be.data)):t.texImage2D(n.TEXTURE_2D,0,He,be.width,be.height,0,Fe,Re,be.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){Ve&&Qe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,te,He,Ze[0].width,Ze[0].height,be.depth);for(let ie=0,de=Ze.length;ie<de;ie++)if(Te=Ze[ie],D.format!==jt)if(Fe!==null)if(Ve){if(W)if(D.layerUpdates.size>0){const Be=Fh(Te.width,Te.height,D.format,D.type);for(const Ae of D.layerUpdates){const je=Te.data.subarray(Ae*Be/Te.data.BYTES_PER_ELEMENT,(Ae+1)*Be/Te.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ie,0,0,Ae,Te.width,Te.height,1,Fe,je)}D.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ie,0,0,0,Te.width,Te.height,be.depth,Fe,Te.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ie,He,Te.width,Te.height,be.depth,0,Te.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Ve?W&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,ie,0,0,0,Te.width,Te.height,be.depth,Fe,Re,Te.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ie,He,Te.width,Te.height,be.depth,0,Fe,Re,Te.data)}else{Ve&&Qe&&t.texStorage2D(n.TEXTURE_2D,te,He,Ze[0].width,Ze[0].height);for(let ie=0,de=Ze.length;ie<de;ie++)Te=Ze[ie],D.format!==jt?Fe!==null?Ve?W&&t.compressedTexSubImage2D(n.TEXTURE_2D,ie,0,0,Te.width,Te.height,Fe,Te.data):t.compressedTexImage2D(n.TEXTURE_2D,ie,He,Te.width,Te.height,0,Te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ve?W&&t.texSubImage2D(n.TEXTURE_2D,ie,0,0,Te.width,Te.height,Fe,Re,Te.data):t.texImage2D(n.TEXTURE_2D,ie,He,Te.width,Te.height,0,Fe,Re,Te.data)}else if(D.isDataArrayTexture)if(Ve){if(Qe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,te,He,be.width,be.height,be.depth),W)if(D.layerUpdates.size>0){const ie=Fh(be.width,be.height,D.format,D.type);for(const de of D.layerUpdates){const Be=be.data.subarray(de*ie/be.data.BYTES_PER_ELEMENT,(de+1)*ie/be.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,de,be.width,be.height,1,Fe,Re,Be)}D.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,be.width,be.height,be.depth,Fe,Re,be.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,He,be.width,be.height,be.depth,0,Fe,Re,be.data);else if(D.isData3DTexture)Ve?(Qe&&t.texStorage3D(n.TEXTURE_3D,te,He,be.width,be.height,be.depth),W&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,be.width,be.height,be.depth,Fe,Re,be.data)):t.texImage3D(n.TEXTURE_3D,0,He,be.width,be.height,be.depth,0,Fe,Re,be.data);else if(D.isFramebufferTexture){if(Qe)if(Ve)t.texStorage2D(n.TEXTURE_2D,te,He,be.width,be.height);else{let ie=be.width,de=be.height;for(let Be=0;Be<te;Be++)t.texImage2D(n.TEXTURE_2D,Be,He,ie,de,0,Fe,Re,null),ie>>=1,de>>=1}}else if(Ze.length>0){if(Ve&&Qe){const ie=Ue(Ze[0]);t.texStorage2D(n.TEXTURE_2D,te,He,ie.width,ie.height)}for(let ie=0,de=Ze.length;ie<de;ie++)Te=Ze[ie],Ve?W&&t.texSubImage2D(n.TEXTURE_2D,ie,0,0,Fe,Re,Te):t.texImage2D(n.TEXTURE_2D,ie,He,Fe,Re,Te);D.generateMipmaps=!1}else if(Ve){if(Qe){const ie=Ue(be);t.texStorage2D(n.TEXTURE_2D,te,He,ie.width,ie.height)}W&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Fe,Re,be)}else t.texImage2D(n.TEXTURE_2D,0,He,Fe,Re,be);g(D)&&x(se),Le.__version=oe.version,D.onUpdate&&D.onUpdate(D)}N.__version=D.version}function ge(N,D,j){if(D.image.length!==6)return;const se=Ge(N,D),pe=D.source;t.bindTexture(n.TEXTURE_CUBE_MAP,N.__webglTexture,n.TEXTURE0+j);const oe=i.get(pe);if(pe.version!==oe.__version||se===!0){t.activeTexture(n.TEXTURE0+j);const Le=ct.getPrimaries(ct.workingColorSpace),Ce=D.colorSpace===_n?null:ct.getPrimaries(D.colorSpace),ze=D.colorSpace===_n||Le===Ce?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,D.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,D.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ze);const qe=D.isCompressedTexture||D.image[0].isCompressedTexture,be=D.image[0]&&D.image[0].isDataTexture,Fe=[];for(let de=0;de<6;de++)!qe&&!be?Fe[de]=E(D.image[de],!0,o.maxCubemapSize):Fe[de]=be?D.image[de].image:D.image[de],Fe[de]=it(D,Fe[de]);const Re=Fe[0],He=r.convert(D.format,D.colorSpace),Te=r.convert(D.type),Ze=C(D.internalFormat,He,Te,D.colorSpace),Ve=D.isVideoTexture!==!0,Qe=oe.__version===void 0||se===!0,W=pe.dataReady;let te=F(D,Re);ve(n.TEXTURE_CUBE_MAP,D);let ie;if(qe){Ve&&Qe&&t.texStorage2D(n.TEXTURE_CUBE_MAP,te,Ze,Re.width,Re.height);for(let de=0;de<6;de++){ie=Fe[de].mipmaps;for(let Be=0;Be<ie.length;Be++){const Ae=ie[Be];D.format!==jt?He!==null?Ve?W&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be,0,0,Ae.width,Ae.height,He,Ae.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be,Ze,Ae.width,Ae.height,0,Ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ve?W&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be,0,0,Ae.width,Ae.height,He,Te,Ae.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be,Ze,Ae.width,Ae.height,0,He,Te,Ae.data)}}}else{if(ie=D.mipmaps,Ve&&Qe){ie.length>0&&te++;const de=Ue(Fe[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,te,Ze,de.width,de.height)}for(let de=0;de<6;de++)if(be){Ve?W&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,0,0,Fe[de].width,Fe[de].height,He,Te,Fe[de].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,Ze,Fe[de].width,Fe[de].height,0,He,Te,Fe[de].data);for(let Be=0;Be<ie.length;Be++){const je=ie[Be].image[de].image;Ve?W&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be+1,0,0,je.width,je.height,He,Te,je.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be+1,Ze,je.width,je.height,0,He,Te,je.data)}}else{Ve?W&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,0,0,He,Te,Fe[de]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,Ze,He,Te,Fe[de]);for(let Be=0;Be<ie.length;Be++){const Ae=ie[Be];Ve?W&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be+1,0,0,He,Te,Ae.image[de]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+de,Be+1,Ze,He,Te,Ae.image[de])}}}g(D)&&x(n.TEXTURE_CUBE_MAP),oe.__version=pe.version,D.onUpdate&&D.onUpdate(D)}N.__version=D.version}function ce(N,D,j,se,pe,oe){const Le=r.convert(j.format,j.colorSpace),Ce=r.convert(j.type),ze=C(j.internalFormat,Le,Ce,j.colorSpace),qe=i.get(D),be=i.get(j);if(be.__renderTarget=D,!qe.__hasExternalTextures){const Fe=Math.max(1,D.width>>oe),Re=Math.max(1,D.height>>oe);pe===n.TEXTURE_3D||pe===n.TEXTURE_2D_ARRAY?t.texImage3D(pe,oe,ze,Fe,Re,D.depth,0,Le,Ce,null):t.texImage2D(pe,oe,ze,Fe,Re,0,Le,Ce,null)}t.bindFramebuffer(n.FRAMEBUFFER,N),Ke(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,se,pe,be.__webglTexture,0,Ye(D)):(pe===n.TEXTURE_2D||pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,se,pe,be.__webglTexture,oe),t.bindFramebuffer(n.FRAMEBUFFER,null)}function me(N,D,j){if(n.bindRenderbuffer(n.RENDERBUFFER,N),D.depthBuffer){const se=D.depthTexture,pe=se&&se.isDepthTexture?se.type:null,oe=y(D.stencilBuffer,pe),Le=D.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ce=Ye(D);Ke(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ce,oe,D.width,D.height):j?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ce,oe,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,oe,D.width,D.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Le,n.RENDERBUFFER,N)}else{const se=D.textures;for(let pe=0;pe<se.length;pe++){const oe=se[pe],Le=r.convert(oe.format,oe.colorSpace),Ce=r.convert(oe.type),ze=C(oe.internalFormat,Le,Ce,oe.colorSpace),qe=Ye(D);j&&Ke(D)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,qe,ze,D.width,D.height):Ke(D)?h.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,qe,ze,D.width,D.height):n.renderbufferStorage(n.RENDERBUFFER,ze,D.width,D.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function _e(N,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,N),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const se=i.get(D.depthTexture);se.__renderTarget=D,(!se.__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),Y(D.depthTexture,0);const pe=se.__webglTexture,oe=Ye(D);if(D.depthTexture.format===mo)Ke(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,pe,0,oe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,pe,0);else if(D.depthTexture.format===po)Ke(D)?h.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,pe,0,oe):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,pe,0);else throw new Error("Unknown depthTexture format")}function we(N){const D=i.get(N),j=N.isWebGLCubeRenderTarget===!0;if(D.__boundDepthTexture!==N.depthTexture){const se=N.depthTexture;if(D.__depthDisposeCallback&&D.__depthDisposeCallback(),se){const pe=()=>{delete D.__boundDepthTexture,delete D.__depthDisposeCallback,se.removeEventListener("dispose",pe)};se.addEventListener("dispose",pe),D.__depthDisposeCallback=pe}D.__boundDepthTexture=se}if(N.depthTexture&&!D.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");const se=N.texture.mipmaps;se&&se.length>0?_e(D.__webglFramebuffer[0],N):_e(D.__webglFramebuffer,N)}else if(j){D.__webglDepthbuffer=[];for(let se=0;se<6;se++)if(t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer[se]),D.__webglDepthbuffer[se]===void 0)D.__webglDepthbuffer[se]=n.createRenderbuffer(),me(D.__webglDepthbuffer[se],N,!1);else{const pe=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,oe=D.__webglDepthbuffer[se];n.bindRenderbuffer(n.RENDERBUFFER,oe),n.framebufferRenderbuffer(n.FRAMEBUFFER,pe,n.RENDERBUFFER,oe)}}else{const se=N.texture.mipmaps;if(se&&se.length>0?t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer===void 0)D.__webglDepthbuffer=n.createRenderbuffer(),me(D.__webglDepthbuffer,N,!1);else{const pe=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,oe=D.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,oe),n.framebufferRenderbuffer(n.FRAMEBUFFER,pe,n.RENDERBUFFER,oe)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ne(N,D,j){const se=i.get(N);D!==void 0&&ce(se.__webglFramebuffer,N,N.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),j!==void 0&&we(N)}function rt(N){const D=N.texture,j=i.get(N),se=i.get(D);N.addEventListener("dispose",B);const pe=N.textures,oe=N.isWebGLCubeRenderTarget===!0,Le=pe.length>1;if(Le||(se.__webglTexture===void 0&&(se.__webglTexture=n.createTexture()),se.__version=D.version,l.memory.textures++),oe){j.__webglFramebuffer=[];for(let Ce=0;Ce<6;Ce++)if(D.mipmaps&&D.mipmaps.length>0){j.__webglFramebuffer[Ce]=[];for(let ze=0;ze<D.mipmaps.length;ze++)j.__webglFramebuffer[Ce][ze]=n.createFramebuffer()}else j.__webglFramebuffer[Ce]=n.createFramebuffer()}else{if(D.mipmaps&&D.mipmaps.length>0){j.__webglFramebuffer=[];for(let Ce=0;Ce<D.mipmaps.length;Ce++)j.__webglFramebuffer[Ce]=n.createFramebuffer()}else j.__webglFramebuffer=n.createFramebuffer();if(Le)for(let Ce=0,ze=pe.length;Ce<ze;Ce++){const qe=i.get(pe[Ce]);qe.__webglTexture===void 0&&(qe.__webglTexture=n.createTexture(),l.memory.textures++)}if(N.samples>0&&Ke(N)===!1){j.__webglMultisampledFramebuffer=n.createFramebuffer(),j.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,j.__webglMultisampledFramebuffer);for(let Ce=0;Ce<pe.length;Ce++){const ze=pe[Ce];j.__webglColorRenderbuffer[Ce]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,j.__webglColorRenderbuffer[Ce]);const qe=r.convert(ze.format,ze.colorSpace),be=r.convert(ze.type),Fe=C(ze.internalFormat,qe,be,ze.colorSpace,N.isXRRenderTarget===!0),Re=Ye(N);n.renderbufferStorageMultisample(n.RENDERBUFFER,Re,Fe,N.width,N.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ce,n.RENDERBUFFER,j.__webglColorRenderbuffer[Ce])}n.bindRenderbuffer(n.RENDERBUFFER,null),N.depthBuffer&&(j.__webglDepthRenderbuffer=n.createRenderbuffer(),me(j.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(oe){t.bindTexture(n.TEXTURE_CUBE_MAP,se.__webglTexture),ve(n.TEXTURE_CUBE_MAP,D);for(let Ce=0;Ce<6;Ce++)if(D.mipmaps&&D.mipmaps.length>0)for(let ze=0;ze<D.mipmaps.length;ze++)ce(j.__webglFramebuffer[Ce][ze],N,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,ze);else ce(j.__webglFramebuffer[Ce],N,D,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ce,0);g(D)&&x(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Le){for(let Ce=0,ze=pe.length;Ce<ze;Ce++){const qe=pe[Ce],be=i.get(qe);t.bindTexture(n.TEXTURE_2D,be.__webglTexture),ve(n.TEXTURE_2D,qe),ce(j.__webglFramebuffer,N,qe,n.COLOR_ATTACHMENT0+Ce,n.TEXTURE_2D,0),g(qe)&&x(n.TEXTURE_2D)}t.unbindTexture()}else{let Ce=n.TEXTURE_2D;if((N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(Ce=N.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ce,se.__webglTexture),ve(Ce,D),D.mipmaps&&D.mipmaps.length>0)for(let ze=0;ze<D.mipmaps.length;ze++)ce(j.__webglFramebuffer[ze],N,D,n.COLOR_ATTACHMENT0,Ce,ze);else ce(j.__webglFramebuffer,N,D,n.COLOR_ATTACHMENT0,Ce,0);g(D)&&x(Ce),t.unbindTexture()}N.depthBuffer&&we(N)}function lt(N){const D=N.textures;for(let j=0,se=D.length;j<se;j++){const pe=D[j];if(g(pe)){const oe=T(N),Le=i.get(pe).__webglTexture;t.bindTexture(oe,Le),x(oe),t.unbindTexture()}}}const Xe=[],O=[];function pt(N){if(N.samples>0){if(Ke(N)===!1){const D=N.textures,j=N.width,se=N.height;let pe=n.COLOR_BUFFER_BIT;const oe=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Le=i.get(N),Ce=D.length>1;if(Ce)for(let qe=0;qe<D.length;qe++)t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+qe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+qe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Le.__webglMultisampledFramebuffer);const ze=N.texture.mipmaps;ze&&ze.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglFramebuffer);for(let qe=0;qe<D.length;qe++){if(N.resolveDepthBuffer&&(N.depthBuffer&&(pe|=n.DEPTH_BUFFER_BIT),N.stencilBuffer&&N.resolveStencilBuffer&&(pe|=n.STENCIL_BUFFER_BIT)),Ce){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Le.__webglColorRenderbuffer[qe]);const be=i.get(D[qe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,be,0)}n.blitFramebuffer(0,0,j,se,0,0,j,se,pe,n.NEAREST),c===!0&&(Xe.length=0,O.length=0,Xe.push(n.COLOR_ATTACHMENT0+qe),N.depthBuffer&&N.resolveDepthBuffer===!1&&(Xe.push(oe),O.push(oe),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,O)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Xe))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ce)for(let qe=0;qe<D.length;qe++){t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+qe,n.RENDERBUFFER,Le.__webglColorRenderbuffer[qe]);const be=i.get(D[qe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Le.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+qe,n.TEXTURE_2D,be,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Le.__webglMultisampledFramebuffer)}else if(N.depthBuffer&&N.resolveDepthBuffer===!1&&c){const D=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[D])}}}function Ye(N){return Math.min(o.maxSamples,N.samples)}function Ke(N){const D=i.get(N);return N.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function Ie(N){const D=l.render.frame;u.get(N)!==D&&(u.set(N,D),N.update())}function it(N,D){const j=N.colorSpace,se=N.format,pe=N.type;return N.isCompressedTexture===!0||N.isVideoTexture===!0||j!==Kn&&j!==_n&&(ct.getTransfer(j)===mt?(se!==jt||pe!==kn)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",j)),D}function Ue(N){return typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement?(d.width=N.naturalWidth||N.width,d.height=N.naturalHeight||N.height):typeof VideoFrame<"u"&&N instanceof VideoFrame?(d.width=N.displayWidth,d.height=N.displayHeight):(d.width=N.width,d.height=N.height),d}this.allocateTextureUnit=z,this.resetTextureUnits=U,this.setTexture2D=Y,this.setTexture2DArray=X,this.setTexture3D=ee,this.setTextureCube=$,this.rebindTextures=Ne,this.setupRenderTarget=rt,this.updateRenderTargetMipmap=lt,this.updateMultisampleRenderTarget=pt,this.setupDepthRenderbuffer=we,this.setupFrameBufferTexture=ce,this.useMultisampledRTT=Ke}function LS(n,e){function t(i,o=_n){let r;const l=ct.getTransfer(o);if(i===kn)return n.UNSIGNED_BYTE;if(i===Es)return n.UNSIGNED_SHORT_4_4_4_4;if(i===Cs)return n.UNSIGNED_SHORT_5_5_5_1;if(i===zc)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===Uc)return n.BYTE;if(i===Oc)return n.SHORT;if(i===uo)return n.UNSIGNED_SHORT;if(i===ws)return n.INT;if(i===si)return n.UNSIGNED_INT;if(i===Qt)return n.FLOAT;if(i===Jt)return n.HALF_FLOAT;if(i===Vc)return n.ALPHA;if(i===Wc)return n.RGB;if(i===jt)return n.RGBA;if(i===mo)return n.DEPTH_COMPONENT;if(i===po)return n.DEPTH_STENCIL;if(i===As)return n.RED;if(i===Ss)return n.RED_INTEGER;if(i===Jc)return n.RG;if(i===Bs)return n.RG_INTEGER;if(i===_s)return n.RGBA_INTEGER;if(i===tr||i===nr||i===ir||i===or)if(l===mt)if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===tr)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===nr)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===ir)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===or)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=e.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===tr)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===nr)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===ir)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===or)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Ma||i===Pa||i===ka||i===Ia)if(r=e.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===Ma)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Pa)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===ka)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Ia)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Ra||i===Na||i===La)if(r=e.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Ra||i===Na)return l===mt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===La)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Ha||i===Ga||i===Ua||i===Oa||i===za||i===Va||i===Wa||i===Ja||i===qa||i===Xa||i===Ka||i===Ya||i===$a||i===Za)if(r=e.get("WEBGL_compressed_texture_astc"),r!==null){if(i===Ha)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Ga)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Ua)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Oa)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===za)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Va)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Wa)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Ja)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===qa)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Xa)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Ka)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Ya)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===$a)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Za)return l===mt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===rr||i===Qa||i===ja)if(r=e.get("EXT_texture_compression_bptc"),r!==null){if(i===rr)return l===mt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Qa)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===ja)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===qc||i===es||i===ts||i===ns)if(r=e.get("EXT_texture_compression_rgtc"),r!==null){if(i===rr)return r.COMPRESSED_RED_RGTC1_EXT;if(i===es)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===ts)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===ns)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===fo?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const HS=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,GS=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class US{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const o=new Ut,r=e.properties.get(o);r.__webglTexture=t.texture,(t.depthNear!==i.depthNear||t.depthFar!==i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=o}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Ht({vertexShader:HS,fragmentShader:GS,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new en(new Cr(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class OS extends Wi{constructor(e,t){super();const i=this;let o=null,r=1,l=null,h="local-floor",c=1,d=null,u=null,f=null,m=null,p=null,b=null;const E=new US,g=t.getContextAttributes();let x=null,T=null;const C=[],y=[],F=new $e;let _=null;const B=new $t;B.viewport=new vt;const P=new $t;P.viewport=new vt;const A=[B,P],S=new s1;let R=null,U=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Z){let ge=C[Z];return ge===void 0&&(ge=new Qr,C[Z]=ge),ge.getTargetRaySpace()},this.getControllerGrip=function(Z){let ge=C[Z];return ge===void 0&&(ge=new Qr,C[Z]=ge),ge.getGripSpace()},this.getHand=function(Z){let ge=C[Z];return ge===void 0&&(ge=new Qr,C[Z]=ge),ge.getHandSpace()};function z(Z){const ge=y.indexOf(Z.inputSource);if(ge===-1)return;const ce=C[ge];ce!==void 0&&(ce.update(Z.inputSource,Z.frame,d||l),ce.dispatchEvent({type:Z.type,data:Z.inputSource}))}function J(){o.removeEventListener("select",z),o.removeEventListener("selectstart",z),o.removeEventListener("selectend",z),o.removeEventListener("squeeze",z),o.removeEventListener("squeezestart",z),o.removeEventListener("squeezeend",z),o.removeEventListener("end",J),o.removeEventListener("inputsourceschange",Y);for(let Z=0;Z<C.length;Z++){const ge=y[Z];ge!==null&&(y[Z]=null,C[Z].disconnect(ge))}R=null,U=null,E.reset(),e.setRenderTarget(x),p=null,m=null,f=null,o=null,T=null,Ge.stop(),i.isPresenting=!1,e.setPixelRatio(_),e.setSize(F.width,F.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Z){r=Z,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Z){h=Z,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||l},this.setReferenceSpace=function(Z){d=Z},this.getBaseLayer=function(){return m!==null?m:p},this.getBinding=function(){return f},this.getFrame=function(){return b},this.getSession=function(){return o},this.setSession=async function(Z){if(o=Z,o!==null){if(x=e.getRenderTarget(),o.addEventListener("select",z),o.addEventListener("selectstart",z),o.addEventListener("selectend",z),o.addEventListener("squeeze",z),o.addEventListener("squeezestart",z),o.addEventListener("squeezeend",z),o.addEventListener("end",J),o.addEventListener("inputsourceschange",Y),g.xrCompatible!==!0&&await t.makeXRCompatible(),_=e.getPixelRatio(),e.getSize(F),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let ce=null,me=null,_e=null;g.depth&&(_e=g.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ce=g.stencil?po:mo,me=g.stencil?fo:si);const we={colorFormat:t.RGBA8,depthFormat:_e,scaleFactor:r};f=new XRWebGLBinding(o,t),m=f.createProjectionLayer(we),o.updateRenderState({layers:[m]}),e.setPixelRatio(1),e.setSize(m.textureWidth,m.textureHeight,!1),T=new dn(m.textureWidth,m.textureHeight,{format:jt,type:kn,depthTexture:new rd(m.textureWidth,m.textureHeight,me,void 0,void 0,void 0,void 0,void 0,void 0,ce),stencilBuffer:g.stencil,colorSpace:e.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}else{const ce={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};p=new XRWebGLLayer(o,t,ce),o.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),T=new dn(p.framebufferWidth,p.framebufferHeight,{format:jt,type:kn,colorSpace:e.outputColorSpace,stencilBuffer:g.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}T.isXRRenderTarget=!0,this.setFoveation(c),d=null,l=await o.requestReferenceSpace(h),Ge.setContext(o),Ge.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(o!==null)return o.environmentBlendMode},this.getDepthTexture=function(){return E.getDepthTexture()};function Y(Z){for(let ge=0;ge<Z.removed.length;ge++){const ce=Z.removed[ge],me=y.indexOf(ce);me>=0&&(y[me]=null,C[me].disconnect(ce))}for(let ge=0;ge<Z.added.length;ge++){const ce=Z.added[ge];let me=y.indexOf(ce);if(me===-1){for(let we=0;we<C.length;we++)if(we>=y.length){y.push(ce),me=we;break}else if(y[we]===null){y[we]=ce,me=we;break}if(me===-1)break}const _e=C[me];_e&&_e.connect(ce)}}const X=new Q,ee=new Q;function $(Z,ge,ce){X.setFromMatrixPosition(ge.matrixWorld),ee.setFromMatrixPosition(ce.matrixWorld);const me=X.distanceTo(ee),_e=ge.projectionMatrix.elements,we=ce.projectionMatrix.elements,Ne=_e[14]/(_e[10]-1),rt=_e[14]/(_e[10]+1),lt=(_e[9]+1)/_e[5],Xe=(_e[9]-1)/_e[5],O=(_e[8]-1)/_e[0],pt=(we[8]+1)/we[0],Ye=Ne*O,Ke=Ne*pt,Ie=me/(-O+pt),it=Ie*-O;if(ge.matrixWorld.decompose(Z.position,Z.quaternion,Z.scale),Z.translateX(it),Z.translateZ(Ie),Z.matrixWorld.compose(Z.position,Z.quaternion,Z.scale),Z.matrixWorldInverse.copy(Z.matrixWorld).invert(),_e[10]===-1)Z.projectionMatrix.copy(ge.projectionMatrix),Z.projectionMatrixInverse.copy(ge.projectionMatrixInverse);else{const Ue=Ne+Ie,N=rt+Ie,D=Ye-it,j=Ke+(me-it),se=lt*rt/N*Ue,pe=Xe*rt/N*Ue;Z.projectionMatrix.makePerspective(D,j,se,pe,Ue,N),Z.projectionMatrixInverse.copy(Z.projectionMatrix).invert()}}function he(Z,ge){ge===null?Z.matrixWorld.copy(Z.matrix):Z.matrixWorld.multiplyMatrices(ge.matrixWorld,Z.matrix),Z.matrixWorldInverse.copy(Z.matrixWorld).invert()}this.updateCamera=function(Z){if(o===null)return;let ge=Z.near,ce=Z.far;E.texture!==null&&(E.depthNear>0&&(ge=E.depthNear),E.depthFar>0&&(ce=E.depthFar)),S.near=P.near=B.near=ge,S.far=P.far=B.far=ce,(R!==S.near||U!==S.far)&&(o.updateRenderState({depthNear:S.near,depthFar:S.far}),R=S.near,U=S.far),B.layers.mask=Z.layers.mask|2,P.layers.mask=Z.layers.mask|4,S.layers.mask=B.layers.mask|P.layers.mask;const me=Z.parent,_e=S.cameras;he(S,me);for(let we=0;we<_e.length;we++)he(_e[we],me);_e.length===2?$(S,B,P):S.projectionMatrix.copy(B.projectionMatrix),fe(Z,S,me)};function fe(Z,ge,ce){ce===null?Z.matrix.copy(ge.matrixWorld):(Z.matrix.copy(ce.matrixWorld),Z.matrix.invert(),Z.matrix.multiply(ge.matrixWorld)),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale),Z.updateMatrixWorld(!0),Z.projectionMatrix.copy(ge.projectionMatrix),Z.projectionMatrixInverse.copy(ge.projectionMatrixInverse),Z.isPerspectiveCamera&&(Z.fov=os*2*Math.atan(1/Z.projectionMatrix.elements[5]),Z.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(m===null&&p===null))return c},this.setFoveation=function(Z){c=Z,m!==null&&(m.fixedFoveation=Z),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=Z)},this.hasDepthSensing=function(){return E.texture!==null},this.getDepthSensingMesh=function(){return E.getMesh(S)};let re=null;function ve(Z,ge){if(u=ge.getViewerPose(d||l),b=ge,u!==null){const ce=u.views;p!==null&&(e.setRenderTargetFramebuffer(T,p.framebuffer),e.setRenderTarget(T));let me=!1;ce.length!==S.cameras.length&&(S.cameras.length=0,me=!0);for(let Ne=0;Ne<ce.length;Ne++){const rt=ce[Ne];let lt=null;if(p!==null)lt=p.getViewport(rt);else{const O=f.getViewSubImage(m,rt);lt=O.viewport,Ne===0&&(e.setRenderTargetTextures(T,O.colorTexture,O.depthStencilTexture),e.setRenderTarget(T))}let Xe=A[Ne];Xe===void 0&&(Xe=new $t,Xe.layers.enable(Ne),Xe.viewport=new vt,A[Ne]=Xe),Xe.matrix.fromArray(rt.transform.matrix),Xe.matrix.decompose(Xe.position,Xe.quaternion,Xe.scale),Xe.projectionMatrix.fromArray(rt.projectionMatrix),Xe.projectionMatrixInverse.copy(Xe.projectionMatrix).invert(),Xe.viewport.set(lt.x,lt.y,lt.width,lt.height),Ne===0&&(S.matrix.copy(Xe.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),me===!0&&S.cameras.push(Xe)}const _e=o.enabledFeatures;if(_e&&_e.includes("depth-sensing")&&o.depthUsage=="gpu-optimized"&&f){const Ne=f.getDepthInformation(ce[0]);Ne&&Ne.isValid&&Ne.texture&&E.init(e,Ne,o.renderState)}}for(let ce=0;ce<C.length;ce++){const me=y[ce],_e=C[ce];me!==null&&_e!==void 0&&_e.update(me,ge,d||l)}re&&re(Z,ge),ge.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:ge}),b=null}const Ge=new sd;Ge.setAnimationLoop(ve),this.setAnimationLoop=function(Z){re=Z},this.dispose=function(){}}}const ti=new un,zS=new Ct;function VS(n,e){function t(g,x){g.matrixAutoUpdate===!0&&g.updateMatrix(),x.value.copy(g.matrix)}function i(g,x){x.color.getRGB(g.fogColor.value,td(n)),x.isFog?(g.fogNear.value=x.near,g.fogFar.value=x.far):x.isFogExp2&&(g.fogDensity.value=x.density)}function o(g,x,T,C,y){x.isMeshBasicMaterial||x.isMeshLambertMaterial?r(g,x):x.isMeshToonMaterial?(r(g,x),f(g,x)):x.isMeshPhongMaterial?(r(g,x),u(g,x)):x.isMeshStandardMaterial?(r(g,x),m(g,x),x.isMeshPhysicalMaterial&&p(g,x,y)):x.isMeshMatcapMaterial?(r(g,x),b(g,x)):x.isMeshDepthMaterial?r(g,x):x.isMeshDistanceMaterial?(r(g,x),E(g,x)):x.isMeshNormalMaterial?r(g,x):x.isLineBasicMaterial?(l(g,x),x.isLineDashedMaterial&&h(g,x)):x.isPointsMaterial?c(g,x,T,C):x.isSpriteMaterial?d(g,x):x.isShadowMaterial?(g.color.value.copy(x.color),g.opacity.value=x.opacity):x.isShaderMaterial&&(x.uniformsNeedUpdate=!1)}function r(g,x){g.opacity.value=x.opacity,x.color&&g.diffuse.value.copy(x.color),x.emissive&&g.emissive.value.copy(x.emissive).multiplyScalar(x.emissiveIntensity),x.map&&(g.map.value=x.map,t(x.map,g.mapTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,t(x.alphaMap,g.alphaMapTransform)),x.bumpMap&&(g.bumpMap.value=x.bumpMap,t(x.bumpMap,g.bumpMapTransform),g.bumpScale.value=x.bumpScale,x.side===Gt&&(g.bumpScale.value*=-1)),x.normalMap&&(g.normalMap.value=x.normalMap,t(x.normalMap,g.normalMapTransform),g.normalScale.value.copy(x.normalScale),x.side===Gt&&g.normalScale.value.negate()),x.displacementMap&&(g.displacementMap.value=x.displacementMap,t(x.displacementMap,g.displacementMapTransform),g.displacementScale.value=x.displacementScale,g.displacementBias.value=x.displacementBias),x.emissiveMap&&(g.emissiveMap.value=x.emissiveMap,t(x.emissiveMap,g.emissiveMapTransform)),x.specularMap&&(g.specularMap.value=x.specularMap,t(x.specularMap,g.specularMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest);const T=e.get(x),C=T.envMap,y=T.envMapRotation;C&&(g.envMap.value=C,ti.copy(y),ti.x*=-1,ti.y*=-1,ti.z*=-1,C.isCubeTexture&&C.isRenderTargetTexture===!1&&(ti.y*=-1,ti.z*=-1),g.envMapRotation.value.setFromMatrix4(zS.makeRotationFromEuler(ti)),g.flipEnvMap.value=C.isCubeTexture&&C.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=x.reflectivity,g.ior.value=x.ior,g.refractionRatio.value=x.refractionRatio),x.lightMap&&(g.lightMap.value=x.lightMap,g.lightMapIntensity.value=x.lightMapIntensity,t(x.lightMap,g.lightMapTransform)),x.aoMap&&(g.aoMap.value=x.aoMap,g.aoMapIntensity.value=x.aoMapIntensity,t(x.aoMap,g.aoMapTransform))}function l(g,x){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,x.map&&(g.map.value=x.map,t(x.map,g.mapTransform))}function h(g,x){g.dashSize.value=x.dashSize,g.totalSize.value=x.dashSize+x.gapSize,g.scale.value=x.scale}function c(g,x,T,C){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,g.size.value=x.size*T,g.scale.value=C*.5,x.map&&(g.map.value=x.map,t(x.map,g.uvTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,t(x.alphaMap,g.alphaMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest)}function d(g,x){g.diffuse.value.copy(x.color),g.opacity.value=x.opacity,g.rotation.value=x.rotation,x.map&&(g.map.value=x.map,t(x.map,g.mapTransform)),x.alphaMap&&(g.alphaMap.value=x.alphaMap,t(x.alphaMap,g.alphaMapTransform)),x.alphaTest>0&&(g.alphaTest.value=x.alphaTest)}function u(g,x){g.specular.value.copy(x.specular),g.shininess.value=Math.max(x.shininess,1e-4)}function f(g,x){x.gradientMap&&(g.gradientMap.value=x.gradientMap)}function m(g,x){g.metalness.value=x.metalness,x.metalnessMap&&(g.metalnessMap.value=x.metalnessMap,t(x.metalnessMap,g.metalnessMapTransform)),g.roughness.value=x.roughness,x.roughnessMap&&(g.roughnessMap.value=x.roughnessMap,t(x.roughnessMap,g.roughnessMapTransform)),x.envMap&&(g.envMapIntensity.value=x.envMapIntensity)}function p(g,x,T){g.ior.value=x.ior,x.sheen>0&&(g.sheenColor.value.copy(x.sheenColor).multiplyScalar(x.sheen),g.sheenRoughness.value=x.sheenRoughness,x.sheenColorMap&&(g.sheenColorMap.value=x.sheenColorMap,t(x.sheenColorMap,g.sheenColorMapTransform)),x.sheenRoughnessMap&&(g.sheenRoughnessMap.value=x.sheenRoughnessMap,t(x.sheenRoughnessMap,g.sheenRoughnessMapTransform))),x.clearcoat>0&&(g.clearcoat.value=x.clearcoat,g.clearcoatRoughness.value=x.clearcoatRoughness,x.clearcoatMap&&(g.clearcoatMap.value=x.clearcoatMap,t(x.clearcoatMap,g.clearcoatMapTransform)),x.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=x.clearcoatRoughnessMap,t(x.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),x.clearcoatNormalMap&&(g.clearcoatNormalMap.value=x.clearcoatNormalMap,t(x.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(x.clearcoatNormalScale),x.side===Gt&&g.clearcoatNormalScale.value.negate())),x.dispersion>0&&(g.dispersion.value=x.dispersion),x.iridescence>0&&(g.iridescence.value=x.iridescence,g.iridescenceIOR.value=x.iridescenceIOR,g.iridescenceThicknessMinimum.value=x.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=x.iridescenceThicknessRange[1],x.iridescenceMap&&(g.iridescenceMap.value=x.iridescenceMap,t(x.iridescenceMap,g.iridescenceMapTransform)),x.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=x.iridescenceThicknessMap,t(x.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),x.transmission>0&&(g.transmission.value=x.transmission,g.transmissionSamplerMap.value=T.texture,g.transmissionSamplerSize.value.set(T.width,T.height),x.transmissionMap&&(g.transmissionMap.value=x.transmissionMap,t(x.transmissionMap,g.transmissionMapTransform)),g.thickness.value=x.thickness,x.thicknessMap&&(g.thicknessMap.value=x.thicknessMap,t(x.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=x.attenuationDistance,g.attenuationColor.value.copy(x.attenuationColor)),x.anisotropy>0&&(g.anisotropyVector.value.set(x.anisotropy*Math.cos(x.anisotropyRotation),x.anisotropy*Math.sin(x.anisotropyRotation)),x.anisotropyMap&&(g.anisotropyMap.value=x.anisotropyMap,t(x.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=x.specularIntensity,g.specularColor.value.copy(x.specularColor),x.specularColorMap&&(g.specularColorMap.value=x.specularColorMap,t(x.specularColorMap,g.specularColorMapTransform)),x.specularIntensityMap&&(g.specularIntensityMap.value=x.specularIntensityMap,t(x.specularIntensityMap,g.specularIntensityMapTransform))}function b(g,x){x.matcap&&(g.matcap.value=x.matcap)}function E(g,x){const T=e.get(x).light;g.referencePosition.value.setFromMatrixPosition(T.matrixWorld),g.nearDistance.value=T.shadow.camera.near,g.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:o}}function WS(n,e,t,i){let o={},r={},l=[];const h=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function c(T,C){const y=C.program;i.uniformBlockBinding(T,y)}function d(T,C){let y=o[T.id];y===void 0&&(b(T),y=u(T),o[T.id]=y,T.addEventListener("dispose",g));const F=C.program;i.updateUBOMapping(T,F);const _=e.render.frame;r[T.id]!==_&&(m(T),r[T.id]=_)}function u(T){const C=f();T.__bindingPointIndex=C;const y=n.createBuffer(),F=T.__size,_=T.usage;return n.bindBuffer(n.UNIFORM_BUFFER,y),n.bufferData(n.UNIFORM_BUFFER,F,_),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,C,y),y}function f(){for(let T=0;T<h;T++)if(l.indexOf(T)===-1)return l.push(T),T;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function m(T){const C=o[T.id],y=T.uniforms,F=T.__cache;n.bindBuffer(n.UNIFORM_BUFFER,C);for(let _=0,B=y.length;_<B;_++){const P=Array.isArray(y[_])?y[_]:[y[_]];for(let A=0,S=P.length;A<S;A++){const R=P[A];if(p(R,_,A,F)===!0){const U=R.__offset,z=Array.isArray(R.value)?R.value:[R.value];let J=0;for(let Y=0;Y<z.length;Y++){const X=z[Y],ee=E(X);typeof X=="number"||typeof X=="boolean"?(R.__data[0]=X,n.bufferSubData(n.UNIFORM_BUFFER,U+J,R.__data)):X.isMatrix3?(R.__data[0]=X.elements[0],R.__data[1]=X.elements[1],R.__data[2]=X.elements[2],R.__data[3]=0,R.__data[4]=X.elements[3],R.__data[5]=X.elements[4],R.__data[6]=X.elements[5],R.__data[7]=0,R.__data[8]=X.elements[6],R.__data[9]=X.elements[7],R.__data[10]=X.elements[8],R.__data[11]=0):(X.toArray(R.__data,J),J+=ee.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,U,R.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function p(T,C,y,F){const _=T.value,B=C+"_"+y;if(F[B]===void 0)return typeof _=="number"||typeof _=="boolean"?F[B]=_:F[B]=_.clone(),!0;{const P=F[B];if(typeof _=="number"||typeof _=="boolean"){if(P!==_)return F[B]=_,!0}else if(P.equals(_)===!1)return P.copy(_),!0}return!1}function b(T){const C=T.uniforms;let y=0;const F=16;for(let B=0,P=C.length;B<P;B++){const A=Array.isArray(C[B])?C[B]:[C[B]];for(let S=0,R=A.length;S<R;S++){const U=A[S],z=Array.isArray(U.value)?U.value:[U.value];for(let J=0,Y=z.length;J<Y;J++){const X=z[J],ee=E(X),$=y%F,he=$%ee.boundary,fe=$+he;y+=he,fe!==0&&F-fe<ee.storage&&(y+=F-fe),U.__data=new Float32Array(ee.storage/Float32Array.BYTES_PER_ELEMENT),U.__offset=y,y+=ee.storage}}}const _=y%F;return _>0&&(y+=F-_),T.__size=y,T.__cache={},this}function E(T){const C={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(C.boundary=4,C.storage=4):T.isVector2?(C.boundary=8,C.storage=8):T.isVector3||T.isColor?(C.boundary=16,C.storage=12):T.isVector4?(C.boundary=16,C.storage=16):T.isMatrix3?(C.boundary=48,C.storage=48):T.isMatrix4?(C.boundary=64,C.storage=64):T.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",T),C}function g(T){const C=T.target;C.removeEventListener("dispose",g);const y=l.indexOf(C.__bindingPointIndex);l.splice(y,1),n.deleteBuffer(o[C.id]),delete o[C.id],delete r[C.id]}function x(){for(const T in o)n.deleteBuffer(o[T]);l=[],o={},r={}}return{bind:c,update:d,dispose:x}}class JS{constructor(e={}){const{canvas:t=gw(),context:i=null,depth:o=!0,stencil:r=!1,alpha:l=!1,antialias:h=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:d=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:f=!1,reverseDepthBuffer:m=!1}=e;this.isWebGLRenderer=!0;let p;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=i.getContextAttributes().alpha}else p=l;const b=new Uint32Array(4),E=new Int32Array(4);let g=null,x=null;const T=[],C=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=qn,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const y=this;let F=!1;this._outputColorSpace=Yt;let _=0,B=0,P=null,A=-1,S=null;const R=new vt,U=new vt;let z=null;const J=new st(0);let Y=0,X=t.width,ee=t.height,$=1,he=null,fe=null;const re=new vt(0,0,X,ee),ve=new vt(0,0,X,ee);let Ge=!1;const Z=new od;let ge=!1,ce=!1;const me=new Ct,_e=new Ct,we=new Q,Ne=new vt,rt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let lt=!1;function Xe(){return P===null?$:1}let O=i;function pt(w,k){return t.getContext(w,k)}try{const w={alpha:!0,depth:o,stencil:r,antialias:h,premultipliedAlpha:c,preserveDrawingBuffer:d,powerPreference:u,failIfMajorPerformanceCaveat:f};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${vs}`),t.addEventListener("webglcontextlost",de,!1),t.addEventListener("webglcontextrestored",Be,!1),t.addEventListener("webglcontextcreationerror",Ae,!1),O===null){const k="webgl2";if(O=pt(k,w),O===null)throw pt(k)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(w){throw console.error("THREE.WebGLRenderer: "+w.message),w}let Ye,Ke,Ie,it,Ue,N,D,j,se,pe,oe,Le,Ce,ze,qe,be,Fe,Re,He,Te,Ze,Ve,Qe,W;function te(){Ye=new tA(O),Ye.init(),Ve=new LS(O,Ye),Ke=new KC(O,Ye,e,Ve),Ie=new RS(O,Ye),Ke.reverseDepthBuffer&&m&&Ie.buffers.depth.setReversed(!0),it=new oA(O),Ue=new ES,N=new NS(O,Ye,Ie,Ue,Ke,Ve,it),D=new $C(y),j=new eA(y),se=new c1(O),Qe=new qC(O,se),pe=new nA(O,se,it,Qe),oe=new aA(O,pe,se,it),He=new rA(O,Ke,N),be=new YC(Ue),Le=new wS(y,D,j,Ye,Ke,Qe,be),Ce=new VS(y,Ue),ze=new AS,qe=new DS(Ye),Re=new JC(y,D,j,Ie,oe,p,c),Fe=new kS(y,oe,Ke),W=new WS(O,it,Ke,Ie),Te=new XC(O,Ye,it),Ze=new iA(O,Ye,it),it.programs=Le.programs,y.capabilities=Ke,y.extensions=Ye,y.properties=Ue,y.renderLists=ze,y.shadowMap=Fe,y.state=Ie,y.info=it}te();const ie=new OS(y,O);this.xr=ie,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const w=Ye.get("WEBGL_lose_context");w&&w.loseContext()},this.forceContextRestore=function(){const w=Ye.get("WEBGL_lose_context");w&&w.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(w){w!==void 0&&($=w,this.setSize(X,ee,!1))},this.getSize=function(w){return w.set(X,ee)},this.setSize=function(w,k,I=!0){if(ie.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}X=w,ee=k,t.width=Math.floor(w*$),t.height=Math.floor(k*$),I===!0&&(t.style.width=w+"px",t.style.height=k+"px"),this.setViewport(0,0,w,k)},this.getDrawingBufferSize=function(w){return w.set(X*$,ee*$).floor()},this.setDrawingBufferSize=function(w,k,I){X=w,ee=k,$=I,t.width=Math.floor(w*I),t.height=Math.floor(k*I),this.setViewport(0,0,w,k)},this.getCurrentViewport=function(w){return w.copy(R)},this.getViewport=function(w){return w.copy(re)},this.setViewport=function(w,k,I,G){w.isVector4?re.set(w.x,w.y,w.z,w.w):re.set(w,k,I,G),Ie.viewport(R.copy(re).multiplyScalar($).round())},this.getScissor=function(w){return w.copy(ve)},this.setScissor=function(w,k,I,G){w.isVector4?ve.set(w.x,w.y,w.z,w.w):ve.set(w,k,I,G),Ie.scissor(U.copy(ve).multiplyScalar($).round())},this.getScissorTest=function(){return Ge},this.setScissorTest=function(w){Ie.setScissorTest(Ge=w)},this.setOpaqueSort=function(w){he=w},this.setTransparentSort=function(w){fe=w},this.getClearColor=function(w){return w.copy(Re.getClearColor())},this.setClearColor=function(){Re.setClearColor(...arguments)},this.getClearAlpha=function(){return Re.getClearAlpha()},this.setClearAlpha=function(){Re.setClearAlpha(...arguments)},this.clear=function(w=!0,k=!0,I=!0){let G=0;if(w){let L=!1;if(P!==null){const V=P.texture.format;L=V===_s||V===Bs||V===Ss}if(L){const V=P.texture.type,q=V===kn||V===si||V===uo||V===fo||V===Es||V===Cs,K=Re.getClearColor(),ne=Re.getClearAlpha(),le=K.r,ae=K.g,ue=K.b;q?(b[0]=le,b[1]=ae,b[2]=ue,b[3]=ne,O.clearBufferuiv(O.COLOR,0,b)):(E[0]=le,E[1]=ae,E[2]=ue,E[3]=ne,O.clearBufferiv(O.COLOR,0,E))}else G|=O.COLOR_BUFFER_BIT}k&&(G|=O.DEPTH_BUFFER_BIT),I&&(G|=O.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),O.clear(G)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",de,!1),t.removeEventListener("webglcontextrestored",Be,!1),t.removeEventListener("webglcontextcreationerror",Ae,!1),Re.dispose(),ze.dispose(),qe.dispose(),Ue.dispose(),D.dispose(),j.dispose(),oe.dispose(),Qe.dispose(),W.dispose(),Le.dispose(),ie.dispose(),ie.removeEventListener("sessionstart",Co),ie.removeEventListener("sessionend",Ao),gn.stop()};function de(w){w.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),F=!0}function Be(){console.log("THREE.WebGLRenderer: Context Restored."),F=!1;const w=it.autoReset,k=Fe.enabled,I=Fe.autoUpdate,G=Fe.needsUpdate,L=Fe.type;te(),it.autoReset=w,Fe.enabled=k,Fe.autoUpdate=I,Fe.needsUpdate=G,Fe.type=L}function Ae(w){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",w.statusMessage)}function je(w){const k=w.target;k.removeEventListener("dispose",je),yt(k)}function yt(w){Tt(w),Ue.remove(w)}function Tt(w){const k=Ue.get(w).programs;k!==void 0&&(k.forEach(function(I){Le.releaseProgram(I)}),w.isShaderMaterial&&Le.releaseShaderCache(w))}this.renderBufferDirect=function(w,k,I,G,L,V){k===null&&(k=rt);const q=L.isMesh&&L.matrixWorld.determinant()<0,K=Sr(w,k,I,G,L);Ie.setMaterial(G,q);let ne=I.index,le=1;if(G.wireframe===!0){if(ne=pe.getWireframeAttribute(I),ne===void 0)return;le=2}const ae=I.drawRange,ue=I.attributes.position;let xe=ae.start*le,ye=(ae.start+ae.count)*le;V!==null&&(xe=Math.max(xe,V.start*le),ye=Math.min(ye,(V.start+V.count)*le)),ne!==null?(xe=Math.max(xe,0),ye=Math.min(ye,ne.count)):ue!=null&&(xe=Math.max(xe,0),ye=Math.min(ye,ue.count));const Pe=ye-xe;if(Pe<0||Pe===1/0)return;Qe.setup(L,G,K,I,ne);let We,Oe=Te;if(ne!==null&&(We=se.get(ne),Oe=Ze,Oe.setIndex(We)),L.isMesh)G.wireframe===!0?(Ie.setLineWidth(G.wireframeLinewidth*Xe()),Oe.setMode(O.LINES)):Oe.setMode(O.TRIANGLES);else if(L.isLine){let De=G.linewidth;De===void 0&&(De=1),Ie.setLineWidth(De*Xe()),L.isLineSegments?Oe.setMode(O.LINES):L.isLineLoop?Oe.setMode(O.LINE_LOOP):Oe.setMode(O.LINE_STRIP)}else L.isPoints?Oe.setMode(O.POINTS):L.isSprite&&Oe.setMode(O.TRIANGLES);if(L.isBatchedMesh)if(L._multiDrawInstances!==null)ar("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Oe.renderMultiDrawInstances(L._multiDrawStarts,L._multiDrawCounts,L._multiDrawCount,L._multiDrawInstances);else if(Ye.get("WEBGL_multi_draw"))Oe.renderMultiDraw(L._multiDrawStarts,L._multiDrawCounts,L._multiDrawCount);else{const De=L._multiDrawStarts,et=L._multiDrawCounts,ke=L._multiDrawCount,ft=ne?se.get(ne).bytesPerElement:1,At=Ue.get(G).currentProgram.getUniforms();for(let ht=0;ht<ke;ht++)At.setValue(O,"_gl_DrawID",ht),Oe.render(De[ht]/ft,et[ht])}else if(L.isInstancedMesh)Oe.renderInstances(xe,Pe,L.count);else if(I.isInstancedBufferGeometry){const De=I._maxInstanceCount!==void 0?I._maxInstanceCount:1/0,et=Math.min(I.instanceCount,De);Oe.renderInstances(xe,Pe,et)}else Oe.render(xe,Pe)};function ut(w,k,I){w.transparent===!0&&w.side===Bn&&w.forceSinglePass===!1?(w.side=Gt,w.needsUpdate=!0,di(w,k,I),w.side=Xn,w.needsUpdate=!0,di(w,k,I),w.side=Bn):di(w,k,I)}this.compile=function(w,k,I=null){I===null&&(I=w),x=qe.get(I),x.init(k),C.push(x),I.traverseVisible(function(L){L.isLight&&L.layers.test(k.layers)&&(x.pushLight(L),L.castShadow&&x.pushShadow(L))}),w!==I&&w.traverseVisible(function(L){L.isLight&&L.layers.test(k.layers)&&(x.pushLight(L),L.castShadow&&x.pushShadow(L))}),x.setupLights();const G=new Set;return w.traverse(function(L){if(!(L.isMesh||L.isPoints||L.isLine||L.isSprite))return;const V=L.material;if(V)if(Array.isArray(V))for(let q=0;q<V.length;q++){const K=V[q];ut(K,I,L),G.add(K)}else ut(V,I,L),G.add(V)}),x=C.pop(),G},this.compileAsync=function(w,k,I=null){const G=this.compile(w,k,I);return new Promise(L=>{function V(){if(G.forEach(function(q){Ue.get(q).currentProgram.isReady()&&G.delete(q)}),G.size===0){L(w);return}setTimeout(V,10)}Ye.get("KHR_parallel_shader_compile")!==null?V():setTimeout(V,10)})};let zt=null;function on(w){zt&&zt(w)}function Co(){gn.stop()}function Ao(){gn.start()}const gn=new sd;gn.setAnimationLoop(on),typeof self<"u"&&gn.setContext(self),this.setAnimationLoop=function(w){zt=w,ie.setAnimationLoop(w),w===null?gn.stop():gn.start()},ie.addEventListener("sessionstart",Co),ie.addEventListener("sessionend",Ao),this.render=function(w,k){if(k!==void 0&&k.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(F===!0)return;if(w.matrixWorldAutoUpdate===!0&&w.updateMatrixWorld(),k.parent===null&&k.matrixWorldAutoUpdate===!0&&k.updateMatrixWorld(),ie.enabled===!0&&ie.isPresenting===!0&&(ie.cameraAutoUpdate===!0&&ie.updateCamera(k),k=ie.getCamera()),w.isScene===!0&&w.onBeforeRender(y,w,k,P),x=qe.get(w,C.length),x.init(k),C.push(x),_e.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse),Z.setFromProjectionMatrix(_e),ce=this.localClippingEnabled,ge=be.init(this.clippingPlanes,ce),g=ze.get(w,T.length),g.init(),T.push(g),ie.enabled===!0&&ie.isPresenting===!0){const V=y.xr.getDepthSensingMesh();V!==null&&Xi(V,k,-1/0,y.sortObjects)}Xi(w,k,0,y.sortObjects),g.finish(),y.sortObjects===!0&&g.sort(he,fe),lt=ie.enabled===!1||ie.isPresenting===!1||ie.hasDepthSensing()===!1,lt&&Re.addToRenderList(g,w),this.info.render.frame++,ge===!0&&be.beginShadows();const I=x.state.shadowsArray;Fe.render(I,w,k),ge===!0&&be.endShadows(),this.info.autoReset===!0&&this.info.reset();const G=g.opaque,L=g.transmissive;if(x.setupLights(),k.isArrayCamera){const V=k.cameras;if(L.length>0)for(let q=0,K=V.length;q<K;q++){const ne=V[q];So(G,L,w,ne)}lt&&Re.render(w);for(let q=0,K=V.length;q<K;q++){const ne=V[q];Ki(g,w,ne,ne.viewport)}}else L.length>0&&So(G,L,w,k),lt&&Re.render(w),Ki(g,w,k);P!==null&&B===0&&(N.updateMultisampleRenderTarget(P),N.updateRenderTargetMipmap(P)),w.isScene===!0&&w.onAfterRender(y,w,k),Qe.resetDefaultState(),A=-1,S=null,C.pop(),C.length>0?(x=C[C.length-1],ge===!0&&be.setGlobalState(y.clippingPlanes,x.state.camera)):x=null,T.pop(),T.length>0?g=T[T.length-1]:g=null};function Xi(w,k,I,G){if(w.visible===!1)return;if(w.layers.test(k.layers)){if(w.isGroup)I=w.renderOrder;else if(w.isLOD)w.autoUpdate===!0&&w.update(k);else if(w.isLight)x.pushLight(w),w.castShadow&&x.pushShadow(w);else if(w.isSprite){if(!w.frustumCulled||Z.intersectsSprite(w)){G&&Ne.setFromMatrixPosition(w.matrixWorld).applyMatrix4(_e);const q=oe.update(w),K=w.material;K.visible&&g.push(w,q,K,I,Ne.z,null)}}else if((w.isMesh||w.isLine||w.isPoints)&&(!w.frustumCulled||Z.intersectsObject(w))){const q=oe.update(w),K=w.material;if(G&&(w.boundingSphere!==void 0?(w.boundingSphere===null&&w.computeBoundingSphere(),Ne.copy(w.boundingSphere.center)):(q.boundingSphere===null&&q.computeBoundingSphere(),Ne.copy(q.boundingSphere.center)),Ne.applyMatrix4(w.matrixWorld).applyMatrix4(_e)),Array.isArray(K)){const ne=q.groups;for(let le=0,ae=ne.length;le<ae;le++){const ue=ne[le],xe=K[ue.materialIndex];xe&&xe.visible&&g.push(w,q,xe,I,Ne.z,ue)}}else K.visible&&g.push(w,q,K,I,Ne.z,null)}}const V=w.children;for(let q=0,K=V.length;q<K;q++)Xi(V[q],k,I,G)}function Ki(w,k,I,G){const L=w.opaque,V=w.transmissive,q=w.transparent;x.setupLightsView(I),ge===!0&&be.setGlobalState(y.clippingPlanes,I),G&&Ie.viewport(R.copy(G)),L.length>0&&ci(L,k,I),V.length>0&&ci(V,k,I),q.length>0&&ci(q,k,I),Ie.buffers.depth.setTest(!0),Ie.buffers.depth.setMask(!0),Ie.buffers.color.setMask(!0),Ie.setPolygonOffset(!1)}function So(w,k,I,G){if((I.isScene===!0?I.overrideMaterial:null)!==null)return;x.state.transmissionRenderTarget[G.id]===void 0&&(x.state.transmissionRenderTarget[G.id]=new dn(1,1,{generateMipmaps:!0,type:Ye.has("EXT_color_buffer_half_float")||Ye.has("EXT_color_buffer_float")?Jt:kn,minFilter:Jn,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ct.workingColorSpace}));const V=x.state.transmissionRenderTarget[G.id],q=G.viewport||R;V.setSize(q.z*y.transmissionResolutionScale,q.w*y.transmissionResolutionScale);const K=y.getRenderTarget();y.setRenderTarget(V),y.getClearColor(J),Y=y.getClearAlpha(),Y<1&&y.setClearColor(16777215,.5),y.clear(),lt&&Re.render(I);const ne=y.toneMapping;y.toneMapping=qn;const le=G.viewport;if(G.viewport!==void 0&&(G.viewport=void 0),x.setupLightsView(G),ge===!0&&be.setGlobalState(y.clippingPlanes,G),ci(w,I,G),N.updateMultisampleRenderTarget(V),N.updateRenderTargetMipmap(V),Ye.has("WEBGL_multisampled_render_to_texture")===!1){let ae=!1;for(let ue=0,xe=k.length;ue<xe;ue++){const ye=k[ue],Pe=ye.object,We=ye.geometry,Oe=ye.material,De=ye.group;if(Oe.side===Bn&&Pe.layers.test(G.layers)){const et=Oe.side;Oe.side=Gt,Oe.needsUpdate=!0,Bo(Pe,I,G,We,Oe,De),Oe.side=et,Oe.needsUpdate=!0,ae=!0}}ae===!0&&(N.updateMultisampleRenderTarget(V),N.updateRenderTargetMipmap(V))}y.setRenderTarget(K),y.setClearColor(J,Y),le!==void 0&&(G.viewport=le),y.toneMapping=ne}function ci(w,k,I){const G=k.isScene===!0?k.overrideMaterial:null;for(let L=0,V=w.length;L<V;L++){const q=w[L],K=q.object,ne=q.geometry,le=q.group;let ae=q.material;ae.allowOverride===!0&&G!==null&&(ae=G),K.layers.test(I.layers)&&Bo(K,k,I,ne,ae,le)}}function Bo(w,k,I,G,L,V){w.onBeforeRender(y,k,I,G,L,V),w.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,w.matrixWorld),w.normalMatrix.getNormalMatrix(w.modelViewMatrix),L.onBeforeRender(y,k,I,G,w,V),L.transparent===!0&&L.side===Bn&&L.forceSinglePass===!1?(L.side=Gt,L.needsUpdate=!0,y.renderBufferDirect(I,k,G,L,w,V),L.side=Xn,L.needsUpdate=!0,y.renderBufferDirect(I,k,G,L,w,V),L.side=Bn):y.renderBufferDirect(I,k,G,L,w,V),w.onAfterRender(y,k,I,G,L,V)}function di(w,k,I){k.isScene!==!0&&(k=rt);const G=Ue.get(w),L=x.state.lights,V=x.state.shadowsArray,q=L.state.version,K=Le.getParameters(w,L.state,V,k,I),ne=Le.getProgramCacheKey(K);let le=G.programs;G.environment=w.isMeshStandardMaterial?k.environment:null,G.fog=k.fog,G.envMap=(w.isMeshStandardMaterial?j:D).get(w.envMap||G.environment),G.envMapRotation=G.environment!==null&&w.envMap===null?k.environmentRotation:w.envMapRotation,le===void 0&&(w.addEventListener("dispose",je),le=new Map,G.programs=le);let ae=le.get(ne);if(ae!==void 0){if(G.currentProgram===ae&&G.lightsStateVersion===q)return $i(w,K),ae}else K.uniforms=Le.getUniforms(w),w.onBeforeCompile(K,y),ae=Le.acquireProgram(K,ne),le.set(ne,ae),G.uniforms=K.uniforms;const ue=G.uniforms;return(!w.isShaderMaterial&&!w.isRawShaderMaterial||w.clipping===!0)&&(ue.clippingPlanes=be.uniform),$i(w,K),G.needsLights=Nn(w),G.lightsStateVersion=q,G.needsLights&&(ue.ambientLightColor.value=L.state.ambient,ue.lightProbe.value=L.state.probe,ue.directionalLights.value=L.state.directional,ue.directionalLightShadows.value=L.state.directionalShadow,ue.spotLights.value=L.state.spot,ue.spotLightShadows.value=L.state.spotShadow,ue.rectAreaLights.value=L.state.rectArea,ue.ltc_1.value=L.state.rectAreaLTC1,ue.ltc_2.value=L.state.rectAreaLTC2,ue.pointLights.value=L.state.point,ue.pointLightShadows.value=L.state.pointShadow,ue.hemisphereLights.value=L.state.hemi,ue.directionalShadowMap.value=L.state.directionalShadowMap,ue.directionalShadowMatrix.value=L.state.directionalShadowMatrix,ue.spotShadowMap.value=L.state.spotShadowMap,ue.spotLightMatrix.value=L.state.spotLightMatrix,ue.spotLightMap.value=L.state.spotLightMap,ue.pointShadowMap.value=L.state.pointShadowMap,ue.pointShadowMatrix.value=L.state.pointShadowMatrix),G.currentProgram=ae,G.uniformsList=null,ae}function Yi(w){if(w.uniformsList===null){const k=w.currentProgram.getUniforms();w.uniformsList=sr.seqWithValue(k.seq,w.uniforms)}return w.uniformsList}function $i(w,k){const I=Ue.get(w);I.outputColorSpace=k.outputColorSpace,I.batching=k.batching,I.batchingColor=k.batchingColor,I.instancing=k.instancing,I.instancingColor=k.instancingColor,I.instancingMorph=k.instancingMorph,I.skinning=k.skinning,I.morphTargets=k.morphTargets,I.morphNormals=k.morphNormals,I.morphColors=k.morphColors,I.morphTargetsCount=k.morphTargetsCount,I.numClippingPlanes=k.numClippingPlanes,I.numIntersection=k.numClipIntersection,I.vertexAlphas=k.vertexAlphas,I.vertexTangents=k.vertexTangents,I.toneMapping=k.toneMapping}function Sr(w,k,I,G,L){k.isScene!==!0&&(k=rt),N.resetTextureUnits();const V=k.fog,q=G.isMeshStandardMaterial?k.environment:null,K=P===null?y.outputColorSpace:P.isXRRenderTarget===!0?P.texture.colorSpace:Kn,ne=(G.isMeshStandardMaterial?j:D).get(G.envMap||q),le=G.vertexColors===!0&&!!I.attributes.color&&I.attributes.color.itemSize===4,ae=!!I.attributes.tangent&&(!!G.normalMap||G.anisotropy>0),ue=!!I.morphAttributes.position,xe=!!I.morphAttributes.normal,ye=!!I.morphAttributes.color;let Pe=qn;G.toneMapped&&(P===null||P.isXRRenderTarget===!0)&&(Pe=y.toneMapping);const We=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,Oe=We!==void 0?We.length:0,De=Ue.get(G),et=x.state.lights;if(ge===!0&&(ce===!0||w!==S)){const xt=w===S&&G.id===A;be.setState(G,w,xt)}let ke=!1;G.version===De.__version?(De.needsLights&&De.lightsStateVersion!==et.state.version||De.outputColorSpace!==K||L.isBatchedMesh&&De.batching===!1||!L.isBatchedMesh&&De.batching===!0||L.isBatchedMesh&&De.batchingColor===!0&&L.colorTexture===null||L.isBatchedMesh&&De.batchingColor===!1&&L.colorTexture!==null||L.isInstancedMesh&&De.instancing===!1||!L.isInstancedMesh&&De.instancing===!0||L.isSkinnedMesh&&De.skinning===!1||!L.isSkinnedMesh&&De.skinning===!0||L.isInstancedMesh&&De.instancingColor===!0&&L.instanceColor===null||L.isInstancedMesh&&De.instancingColor===!1&&L.instanceColor!==null||L.isInstancedMesh&&De.instancingMorph===!0&&L.morphTexture===null||L.isInstancedMesh&&De.instancingMorph===!1&&L.morphTexture!==null||De.envMap!==ne||G.fog===!0&&De.fog!==V||De.numClippingPlanes!==void 0&&(De.numClippingPlanes!==be.numPlanes||De.numIntersection!==be.numIntersection)||De.vertexAlphas!==le||De.vertexTangents!==ae||De.morphTargets!==ue||De.morphNormals!==xe||De.morphColors!==ye||De.toneMapping!==Pe||De.morphTargetsCount!==Oe)&&(ke=!0):(ke=!0,De.__version=G.version);let ft=De.currentProgram;ke===!0&&(ft=di(G,k,L));let At=!1,ht=!1,at=!1;const Je=ft.getUniforms(),wt=De.uniforms;if(Ie.useProgram(ft.program)&&(At=!0,ht=!0,at=!0),G.id!==A&&(A=G.id,ht=!0),At||S!==w){Ie.buffers.depth.getReversed()?(me.copy(w.projectionMatrix),yw(me),vw(me),Je.setValue(O,"projectionMatrix",me)):Je.setValue(O,"projectionMatrix",w.projectionMatrix),Je.setValue(O,"viewMatrix",w.matrixWorldInverse);const St=Je.map.cameraPosition;St!==void 0&&St.setValue(O,we.setFromMatrixPosition(w.matrixWorld)),Ke.logarithmicDepthBuffer&&Je.setValue(O,"logDepthBufFC",2/(Math.log(w.far+1)/Math.LN2)),(G.isMeshPhongMaterial||G.isMeshToonMaterial||G.isMeshLambertMaterial||G.isMeshBasicMaterial||G.isMeshStandardMaterial||G.isShaderMaterial)&&Je.setValue(O,"isOrthographic",w.isOrthographicCamera===!0),S!==w&&(S=w,ht=!0,at=!0)}if(L.isSkinnedMesh){Je.setOptional(O,L,"bindMatrix"),Je.setOptional(O,L,"bindMatrixInverse");const xt=L.skeleton;xt&&(xt.boneTexture===null&&xt.computeBoneTexture(),Je.setValue(O,"boneTexture",xt.boneTexture,N))}L.isBatchedMesh&&(Je.setOptional(O,L,"batchingTexture"),Je.setValue(O,"batchingTexture",L._matricesTexture,N),Je.setOptional(O,L,"batchingIdTexture"),Je.setValue(O,"batchingIdTexture",L._indirectTexture,N),Je.setOptional(O,L,"batchingColorTexture"),L._colorsTexture!==null&&Je.setValue(O,"batchingColorTexture",L._colorsTexture,N));const Ft=I.morphAttributes;if((Ft.position!==void 0||Ft.normal!==void 0||Ft.color!==void 0)&&He.update(L,I,ft),(ht||De.receiveShadow!==L.receiveShadow)&&(De.receiveShadow=L.receiveShadow,Je.setValue(O,"receiveShadow",L.receiveShadow)),G.isMeshGouraudMaterial&&G.envMap!==null&&(wt.envMap.value=ne,wt.flipEnvMap.value=ne.isCubeTexture&&ne.isRenderTargetTexture===!1?-1:1),G.isMeshStandardMaterial&&G.envMap===null&&k.environment!==null&&(wt.envMapIntensity.value=k.environmentIntensity),ht&&(Je.setValue(O,"toneMappingExposure",y.toneMappingExposure),De.needsLights&&bn(wt,at),V&&G.fog===!0&&Ce.refreshFogUniforms(wt,V),Ce.refreshMaterialUniforms(wt,G,$,ee,x.state.transmissionRenderTarget[w.id]),sr.upload(O,Yi(De),wt,N)),G.isShaderMaterial&&G.uniformsNeedUpdate===!0&&(sr.upload(O,Yi(De),wt,N),G.uniformsNeedUpdate=!1),G.isSpriteMaterial&&Je.setValue(O,"center",L.center),Je.setValue(O,"modelViewMatrix",L.modelViewMatrix),Je.setValue(O,"normalMatrix",L.normalMatrix),Je.setValue(O,"modelMatrix",L.matrixWorld),G.isShaderMaterial||G.isRawShaderMaterial){const xt=G.uniformsGroups;for(let St=0,Br=xt.length;St<Br;St++){const Yn=xt[St];W.update(Yn,ft),W.bind(Yn,ft)}}return ft}function bn(w,k){w.ambientLightColor.needsUpdate=k,w.lightProbe.needsUpdate=k,w.directionalLights.needsUpdate=k,w.directionalLightShadows.needsUpdate=k,w.pointLights.needsUpdate=k,w.pointLightShadows.needsUpdate=k,w.spotLights.needsUpdate=k,w.spotLightShadows.needsUpdate=k,w.rectAreaLights.needsUpdate=k,w.hemisphereLights.needsUpdate=k}function Nn(w){return w.isMeshLambertMaterial||w.isMeshToonMaterial||w.isMeshPhongMaterial||w.isMeshStandardMaterial||w.isShadowMaterial||w.isShaderMaterial&&w.lights===!0}this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return B},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(w,k,I){const G=Ue.get(w);G.__autoAllocateDepthBuffer=w.resolveDepthBuffer===!1,G.__autoAllocateDepthBuffer===!1&&(G.__useRenderToTexture=!1),Ue.get(w.texture).__webglTexture=k,Ue.get(w.depthTexture).__webglTexture=G.__autoAllocateDepthBuffer?void 0:I,G.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(w,k){const I=Ue.get(w);I.__webglFramebuffer=k,I.__useDefaultFramebuffer=k===void 0};const v=O.createFramebuffer();this.setRenderTarget=function(w,k=0,I=0){P=w,_=k,B=I;let G=!0,L=null,V=!1,q=!1;if(w){const ne=Ue.get(w);if(ne.__useDefaultFramebuffer!==void 0)Ie.bindFramebuffer(O.FRAMEBUFFER,null),G=!1;else if(ne.__webglFramebuffer===void 0)N.setupRenderTarget(w);else if(ne.__hasExternalTextures)N.rebindTextures(w,Ue.get(w.texture).__webglTexture,Ue.get(w.depthTexture).__webglTexture);else if(w.depthBuffer){const ue=w.depthTexture;if(ne.__boundDepthTexture!==ue){if(ue!==null&&Ue.has(ue)&&(w.width!==ue.image.width||w.height!==ue.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");N.setupDepthRenderbuffer(w)}}const le=w.texture;(le.isData3DTexture||le.isDataArrayTexture||le.isCompressedArrayTexture)&&(q=!0);const ae=Ue.get(w).__webglFramebuffer;w.isWebGLCubeRenderTarget?(Array.isArray(ae[k])?L=ae[k][I]:L=ae[k],V=!0):w.samples>0&&N.useMultisampledRTT(w)===!1?L=Ue.get(w).__webglMultisampledFramebuffer:Array.isArray(ae)?L=ae[I]:L=ae,R.copy(w.viewport),U.copy(w.scissor),z=w.scissorTest}else R.copy(re).multiplyScalar($).floor(),U.copy(ve).multiplyScalar($).floor(),z=Ge;if(I!==0&&(L=v),Ie.bindFramebuffer(O.FRAMEBUFFER,L)&&G&&Ie.drawBuffers(w,L),Ie.viewport(R),Ie.scissor(U),Ie.setScissorTest(z),V){const ne=Ue.get(w.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+k,ne.__webglTexture,I)}else if(q){const ne=Ue.get(w.texture),le=k;O.framebufferTextureLayer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,ne.__webglTexture,I,le)}else if(w!==null&&I!==0){const ne=Ue.get(w.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,ne.__webglTexture,I)}A=-1},this.readRenderTargetPixels=function(w,k,I,G,L,V,q){if(!(w&&w.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let K=Ue.get(w).__webglFramebuffer;if(w.isWebGLCubeRenderTarget&&q!==void 0&&(K=K[q]),K){Ie.bindFramebuffer(O.FRAMEBUFFER,K);try{const ne=w.texture,le=ne.format,ae=ne.type;if(!Ke.textureFormatReadable(le)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ke.textureTypeReadable(ae)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}k>=0&&k<=w.width-G&&I>=0&&I<=w.height-L&&O.readPixels(k,I,G,L,Ve.convert(le),Ve.convert(ae),V)}finally{const ne=P!==null?Ue.get(P).__webglFramebuffer:null;Ie.bindFramebuffer(O.FRAMEBUFFER,ne)}}},this.readRenderTargetPixelsAsync=async function(w,k,I,G,L,V,q){if(!(w&&w.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let K=Ue.get(w).__webglFramebuffer;if(w.isWebGLCubeRenderTarget&&q!==void 0&&(K=K[q]),K)if(k>=0&&k<=w.width-G&&I>=0&&I<=w.height-L){Ie.bindFramebuffer(O.FRAMEBUFFER,K);const ne=w.texture,le=ne.format,ae=ne.type;if(!Ke.textureFormatReadable(le))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ke.textureTypeReadable(ae))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const ue=O.createBuffer();O.bindBuffer(O.PIXEL_PACK_BUFFER,ue),O.bufferData(O.PIXEL_PACK_BUFFER,V.byteLength,O.STREAM_READ),O.readPixels(k,I,G,L,Ve.convert(le),Ve.convert(ae),0);const xe=P!==null?Ue.get(P).__webglFramebuffer:null;Ie.bindFramebuffer(O.FRAMEBUFFER,xe);const ye=O.fenceSync(O.SYNC_GPU_COMMANDS_COMPLETE,0);return O.flush(),await bw(O,ye,4),O.bindBuffer(O.PIXEL_PACK_BUFFER,ue),O.getBufferSubData(O.PIXEL_PACK_BUFFER,0,V),O.deleteBuffer(ue),O.deleteSync(ye),V}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(w,k=null,I=0){const G=Math.pow(2,-I),L=Math.floor(w.image.width*G),V=Math.floor(w.image.height*G),q=k!==null?k.x:0,K=k!==null?k.y:0;N.setTexture2D(w,0),O.copyTexSubImage2D(O.TEXTURE_2D,I,0,0,q,K,L,V),Ie.unbindTexture()};const M=O.createFramebuffer(),H=O.createFramebuffer();this.copyTextureToTexture=function(w,k,I=null,G=null,L=0,V=null){V===null&&(L!==0?(ar("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),V=L,L=0):V=0);let q,K,ne,le,ae,ue,xe,ye,Pe;const We=w.isCompressedTexture?w.mipmaps[V]:w.image;if(I!==null)q=I.max.x-I.min.x,K=I.max.y-I.min.y,ne=I.isBox3?I.max.z-I.min.z:1,le=I.min.x,ae=I.min.y,ue=I.isBox3?I.min.z:0;else{const Ft=Math.pow(2,-L);q=Math.floor(We.width*Ft),K=Math.floor(We.height*Ft),w.isDataArrayTexture?ne=We.depth:w.isData3DTexture?ne=Math.floor(We.depth*Ft):ne=1,le=0,ae=0,ue=0}G!==null?(xe=G.x,ye=G.y,Pe=G.z):(xe=0,ye=0,Pe=0);const Oe=Ve.convert(k.format),De=Ve.convert(k.type);let et;k.isData3DTexture?(N.setTexture3D(k,0),et=O.TEXTURE_3D):k.isDataArrayTexture||k.isCompressedArrayTexture?(N.setTexture2DArray(k,0),et=O.TEXTURE_2D_ARRAY):(N.setTexture2D(k,0),et=O.TEXTURE_2D),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,k.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,k.unpackAlignment);const ke=O.getParameter(O.UNPACK_ROW_LENGTH),ft=O.getParameter(O.UNPACK_IMAGE_HEIGHT),At=O.getParameter(O.UNPACK_SKIP_PIXELS),ht=O.getParameter(O.UNPACK_SKIP_ROWS),at=O.getParameter(O.UNPACK_SKIP_IMAGES);O.pixelStorei(O.UNPACK_ROW_LENGTH,We.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,We.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,le),O.pixelStorei(O.UNPACK_SKIP_ROWS,ae),O.pixelStorei(O.UNPACK_SKIP_IMAGES,ue);const Je=w.isDataArrayTexture||w.isData3DTexture,wt=k.isDataArrayTexture||k.isData3DTexture;if(w.isDepthTexture){const Ft=Ue.get(w),xt=Ue.get(k),St=Ue.get(Ft.__renderTarget),Br=Ue.get(xt.__renderTarget);Ie.bindFramebuffer(O.READ_FRAMEBUFFER,St.__webglFramebuffer),Ie.bindFramebuffer(O.DRAW_FRAMEBUFFER,Br.__webglFramebuffer);for(let Yn=0;Yn<ne;Yn++)Je&&(O.framebufferTextureLayer(O.READ_FRAMEBUFFER,O.COLOR_ATTACHMENT0,Ue.get(w).__webglTexture,L,ue+Yn),O.framebufferTextureLayer(O.DRAW_FRAMEBUFFER,O.COLOR_ATTACHMENT0,Ue.get(k).__webglTexture,V,Pe+Yn)),O.blitFramebuffer(le,ae,q,K,xe,ye,q,K,O.DEPTH_BUFFER_BIT,O.NEAREST);Ie.bindFramebuffer(O.READ_FRAMEBUFFER,null),Ie.bindFramebuffer(O.DRAW_FRAMEBUFFER,null)}else if(L!==0||w.isRenderTargetTexture||Ue.has(w)){const Ft=Ue.get(w),xt=Ue.get(k);Ie.bindFramebuffer(O.READ_FRAMEBUFFER,M),Ie.bindFramebuffer(O.DRAW_FRAMEBUFFER,H);for(let St=0;St<ne;St++)Je?O.framebufferTextureLayer(O.READ_FRAMEBUFFER,O.COLOR_ATTACHMENT0,Ft.__webglTexture,L,ue+St):O.framebufferTexture2D(O.READ_FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,Ft.__webglTexture,L),wt?O.framebufferTextureLayer(O.DRAW_FRAMEBUFFER,O.COLOR_ATTACHMENT0,xt.__webglTexture,V,Pe+St):O.framebufferTexture2D(O.DRAW_FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_2D,xt.__webglTexture,V),L!==0?O.blitFramebuffer(le,ae,q,K,xe,ye,q,K,O.COLOR_BUFFER_BIT,O.NEAREST):wt?O.copyTexSubImage3D(et,V,xe,ye,Pe+St,le,ae,q,K):O.copyTexSubImage2D(et,V,xe,ye,le,ae,q,K);Ie.bindFramebuffer(O.READ_FRAMEBUFFER,null),Ie.bindFramebuffer(O.DRAW_FRAMEBUFFER,null)}else wt?w.isDataTexture||w.isData3DTexture?O.texSubImage3D(et,V,xe,ye,Pe,q,K,ne,Oe,De,We.data):k.isCompressedArrayTexture?O.compressedTexSubImage3D(et,V,xe,ye,Pe,q,K,ne,Oe,We.data):O.texSubImage3D(et,V,xe,ye,Pe,q,K,ne,Oe,De,We):w.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,V,xe,ye,q,K,Oe,De,We.data):w.isCompressedTexture?O.compressedTexSubImage2D(O.TEXTURE_2D,V,xe,ye,We.width,We.height,Oe,We.data):O.texSubImage2D(O.TEXTURE_2D,V,xe,ye,q,K,Oe,De,We);O.pixelStorei(O.UNPACK_ROW_LENGTH,ke),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,ft),O.pixelStorei(O.UNPACK_SKIP_PIXELS,At),O.pixelStorei(O.UNPACK_SKIP_ROWS,ht),O.pixelStorei(O.UNPACK_SKIP_IMAGES,at),V===0&&k.generateMipmaps&&O.generateMipmap(et),Ie.unbindTexture()},this.copyTextureToTexture3D=function(w,k,I=null,G=null,L=0){return ar('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(w,k,I,G,L)},this.initRenderTarget=function(w){Ue.get(w).__webglFramebuffer===void 0&&N.setupRenderTarget(w)},this.initTexture=function(w){w.isCubeTexture?N.setTextureCube(w,0):w.isData3DTexture?N.setTexture3D(w,0):w.isDataArrayTexture||w.isCompressedArrayTexture?N.setTexture2DArray(w,0):N.setTexture2D(w,0),Ie.unbindTexture()},this.resetState=function(){_=0,B=0,P=null,Ie.reset(),Qe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Dn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=ct._getDrawingBufferColorSpace(e),t.unpackColorSpace=ct._getUnpackColorSpace()}}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var Zt=Uint8Array,Fi=Uint16Array,qS=Int32Array,ud=new Zt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fd=new Zt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),XS=new Zt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),md=function(n,e){for(var t=new Fi(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var o=new qS(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)o[r]=r-t[i]<<5|i;return{b:t,r:o}},pd=md(ud,2),xd=pd.b,KS=pd.r;xd[28]=258,KS[258]=28;var YS=md(fd,0),$S=YS.b,ss=new Fi(32768);for(var bt=0;bt<32768;++bt){var Vn=(bt&43690)>>1|(bt&21845)<<1;Vn=(Vn&52428)>>2|(Vn&13107)<<2,Vn=(Vn&61680)>>4|(Vn&3855)<<4,ss[bt]=((Vn&65280)>>8|(Vn&255)<<8)>>1}var ho=(function(n,e,t){for(var i=n.length,o=0,r=new Fi(e);o<i;++o)n[o]&&++r[n[o]-1];var l=new Fi(e);for(o=1;o<e;++o)l[o]=l[o-1]+r[o-1]<<1;var h;if(t){h=new Fi(1<<e);var c=15-e;for(o=0;o<i;++o)if(n[o])for(var d=o<<4|n[o],u=e-n[o],f=l[n[o]-1]++<<u,m=f|(1<<u)-1;f<=m;++f)h[ss[f]>>c]=d}else for(h=new Fi(i),o=0;o<i;++o)n[o]&&(h[o]=ss[l[n[o]-1]++]>>15-n[o]);return h}),wo=new Zt(288);for(var bt=0;bt<144;++bt)wo[bt]=8;for(var bt=144;bt<256;++bt)wo[bt]=9;for(var bt=256;bt<280;++bt)wo[bt]=7;for(var bt=280;bt<288;++bt)wo[bt]=8;var gd=new Zt(32);for(var bt=0;bt<32;++bt)gd[bt]=5;var ZS=ho(wo,9,1),QS=ho(gd,5,1),aa=function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},ln=function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},sa=function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},jS=function(n){return(n+7)/8|0},e9=function(n,e,t){return(t==null||t>n.length)&&(t=n.length),new Zt(n.subarray(e,t))},t9=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],hn=function(n,e,t){var i=new Error(e||t9[n]);if(i.code=n,Error.captureStackTrace&&Error.captureStackTrace(i,hn),!t)throw i;return i},n9=function(n,e,t,i){var o=n.length,r=0;if(!o||e.f&&!e.l)return t||new Zt(0);var l=!t,h=l||e.i!=2,c=e.i;l&&(t=new Zt(o*3));var d=function(rt){var lt=t.length;if(rt>lt){var Xe=new Zt(Math.max(lt*2,rt));Xe.set(t),t=Xe}},u=e.f||0,f=e.p||0,m=e.b||0,p=e.l,b=e.d,E=e.m,g=e.n,x=o*8;do{if(!p){u=ln(n,f,1);var T=ln(n,f+1,3);if(f+=3,T)if(T==1)p=ZS,b=QS,E=9,g=5;else if(T==2){var _=ln(n,f,31)+257,B=ln(n,f+10,15)+4,P=_+ln(n,f+5,31)+1;f+=14;for(var A=new Zt(P),S=new Zt(19),R=0;R<B;++R)S[XS[R]]=ln(n,f+R*3,7);f+=B*3;for(var U=aa(S),z=(1<<U)-1,J=ho(S,U,1),R=0;R<P;){var Y=J[ln(n,f,z)];f+=Y&15;var C=Y>>4;if(C<16)A[R++]=C;else{var X=0,ee=0;for(C==16?(ee=3+ln(n,f,3),f+=2,X=A[R-1]):C==17?(ee=3+ln(n,f,7),f+=3):C==18&&(ee=11+ln(n,f,127),f+=7);ee--;)A[R++]=X}}var $=A.subarray(0,_),he=A.subarray(_);E=aa($),g=aa(he),p=ho($,E,1),b=ho(he,g,1)}else hn(1);else{var C=jS(f)+4,y=n[C-4]|n[C-3]<<8,F=C+y;if(F>o){c&&hn(0);break}h&&d(m+y),t.set(n.subarray(C,F),m),e.b=m+=y,e.p=f=F*8,e.f=u;continue}if(f>x){c&&hn(0);break}}h&&d(m+131072);for(var fe=(1<<E)-1,re=(1<<g)-1,ve=f;;ve=f){var X=p[sa(n,f)&fe],Ge=X>>4;if(f+=X&15,f>x){c&&hn(0);break}if(X||hn(2),Ge<256)t[m++]=Ge;else if(Ge==256){ve=f,p=null;break}else{var Z=Ge-254;if(Ge>264){var R=Ge-257,ge=ud[R];Z=ln(n,f,(1<<ge)-1)+xd[R],f+=ge}var ce=b[sa(n,f)&re],me=ce>>4;ce||hn(3),f+=ce&15;var he=$S[me];if(me>3){var ge=fd[me];he+=sa(n,f)&(1<<ge)-1,f+=ge}if(f>x){c&&hn(0);break}h&&d(m+131072);var _e=m+Z;if(m<he){var we=r-he,Ne=Math.min(he,_e);for(we+m<0&&hn(3);m<Ne;++m)t[m]=i[we+m]}for(;m<_e;++m)t[m]=t[m-he]}}e.l=p,e.p=ve,e.b=m,e.f=u,p&&(u=1,e.m=E,e.d=b,e.n=g)}while(!u);return m!=t.length&&l?e9(t,0,m):t.subarray(0,m)},i9=new Zt(0),o9=function(n,e){return((n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31)&&hn(6,"invalid zlib data"),(n[1]>>5&1)==1&&hn(6,"invalid zlib data: "+(n[1]&32?"need":"unexpected")+" dictionary"),(n[1]>>3&4)+2};function Zo(n,e){return n9(n.subarray(o9(n),-4),{i:2},e,e)}var r9=typeof TextDecoder<"u"&&new TextDecoder,a9=0;try{r9.decode(i9,{stream:!0}),a9=1}catch{}class s9 extends a1{constructor(e){super(e),this.type=Jt}parse(e){const A=Math.pow(2.7182818,2.2);function S(v,M){let H=0;for(let k=0;k<65536;++k)(k==0||v[k>>3]&1<<(k&7))&&(M[H++]=k);const w=H-1;for(;H<65536;)M[H++]=0;return w}function R(v){for(let M=0;M<16384;M++)v[M]={},v[M].len=0,v[M].lit=0,v[M].p=null}const U={l:0,c:0,lc:0};function z(v,M,H,w,k){for(;H<v;)M=M<<8|Te(w,k),H+=8;H-=v,U.l=M>>H&(1<<v)-1,U.c=M,U.lc=H}const J=new Array(59);function Y(v){for(let H=0;H<=58;++H)J[H]=0;for(let H=0;H<65537;++H)J[v[H]]+=1;let M=0;for(let H=58;H>0;--H){const w=M+J[H]>>1;J[H]=M,M=w}for(let H=0;H<65537;++H){const w=v[H];w>0&&(v[H]=w|J[w]++<<6)}}function X(v,M,H,w,k,I){const G=M;let L=0,V=0;for(;w<=k;w++){if(G.value-M.value>H)return!1;z(6,L,V,v,G);const q=U.l;if(L=U.c,V=U.lc,I[w]=q,q==63){if(G.value-M.value>H)throw new Error("Something wrong with hufUnpackEncTable");z(8,L,V,v,G);let K=U.l+6;if(L=U.c,V=U.lc,w+K>k+1)throw new Error("Something wrong with hufUnpackEncTable");for(;K--;)I[w++]=0;w--}else if(q>=59){let K=q-59+2;if(w+K>k+1)throw new Error("Something wrong with hufUnpackEncTable");for(;K--;)I[w++]=0;w--}}Y(I)}function ee(v){return v&63}function $(v){return v>>6}function he(v,M,H,w){for(;M<=H;M++){const k=$(v[M]),I=ee(v[M]);if(k>>I)throw new Error("Invalid table entry");if(I>14){const G=w[k>>I-14];if(G.len)throw new Error("Invalid table entry");if(G.lit++,G.p){const L=G.p;G.p=new Array(G.lit);for(let V=0;V<G.lit-1;++V)G.p[V]=L[V]}else G.p=new Array(1);G.p[G.lit-1]=M}else if(I){let G=0;for(let L=1<<14-I;L>0;L--){const V=w[(k<<14-I)+G];if(V.len||V.p)throw new Error("Invalid table entry");V.len=I,V.lit=M,G++}}}return!0}const fe={c:0,lc:0};function re(v,M,H,w){v=v<<8|Te(H,w),M+=8,fe.c=v,fe.lc=M}const ve={c:0,lc:0};function Ge(v,M,H,w,k,I,G,L,V){if(v==M){w<8&&(re(H,w,k,I),H=fe.c,w=fe.lc),w-=8;let q=H>>w;if(q=new Uint8Array([q])[0],L.value+q>V)return!1;const K=G[L.value-1];for(;q-- >0;)G[L.value++]=K}else if(L.value<V)G[L.value++]=v;else return!1;ve.c=H,ve.lc=w}function Z(v){return v&65535}function ge(v){const M=Z(v);return M>32767?M-65536:M}const ce={a:0,b:0};function me(v,M){const H=ge(v),k=ge(M),I=H+(k&1)+(k>>1),G=I,L=I-k;ce.a=G,ce.b=L}function _e(v,M){const H=Z(v),w=Z(M),k=H-(w>>1)&65535,I=w+k-32768&65535;ce.a=I,ce.b=k}function we(v,M,H,w,k,I,G){const L=G<16384,V=H>k?k:H;let q=1,K,ne;for(;q<=V;)q<<=1;for(q>>=1,K=q,q>>=1;q>=1;){ne=0;const le=ne+I*(k-K),ae=I*q,ue=I*K,xe=w*q,ye=w*K;let Pe,We,Oe,De;for(;ne<=le;ne+=ue){let et=ne;const ke=ne+w*(H-K);for(;et<=ke;et+=ye){const ft=et+xe,At=et+ae,ht=At+xe;L?(me(v[et+M],v[At+M]),Pe=ce.a,Oe=ce.b,me(v[ft+M],v[ht+M]),We=ce.a,De=ce.b,me(Pe,We),v[et+M]=ce.a,v[ft+M]=ce.b,me(Oe,De),v[At+M]=ce.a,v[ht+M]=ce.b):(_e(v[et+M],v[At+M]),Pe=ce.a,Oe=ce.b,_e(v[ft+M],v[ht+M]),We=ce.a,De=ce.b,_e(Pe,We),v[et+M]=ce.a,v[ft+M]=ce.b,_e(Oe,De),v[At+M]=ce.a,v[ht+M]=ce.b)}if(H&q){const ft=et+ae;L?me(v[et+M],v[ft+M]):_e(v[et+M],v[ft+M]),Pe=ce.a,v[ft+M]=ce.b,v[et+M]=Pe}}if(k&q){let et=ne;const ke=ne+w*(H-K);for(;et<=ke;et+=ye){const ft=et+xe;L?me(v[et+M],v[ft+M]):_e(v[et+M],v[ft+M]),Pe=ce.a,v[ft+M]=ce.b,v[et+M]=Pe}}K=q,q>>=1}return ne}function Ne(v,M,H,w,k,I,G,L,V){let q=0,K=0;const ne=G,le=Math.trunc(w.value+(k+7)/8);for(;w.value<le;)for(re(q,K,H,w),q=fe.c,K=fe.lc;K>=14;){const ue=q>>K-14&16383,xe=M[ue];if(xe.len)K-=xe.len,Ge(xe.lit,I,q,K,H,w,L,V,ne),q=ve.c,K=ve.lc;else{if(!xe.p)throw new Error("hufDecode issues");let ye;for(ye=0;ye<xe.lit;ye++){const Pe=ee(v[xe.p[ye]]);for(;K<Pe&&w.value<le;)re(q,K,H,w),q=fe.c,K=fe.lc;if(K>=Pe&&$(v[xe.p[ye]])==(q>>K-Pe&(1<<Pe)-1)){K-=Pe,Ge(xe.p[ye],I,q,K,H,w,L,V,ne),q=ve.c,K=ve.lc;break}}if(ye==xe.lit)throw new Error("hufDecode issues")}}const ae=8-k&7;for(q>>=ae,K-=ae;K>0;){const ue=M[q<<14-K&16383];if(ue.len)K-=ue.len,Ge(ue.lit,I,q,K,H,w,L,V,ne),q=ve.c,K=ve.lc;else throw new Error("hufDecode issues")}return!0}function rt(v,M,H,w,k,I){const G={value:0},L=H.value,V=He(M,H),q=He(M,H);H.value+=4;const K=He(M,H);if(H.value+=4,V<0||V>=65537||q<0||q>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const ne=new Array(65537),le=new Array(16384);R(le);const ae=w-(H.value-L);if(X(v,H,ae,V,q,ne),K>8*(w-(H.value-L)))throw new Error("Something wrong with hufUncompress");he(ne,V,q,le),Ne(ne,le,v,H,K,q,I,k,G)}function lt(v,M,H){for(let w=0;w<H;++w)M[w]=v[M[w]]}function Xe(v){for(let M=1;M<v.length;M++){const H=v[M-1]+v[M]-128;v[M]=H}}function O(v,M){let H=0,w=Math.floor((v.length+1)/2),k=0;const I=v.length-1;for(;!(k>I||(M[k++]=v[H++],k>I));)M[k++]=v[w++]}function pt(v){let M=v.byteLength;const H=new Array;let w=0;const k=new DataView(v);for(;M>0;){const I=k.getInt8(w++);if(I<0){const G=-I;M-=G+1;for(let L=0;L<G;L++)H.push(k.getUint8(w++))}else{const G=I;M-=2;const L=k.getUint8(w++);for(let V=0;V<G+1;V++)H.push(L)}}return H}function Ye(v,M,H,w,k,I){let G=new DataView(I.buffer);const L=H[v.idx[0]].width,V=H[v.idx[0]].height,q=3,K=Math.floor(L/8),ne=Math.ceil(L/8),le=Math.ceil(V/8),ae=L-(ne-1)*8,ue=V-(le-1)*8,xe={value:0},ye=new Array(q),Pe=new Array(q),We=new Array(q),Oe=new Array(q),De=new Array(q);for(let ke=0;ke<q;++ke)De[ke]=M[v.idx[ke]],ye[ke]=ke<1?0:ye[ke-1]+ne*le,Pe[ke]=new Float32Array(64),We[ke]=new Uint16Array(64),Oe[ke]=new Uint16Array(ne*64);for(let ke=0;ke<le;++ke){let ft=8;ke==le-1&&(ft=ue);let At=8;for(let at=0;at<ne;++at){at==ne-1&&(At=ae);for(let Je=0;Je<q;++Je)We[Je].fill(0),We[Je][0]=k[ye[Je]++],Ke(xe,w,We[Je]),Ie(We[Je],Pe[Je]),it(Pe[Je]);Ue(Pe);for(let Je=0;Je<q;++Je)N(Pe[Je],Oe[Je],at*64)}let ht=0;for(let at=0;at<q;++at){const Je=H[v.idx[at]].type;for(let wt=8*ke;wt<8*ke+ft;++wt){ht=De[at][wt];for(let Ft=0;Ft<K;++Ft){const xt=Ft*64+(wt&7)*8;G.setUint16(ht+0*Je,Oe[at][xt+0],!0),G.setUint16(ht+2*Je,Oe[at][xt+1],!0),G.setUint16(ht+4*Je,Oe[at][xt+2],!0),G.setUint16(ht+6*Je,Oe[at][xt+3],!0),G.setUint16(ht+8*Je,Oe[at][xt+4],!0),G.setUint16(ht+10*Je,Oe[at][xt+5],!0),G.setUint16(ht+12*Je,Oe[at][xt+6],!0),G.setUint16(ht+14*Je,Oe[at][xt+7],!0),ht+=16*Je}}if(K!=ne)for(let wt=8*ke;wt<8*ke+ft;++wt){const Ft=De[at][wt]+8*K*2*Je,xt=K*64+(wt&7)*8;for(let St=0;St<At;++St)G.setUint16(Ft+St*2*Je,Oe[at][xt+St],!0)}}}const et=new Uint16Array(L);G=new DataView(I.buffer);for(let ke=0;ke<q;++ke){H[v.idx[ke]].decoded=!0;const ft=H[v.idx[ke]].type;if(H[ke].type==2)for(let At=0;At<V;++At){const ht=De[ke][At];for(let at=0;at<L;++at)et[at]=G.getUint16(ht+at*2*ft,!0);for(let at=0;at<L;++at)G.setFloat32(ht+at*2*ft,te(et[at]),!0)}}}function Ke(v,M,H){let w,k=1;for(;k<64;)w=M[v.value],w==65280?k=64:w>>8==255?k+=w&255:(H[k]=w,k++),v.value++}function Ie(v,M){M[0]=te(v[0]),M[1]=te(v[1]),M[2]=te(v[5]),M[3]=te(v[6]),M[4]=te(v[14]),M[5]=te(v[15]),M[6]=te(v[27]),M[7]=te(v[28]),M[8]=te(v[2]),M[9]=te(v[4]),M[10]=te(v[7]),M[11]=te(v[13]),M[12]=te(v[16]),M[13]=te(v[26]),M[14]=te(v[29]),M[15]=te(v[42]),M[16]=te(v[3]),M[17]=te(v[8]),M[18]=te(v[12]),M[19]=te(v[17]),M[20]=te(v[25]),M[21]=te(v[30]),M[22]=te(v[41]),M[23]=te(v[43]),M[24]=te(v[9]),M[25]=te(v[11]),M[26]=te(v[18]),M[27]=te(v[24]),M[28]=te(v[31]),M[29]=te(v[40]),M[30]=te(v[44]),M[31]=te(v[53]),M[32]=te(v[10]),M[33]=te(v[19]),M[34]=te(v[23]),M[35]=te(v[32]),M[36]=te(v[39]),M[37]=te(v[45]),M[38]=te(v[52]),M[39]=te(v[54]),M[40]=te(v[20]),M[41]=te(v[22]),M[42]=te(v[33]),M[43]=te(v[38]),M[44]=te(v[46]),M[45]=te(v[51]),M[46]=te(v[55]),M[47]=te(v[60]),M[48]=te(v[21]),M[49]=te(v[34]),M[50]=te(v[37]),M[51]=te(v[47]),M[52]=te(v[50]),M[53]=te(v[56]),M[54]=te(v[59]),M[55]=te(v[61]),M[56]=te(v[35]),M[57]=te(v[36]),M[58]=te(v[48]),M[59]=te(v[49]),M[60]=te(v[57]),M[61]=te(v[58]),M[62]=te(v[62]),M[63]=te(v[63])}function it(v){const M=.5*Math.cos(.7853975),H=.5*Math.cos(3.14159/16),w=.5*Math.cos(3.14159/8),k=.5*Math.cos(3*3.14159/16),I=.5*Math.cos(5*3.14159/16),G=.5*Math.cos(3*3.14159/8),L=.5*Math.cos(7*3.14159/16),V=new Array(4),q=new Array(4),K=new Array(4),ne=new Array(4);for(let le=0;le<8;++le){const ae=le*8;V[0]=w*v[ae+2],V[1]=G*v[ae+2],V[2]=w*v[ae+6],V[3]=G*v[ae+6],q[0]=H*v[ae+1]+k*v[ae+3]+I*v[ae+5]+L*v[ae+7],q[1]=k*v[ae+1]-L*v[ae+3]-H*v[ae+5]-I*v[ae+7],q[2]=I*v[ae+1]-H*v[ae+3]+L*v[ae+5]+k*v[ae+7],q[3]=L*v[ae+1]-I*v[ae+3]+k*v[ae+5]-H*v[ae+7],K[0]=M*(v[ae+0]+v[ae+4]),K[3]=M*(v[ae+0]-v[ae+4]),K[1]=V[0]+V[3],K[2]=V[1]-V[2],ne[0]=K[0]+K[1],ne[1]=K[3]+K[2],ne[2]=K[3]-K[2],ne[3]=K[0]-K[1],v[ae+0]=ne[0]+q[0],v[ae+1]=ne[1]+q[1],v[ae+2]=ne[2]+q[2],v[ae+3]=ne[3]+q[3],v[ae+4]=ne[3]-q[3],v[ae+5]=ne[2]-q[2],v[ae+6]=ne[1]-q[1],v[ae+7]=ne[0]-q[0]}for(let le=0;le<8;++le)V[0]=w*v[16+le],V[1]=G*v[16+le],V[2]=w*v[48+le],V[3]=G*v[48+le],q[0]=H*v[8+le]+k*v[24+le]+I*v[40+le]+L*v[56+le],q[1]=k*v[8+le]-L*v[24+le]-H*v[40+le]-I*v[56+le],q[2]=I*v[8+le]-H*v[24+le]+L*v[40+le]+k*v[56+le],q[3]=L*v[8+le]-I*v[24+le]+k*v[40+le]-H*v[56+le],K[0]=M*(v[le]+v[32+le]),K[3]=M*(v[le]-v[32+le]),K[1]=V[0]+V[3],K[2]=V[1]-V[2],ne[0]=K[0]+K[1],ne[1]=K[3]+K[2],ne[2]=K[3]-K[2],ne[3]=K[0]-K[1],v[0+le]=ne[0]+q[0],v[8+le]=ne[1]+q[1],v[16+le]=ne[2]+q[2],v[24+le]=ne[3]+q[3],v[32+le]=ne[3]-q[3],v[40+le]=ne[2]-q[2],v[48+le]=ne[1]-q[1],v[56+le]=ne[0]-q[0]}function Ue(v){for(let M=0;M<64;++M){const H=v[0][M],w=v[1][M],k=v[2][M];v[0][M]=H+1.5747*k,v[1][M]=H-.1873*w-.4682*k,v[2][M]=H+1.8556*w}}function N(v,M,H){for(let w=0;w<64;++w)M[H+w]=wh.toHalfFloat(D(v[w]))}function D(v){return v<=1?Math.sign(v)*Math.pow(Math.abs(v),2.2):Math.sign(v)*Math.pow(A,Math.abs(v)-1)}function j(v){return new DataView(v.array.buffer,v.offset.value,v.size)}function se(v){const M=v.viewer.buffer.slice(v.offset.value,v.offset.value+v.size),H=new Uint8Array(pt(M)),w=new Uint8Array(H.length);return Xe(H),O(H,w),new DataView(w.buffer)}function pe(v){const M=v.array.slice(v.offset.value,v.offset.value+v.size),H=Zo(M),w=new Uint8Array(H.length);return Xe(H),O(H,w),new DataView(w.buffer)}function oe(v){const M=v.viewer,H={value:v.offset.value},w=new Uint16Array(v.columns*v.lines*(v.inputChannels.length*v.type)),k=new Uint8Array(8192);let I=0;const G=new Array(v.inputChannels.length);for(let ue=0,xe=v.inputChannels.length;ue<xe;ue++)G[ue]={},G[ue].start=I,G[ue].end=G[ue].start,G[ue].nx=v.columns,G[ue].ny=v.lines,G[ue].size=v.type,I+=G[ue].nx*G[ue].ny*G[ue].size;const L=ie(M,H),V=ie(M,H);if(V>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(L<=V)for(let ue=0;ue<V-L+1;ue++)k[ue+L]=Ze(M,H);const q=new Uint16Array(65536),K=S(k,q),ne=He(M,H);rt(v.array,M,H,ne,w,I);for(let ue=0;ue<v.inputChannels.length;++ue){const xe=G[ue];for(let ye=0;ye<G[ue].size;++ye)we(w,xe.start+ye,xe.nx,xe.size,xe.ny,xe.nx*xe.size,K)}lt(q,w,I);let le=0;const ae=new Uint8Array(w.buffer.byteLength);for(let ue=0;ue<v.lines;ue++)for(let xe=0;xe<v.inputChannels.length;xe++){const ye=G[xe],Pe=ye.nx*ye.size,We=new Uint8Array(w.buffer,ye.end*2,Pe*2);ae.set(We,le),le+=Pe*2,ye.end+=Pe}return new DataView(ae.buffer)}function Le(v){const M=v.array.slice(v.offset.value,v.offset.value+v.size),H=Zo(M),w=v.inputChannels.length*v.lines*v.columns*v.totalBytes,k=new ArrayBuffer(w),I=new DataView(k);let G=0,L=0;const V=new Array(4);for(let q=0;q<v.lines;q++)for(let K=0;K<v.inputChannels.length;K++){let ne=0;switch(v.inputChannels[K].pixelType){case 1:V[0]=G,V[1]=V[0]+v.columns,G=V[1]+v.columns;for(let ae=0;ae<v.columns;++ae){const ue=H[V[0]++]<<8|H[V[1]++];ne+=ue,I.setUint16(L,ne,!0),L+=2}break;case 2:V[0]=G,V[1]=V[0]+v.columns,V[2]=V[1]+v.columns,G=V[2]+v.columns;for(let ae=0;ae<v.columns;++ae){const ue=H[V[0]++]<<24|H[V[1]++]<<16|H[V[2]++]<<8;ne+=ue,I.setUint32(L,ne,!0),L+=4}break}}return I}function Ce(v){const M=v.viewer,H={value:v.offset.value},w=new Uint8Array(v.columns*v.lines*(v.inputChannels.length*v.type*2)),k={version:Ve(M,H),unknownUncompressedSize:Ve(M,H),unknownCompressedSize:Ve(M,H),acCompressedSize:Ve(M,H),dcCompressedSize:Ve(M,H),rleCompressedSize:Ve(M,H),rleUncompressedSize:Ve(M,H),rleRawSize:Ve(M,H),totalAcUncompressedCount:Ve(M,H),totalDcUncompressedCount:Ve(M,H),acCompression:Ve(M,H)};if(k.version<2)throw new Error("EXRLoader.parse: "+bn.compression+" version "+k.version+" is unsupported");const I=new Array;let G=ie(M,H)-2;for(;G>0;){const xe=ze(M.buffer,H),ye=Ze(M,H),Pe=ye>>2&3,We=(ye>>4)-1,Oe=new Int8Array([We])[0],De=Ze(M,H);I.push({name:xe,index:Oe,type:De,compression:Pe}),G-=xe.length+3}const L=bn.channels,V=new Array(v.inputChannels.length);for(let xe=0;xe<v.inputChannels.length;++xe){const ye=V[xe]={},Pe=L[xe];ye.name=Pe.name,ye.compression=0,ye.decoded=!1,ye.type=Pe.pixelType,ye.pLinear=Pe.pLinear,ye.width=v.columns,ye.height=v.lines}const q={idx:new Array(3)};for(let xe=0;xe<v.inputChannels.length;++xe){const ye=V[xe];for(let Pe=0;Pe<I.length;++Pe){const We=I[Pe];ye.name==We.name&&(ye.compression=We.compression,We.index>=0&&(q.idx[We.index]=xe),ye.offset=xe)}}let K,ne,le;if(k.acCompressedSize>0)switch(k.acCompression){case 0:K=new Uint16Array(k.totalAcUncompressedCount),rt(v.array,M,H,k.acCompressedSize,K,k.totalAcUncompressedCount);break;case 1:const xe=v.array.slice(H.value,H.value+k.totalAcUncompressedCount),ye=Zo(xe);K=new Uint16Array(ye.buffer),H.value+=k.totalAcUncompressedCount;break}if(k.dcCompressedSize>0){const xe={array:v.array,offset:H,size:k.dcCompressedSize};ne=new Uint16Array(pe(xe).buffer),H.value+=k.dcCompressedSize}if(k.rleRawSize>0){const xe=v.array.slice(H.value,H.value+k.rleCompressedSize),ye=Zo(xe);le=pt(ye.buffer),H.value+=k.rleCompressedSize}let ae=0;const ue=new Array(V.length);for(let xe=0;xe<ue.length;++xe)ue[xe]=new Array;for(let xe=0;xe<v.lines;++xe)for(let ye=0;ye<V.length;++ye)ue[ye].push(ae),ae+=V[ye].width*v.type*2;Ye(q,ue,V,K,ne,w);for(let xe=0;xe<V.length;++xe){const ye=V[xe];if(!ye.decoded)switch(ye.compression){case 2:let Pe=0,We=0;for(let Oe=0;Oe<v.lines;++Oe){let De=ue[xe][Pe];for(let et=0;et<ye.width;++et){for(let ke=0;ke<2*ye.type;++ke)w[De++]=le[We+ke*ye.width*ye.height];We++}Pe++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(w.buffer)}function ze(v,M){const H=new Uint8Array(v);let w=0;for(;H[M.value+w]!=0;)w+=1;const k=new TextDecoder().decode(H.slice(M.value,M.value+w));return M.value=M.value+w+1,k}function qe(v,M,H){const w=new TextDecoder().decode(new Uint8Array(v).slice(M.value,M.value+H));return M.value=M.value+H,w}function be(v,M){const H=Re(v,M),w=He(v,M);return[H,w]}function Fe(v,M){const H=He(v,M),w=He(v,M);return[H,w]}function Re(v,M){const H=v.getInt32(M.value,!0);return M.value=M.value+4,H}function He(v,M){const H=v.getUint32(M.value,!0);return M.value=M.value+4,H}function Te(v,M){const H=v[M.value];return M.value=M.value+1,H}function Ze(v,M){const H=v.getUint8(M.value);return M.value=M.value+1,H}const Ve=function(v,M){let H;return"getBigInt64"in DataView.prototype?H=Number(v.getBigInt64(M.value,!0)):H=v.getUint32(M.value+4,!0)+Number(v.getUint32(M.value,!0)<<32),M.value+=8,H};function Qe(v,M){const H=v.getFloat32(M.value,!0);return M.value+=4,H}function W(v,M){return wh.toHalfFloat(Qe(v,M))}function te(v){const M=(v&31744)>>10,H=v&1023;return(v>>15?-1:1)*(M?M===31?H?NaN:1/0:Math.pow(2,M-15)*(1+H/1024):6103515625e-14*(H/1024))}function ie(v,M){const H=v.getUint16(M.value,!0);return M.value+=2,H}function de(v,M){return te(ie(v,M))}function Be(v,M,H,w){const k=H.value,I=[];for(;H.value<k+w-1;){const G=ze(M,H),L=Re(v,H),V=Ze(v,H);H.value+=3;const q=Re(v,H),K=Re(v,H);I.push({name:G,pixelType:L,pLinear:V,xSampling:q,ySampling:K})}return H.value+=1,I}function Ae(v,M){const H=Qe(v,M),w=Qe(v,M),k=Qe(v,M),I=Qe(v,M),G=Qe(v,M),L=Qe(v,M),V=Qe(v,M),q=Qe(v,M);return{redX:H,redY:w,greenX:k,greenY:I,blueX:G,blueY:L,whiteX:V,whiteY:q}}function je(v,M){const H=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],w=Ze(v,M);return H[w]}function yt(v,M){const H=Re(v,M),w=Re(v,M),k=Re(v,M),I=Re(v,M);return{xMin:H,yMin:w,xMax:k,yMax:I}}function Tt(v,M){const H=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],w=Ze(v,M);return H[w]}function ut(v,M){const H=["ENVMAP_LATLONG","ENVMAP_CUBE"],w=Ze(v,M);return H[w]}function zt(v,M){const H=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],w=["ROUND_DOWN","ROUND_UP"],k=He(v,M),I=He(v,M),G=Ze(v,M);return{xSize:k,ySize:I,levelMode:H[G&15],roundingMode:w[G>>4]}}function on(v,M){const H=Qe(v,M),w=Qe(v,M);return[H,w]}function Co(v,M){const H=Qe(v,M),w=Qe(v,M),k=Qe(v,M);return[H,w,k]}function Ao(v,M,H,w,k){if(w==="string"||w==="stringvector"||w==="iccProfile")return qe(M,H,k);if(w==="chlist")return Be(v,M,H,k);if(w==="chromaticities")return Ae(v,H);if(w==="compression")return je(v,H);if(w==="box2i")return yt(v,H);if(w==="envmap")return ut(v,H);if(w==="tiledesc")return zt(v,H);if(w==="lineOrder")return Tt(v,H);if(w==="float")return Qe(v,H);if(w==="v2f")return on(v,H);if(w==="v3f")return Co(v,H);if(w==="int")return Re(v,H);if(w==="rational")return be(v,H);if(w==="timecode")return Fe(v,H);if(w==="preview")return H.value+=k,"skipped";H.value+=k}function gn(v,M){const H=Math.log2(v);return M=="ROUND_DOWN"?Math.floor(H):Math.ceil(H)}function Xi(v,M,H){let w=0;switch(v.levelMode){case"ONE_LEVEL":w=1;break;case"MIPMAP_LEVELS":w=gn(Math.max(M,H),v.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return w}function Ki(v,M,H,w){const k=new Array(v);for(let I=0;I<v;I++){const G=1<<I;let L=M/G|0;w=="ROUND_UP"&&L*G<M&&(L+=1);const V=Math.max(L,1);k[I]=(V+H-1)/H|0}return k}function So(){const v=this,M=v.offset,H={value:0};for(let w=0;w<v.tileCount;w++){const k=Re(v.viewer,M),I=Re(v.viewer,M);M.value+=8,v.size=He(v.viewer,M);const G=k*v.blockWidth,L=I*v.blockHeight;v.columns=G+v.blockWidth>v.width?v.width-G:v.blockWidth,v.lines=L+v.blockHeight>v.height?v.height-L:v.blockHeight;const V=v.columns*v.totalBytes,K=v.size<v.lines*V?v.uncompress(v):j(v);M.value+=v.size;for(let ne=0;ne<v.lines;ne++){const le=ne*v.columns*v.totalBytes;for(let ae=0;ae<v.inputChannels.length;ae++){const ue=bn.channels[ae].name,xe=v.channelByteOffsets[ue]*v.columns,ye=v.decodeChannels[ue];if(ye===void 0)continue;H.value=le+xe;const Pe=(v.height-(1+L+ne))*v.outLineWidth;for(let We=0;We<v.columns;We++){const Oe=Pe+(We+G)*v.outputChannels+ye;v.byteArray[Oe]=v.getter(K,H)}}}}}function ci(){const v=this,M=v.offset,H={value:0};for(let w=0;w<v.height/v.blockHeight;w++){const k=Re(v.viewer,M)-bn.dataWindow.yMin;v.size=He(v.viewer,M),v.lines=k+v.blockHeight>v.height?v.height-k:v.blockHeight;const I=v.columns*v.totalBytes,L=v.size<v.lines*I?v.uncompress(v):j(v);M.value+=v.size;for(let V=0;V<v.blockHeight;V++){const q=w*v.blockHeight,K=V+v.scanOrder(q);if(K>=v.height)continue;const ne=V*I,le=(v.height-1-K)*v.outLineWidth;for(let ae=0;ae<v.inputChannels.length;ae++){const ue=bn.channels[ae].name,xe=v.channelByteOffsets[ue]*v.columns,ye=v.decodeChannels[ue];if(ye!==void 0){H.value=ne+xe;for(let Pe=0;Pe<v.columns;Pe++){const We=le+Pe*v.outputChannels+ye;v.byteArray[We]=v.getter(L,H)}}}}}}function Bo(v,M,H){const w={};if(v.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");w.version=v.getUint8(4);const k=v.getUint8(5);w.spec={singleTile:!!(k&2),longName:!!(k&4),deepFormat:!!(k&8),multiPart:!!(k&16)},H.value=8;let I=!0;for(;I;){const G=ze(M,H);if(G==="")I=!1;else{const L=ze(M,H),V=He(v,H),q=Ao(v,M,H,L,V);q===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${L}'.`):w[G]=q}}if((k&-7)!=0)throw console.error("THREE.EXRHeader:",w),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return w}function di(v,M,H,w,k){const I={size:0,viewer:M,array:H,offset:w,width:v.dataWindow.xMax-v.dataWindow.xMin+1,height:v.dataWindow.yMax-v.dataWindow.yMin+1,inputChannels:v.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:Kn};switch(v.compression){case"NO_COMPRESSION":I.blockHeight=1,I.uncompress=j;break;case"RLE_COMPRESSION":I.blockHeight=1,I.uncompress=se;break;case"ZIPS_COMPRESSION":I.blockHeight=1,I.uncompress=pe;break;case"ZIP_COMPRESSION":I.blockHeight=16,I.uncompress=pe;break;case"PIZ_COMPRESSION":I.blockHeight=32,I.uncompress=oe;break;case"PXR24_COMPRESSION":I.blockHeight=16,I.uncompress=Le;break;case"DWAA_COMPRESSION":I.blockHeight=32,I.uncompress=Ce;break;case"DWAB_COMPRESSION":I.blockHeight=256,I.uncompress=Ce;break;default:throw new Error("EXRLoader.parse: "+v.compression+" is unsupported")}const G={};for(const K of v.channels)switch(K.name){case"Y":case"R":case"G":case"B":case"A":G[K.name]=!0,I.type=K.pixelType}let L=!1;if(G.R&&G.G&&G.B)L=!G.A,I.outputChannels=4,I.decodeChannels={R:0,G:1,B:2,A:3};else if(G.Y)I.outputChannels=1,I.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(I.type==1)switch(k){case Qt:I.getter=de;break;case Jt:I.getter=ie;break}else if(I.type==2)switch(k){case Qt:I.getter=Qe;break;case Jt:I.getter=W}else throw new Error("EXRLoader.parse: unsupported pixelType "+I.type+" for "+v.compression+".");I.columns=I.width;const V=I.width*I.height*I.outputChannels;switch(k){case Qt:I.byteArray=new Float32Array(V),L&&I.byteArray.fill(1,0,V);break;case Jt:I.byteArray=new Uint16Array(V),L&&I.byteArray.fill(15360,0,V);break;default:console.error("THREE.EXRLoader: unsupported type: ",k);break}let q=0;for(const K of v.channels)I.decodeChannels[K.name]!==void 0&&(I.channelByteOffsets[K.name]=q),q+=K.pixelType*2;if(I.totalBytes=q,I.outLineWidth=I.width*I.outputChannels,v.lineOrder==="INCREASING_Y"?I.scanOrder=K=>K:I.scanOrder=K=>I.height-1-K,I.outputChannels==4?(I.format=jt,I.colorSpace=Kn):(I.format=As,I.colorSpace=_n),v.spec.singleTile){I.blockHeight=v.tiles.ySize,I.blockWidth=v.tiles.xSize;const K=Xi(v.tiles,I.width,I.height),ne=Ki(K,I.width,v.tiles.xSize,v.tiles.roundingMode),le=Ki(K,I.height,v.tiles.ySize,v.tiles.roundingMode);I.tileCount=ne[0]*le[0];for(let ae=0;ae<K;ae++)for(let ue=0;ue<le[ae];ue++)for(let xe=0;xe<ne[ae];xe++)Ve(M,w);I.decode=So.bind(I)}else{I.blockWidth=I.width;const K=Math.ceil(I.height/I.blockHeight);for(let ne=0;ne<K;ne++)Ve(M,w);I.decode=ci.bind(I)}return I}const Yi={value:0},$i=new DataView(e),Sr=new Uint8Array(e),bn=Bo($i,e,Yi),Nn=di(bn,$i,Sr,Yi,this.type);return Nn.decode(),{header:bn,width:Nn.width,height:Nn.height,data:Nn.byteArray,format:Nn.format,colorSpace:Nn.colorSpace,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,i,o){function r(l,h){l.colorSpace=h.colorSpace,l.minFilter=Lt,l.magFilter=Lt,l.generateMipmaps=!1,l.flipY=!1,t&&t(l,h)}return super.load(e,r,i,o)}}const lr={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Eo{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const l9=new ad(-1,1,1,-1,0,1);class h9 extends Rn{constructor(){super(),this.setAttribute("position",new nn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new nn([0,2,0,0,2,0],2))}}const c9=new h9;class bd{constructor(e){this._mesh=new en(c9,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,l9)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class yd extends Eo{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof Ht?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=gr.clone(e.uniforms),this.material=new Ht({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new bd(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class jh extends Eo{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const o=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let l,h;this.inverse?(l=0,h=1):(l=1,h=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),r.buffers.stencil.setFunc(o.ALWAYS,l,4294967295),r.buffers.stencil.setClear(h),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(o.EQUAL,1,4294967295),r.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),r.buffers.stencil.setLocked(!0)}}class d9 extends Eo{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class u9{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new $e);this._width=i.width,this._height=i.height,t=new dn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Jt}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new yd(lr),this.copyPass.material.blending=Mn,this.clock=new l1}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let o=0,r=this.passes.length;o<r;o++){const l=this.passes[o];if(l.enabled!==!1){if(l.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(o),l.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),l.needsSwap){if(i){const h=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(h.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(h.EQUAL,1,4294967295)}this.swapBuffers()}jh!==void 0&&(l instanceof jh?i=!0:l instanceof d9&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new $e);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget1.setSize(i,o),this.renderTarget2.setSize(i,o);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class f9 extends Eo{constructor(e,t,i=null,o=null,r=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=o,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new st}render(e,t,i){const o=e.autoClear;e.autoClear=!1;let r,l;this.overrideMaterial!==null&&(l=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(r),this.overrideMaterial!==null&&(this.scene.overrideMaterial=l),e.autoClear=o}}const m9={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new st(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class Gi extends Eo{constructor(e,t=1,i,o){super(),this.strength=t,this.radius=i,this.threshold=o,this.resolution=e!==void 0?new $e(e.x,e.y):new $e(256,256),this.clearColor=new st(0,0,0),this.needsSwap=!1,this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let r=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.renderTargetBright=new dn(r,l,{type:Jt}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let u=0;u<this.nMips;u++){const f=new dn(r,l,{type:Jt});f.texture.name="UnrealBloomPass.h"+u,f.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(f);const m=new dn(r,l,{type:Jt});m.texture.name="UnrealBloomPass.v"+u,m.texture.generateMipmaps=!1,this.renderTargetsVertical.push(m),r=Math.round(r/2),l=Math.round(l/2)}const h=m9;this.highPassUniforms=gr.clone(h.uniforms),this.highPassUniforms.luminosityThreshold.value=o,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new Ht({uniforms:this.highPassUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader}),this.separableBlurMaterials=[];const c=[3,5,7,9,11];r=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this._getSeparableBlurMaterial(c[u])),this.separableBlurMaterials[u].uniforms.invSize.value=new $e(1/r,1/l),r=Math.round(r/2),l=Math.round(l/2);this.compositeMaterial=this._getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1;const d=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=d,this.bloomTintColors=[new Q(1,1,1),new Q(1,1,1),new Q(1,1,1),new Q(1,1,1),new Q(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,this.copyUniforms=gr.clone(lr.uniforms),this.blendMaterial=new Ht({uniforms:this.copyUniforms,vertexShader:lr.vertexShader,fragmentShader:lr.fragmentShader,blending:ba,depthTest:!1,depthWrite:!1,transparent:!0}),this._oldClearColor=new st,this._oldClearAlpha=1,this._basic=new Ds,this._fsQuad=new bd(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this._basic.dispose(),this._fsQuad.dispose()}setSize(e,t){let i=Math.round(e/2),o=Math.round(t/2);this.renderTargetBright.setSize(i,o);for(let r=0;r<this.nMips;r++)this.renderTargetsHorizontal[r].setSize(i,o),this.renderTargetsVertical[r].setSize(i,o),this.separableBlurMaterials[r].uniforms.invSize.value=new $e(1/i,1/o),i=Math.round(i/2),o=Math.round(o/2)}render(e,t,i,o,r){e.getClearColor(this._oldClearColor),this._oldClearAlpha=e.getClearAlpha();const l=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),r&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this._fsQuad.material=this._basic,this._basic.map=i.texture,e.setRenderTarget(null),e.clear(),this._fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=i.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this._fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this._fsQuad.render(e);let h=this.renderTargetBright;for(let c=0;c<this.nMips;c++)this._fsQuad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=h.texture,this.separableBlurMaterials[c].uniforms.direction.value=Gi.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),this._fsQuad.render(e),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=Gi.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),this._fsQuad.render(e),h=this.renderTargetsVertical[c];this._fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this._fsQuad.render(e),this._fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,r&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(i),this._fsQuad.render(e)),e.setClearColor(this._oldClearColor,this._oldClearAlpha),e.autoClear=l}_getSeparableBlurMaterial(e){const t=[];for(let i=0;i<e;i++)t.push(.39894*Math.exp(-.5*i*i/(e*e))/e);return new Ht({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new $e(.5,.5)},direction:{value:new $e(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}_getCompositeMaterial(e){return new Ht({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}Gi.BlurDirectionX=new $e(1,0);Gi.BlurDirectionY=new $e(0,1);const p9={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new $e(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		#define EDGE_STEP_COUNT 6
		#define EDGE_GUESS 8.0
		#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0
		const float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );

		float _ContrastThreshold = 0.0312;
		float _RelativeThreshold = 0.063;
		float _SubpixelBlending = 1.0;

		vec4 Sample( sampler2D  tex2D, vec2 uv ) {

			return texture( tex2D, uv );

		}

		float SampleLuminance( sampler2D tex2D, vec2 uv ) {

			return dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );

		}

		float SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {

			uv += texSize * vec2(uOffset, vOffset);
			return SampleLuminance(tex2D, uv);

		}

		struct LuminanceData {

			float m, n, e, s, w;
			float ne, nw, se, sw;
			float highest, lowest, contrast;

		};

		LuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData l;
			l.m = SampleLuminance( tex2D, uv );
			l.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );
			l.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );
			l.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );
			l.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );

			l.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );
			l.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );
			l.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );
			l.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );

			l.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );
			l.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );
			l.contrast = l.highest - l.lowest;
			return l;

		}

		bool ShouldSkipPixel( LuminanceData l ) {

			float threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );
			return l.contrast < threshold;

		}

		float DeterminePixelBlendFactor( LuminanceData l ) {

			float f = 2.0 * ( l.n + l.e + l.s + l.w );
			f += l.ne + l.nw + l.se + l.sw;
			f *= 1.0 / 12.0;
			f = abs( f - l.m );
			f = clamp( f / l.contrast, 0.0, 1.0 );

			float blendFactor = smoothstep( 0.0, 1.0, f );
			return blendFactor * blendFactor * _SubpixelBlending;

		}

		struct EdgeData {

			bool isHorizontal;
			float pixelStep;
			float oppositeLuminance, gradient;

		};

		EdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {

			EdgeData e;
			float horizontal =
				abs( l.n + l.s - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.se - 2.0 * l.e ) +
				abs( l.nw + l.sw - 2.0 * l.w );
			float vertical =
				abs( l.e + l.w - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.nw - 2.0 * l.n ) +
				abs( l.se + l.sw - 2.0 * l.s );
			e.isHorizontal = horizontal >= vertical;

			float pLuminance = e.isHorizontal ? l.n : l.e;
			float nLuminance = e.isHorizontal ? l.s : l.w;
			float pGradient = abs( pLuminance - l.m );
			float nGradient = abs( nLuminance - l.m );

			e.pixelStep = e.isHorizontal ? texSize.y : texSize.x;

			if (pGradient < nGradient) {

				e.pixelStep = -e.pixelStep;
				e.oppositeLuminance = nLuminance;
				e.gradient = nGradient;

			} else {

				e.oppositeLuminance = pLuminance;
				e.gradient = pGradient;

			}

			return e;

		}

		float DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {

			vec2 uvEdge = uv;
			vec2 edgeStep;
			if (e.isHorizontal) {

				uvEdge.y += e.pixelStep * 0.5;
				edgeStep = vec2( texSize.x, 0.0 );

			} else {

				uvEdge.x += e.pixelStep * 0.5;
				edgeStep = vec2( 0.0, texSize.y );

			}

			float edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;
			float gradientThreshold = e.gradient * 0.25;

			vec2 puv = uvEdge + edgeStep * edgeSteps[0];
			float pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
			bool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {

				puv += edgeStep * edgeSteps[i];
				pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
				pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			}

			if ( !pAtEnd ) {

				puv += edgeStep * EDGE_GUESS;

			}

			vec2 nuv = uvEdge - edgeStep * edgeSteps[0];
			float nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
			bool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {

				nuv -= edgeStep * edgeSteps[i];
				nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
				nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			}

			if ( !nAtEnd ) {

				nuv -= edgeStep * EDGE_GUESS;

			}

			float pDistance, nDistance;
			if ( e.isHorizontal ) {

				pDistance = puv.x - uv.x;
				nDistance = uv.x - nuv.x;

			} else {

				pDistance = puv.y - uv.y;
				nDistance = uv.y - nuv.y;

			}

			float shortestDistance;
			bool deltaSign;
			if ( pDistance <= nDistance ) {

				shortestDistance = pDistance;
				deltaSign = pLuminanceDelta >= 0.0;

			} else {

				shortestDistance = nDistance;
				deltaSign = nLuminanceDelta >= 0.0;

			}

			if ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {

				return 0.0;

			}

			return 0.5 - shortestDistance / ( pDistance + nDistance );

		}

		vec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );
			if ( ShouldSkipPixel( luminance ) ) {

				return Sample( tex2D, uv );

			}

			float pixelBlend = DeterminePixelBlendFactor( luminance );
			EdgeData edge = DetermineEdge( texSize, luminance );
			float edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );
			float finalBlend = max( pixelBlend, edgeBlend );

			if (edge.isHorizontal) {

				uv.y += edge.pixelStep * finalBlend;

			} else {

				uv.x += edge.pixelStep * finalBlend;

			}

			return Sample( tex2D, uv );

		}

		void main() {

			gl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );

		}`};/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const x9=`precision highp float;

in vec3 position;

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.);
}`,g9=`precision highp float;

out vec4 fragmentColor;

uniform vec2 resolution;
uniform float rand;

void main() {
  float aspectRatio = resolution.x / resolution.y; 
  vec2 vUv = gl_FragCoord.xy / resolution;
  float noise = (fract(sin(dot(vUv, vec2(12.9898 + rand,78.233)*2.0)) * 43758.5453));

  vUv -= .5;
  vUv.x *= aspectRatio;

  float factor = 4.;
  float d = factor * length(vUv);
  vec3 from = vec3(3.) / 255.;
  vec3 to = vec3(16., 12., 20.) / 2550.;

  fragmentColor = vec4(mix(from, to, d) + .005 * noise, 1.);
}
`;/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const b9=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
  varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

uniform float time;

uniform vec4 inputData;
uniform vec4 outputData;

vec3 calc( vec3 pos ) {

  vec3 dir = normalize( pos );
  vec3 p = dir + vec3( time, 0., 0. );
  return pos +
    1. * inputData.x * inputData.y * dir * (.5 + .5 * sin(inputData.z * pos.x + time)) +
    1. * outputData.x * outputData.y * dir * (.5 + .5 * sin(outputData.z * pos.y + time))
  ;
}

vec3 spherical( float r, float theta, float phi ) {
  return r * vec3(
    cos( theta ) * cos( phi ),
    sin( theta ) * cos( phi ),
    sin( phi )
  );
}

void main() {
  #include <uv_vertex>
  #include <color_vertex>
  #include <morphinstance_vertex>
  #include <morphcolor_vertex>
  #include <batching_vertex>
  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinbase_vertex>
  #include <skinnormal_vertex>
  #include <defaultnormal_vertex>
  #include <normal_vertex>
  #include <begin_vertex>

  float inc = 0.001;

  float r = length( position );
  float theta = ( uv.x + 0.5 ) * 2. * PI;
  float phi = -( uv.y + 0.5 ) * PI;

  vec3 np = calc( spherical( r, theta, phi )  );

  vec3 tangent = normalize( calc( spherical( r, theta + inc, phi ) ) - np );
  vec3 bitangent = normalize( calc( spherical( r, theta, phi + inc ) ) - np );
  transformedNormal = -normalMatrix * normalize( cross( tangent, bitangent ) );

  vNormal = normalize( transformedNormal );

  transformed = np;

  #include <morphtarget_vertex>
  #include <skinning_vertex>
  #include <displacementmap_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>
  vViewPosition = - mvPosition.xyz;
  #include <worldpos_vertex>
  #include <shadowmap_vertex>
  #include <fog_vertex>
  #ifdef USE_TRANSMISSION
    vWorldPosition = worldPosition.xyz;
  #endif
}`;var y9=cs('<canvas class="svelte-8eyrkw"></canvas>');function v9(n,e){hs(e,!0);let t=Nt(void 0),i=Nt(void 0),o=Nt(void 0),r,l,h,c,d=0,u=new Q(0,0,0);ls(()=>f()),cr(()=>{e.inputNode&&Mt(i,new ih(e.inputNode),!0)}),cr(()=>{e.outputNode&&Mt(o,new ih(e.outputNode),!0)});const f=()=>{const b=new Kw;b.background=new st(1051668),l=new en(new br(10,5),new Qw({uniforms:{resolution:{value:new $e(1,1)},rand:{value:0}},vertexShader:x9,fragmentShader:g9,glslVersion:is})),l.material.side=Gt,b.add(l),r=new $t(75,window.innerWidth/window.innerHeight,.1,1e3),r.position.set(2,-2,5);const E=new JS({canvas:Se(t),antialias:!1});E.setSize(window.innerWidth,window.innerHeight),E.setPixelRatio(window.devicePixelRatio/1);const g=new br(1,10);new s9().load("piz_compressed.exr",B=>{B.mapping=fr;const P=x.fromEquirectangular(B);T.envMap=P.texture,c.visible=!0});const x=new rs(E);x.compileEquirectangularShader();const T=new jw({color:16,metalness:.5,roughness:.1,emissive:16,emissiveIntensity:1.5});T.onBeforeCompile=B=>{B.uniforms.time={value:0},B.uniforms.inputData={value:new vt},B.uniforms.outputData={value:new vt},T.userData.shader=B,B.vertexShader=b9},c=new en(g,T),b.add(c),c.visible=!1;const C=new f9(b,r),y=new Gi(new $e(window.innerWidth,window.innerHeight),5,.5,0),F=new yd(p9);h=new u9(E),h.addPass(C),h.addPass(y);const _=()=>{r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix();const B=E.getPixelRatio(),P=window.innerWidth,A=window.innerHeight;l.material.uniforms.resolution.value.set(P*B,A*B),E.setSize(P,A),h.setSize(P,A),F.material.uniforms.resolution.value.set(1/(P*B),1/(A*B))};window.addEventListener("resize",_),_(),m()},m=()=>{if(requestAnimationFrame(m),!Se(i)||!Se(o)){h&&h.render();return}Se(i).update(),Se(o).update();const b=performance.now(),E=(b-d)/(1e3/60);d=b;const g=l.material,x=c.material;if(g.uniforms.rand.value=Math.random()*1e4,x.userData.shader){c.scale.setScalar(1+.2*Se(o).data[1]/255);const T=.001;u.x+=E*T*.5*Se(o).data[1]/255,u.z+=E*T*.5*Se(i).data[1]/255,u.y+=E*T*.25*Se(i).data[2]/255,u.y+=E*T*.25*Se(o).data[2]/255;const C=new un(u.x,u.y,u.z),y=new Ji().setFromEuler(C),F=new Q(0,0,5);F.applyQuaternion(y),r.position.copy(F),r.lookAt(c.position),x.userData.shader.uniforms.time.value+=E*.1*Se(o).data[0]/255,x.userData.shader.uniforms.inputData.value.set(1*Se(i).data[0]/255,.1*Se(i).data[1]/255,10*Se(i).data[2]/255,0),x.userData.shader.uniforms.outputData.value.set(2*Se(o).data[0]/255,.1*Se(o).data[1]/255,10*Se(o).data[2]/255,0)}h.render()};var p=y9();Qo(p,b=>Mt(t,b),()=>Se(t)),ds(n,p),us()}const w9=`The Project Gutenberg EBook of Johann Sebastian Bach by
Johann Nikolaus Forkel and Charles Sanford Terry


This eBook is for the use of anyone anywhere at no cost
and with almost no restrictions whatsoever. You may copy
it, give it away or re-use it under the terms of the Project
Gutenberg License included with this eBook or online at
[http://www.gutenberg.org/license](http://www.gutenberg.org/license)


Title: Johann Sebastian Bach


Author: Johann Nikolaus Forkel and Charles Sanford Terry


Release Date: January 24, 2011 [Ebook 35041]


Language: English


***START OF THE PROJECT GUTENBERG EBOOK

JOHANN SEBASTIAN BACH

***


_Johann Sebastian Bach. About 1720. (From the picture by_
_Johann Jakob Ihle, in the Bach Museum, Eisenach)._


## Johann Sebastian Bach

His Life, Art and Work. Translated from the German of Johann Nikolaus Forkel. With notes and appendices by Charles
Sanford Terry, Litt.D. Cantab.


Johann Nikolaus Forkel and Charles Sanford Terry


Harcourt, Brace and Howe, New York

1920


# Contents

Introduction . . . . . . . . . . . . . . . . . . . . . . . . . xi

FORKEL'S PREFACE . . . . . . . . . . . . . . . . . . . xxi

CHAPTER I. THE FAMILY OF BACH . . . . . . . . . . 3

Chapter II. THE CAREER OF BACH . . . . . . . . . . . 11
CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 . . . . . 31

CHAPTER III. BACH AS A CLAVIER PLAYER . . . . 47

CHAPTER IV. BACH THE ORGANIST . . . . . . . . . 57

CHAPTER V. BACH THE COMPOSER . . . . . . . . . 65

CHAPTER VI. BACH THE COMPOSER (continued) . . 73

CHAPTER VII. BACH AS A TEACHER . . . . . . . . . 83

CHAPTER VIII. PERSONAL CHARACTERISTICS . . . 95

CHAPTER IX. BACH'S COMPOSITIONS . . . . . . . . 101

CHAPTER X. BACH'S MANUSCRIPTS . . . . . . . . . 125

CHAPTER XI. THE GENIUS OF BACH . . . . . . . . . 129

APPENDIX I. CHRONOLOGICAL CATALOGUE OF

BACH'S COMPOSITIONS . . . . . . . . . . . . . . . 137

APPENDIX II. THE CHURCH CANTATAS AR
RANGED CHRONOLOGICALLY . . . . . . . . . . 151

APPENDIX III. THE BACHGESELLSCHAFT EDI
TIONS OF BACH'S WORKS . . . . . . . . . . . . . . 299

APPENDIX IV. BIBLIOGRAPHY OF BACH LITERA
TURE . . . . . . . . . . . . . . . . . . . . . . . . . . 369

APPENDIX V. A COLLATION OF THE NOVELLO

AND PETERS EDITIONS OF THE ORGAN WORKS 377

APPENDIX VI. GENEALOGY OF THE FAMILY OF

BACH . . . . . . . . . . . . . . . . . . . . . . . . . . 389

Footnotes . . . . . . . . . . . . . . . . . . . . . . . . . . 389


# Illustrations

_Johann Sebastian Bach. About 1720. (From the picture by_
_Johann Jakob Ihle, in the Bach Museum, Eisenach)._ . . iii

Bach's Home at Eisenach . . . . . . . . . . . . . . . . . . 9

The Church and School of St. Thomas, Leipzig, in 1723. . 29
Johann Sebastian Bach, circa 1746. _From the picture by_
_Haussmann._ . . . . . . . . . . . . . . . . . . . . . . . 45

Divided Harmony, Bach treatment . . . . . . . . . . . . . 59
Divided Harmony, conventional treatment . . . . . . . . . 59
The Bach Statue at Eisenach . . . . . . . . . . . . . . . . 72

Johann Sebastian Bach. _From the picture discovered by_
_Professor Fritz Volbach_ . . . . . . . . . . . . . . . . . 82
The Bach Statue at Leipzig . . . . . . . . . . . . . . . . . 133
Genealogy Table, p. 303 . . . . . . . . . . . . . . . . . . 390
Genealogy Table, p. 304 . . . . . . . . . . . . . . . . . . 391
Genealogy Table, p. 305 . . . . . . . . . . . . . . . . . . 392
Genealogy Table, p. 306 . . . . . . . . . . . . . . . . . . 393
Genealogy Table, p. 307 . . . . . . . . . . . . . . . . . . 394
Genealogy Table, p. 308 . . . . . . . . . . . . . . . . . . 395
Genealogy Table, p. 309 . . . . . . . . . . . . . . . . . . 396
Genealogy Table, p. 310 . . . . . . . . . . . . . . . . . . 397


# Introduction


[ix]

Johann Nikolaus Forkel, author of the monograph of which the
following pages afford a translation, was born at Meeder, a
small village in Saxe-Coburg, on February 22, 1749, seventeen
months before the death of Johann Sebastian Bach, whose first
biographer he became. Presumably he would have followed the
craft of his father, the village shoemaker, had not an insatiable
love of music seized him in early years. He obtained books,
and studied them with the village schoolmaster. In particular
he profited by the Vollkommener Kapellmeister of Johann
Mattheson, of Hamburg, the sometime friend of Handel. Like
Handel, he found a derelict Clavier in the attic of his home and
acquired proficiency upon it. Forkel's professional career, like
Bach's half a century earlier, began at Lneburg, where, at the
age of thirteen (1762), he was admitted to the choir of the parish
church. Thence, at the age of seventeen (1766), he proceeded to
Schwerin as Chorprfect, and enjoyed the favour of the Grand
Duke. Three years later he betook himself (1769), at the age of
twenty, to the University of Gttingen, which he entered as a [x]
law student, though a slender purse compelled him to give music
lessons for a livelihood. He used his opportunity to acquire
a knowledge of modern languages, which stood him in good
stead later, when his researches required him to explore foreign
literatures. Concurrently he pursued his musical activities, and
in 1774 published at Gttingen his first work, _Ueber die Theorie_
_der Musik,_ advocating the foundation of a music lectureship in
the University. Four years later (1778) he was appointed its
Director of Music, and from 1779 to 1815 conducted the weekly
concerts of the Sing-Akademie. In 1780 he received from the
University the doctorate of philosophy. The rest of his life was


xii Johann Sebastian Bach


spent at Gttingen, where he died on March 17, 1818, having
just completed his sixty-ninth year.

That Forkel is remembered at all is due solely to his monograph
on Bach. Written at a time when Bach's greatness was realised
in hardly any quarter, the book claimed for him pre-eminence
which a tardily enlightened world since has conceded him. By his
generation Forkel was esteemed chiefly for his literary activity,
critical ability, and merit as a composer. His principal work,
_Allgemeine Geschichte der Musik,_ was published in two volumes
at Leipzig in 1788 and 1801. Carl Friedrich Zelter, Goethe's
friend and correspondent, dismissed the book contemptuously as

[xi] that of an author who had set out to write a history of music,
but came to an end just where the history of music begins.
Forkel's work, in fact, breaks off at the sixteenth century. But
the curtailed _History_ cleared the way for the monograph on
Bach, a more valuable contribution to the literature of music.
Forkel already had published, in three volumes, at Gotha in 1778,
his _Musikalisch-kritische Bibliothek,_ and in 1792 completed his
critical studies by publishing at Leipzig his _Allgemeine Literatur_
_der Musik._

Forkel was also a student of the music of the polyphonic
school. He prepared for the press the scores of a number of
sixteenth century Masses, Motets, etc., and fortunately received
proofs of them from the engraver. For, in 1806, after the
Battle of Jena, the French impounded the plates and melted them
down. Forkel's proofs are still preserved in the Berlin Royal
Library. He was diligent in quest of Bach's scattered MSS., and
his friendship with Bach's elder sons, Carl Philipp Emmanuel
and Wilhelm Friedemann, enabled him to secure precious relics
which otherwise might have shared the fate of too many of Bach's
manuscripts. He took an active interest in the proposal of Messrs.
Hoffmeister and Khnel, predecessors of C. F. Peters at Leipzig,
to print a kritisch-korrecte edition of Bach's Organ and Clavier
works. Through his friend, Johann Gottfried Schicht, afterwards


Introduction xiii


Cantor at St. Thomas's, Leipzig, he was also associated with [xii]
Breitkopf and Haertel's publication of five of Bach's six extant
Motets in 1802-3.

As a composer Forkel has long ceased to be remembered. His
works include two Oratorios, _Hiskias_ (1789) and _Die Hirten_
_bey der Krippe_ ; four Cantatas for chorus and orchestra; Clavier
Concertos, and many Sonatas and Variations for the Harpsichord.
In 1802, for reasons which he explains in his Preface, Forkel
published from Hoffmeister and Khnel's Bureau de Musique
his _Ueber Johann Sebastian Bachs Leben, Kunst und Kunstwerke._
_Fr patriotische Verehrer echter musikalischer Kunst,_ of which
a new edition was issued by Peters in 1856. The original edition
bears a dedication to Gottfried Baron van Swieten [1] (1734-1803),
Prefect of the Royal Library, Vienna, and sometime Austrian
Ambassador in Berlin, a friend of Haydn and Mozart, patron of
Beethoven, a man whose age allowed him to have seen Bach,
and whose career makes the association with Bach that Forkel's

dedication gives him not undeserved. It was he, an ardent Bach
enthusiast, who introduced the youthful Mozart to the music of
the Leipzig Cantor. I go every Sunday at twelve o'clock to the
Baron van Swieten, Mozart writes in 1782, where nothing is
played but Handel and Bach, and I am now making a collection [xiii]
of the Fugues of Bach. The merit and limitations of Forkel's
book will be considered later. For the moment the fact deserves

emphasis that, inadequate as it is, it presented a fuller picture of
Bach than so far had been drawn, and was the first to render the
homage due to his genius.
In an illuminating chapter (xii.), _Death and Resurrection_,
Schweitzer has told the story of the neglect that obscured Bach's
memory after his death in 1750. Isolated voices, raised here and
there, acclaimed his genius. With Bach's treatise on _The Art of_
_Fugue_ before him, Johann Mattheson (1681-1664), the foremost


1 Seiner Excellenz dem Freyheren van Swieten ehrerbietigst gewidmet von
dem Verfasser.


xiv Johann Sebastian Bach


critic of the day, claimed that Germany was the true home of
Organ music and Fugue. Friedrich Wilhelm Marpurg (1718-95),
the famous Berlin theorist, expressed the same opinion in his
preface to the edition of that work published shortly after Bach's
death. But such appreciations were rare. Little of Bach's music
was in print and available for performance or critical judgment.
Even at St. Thomas's, Leipzig, it suffered almost complete
neglect until a generation after Forkel's death. The bulk of Bach's
MSS. was divided among his family, and Forkel himself, with
unrivalled opportunity to acquaint himself with the dimensions
of Bach's industry, knew little of his music except the Organ and

[xiv] Clavier compositions.

In these circumstances it is not strange that Bach's memory
waited for more than half a century for a biographer. Forkel,
however, was not the first to assemble the known facts of Bach's
career or to assert his place in the music of Germany.

Putting aside Johann Gottfried Walther's brief epitome in his
_Lexikon_ (1732), the first and most important of the early notices
of Bach was the obituary article, or Nekrolog, contributed by
his son, Carl Philipp Emmanuel, and Johann Friedrich Agricola,
one of Bach's most distinguished pupils, to the fourth volume
of Mizler's _Musikalische Bibliothek,_ published at Leipzig in
1754. The authors of this appreciation give it an intimacy which
renders it precious. But Mizler's periodical was the organ of a
small Society, of which Bach had been a member, and outside
its associates can have done little to extend a knowledge of the
subject of the memoir.

Johann Friedrich Agricola contributed notes on Bach to
Jakob Adlung's _Musica mechanica Organoedi,_ published in
two volumes at Berlin in 1768. The article is valuable chiefly for
Agricola's exposition of Bach's opinions upon Organ and Clavier
building.

With the intention to represent him as the coryphaeus of all
organists, Johann Adam Hiller, who a few years later became


Introduction xv


Cantor at St. Thomas's, Leipzig, published there in 1784 a
brief account of Bach in his _Lebensbeschreibungen berhmter_ [xv]
_Musikgelehrten und Tonknstler neuerer Zeit._
Four years after Hiller's notice, Ernst Ludwig Gerber
published at Leipzig, in two volumes, 1790-92, his _Historisch-_
_biographische Lexikon der Tonknstler._ As in Hiller's case,
Gerber, whose father had been Bach's pupil, was chiefly
interested in Bach as an organist.
Coincidently with Gerber, another of Bach's pupils, Johann
Martin Schubart, who succeeded him at Weimar in 1717,
sketched his characteristics as a performer in the _Aesthetik_
_der Tonkunst_, published at Berlin by his son in the _Deutschen_
_Monatsschrift_ in 1793.
In 1794 appeared at Leipzig the first volume of a work
which Spitta characterises as fantastic and unreliable, so far as it
deals with Bach, Friedrich Carl Gottlieb Hirsching's _Historisch-_
_literarisches Handbuch_ of notable persons deceased in the
eighteenth century.
Last of Forkel's forerunners, A. E. L. Siebigke published at
Breslau in 1801 his _Museum deutscher Tonknstler,_ a work
which adds nothing to our knowledge of Bach's life, but offers
some remarks on his style.
Little, if any, information of value, therefore, had been added
to the _Nekrolog_ of 1754 when Forkel, in 1802, produced his
monograph on Bach and his music. Nor, viewed as a biography,
does Forkel much enlarge our knowledge of the conditions of [xvi]
Bach's life. He had the advantage of knowing Bach's elder sons,
but appears to have lacked curiosity regarding the circumstances
of Bach's career, and to have made no endeavour to add to his
imperfect information, even regarding his hero's life at Leipzig,
upon which it should have been easy for him to obtain details of
utmost interest. His monograph, in fact, is not a Life in the
biographic sense, but a critical appreciation of Bach as player,
teacher, and composer, based upon the Organ and Clavier works,


xvi Johann Sebastian Bach


with which alone Forkel was familiar.

It would be little profitable to weigh the value of Forkel's
criticism. We are tempted to the conclusion that Bach appealed
to him chiefly as a supreme master of technique, and our hearts
would open to him more widely did not his appreciation of
Bach march with a narrow depreciation of Haydn, Mozart, and
Beethoven, the last of whom, he declared ex cathedra, had not
produced a single work which can be called a masterpiece.
Gluck he frankly detested.

But Forkel's monograph is notable on other grounds. It was the
first to claim for Bach a place among the divinities. It used him
to stimulate a national sense in his own people. Bach's is the first
great voice from out of Germany since Luther. Of Germany's
own Kisorgimento, patently initiated by Goethe a generation

[xvii] after Johann Sebastian's death, Bach himself is the harbinger.
In his assertion of a distinctive German musical art he set an

example followed in turn by Mozart, Weber, and Wagner. With
Bach, wrote Wagner, the German Spirit was born anew. It is
Forkel's perpetual distinction that he grasped a fact hidden from
almost all but himself. In his Preface, and more emphatically in
the closing paragraph of his last Chapter, he presents Bach as the
herald of a German nation yet unformed.

It is a farther distinction of Forkel's monograph that it made
converts. With its publication the clouds of neglect that too
long had obscured Bach's grandeur began to melt away, until the
dizzy altitude of his genius stood revealed. The publication of
the five Motets (1803) was followed by that of the Magnificat
in 1811, and of the Mass in A in 1818. A beginning was made
with the Cantatas in 1821, when Breitkopf and Haertel published
Ein' feste Burg (No. 80), commended in an article written
(1822) by Johann Friedrich Rochlitz (1769-1842), the champion
of Beethoven, as now of Bach. Another enthusiastic pioneer
was Carl Friedrich Zelter (1758-1832), conductor of the Berlin
Sing-Akademie, who called Bach a sign of God, clear, yet


Introduction xvii


inexplicable. To him in large measure was due the memorable
revival of the _St. Matthew Passion_ at Berlin, which the youthful
Mendelssohn, Zelter's pupil, conducted in March 1829, exactly [xviii]
one hundred years after the first production of the mighty work
at Leipzig. In the following years it was given at Dresden
and many other German towns. Leipzig heard it again after a
barren interval in 1841, and did tardy homage to its incomparable
composer by erecting (1843) the statue that stands in the shadow
of St. Thomas's Church, hard by the Cantor's home for a quarter
of a century.

Meanwhile, in 1830 and 1831 the _St._ _Matthew Passion_
and _St._ _John Passion_ had been engraved, and by 1845 the
B minor Mass was in print. The credit of having revived it
belongs to Johann Nepomuk Schelble (1789-1837), conductor of
the Frankfort Caecilienverein, though the Berlin Sing-Akademie
was the first to give a performance, considerably curtailed, of
the whole work in 1835. A little later, in the middle of the
forties, Peters began to issue his kritisch-korrecte edition of
the Organ works, which at length made Bach widely known
among organists. But the publication of the Cantatas proceeded
slowly. Only fourteen of them were in print in 1850, when the
foundation of the Bachgesellschaft, on the centenary of Bach's
death, focused a world-wide homage. When it dissolved in 1900
its mission was accomplished, the entire works [2] of Bach were
published, and the vast range of his genius was patent to the [xix]
world.

It remains to discuss the first English version of Forkel's
monograph, published in 1820, with the following title-page:


LIFE OF JOHN SEBASTIAN BACH; with a Critical View

of his Compositions. By J. N. Forkel, Author of The Complete History of Music, etc., etc. Translated from the Ger

2 So far the New Bachgesellschaft has published only a single Cantata
overlooked by the old Society. See infra, p. 280.


xviii Johann Sebastian Bach


man. London: Printed for T. Boosey and Co., Holles-Street,
Cavendish-Square. 1820.


The book was published in February 1820; it was announced,
with a slightly differently worded title-page, in the _New Monthly_
_Magazine and Universal Register_ for March 1820 (p. 341), and
the _Scots Magazine_ for the same month ( vol. lxxxv. p. 263). The
_New Monthly_ states the price as 5s., the _Quarterly Review_ (vol.
xxiii. p. 281) as 6s. The book contains xi+116+3 pages of Music
Figures, crown octavo, bound in dark unlettered cloth. It has
neither Introduction, notes (other than Forkel's), nor indication
of the translator's identity. Much of the translation is so bad as
to suggest grave doubts of the translator's comprehension of the
German original; while his rendering of Forkel's critical chapters
rouses a strong suspicion that he also lacked technical equipment
adequate to his task. It is, in fact, difficult to understand how

[xx] such an unsatisfactory piece of work found its way into print.

The character of the 1820 translation has a close bearing
upon its authorship. In the article on Bach in the new _Grove_
it is attributed to Samuel Wesley (1766-1837), an attractive
suggestion, since Wesley was as enthusiastic a Bach pioneer in
this country as Forkel himself was in Germany. But the statement
is not correct. In Samuel Wesley's _Letters to Mr. Jacobs relating_
_to the Introduction into this Country of the Works of J. S._
_Bach_ (London, 1875) we find the clue. On October 17, 1808,
Wesley writes: We are (in the first place) preparing for the
Press an authentic and accurate Life of Sebastian, which Mr.
Stephenson the Banker (a most zealous and scientific member of
our Fraternity) has translated into English from the German of
Forkel.

Unfortunately, it is impossible to identify Stephenson
precisely, or to detect his activities in the musical circle in which
Wesley includes him. In 1820 there was in Lombard Street
a firm of bankers under the style of Remington, Stephenson,


Introduction xix


Remington, and Toulmin, the active partner being Mr. Rowland
Stephenson, a man of about forty in that year. The firm was
wound up in bankruptcy in 1829, Stephenson having absconded
to America the previous year. He appears to have been the only
banker of that name holding such a recognised position as Wesley
attributes to him, though it remains no more than a conjecture that
he was the author of the translation issued in 1820. [3] But whoever [xxi]
Stephenson the Banker may have been, the poverty of his
work fails to support Wesley's commendation of his scientific
equipment, and suggests that his purse rather than his talents
were serviceable to Wesley's missionary campaign.

For the facts of Bach's life, and as a record of his artistic
activities, Forkel admittedly is inadequate and often misleading.
Stephenson necessarily was without information to enable him
to correct or supplement his author. Recent research, and
particularly the classic volumes of Spitta and Schweitzer, have
placed the present generation in a more instructed and therefore
responsible position. The following pages, accordingly, have
been annotated copiously in order to bring Forkel into line with
modern scholarship. His own infrequent notes are invariably
indicated by a prefixed asterisk. It has been thought advisable to
write an addendum to Chapter II. in order to supplement Forkel
at the weakest point of his narrative.

Readers of Spitta's first volume probably will remember the
effort to follow the ramifications of the Bach pedigree unaided
by a genealogical Table. It is unfortunate that Spitta did not set [xxii]
out in that form the wealth of biographical material his pages
contain. To supply the deficiency, and to illustrate Forkel's first
Chapter, a complete Genealogical Table is provided in Appendix
VI., based mainly upon the biographical details scattered over


3 In _The News_ of January 4, 1829, he is described as the second son of the
late John Stephenson of Great Ormonde Street, Queen Square, whom he had
succeeded in the partnership of the firm. His wife was dead, and of his eight
children the eldest was also in the Bank.


xx Johann Sebastian Bach


Spitta's pages.
In Chapter IX. Forkel gives a list of Bach's compositions
known to him. It is, necessarily, incomplete. For that reason
Appendices I. and II. provide a full catalogue of Bach's works
arranged under the periods of his career. In the case of the
Oratorios, Cantatas, Motets, and Passions, it is not difficult to
distribute them upon a chronological basis. The Clavier works
also can be dated with some approximation to closeness. The
effort is more speculative in the case of the Organ music.
In his Preface Forkel suggests the institution of a Society for
the publication and study of Bach's works. The proposal was
adopted after half a century's interval, and in Appendix III. will be
found a complete and detailed catalogue of the publications of the
Old and New Bachgesellschaft from 1850 to 1918 inclusive. The
Society's issues for 1915-18 have not yet reached this country.
The present writer had an opportunity to examine them in the
Library of the Cologne Conservatorium of Music in the spring
of this year.
In this Introduction will be found a list of works bearing

[xxiii] on Bach, which preceded Forkel's monograph. Appendix IV.
provides a bibliography of Bach literature published subsequently
to it.

Grateful acknowledgment is made to Mr. Ivor Atkins, of
Worcester Cathedral, and to Mr. W. G. Whittaker, of Newcastleupon-Tyne, who have read these pages in proof, and improved
them by their criticism.

C. S. T.

October 1, 1919.


# FORKEL'S PREFACE

Many years ago I determined to give the public an account of
the life of Johann Sebastian Bach, with some reflections upon
his genius and his works. The brief article by Carl Philipp
Emmanuel Bach [4] and Herr Agricola, [5] formerly composer to the
Court of Prussia, contributed to the fourth volume of Mizler's
_Musical Library,_ [6] can hardly be deemed adequate by Bach's
admirers and, but for the desire to complete my _General History_ [xxv]
_of Music,_ [7] I should have fulfilled my purpose long ago. As Bach,
more than any other artist, represents an era in the history of
music, it was my intention to devote to the concluding volume of
that work the materials I had collected for a history of his career.


4 Carl Philipp Emmanuel Bach, third son of Johann Sebastian Bach, b. 1714;
Kammermusikus to Frederick the Great of Prussia (1746), Kapellmeister at
Hamburg (1768); d. 1788.
5 Johann Friedrich Agricola, of Dobitsch, b. 1720; studied composition
with Bach at Leipzig; Court Composer (1751) and, after Carl Heinrich Graun's
death (1759), Kapellmeister to Frederick the Great of Prussia; d. 1774. See
Spitta, _Johann Sebastian Bach,_ iii. 243 ff.
6 Lorenz Christoph Mizler (1711-78), a pupil of Bach, founded at Leipzig
in 1738 the Sozietat der musikalischen Wissenschaften, of which Bach and
Handel were members. Mizler's journal, the _Neuerffneter Musikalischer_
_Bibliothek,_ was its organ. It appeared from 1736 to 1754. In Part I. of vol.
iv. (1754) C. P. E. Bach and Agricola collaborated in the obituary notice, or
Nekrolog, which is almost the earliest literary authority for Bach's life. It
covered less than twenty pages. (See Schweitzer, _J. S. Bach_ (trans. Ernest
Newman), i. 189 ff. and Spitta, i. Pref.) Agricola's association with Bach's son
in the preparation of the obituary notice is explained by the fact that for the last
ten years of Sebastian's life Agricola was in closer relations with him than Carl
Philipp Emmanuel, who no longer was resident in Leipzig.
7 Forkel's _Allgemeine Geschichte der Musik_ (2 vols. 1788-1801) had only
come down to the sixteenth century when its author diverted his pen to a
biography of Bach.


xxii Johann Sebastian Bach


But the announcement that Messrs. Hoffmeister and Khnel, the
Leipzig music-sellers and publishers, propose to issue a complete
and critical edition of Bach's works has induced me to change
my original plan. [8]


Messrs. Hoffmeister and Knel's project promises at once to
advance the art of music and enhance the honour of the German

name. For Bach's works are a priceless national patrimony;
no other nation possesses a treasure comparable to it. Their
publication in an authoritative text will be a national service and
raise an imperishable monument to the composer himself. All
who hold Germany dear are bound in honour to promote the
undertaking to the utmost of their power. I deem it a duty to
remind the public of this obligation and to kindle interest in it in

[xxvi] every true German heart. To that end these pages appear earlier
than my original plan proposed; for they will enable me to reach
a larger number of my fellow countrymen. The section on Bach
in my _History of Music_ probably would have been read by a
handful of experts or musical artists. Here I hope to speak to
a larger audience. For, let me repeat, not merely the interests
of music but our national honour are concerned to rescue from

oblivion the memory of one of Germany's greatest sons.


One of the best and most effective means of popularising
musical masterpieces is to perform them in public. In that
way works of merit secure a widening audience. People listen
to them with pleasure in the concert room, church, or theatre,
remember the agreeable impression they created, and purchase
them when published, even though they cannot always play them.
But Bach's works unfortunately are rarely heard nowadays; for


8 The firm of Hoffmeister and Khnel was founded at Leipzig in 1800
by Franz Anton Hoffmeister, who started, in 1801, a subscription for the
publication of Bach's works, to which Forkel alludes. The scheme failed to
mature, and its accomplishment was reserved to C. F. Peters, who purchased
Hoffmeister's Bureau de Musique in 1814. See articles on Hoffmeister and
Peters in Grove's _Dictionary._


FORKEL'S PREFACE xxiii


the number of persons capable of playing them adequately
is at best inconsiderable. It would have been otherwise had
Bach given touring performances of his music, [9] a labour for
which he had neither time nor liking. Many of his pupils did
so, and though their skill was inferior to their master's, the
admiration and astonishment they excited revealed the grandeur [xxvii]
of his compositions. Here and there, too, were found persons
who desired to hear on their own instrument pieces which the
performer had played best or gave them most pleasure. They
could do so more easily for having heard how the piece ought to
sound.


But, to awaken a wide appreciation of musical masterpieces
depends upon the existence of good teachers. The want of them
is our chief difficulty. In order to safeguard their credit, the
ignorant and incompetent of their number are disposed to decry
good music, lest they should be asked to play it. Consequently,
their pupils, condemned to spend time, labour, and money on
second-rate material, will not after half a dozen years, perhaps,
show themselves farther advanced in sound musical appreciation
than they were at the outset. Whereas, under a good teacher, half
the time, labour, and money produces progressive improvement.
Time will show whether this obstacle can be surmounted by
making Bach's works accessible in the music shops and by
forming a Society among the admirers of his genius to make
them known and promote their study. [10] [xxviii]


9 Though Bach never ventured upon such tours as Mozart or Berlioz, for
instance, undertook, he loved travelling, and his artistic journeys made him
famous throughout Germany, at least as an organist. Forkel himself describes
(infra, pp. 19, 23) his notable visits to the Courts of Berlin and Dresden.
10 In 1802, it must be remembered, not a note of Bach's concerted Church
music was in print except the tunes he wrote for Schemelli's Hymn-book (1736)
and the vocal parts of an early Cantata (No. 71). Of his instrumental works
engraved by 1802 Forkel gives a list infra, p. 137. It was hardly until the
foundation of the Bachgesellschaft in 1850, to celebrate the centenary of Bach's
death, that the systematic publication of his concerted Church music began.


xxiv Johann Sebastian Bach


At any rate, if music is really an art, and not a mere pastime,
its masterpieces must be more widely known and performed than
in fact they are. And here Bach, prince of classic composers,
can render yeoman service. [11] For his music is so well calculated
to educate the student to distinguish what is trivial from what
is good, and to comport himself as an artist in whatever branch
of the art he makes his own. Moreover, Bach, whose influence
pervades every musical form, can be relied on more than any
other composer to correct the superficiality which is the bane of
modern taste. Neglect of the classics is as prejudicial to the art
of music as it would be fatal to the interests of general culture
to banish Greek and Latin writers from our schools. Modern

taste exhibits no shame in its preference for agreeable trifles, in
its neglect of everything that makes a demand, however slight,

[xxix] upon its attention. To-day we are menaced by a proposal to
banish the classics from our schoolrooms. Equally short-sighted
vision threatens to extinguish our musical classics as well. And
is it surprising? Modern art displays such poverty and frivolity
that it well may shrink from putting itself in context with great
literature, particularly with Bach's mighty and creative genius,
and seek rather to proscribe it.

I fain would do justice to the sublime genius of this prince
of musicians, German and foreign! Short of being such a man
as he was, dwarfing all other musicians from the height of his
superiority, I can conceive no greater distinction than the power


Before that date, however, Peters of Leipzig had taken in hand the abandoned
scheme of Hoffmeister and Khnel, to which Forkel alludes, and in which he
participated.
11 It is notable that Forkel makes no mention of Haydn, Mozart, or Handel,
whose English domicile had divorced him from Germany's service. Forkel's
pessimism is the more curious, seeing that Beethoven was already thirty years
old, and that Mozart in 1786, after giving him a subject to extemporise upon,
had remarked, Listen to that young man; he will some day make a noise in the
world (Holmes, _Life of Mozart,_ Dent's ed., p. 223). Forkel, in fact, appreciated
neither Mozart nor Beethoven and thoroughly detested Gluck.


FORKEL'S PREFACE xxv


to comprehend and interpret him to others. [12] The ability to
do so must at least connote a temperament not wholly alien
from his own. It may even hint the flattering prospect that, if
circumstances had opened up the same career, similar results
might have been forthcoming. I am not presumptuous to suggest
such a result in my own case. On the contrary I am convinced
that there are no words adequate to express the thoughts Bach's
transcendent genius stirs one to utter. The more intimately we are
acquainted with it the greater must be our admiration. Our utmost
eulogy, our deepest expressions of homage, must seem little more [xxx]
than well-meant prattle. No one who is familiar with the work of
other centuries will contradict or hold my statement exaggerated,
that Bach cannot be named except in tones of rapture, and even
of devout awe, by those who have learnt to know him. We may
discover and lay bare the secrets of his technique. But his power
to inspire into it the breath of genius, the perfection of life and
charm that moves us so powerfully, even in his slightest works,
must always remain extraordinary and insoluble.


I do not choose to compare Bach with other artists. Whoever
is interested to measure him with Handel will find a just and
balanced estimate of their relative merits, written by one fully
informed for the task, in the first number of the eighty-first
volume of the _Universal German Library,_ pages 295-303. [13]


So far as it is not derived from the short article in Mizler's


12 As has been pointed out in the Introduction, Forkel stood almost alone in
1802 in his opinion of Bach's pre-eminence. Even Beethoven placed Bach after
Handel and Mozart, but knew little of his music on which to found a decision.
13 The anonymous article in the _Allgemeine deutsche Bibliothek,_ to which
Forkel alludes, deals with Bach's Clavier and Organ works and upon them
asserts Bach's superiority over Handel. The judgment was unusual. Bach's
fame was gravely prejudiced by German Handel-worship, which the first
performance of the _Messiah_ at Leipzig in 1786 stimulated. Johann Adam
Hiller, Bach's third successor in the Cantorate of St. Thomas', was largely
responsible. He neglected, and even belittled, the treasures of Bach's art which
the library of St. Thomas' contained. See Schweitzer, i. 231.


xxvi Johann Sebastian Bach


_Library_ already mentioned, [14] I am indebted for my information to

[xxxi] the two eldest sons of Bach himself. [15] Not only was I personally
acquainted with them, but I corresponded regularly for many
years with both, [16] particularly Carl Philipp Emmanuel. The
world knows them as great artists. But probably it is not aware
that to the last moment of their lives they spoke of their father's
genius with enthusiastic admiration. [17] From my early youth I
have been inspired by an appreciation no less deep than theirs.
It was a frequent theme of conversation and correspondence
between us.

Thus, having been in a position to inform myself on all
matters relating to Bach's life, genius, and work, I may fairly
hold myself competent to communicate to the public what I have

[xxxii] learnt and to offer useful reflections upon it. I take advantage of
my opportunity the more readily because it permits me to draw
attention to an enterprise [18] that promises to provide a worthy
monument to German art, a gallery of most instructive models
to the sincere artist, and to afford music lovers an inexhaustible
source of sublimest pleasure.


14 The _Nekrolog._ See supra, p. xxiv.
15 Carl Philipp Emmanuel and Wilhelm Friedemann. The latter was born in
1710, and after holding Organistships at Halle and Dresden, died at Berlin in
1784, leaving his widow and daughter in great poverty. The former received a
grant from the receipts of the _Messiah_ performance alluded to in note 1, supra.
A man of brilliant musical attainments, Wilhelm Friedemann's character was
dissolute and unsteady. See Schweitzer, i. 146 ff.
16 Two letters written by C. P. E. Bach to Forkel in 1775, conveying a good
deal of information reproduced by Forkel in this monograph, are printed in
facsimile by Dr. Max Schneider in his _Bach-Urkunden_ (N.B.G., XVII. (3)).
17 Forkel's statement is entitled to respect. On the other hand there is nothing
in the recorded careers of either of Bach's sons that bears him out on this

point. Schweitzer (i. 229) endorses Elinor's judgment: Bach's sons were the
children of their epoch, and never understood their father; it was only from
piety that they looked at him with childlike admiration. Dr. Charles Burney
spent several days with Carl Philipp Emmanuel at Hamburg in 1772, but during
the whole time the son never played to him a note of his father's music.
18 i.e. Hoffmeister and Khnel's project.


[1]


# CHAPTER I. THE FAMILY OF BACH

If there is such a thing as inherited aptitude for art it certainly
showed itself in the family of Bach. For six successive
generations scarcely two or three of its members are found
whom nature had not endowed with remarkable musical talent,
and who did not make music their profession. [19]

Veit Bach, [20] ancestor of this famous family, gained a [2]
livelihood as a baker at Pressburg in Hungary. When the
religious troubles of the sixteenth century broke out he was
driven to seek another place of abode, and having got together


Emmanuel; it has disappeared. Traces of it exist in a work published at
Pressburg by Johann Matthias Korabinsky in 1784, its insertion being due to
the assumption that the Bachs were a Hungarian family. Forkel shared that
error. See Spitta's Preface on the whole question. The MS. genealogy of 1735
is published by the New Bachgesellschaft (XVIII. 3) in facsimile.
19 The accuracy of this statement is apparent from the Genealogy appended to
this volume. Bach's sons represented the sixth generation from Veit Bach, the
sixteenth century ancestor of the family. Veit himself was not a professional
musician; one of his sons was a Spielmann; thereafter for the next 150 years
all but seven of his descendants, whose professions are known, were Organists
or Cantors or Town Musicians. Many of them, moreover, were men of the
highest attainments in their profession.
20 He took his name from St. Vitus (Guy), patron saint of the church
of Wechmar, a fact which sufficiently disproves Forkel's statement that his
original domicile was in Hungary. The Bachs were settled in Wechmar as early
as circ. 1520. Veit migrated thence to Hungary, though there is no adequate
foundation for the statement that he settled at Pressburg. He returned to
Wechmar during the beginning of the Counter-Reformation under the Emperor
Rudolph II. (1576- 1612), and died at Wechmar, March 8, 1619. See Spitta, i.
4.

Apart from church and town registers, laboriously consulted by Spitta in


4 Johann Sebastian Bach


as much of his small property as he could, retired with it to
Thuringia, hoping to find peace and security there. He settled
at Wechmar, a village near Gotha, [21] where he continued to ply
his trade as a baker and miller. [22] In his leisure hours he was
wont to amuse himself with the lute, [23] playing it amid the noise
and clatter of the mill. His taste for music descended to his two
sons [24] and their children, and in time the Bachs grew to be a very

[3] numerous family of professional musicians, Cantors, Organists,
and Town Musicians, [25] throughout Thuringia.


Not all the Bachs, however, were great musicians. But every
generation boasted some of them who were more than usually
distinguished. In the first quarter of the seventeenth century three
of Veit Bach's grandchildren showed such exceptional talent that
the Count of Schwarzburg-Arnstadt thought it worth while to
send them at his expense to Italy, then the chief school of music,


tracing the Bach genealogy, we owe our knowledge of it to an MS. drawn up by
Bach in 1735 which is now in the Berlin Royal Library after being successively
in the possession of Carl Philipp Emmanuel, Forkel, and G. Plchau, the
Hamburg teacher of music.
The original entries in it are stated by Carl P. Emmanuel to be by his
father. Forkel also owned a Bach genealogical tree, given him by Carl Philipp
21 Veit, in fact, returned to his native village. His name, as has been pointed
out, implies a connection with Wechmar that must have dated from infancy.
Moreover, there was living there in 1561 one Hans Bach, an official of the
municipality, who may be regarded confidently as Veit's father.
22 It has been suggested that the name Bach is the sole authority for the
statement that Veit was a baker. But Spitta points out that the vowel in
the name is pronounced long and was frequently written BAACH in the
seventeenth century, a fact which makes it difficult to associate the word with
Backer (Baker).
23 In the Genealogy Johann Sebastian calls the instrument a Cythringen.
24 Hans Bach (d. Dec. 26, 1626) and (?) Lips Bach (d. Oct. 10, 1620). See
infra, Genealogical Tables I. and II. and note to the latter.
25 The Stadt Pfeiferei, or official town musical establishment, descended
from the musicians' guilds of the Middle Ages and was presided over by the
Stadt Musiker, who enjoyed certain ancient privileges and the monopoly of


CHAPTER I. THE FAMILY OF BACH 5


to perfect themselves in the art. [26]


We do not know whether they rewarded the expectations of
their patron, for none of their works has survived. The fourth
generation [27] of the family produced musicians of exceptional
distinction, and several of their compositions, thanks to Johann [4]
Sebastian Bach's regard for them, have come down to us. The
most notable of these Bachs are:


1. Johann Christoph Bach, Court and Town Organist at Eisenach. [28] He was particularly happy in his beautiful melodies
and in setting words to music. In the _Archives of the_
_Bachs,_ [29] which was in Carl Philipp Emmanuel's possession at Hamburg, there is a Motet by Johann Christoph in
which he boldly uses the augmented sixth, a proceeding


providing the music at open-air festivities. Johann Jakob Brahms, the father of
Johannes, was a member of such a corporation at Hamburg, after having served
his apprenticeship for five years elsewhere. See Florence May, _Johannes_
_Brahms,_ vol. i. pp. 48 ff.
26 See Genealogical Table II. The three young Bachs were the sons of Lips
Bach and, presumably, nephews of Hans the Spielmann. The youngest of
them was named Jonas; the name of another was certainly Wendel. It is
remarkable, in a period in which Italy was regarded as the Mecca of musicians,
that exceedingly few of the Bach family found their way thither. Besides the
three sons of Lips Bach, only Johann Nikolaus, 1669-1753 (see Table VI.),
Johann Sebastian Bach's son Johann Christian, 1735-82 (see Table VIII.), and
Carl P. E. Bach's son Sebastian (see Table VII.) seem to have visited Italy.
27 i.e. from Veit Bach. Of the three names Forkel mentions the first two were

a generation before Johann Sebastian; the third, Johann Bombard, was of the
same generation as Johann Sebastian; none of the three belonged to Johann
Sebastian's branch.
28 Eldest son of Heinrich Bach (see Table VI.). Whether he was Court as well
as Town Organist at Eisenach cannot be stated positively.
29 The _Alt-Bachische Archive_ is a collection of the compositions of various
members of the family, before and after Johann Sebastian, formed largely by
the latter. From C. P. E. Bach it passed to G. Plchau and from him to the


6 Johann Sebastian Bach


considered extremely daring in his day. [30] He was also an
uncommon master of harmony, as may be inferred from a
Cantata composed by him for Michaelmas, to the words Es
erhub sich ein Streit, etc., which has twenty-two obbligato
parts in correct harmony. [31] Yet another proof of his rare

[5] skill is in the alleged fact that he never played the Organ or
Clavier in less than five parts. [32] Carl Philipp Emmanuel had
a particularly warm regard for him. [33] I remember the old
man playing some of his compositions to me on the Clavier
at Hamburg, and how quizzically he looked at me when one
of these daring passages occurred. [34]


2. Johann Michael Bach, Organist and Town Clerk at
Gehren. [35] He was the younger brother of Johann Christoph,
and like him, a particularly good composer. The Archives
already mentioned [36] contain several of his Motets, includ

Berlin Royal Library.
30 Johann Christoph composed several Motets (see them discussed in Spitta,
i. 75 ff.). The daring work to which Forkel alludes was written about 1680 and
is lost. Though the augmented sixth was then and remained unusual, Johann
Christoph's is not the earliest use of it. Spitta finds it in Giacomo Carissimi
(1604-74).
31 The Cantata (And there was war in heaven) is analysed by Spitta (i.
44). The score is unusually full: two five-part choirs; Vn. 1 and 2, 4 Violas,
Contrabasso, Fagotto, 4 Trombe, Timpani, Organ. In 1726 Johann Sebastian
Bach wrote a Cantata for Michaelmas on the same text (Rev. xii. 7).
32 Spitta (i. 101 n.) characterises the statement as a mythical exaggeration.
In a chapter devoted to the instrumental works of Johann Christoph and his
brother he instances a collection of forty-four Organ Chorals by the former,
not one of which is in five parts.
33 In the Bach genealogy already referred to C. P. E. Bach designates Johann
Christoph a great and impressive composer.
34 A _Lamento_ published under Johann Christoph's name seems actually to
have been composed by his father Heinrich (see Pirro, _J.-S. Bach,_ 9 n.). Johann
Christoph, however, is the composer of the Motet _Ich lasse dich nicht,_ so often
attributed to Johann Sebastian.
35 See Table VI. He was the father of Johann Sebastian's first wife.
36 See note, p. 4 supra.


CHAPTER I. THE FAMILY OF BACH 7


ing one for eight voices in double chorus, [37] and many
compositions for Church use.
3. Johann Bernhard Bach, Musician in the Prince's Kapelle
and Organist at Eisenach. [38] He is said to have composed
remarkably fine Suites, or Overtures, in the French style. [39]


Besides these three men, the Bachs boasted several able
composers in the generations preceding Johann Sebastian, [40] men
who undoubtedly would have obtained higher positions, wider
reputation, and more brilliant fortune if they could have torn
themselves from their native Thuringia to display their gifts
elsewhere in Germany or abroad. But none of the Bachs seems to
have felt an inclination to migrate. Modest in their needs, frugal
by nature and training, they were content with little, engrossed in
and satisfied by their art, and wholly indifferent to the decorations [7]
which great men of that time were wont to bestow on artists as
special marks of honour. The fact that others who appreciated


Schweinfurt (ib. 155). The other Bach composer outside Heinrich Bach's
branch is Johann Bornhard, already mentioned by Forkel.
37 Spitta (i. 59 ff.) mentions twelve Motets by Michael Bach. Several of them
are for eight voices. Forkel probably refers to the most remarkable of Michael's
Motets, in which he detects the romantic spirit of Johann Sebastian. It is set to
the words _Unser Leben ist ein Schatten,_ ( _Life on earth is but a shadow_ ). The
first choir consists of 2 S., A., 2 T., B., and the second choir of A. T. B. only.
Spitta analyses the work closely (i. 70-72). Novello publishes his five- part
Motet _Christ is risen_ with an English text.
38 He succeeded his cousin Johann Christoph at Eisenach in 1703.
39 Spitta (i. 24 ff.) mentions four Suites, or Overtures, Clavier pieces, and
Organ Chorals as being by him. That Johann Sebastian Bach highly esteemed
the Suites is proved by the fact that he copied the parts of three of them with
his own hand at Leipzig.
40 It is a curious fact that, prior to the career of Johann Sebastian Bach, the
composers of the Bach family occur invariably in other branches than his.
With two exceptions, the gift of composition appears to have been possessed,
or exercised, solely by Heinrich Bach (see Table VI.), his two sons Johann
Christoph and Johann Michael, already discussed, and his grandson, Johann
Nikolaus (son of Johann Christoph). Heinrich Bach was a very productive
composer in all forms of musical art employed at that time in church (Sp. i. 36).


8 Johann Sebastian Bach


them were thus distinguished did not rouse the slightest envy in
the Bachs.

The Bachs not only displayed a happy contentedness,
indispensable for the cheery enjoyment of life, but exhibited
a clannish attachment to each other. They could not all live in
the same locality. But it was their habit to meet once a year at a
time and place arranged beforehand. These gatherings generally
took place at Erfurt, Eisenach, and sometimes at Arnstadt. Even
after the family had grown very large, and many of its members
had left Thuringia to settle in Upper and Lower Saxony and
Franconia, the Bachs continued their annual meetings. On these
occasions music was their sole recreation. As those present
were either Cantors, Organists, or Town Musicians, employed
in the service of the Church and accustomed to preface the day's
work with prayer, their first act was to sing a Hymn. Having
fulfilled their religious duty, they spent the rest of the time in
frivolous recreations. Best of all they liked to extemporise a
chorus out of popular songs, comic or jocular, weaving them into
a harmonious whole while declaiming the words of each. They
called this hotch-potch a Quodlibet, laughed uproariously at

[8] it, and roused equally hearty and irrepressible laughter in their
audience. [41] It is suggested that German Comic Opera has its
origin in these trifles. But the Quodlibet was a familiar
institution in Germany at a much earlier period. I possess a
collection of them printed and published at Vienna in 1542. [42]


But these light-hearted Thuringians, and even those of their
family who treated their art more seriously and worthily, would


His grandson, Johann Nikolaus, composed a Mass and a comic operetta (ib.,
132 ff.). The only other Bach composer known to Spitta is Georg Christoph,
founder of the Franconian Bachs (see Table IV.) and Cantor at Themar and
41 In the Quodlibet different voices sang different well-known melodies,
sacred and profane, and sought to combine them to form a harmonious whole.
For an example see Variation 30 of the _Aria mit 30 Veranderungen_ (Peters' ed.,
bk. 209 p. 83). In it Bach combines two popular songs of his period.
42 See article Quodlibet in Grove.


CHAPTER I. THE FAMILY OF BACH 9


not have escaped oblivion had there not emerged in the fulness
of time one whose genius and renown reflected their splendour
and brilliancy on his forbears. This man, the glory of his family,
pride of his countrymen, most gifted favourite of the Muse of
Music, was Johann Sebastian Bach.


Bach's Home at Eisenach




[9]


# Chapter II. THE CAREER OF BACH

Johann Sebastian Bach was born on March 21, 1685, [43] at

Eisenach, where his father, Johann Ambrosius Bach, was Court
and Town Musician. [44] Johann Ambrosius had a twin brother,
Johann Christoph, Musician to the Court and Town of Arnstadt, [45]

who so exactly resembled him that even their wives could
distinguish them only by their dress. The twins appear to have
been quite remarkable. They were deeply attached, alike in
disposition, in voice, and in the style of their music. If one was
ill, so was the other. They died within a short time of each other,
and were objects of wondering interest to all who knew them. [46]

In 1695, when Johann Sebastian was not quite ten years
old, his father died. He lost his mother at an earlier period. [47]

So, being left an orphan, he became dependent on his eldest [10]
brother, Johann Christoph, Organist at Ohrdruf, [48] from whom


43 The date is conjectural, and is deduced from the fact that the infant was
baptized on March 23. The Gregorian Calendar was not adopted in Germany
until 1701. Had it been in use in 1685 Bach's birthday would be March 31.
44 Johann Ambrosius' Court appointment is to be inferred from the fact that
in 1684 the Duke refused him permission to return to Erfurt.
45 See Table IV.
46 Johann Ambrosius survived his brother by nearly eighteen months.
47 His mother died in May 1694, and his father in January 1695. At the latter
date Johann Sebastian was three months short of his tenth year.
48 Excepting Johann Jakob, a lad of thirteen years, Johann Christoph was
Bach's only surviving brother, and the only one of the family in a position to
look after him. Johann Jakob accompanied Sebastian to Ohrdruf (Pirro, p. 13)
and afterwards apprenticed himself to his father's successor as Town Musician
at Eisenach. One of the daughters was already married. What became of the
other is not stated. See Table V.


12 Johann Sebastian Bach


he received his earliest lessons on the Clavier. [49] His inclination

and talent for music must already have been pronounced. For
his brother no sooner had given him one piece to learn than the
boy was demanding another more difficult. The most renowned
Clavier composers of that day were Froberger, [50] Fischer, [51]

[11] Johann Caspar Kerl, [52] Pachelbel, [53] Buxtehude, [54] Bruhns, [55] and
Bhm. [56] Johann Christoph possessed a book containing several
pieces by these masters, and Bach begged earnestly for it, but
without effect. Refusal increasing his determination, he laid his
plans to get the book without his brother's knowledge. It was
kept on a book-shelf which had a latticed front. Bach's hands
were small. Inserting them, he got hold of the book, rolled it up,
and drew it out. As he was not allowed a candle, he could only
copy it on moonlight nights, and it was six months before he
finished his heavy task. As soon as it was completed he looked
forward to using in secret a treasure won by so much labour. But


49 It is difficult to believe this statement. That the boy was destined for a
musical career by his father hardly can be doubted. That he was of unusual
precocity, the story told by Forkel in the text proves. His father's asserted
neglect to instruct him is therefore hardly credible.
50 Johann Jakob Froberger, born at Halle (date unknown); Court Organist at
Vienna, 1637-57; d. 1667.
51 Johann Caspar Ferdinand Fischer, c. 1660-1738 (actual dates of his birth
and death unknown); Kapellmeister to Markgraf Ludwig of Baden at Schloss
Schlackenwerth in Bohemia. His _Ariadne Musica Neo-Organoedum_ (1702)
was the precursor of Bach's _Das wohltemperirte Clavier._
52 Johann Caspar Kerl, b. 1628; Kapellmeister in Munich, 1656-74; Court
Organist at Vienna, 1677-92; d. 1693.
53 Johann Pachelbel, b. 1653, d. 1706. In 1695 he was Organist of St. Sebald's
Church, Nrnberg. His influence upon the organ playing of his generation was
enormous. Bach's brother, Johann Christoph, was his pupil.
54 Dietrich Buxtehude, b. 1637, d. 1707; Organist (1668) of the Marienkirche,
Lbeck, and the chief musical influence in North Germany.
55 Nikolaus Bruhns, b. circ. 1665, d. 1697; a. pupil of Buxtehude; Organist
at Husum; the greatest organist of his time after Buxtehude.
56 Georg Bhm, b. 1661; date of death uncertain (c. 1739); from 1698
Organist of the Johanniskirche, Lneburg.


Chapter II. THE CAREER OF BACH 13


his brother found the copy and took it from him without pity, nor
did Bach recover it until his brother's death soon after. [57]


Being once more left destitute, [58] Johann Sebastian set out
for Lneburg with one of his Ohrdruf schoolfellows, named
Erdmann [59] (afterwards Russian Resident at Danzig), and entered
the choir of St. Michael's Convent. His fine treble voice procured
him a fair livelihood. But unfortunately he soon lost it and did
not at once develop another. [60]


Meanwhile his ambition to play the Organ and Clavier
remained as keen as ever, and impelled him to hear and practise
everything that promised him improvement. For that purpose,
while he was at Leburg, he several times travelled to Hamburg
to hear the famous organist, [61] Johann Adam Reinken. [62] Often, [13]


of Reinken of Hamburg. Spitta (i. 196) suggests that Bach's cousin, Johann
Ernst (see Table IV.), was at this time completing his musical education at
Hamburg, a fact which may have contributed to draw Bach thither. He made
more than one visit, on foot, to Hamburg. F. W. Marpurg published, in 1786,
the story, which he received from Bach himself, that on one of his journeys
from Hamburg, Bach sat down outside an inn and hungrily sniffed the savours
from its kitchen. His pockets were empty and there seemed little prospect of
a meal, when a window was opened and two herring heads were thrown out.
Bach picked them up eagerly, and found in each of them a Danish ducat. Who
was his benefactor he never discovered; the gift enabled him to satisfy his
hunger and pay another visit to Hamburg.
57 In fact, Johann Christoph did not die until 1721, more than twenty years
after Sebastian ceased to be under his roof.
58 The fact that Johann Christoph survived till 1721 disproves Forkel's
statement. The youthful Bach, aged fifteen in 1700, no doubt seized the earliest
opportunity to relieve his brother of the charge of him. Moreover, Johann
Christoph's family was increasing (see Table V.). In spite of the story of
Bach's midnight copying, it cannot be questioned that he owed a good deal to
his brother, who not only taught him but, presumably, maintained him at the
Ohrdruf Lyceum, where Bach acquired a sound education and a considerable
knowledge of Latin. See Pirro, pp. 14-16, on Bach's education at Ohrdruf. He


14 Johann Sebastian Bach


too, he walked to Celle to hear the Duke's French band play
French music, which was a novelty in those parts. [63]


The date and circumstances of his removal from Lneburg to
Weimar are not precisely known. [64] He certainly became Court
Musician there in 1703, when he was just over eighteen years
of age. [65] But in the following year he gave up the post on his
appointment as Organist to the new Church at Arnstadt, probably
desiring to develop his taste for the Organ and realising that
he would have better opportunities to do so at Arnstadt than at


left the Lyceum in March 1700.
59 Georg Erdmann, Bach's fellow-pupil at the Lyceum.
60 Bach's entry into the choir of St. Michael's Convent, Lneburg, took
place about Easter 1700. The step was taken upon the advice of Elias Herda,
Cantor at the Ohrdruf Lyceum, himself a former member of St. Michael's.
Bach remained at St. Michael's for three years, till 1703. The choir library
was particularly rich in the best church music of the period, both German and
Italian. Spitta is of opinion that Bach's talents as a violinist and Clavier player
were also laid under contribution. His voice, as Forkel states, soon ceased to
be serviceable. His maximum pay was one thaler (three shillings) a month and
free commons.
61 Probably Georg Bhm, who had relations with the Convent choir, inspired
Bach to make the pilgrimage. Bhm, then at St. John's, Lneburg, was a pupil
62 Johann Adam Reinken, b. 1623, became Organist of St. Catherine's
Church, Hamburg, in 1664, and held the post until his death in 1722.
63 His introduction to French music marked another step in Bach's progressive
education. The reigning Duke of Celle (father-in-law of George I. of Great
Britain and Ireland) had married a Frenchwoman. See Pirro, _J. S. Bach,_ pp.
24-27.
64 He entered the Weimar service on April 8, 1703 (Pirro, p. 29).
65 Bach's engagement was in the private band of the younger brother of the


Chapter II. THE CAREER OF BACH 15


Weimar, where he was engaged simply to play the Violin. [66] At
Arnstadt he set himself assiduously to study the works of the
celebrated organists of the period, so far as his modest means
permitted him, and in order to improve himself in composition [67] [14]
and Organ playing, [68] walked the whole way to Lbeck to hear
Dietrich Buxtehude, Organist of St. Mary's Church in that
city, with whose compositions he was acquainted already. He
remained there about three months, [69] listening to the celebrated [15]
Organist, but without making himself known to him, and returned
to Arnstadt with his experience much increased.


Bach's zeal and persevering diligence had already drawn
attention to him, as is evident from the fact that he received in
succession several offers of vacant organistships, one of which,
at the Church of St. Blasius, Mhlhausen, he accepted in


had leisure and the means to employ it. In October 1705 he obtained four
weeks' leave of absence and set off on foot to Lbeck, after leaving an efficient
deputy behind him. He stayed away until February 1706. On his return the
Consistory demanded an explanation of his absence, and took the opportunity
to remonstrate with him on other matters. They charged him with having
been hitherto in the habit of making surprising variationes in the Chorals,
and intermixing divers strange sounds, so that thereby the congregation were
confounded. They charged him with playing too long preludes, and after this
was notified to him, of making them too short. They reproached him with
having gone to a wineshop last Sunday during sermon, and cautioned him
that, for the future he must behave quite differently and much better than
he has done hitherto (see the whole charge in Spitta, i. 315 ff.). Bach also
was on bad terms with the choir, whose members had got out of hand and
discipline. Before his Lbeck visit he engaged in a street brawl with one
of the scholars. Then, as later, he was a choleric gentleman. In November
1706 he got into further trouble for having made music in the church with
a stranger maiden, presumably his cousin Maria Barbara Bach, then on a
visit to Arnstadt; he married her a year later. Clearly the relations between
the Consistory and the brilliant young Organist were becoming difficult, and
Bach's migration to Mhlhausen no doubt was grateful to both. His resignation
was made formally on June 29, 1707.
Duke. He remained in his new post only a few months. He was engaged as a


16 Johann Sebastian Bach


Violin player, and since his interests were towards the Organ and Clavier, it is
clear that he accepted the engagement as a temporary means of livelihood.
66 He is, however, described in July 1703 as Court Organist (Pirro, p. 30).
Bach was drawn to Arnstadt chiefly by the fact that the New Church recently
had been equipped with a particularly fine Organ (specification in Spitta, i.
224), which existed until 1863. Bach inaugurated it on July 13, 1703, and
entered on his duties as Organist of the church in the following month (Pirro,
p. 30).
67 His earliest Church Cantata (No. 15) was composed here in 1704. To the
Arnstadt period (1703-7) also must be attributed the Capriccio written on the
departure of his brother, Johann Jakob (Peters bk. 208 p. 62), the Capriccio in
honour of his Ohrdruf brother, Johann Christoph (Peters bk. 215, p. 34), the
Sonata in D major (Peters bk. 215, p. 44), the Organ Prelude and Fugue in C
minor (Novello bk. 2 p. 48), and the Organ Fugue in C minor (Novello bk. 12
p. 95).
68 In the _Nekrolog_ C. P. E. Bach and Agricola remark of the Arnstadt period,
that Bach then really showed the first-fruits of his industry in the art of
Organ-playing and composition, which he had in great measure learnt only
from the study of the works of the most famous composers of the time, and
from his own reflections on them (quoted in Spitta, i. 235).
69 Bach's stipend at Arnstadt was not inconsiderable, and his duties engaged


Chapter II. THE CAREER OF BACH 17


1707. [70] Barely a year after he entered upon his duties there [71]

he again visited Weimar and played to the Duke, who was
so pleased with his performance that he offered him the post
of Court Organist, which he accepted. [72] Weimar promised
him a particularly agreeable atmosphere in which to cultivate [16]


him only at stated hours on Sundays, Mondays, and Thursdays. He, therefore,
70 Bach was appointed on June 15, 1707, to succeed Johann Georg Able.
Mhlhauson prided itself upon its musical traditions. Bach's Cantata, No.
71, written in February 1708 for the inauguration of the Mhlhausen Town
Council, was engraved (the parts only), the only one of the 206 Cantatas which
have come down to us which was printed during Bach's lifetime. He also
composed Cantatas 131 and 196 at Muhlhausen, and perhaps three others. See
infra, p. 188.
71 Bach's petition to the Mhlhausen Consistory for permission to resign his
post is dated June 25, 1708, and is printed in full by Spitta, i. 373. Bach
mentions the Weimar post as having been offered to him, but bases his desire
to resign the organ of St. Blasius, partly on the ground that his income was
inadequate, partly because, though he had succeeded in improving the organ
and the conditions of music generally, he saw not the slightest appearance that
things will be altered for the better. Mhlhausen, in fact, was a stronghold of
Pietism and unsympathetic to Bach's musical ideals.
72 He was Court Organist and Kammermusikus. In the latter post Bach was
of use as a Violinist and Clavier player. The Court band, or Kapelle, on special
occasions appeared in Hungarian costume, which Bach presumably donned.
His income began at a sum nearly double that he had received at Arnstadt and
Mhlhausen.


18 Johann Sebastian Bach


his genius. [73] He applied himself closely to his work, and
probably at this period achieved the mastery of the Organ that
he ever afterwards possessed. At Weimar also he wrote his
great compositions for that instrument. [74] In 1717 [75] the Duke
appointed him Concertmeister, a post which gave him further
opportunity to develop his art, since it required him to compose
and direct Church music.


It was about this time that Zachau, Handel's master, died at
Halle, where he was Organist. [76] Bach, who by now had acquired
a great reputation, was invited to succeed him. [77] He visited Halle

[17] and composed a work as a specimen of his skill But for some
reason unknown he did not obtain the post. It was given to a


December 1714 he visited Leipzig and performed Cantata No. 61, _Nun komm,_
_der Heiden Heiland._ In 1716 he was again invited to Halle, and at about the
same time performed at Meiningen. Forkel records the famous contest with
Marchand, the French Organist, at Dresden in 1717.
73 The character of his employer, Duke Wilhelm Ernst of Saxe-Weimar, must
be reckoned a factor in the development of the youthful Bach. The Duke was
not only a cultured artist, but was also a man of genuine piety.
74 Though Bach retouched them in later years and wrote others, it may be
stated in general terms that his Organ works were the fruit of the Weimar
period, which lasted from 1708 till 1717.
75 Bach's promotion to the position of Concertmeister had taken place certainly
before March 19, 1714, on which date Spitta (i. 517) prints a letter in which
Bach gives himself the title. The increase in his income early in 1714 also
supports the conclusion, while a letter of January 14, 1714, written by Bach, is
not signed by him as Concertmeister. It would seem that his promotion took
place in the interval between the two letters. As Concertmeister it was part of
his duty to provide Cantatas for the church services. Twenty-two were written
by him at Weimar. See infra, p. 188, for a list of them.
76 Friedrich Wilhelm Zachau died on August 7 or 14, 1712.
77 Spitta (i. 513) infers that, in the later years of the Weimar period, Bach
spent part of the autumn of every year in visits to the Courts and larger towns


Chapter II. THE CAREER OF BACH 19


clever pupil of Zachau, named Kirchhoff. [78]


Johann Sebastian was now thirty-two years old. He had made
good use of his opportunities, had studied hard as a player
and composer, and by tireless enthusiasm had so completely
mastered every branch of his art, that he towered like a giant
above his contemporaries. Both amateurs and professional
musicians already regarded him with admiration when, in 1717,
Marchand, the French virtuoso, a celebrated Clavier and Organ [18]
player, visited Dresden. He played before the King-Elector [79]

and won such approbation that he was offered a large salary
to enter His Majesty's service. [80] Marchand's chief merit was


of Germany in order to give Organ recitals and to conduct performances of his
Cantatas. Besides the visit to Halle, in 1713, to which Forkel alludes, Bach
performed at Cassel in 1713 or 1714 before the future Frederick I. of Sweden,
who presented him with a ring which he drew from his finger. Bach's feet,
an admirer recorded, flew over the pedal-board as if they had wings. In
78 Forkel's brief account follows the _Nekrolog._ Bach was in Halle in the
autumn of 1713, a year after Zachau's death. The latter's post was still vacant
and a new and particularly large Organ (sixty-three speaking stops) was being
erected. The authorities pressed Bach to submit himself to the prescribed tests,
and he complied so far as to compose a Cantata and to conduct a performance
of it. On his return to Weimar he received a formal invitation to accept the
post. After some correspondence Bach refused it, partly, perhaps chiefly, on
the ground that the income was inadequate. The refusal was answered by the
groundless accusation that he had merely entertained the Halle proposal in
order to bring pressure upon Weimar for a rise of salary. The misunderstanding
was cleared away by 1716, when Bach visited Halle again. In the interval
Zachau's post had been given to his pupil, Gottfried Kirchhoff. The whole
matter is discussed at length in Spitta, i. 515 ff.
79 Frederick Augustus I. of Saxony was elected, as Augustus II., to the throne
of Poland in 1697. He died In 1733.
80 Louis Marchand, b. 1669, d. 1732; Organist to the French Court and later


20 Johann Sebastian Bach


his finished technique. Like Couperin, [81] his musical ideas
were weak to the point of banality, as we may judge from his
compositions. [82] Bach was an equally finished player, and so
rich in ideas that Marchand's head would have swollen had he
been equally gifted. Volumier, Concertmeister at Dresden, [83]

was aware of these circumstances, and knowing that the young
German had his instrument and his imagination under the fullest
control, determined to arrange a contest between the two men
in order to give his sovereign the satisfaction of judging their

[19] merits. With the King's approbation, a message was dispatched to
Bach at Weimar [84] inviting him to a contest with Marchand. Bach
accepted the invitation and set out at once on his journey. Upon
his arrival at Dresden Volumier procured him an opportunity
to hear Marchand secretly. Far from being discouraged by
what he heard, Bach wrote a polite note to the French artist
challenging him to a trial of skill, and offering to play at sight
anything Marchand put before him, provided the Frenchman
submitted himself to a similar test. Marchand accepted the
challenge, a time and place for the contest were fixed, and the
King gave his approval. At the appointed hour a large and
distinguished company assembled in the house of Marshal Count


of the Church of St. Honor, Paris. His arrival in Dresden was due to his
being in disgrace at Versailles. Whether or not he was offered a permanent
engagement at the Saxon Court, he was regarded as the champion of the French
style, and as such the challenge was issued to him by Bach.
81 Francois Couperin, b. 1668, d. 1733; Organist of St. Gervais, Paris.
Forkel's judgment upon his art is not supported by modern criticism.
82 Bach, however, admired Marchand's compositions sufficiently to give
them to his pupils. See Pirro, p. 52.
83 Jean-Baptiste Volumier, an acquaintance of Bach, according to Spitta (i.
583). Eitner, _Quellen Lexikon._ says that he was born in Spain and educated in
France. Grove's _Dictionary_ declares him a Belgian. In 1709 he was appointed
Concertmeister to the Saxon Court. He died at Dresden in 1728.
84 It is more probable that Bach was at Dresden either expressly to hear
Marchand or upon one of his autumn tours.


Chapter II. THE CAREER OF BACH 21


Flemming. [85] Bach arrived punctually; Marchand did not appear.
After considerable delay he was sought at his lodging, when
it was discovered, to the astonishment of all, that he had left
Dresden that morning without taking leave of anybody. Bach
therefore performed alone, and excited the admiration of all
who heard him, though Volumier was cheated of his intention
to exhibit the inferiority of French to German art. Bach was
overwhelmed with congratulations; but the dishonesty of a Court
official is said to have intercepted a present of one hundred louis [20]
d'or sent to him by the King. [86]


Bach had not long returned to Weimar when Prince Leopold of
Anhalt-Cthen, a good judge of music and a first-rate amateur, [87]

offered him the post of Kapellmeister. He entered at once upon


85 Some years earlier Flemming had witnessed Handel's triumphant descent
on the Saxon Court, but had failed to establish friendly relations with him. See
Streatfield's _Handel_, p. 87.
86 The article on Marchand in Grove gives a different version of the affair,
based upon Joseph Ftis (1784-1871). According to this story of the event,
Bach, summoned from Weimar, attended Marchand's concert incognito, and
after hearing Marchand perform, was invited by Volumier to take his seat at
the Clavier. Bach thereupon repeated from memory Marchand's theme and
variations, and added others of his own. Having ended, he handed Marchand a
theme for treatment on the Organ and challenged him to a contest. Marchand
accepted it, but left Dresden before the appointed hour.
87 The Prince was brother-in-law of Duke Ernst August of Saxe-Weimar.
Bach was, therefore, already known to him and showed the greatest regard for
him both at Cthen and after he had left his service.


22 Johann Sebastian Bach


his new office [88] and held it for about six years. [89] At this period,

[21] about 1722, [90] he visited Hamburg, played the Organ there, and
excited general admiration. The veteran Reinkenhe was nearly
one hundred years oldwas particularly impressed by Bach's
performance. After he had treated the Choral _An Wasserflssen_
_Babylon_ for half an hour in variation after variation in the true
Organ style, [91] Reinken paid him the compliment of saying, I
thought this art was dead, but I see that it survives in you.
Reinken had treated the same Choral in a similar manner some

years before and had had his work engraved, showing that
he thought highly of it. His praise therefore was particularly


88 The reason for Bach's migration from Weimar to Cthen was his failure to
obtain the post of Kapellmeister at the former Court upon the death of Johann
Samuel Drese in 1716. The post was given to Drese's son. On August 1, 1717,
just before or after his Marchand triumph, Bach was appointed Kapellmeister
to the Court of Cthen. Duke Wilhelm Ernst refused to release him from his

engagement, and Bach endured imprisonment from November 6 to December
2, 1717, for demanding instant permission to take up his new post. Probably
his last work at Weimar was to put the _Orgelbchlein_ into the form in which it
has come down to us (see articles by the present writer in _The Musical Times_
for January-March 1917).
With his departure from Weimar in 1718 Bach left behind him the
distinctively Organ period of his musical fertility. Though his compositions
were still by no means generally known, as a player he held an unchallenged
pre-eminence.
89 He was appointed to Cthen on August 1, 1717, and was inducted at
Leipzig on May 31, 1723.
90 The date actually was November 1720. At Cthen Bach had an inferior
Organ and little scope for his attainments; his chief duties were in connection
with the Prince's band. The yearning to get back to the Organ, which eventually
took him to Leipzig in 1723, shows itself in his readiness to entertain an
invitation to Hamburg in 1720.
91 Three Organ movements by Bach upon Wolfgang Dachstein's melody, _An_


Chapter II. THE CAREER OF BACH 23


flattering to Bach. [92]


On the death of Kuhnau in 1723 [93] Bach was appointed
Director of Music and Cantor to St. Thomas' School, Leipzig, [94]

a position which he occupied until his death. Prince Leopold [22]
of Anhalt-Cthen had great regard for him and Bach left his
service with regret. [95] But he saw the finger of Providence in


_Wasserflssen Babylon,_ are extant. See notes upon them and their relation to
the Hamburg extemporisation in Terry, _Bach's Chorals,_ Part III.
92 As at Halle in 1713, Bach does not appear to have gone to Hamburg
specially to compete for the post of Organist to the Church of St. James, vacant
by the death of Heinrich Friese in September 1720. He was not able to stay
to take part in the final tests, nor was he asked to submit to them, since his
visit to Hamburg had given him an opportunity to display his gifts. In the
result the post was given to Johann Joachim Heitmann, who acknowledged his
appointment by forthwith paying 4000 marks to the treasury of the Church.
See Spitta, ii. 17 ff.
93 Johann Kuhnau died on June 25, 1722.
94 On the title-pages of his published works Bach describes himself as
Capellm. und Direct. Chor. Mus. Lips.
95 Forkel has practically nothing to say regarding the Leipzig period of Bach's
musical life. That a professed historian of music, setting before the public
for the first time the life of one whom he so greatly extolled, and with every
inducement to present as complete a picture of him as was possible, should
have taken no trouble to carry his investigations beyond the point C. P. E.
Bach and Agricola had reached in the _Nekrolog_ of 1754 is almost incredible.
The only reason that can be adduced, apart from the lack of a really scientific
impulse, is that Forkel was almost entirely ignorant of the flood of concerted


24 Johann Sebastian Bach


the event; for the Prince died shortly afterwards. [96] The loss
of his patron affected him deeply, and moved him to compose
a funeral Cantata containing remarkably fine double choruses
which he himself conducted at Cthen. [97] While he was at St.

Thomas' he was appointed honorary Kapellmeister to the Duke

[23] of Weissenfels [98] and, in the following year (1736), received the
title of Court Composer to the King-Elector of Poland-Saxony. [99]

The two compliments are not of great consequence, and the
second was to some degree corollary to Bach's position as Cantor
of St. Thomas' School. [100]


Carl Philipp Emmanuel, Bach's second son, entered the service
of Frederick the Great of Prussia in 1740. So widely was Bach's
skill recognised by this time that the King, who often heard him
praised, was curious to meet so great an artist. More than once
he hinted to Carl Philipp Emmanuel that it would be agreeable
to welcome his father to Potsdam, and as Bach did not appear,


church music which poured from Leipzig from 1723 to 1744. His criticism
of Bach as a composer is restricted practically to Bach's Organ and Clavier
works.
96 On November 19, 1728. Latterly his interest in music had waned. The
fact, along with Bach's concern for the education of his sons and his desire to
return to the Organ, explains his abandonment of the more dignified Cthen
appointment.
97 The score of this work was in Forkel's possession, but was missing from
his library in 1818 and was assumed to be lost until, in 1873, Rust was able
to show that Bach used for the occasion certain choruses and Arias from the

_St. Matthew Passion,_ which he was then writing, with the first chorus of the
_Trauer-Ode_ as an opening of the extemporised work. See Spitta, ii. 618;
Schweitzer, ii. 208.
98 In 1723 he received the title Hochfrstlich Weissenfelsische wirkliche

Kapellmeister and retained it till his death. He retained also his Cthen
appointment.
99 Augustus III. Bach had petitioned for the appointment in a letter dated July
27, 1733 (Spitta, iii. 38), forwarding a copy of the newly-written Kyrie and
Gloria of the B minor Mass.
100 There does not appear to be any ground for the suggestion that the post of
Hofcomponist to the Dresden Court was attached ex officio to the St. Thomas'


Chapter II. THE CAREER OF BACH 25


desired to know the reason. Carl Philipp did not fail to acquaint
his father with the King's interest. But for some time Bach was
too occupied with his duties to accede to the invitation. However,
as Carl Philipp continued to urge him, he set out for Potsdam
towards the end of 1747, in company with his eldest son, Wilhelm
Friedemann. [101] It was the King's custom to hold a private concert
every evening, and to take part on the flute in a Concerto or two. [24]
One evening, [102] when he had got out his flute and the musicians
were at their desks, an official brought him a list of the strangers
newly arrived at Potsdam. Flute in hand the King ran through the
names, and suddenly turning to the waiting musicians, said with
considerable excitement, Gentlemen, Old Bach has arrived.
The flute was put away for the evening, and Bach, who had
alighted at his son's lodging, was summoned immediately to the
Palace. Wilhelm Friedemann, who accompanied his father, often
told me the story. Nor am I likely to forget the racy manner
in which he related it. The courtesy of those days demanded
rather prolix compliments, and the first introduction of Bach to
so illustrious a monarch, into whose presence he had hurried
without being allowed time to change his travelling dress for
a Cantor's black gown, obviously invited ceremonial speeches
on both sides. I will not dwell on them; Wilhelm Friedemann
related a lengthy and formal conversation between the King and [25]


Cantorate. Bach applied for it in 1733, taking advantage of the recent accession
of the new sovereign, Augustus III., in February 1733.
101 Friedemann was then at Halle.
102 May 7, 1747, according to Spitta, quoting Friedrich Wilhelm Marpurg's
_Historisch-kritische Beytrge zur Aufnahme der Musik,_ which appeared in
5 vols. between 1754-1778. On the other hand, Spener, who first records
the event, states briefly: May 11,1747. His Majesty was informed that
Kapellmeister Bach had arrived in Potsdam, and that he was in the King's
ante-chamber, waiting His Majesty's gracious permission to enter, and hear
the music. His Majesty at once commanded that he should be admitted
(Spitta, iii. 231 n.). If the Marpurg and Spener dates are reliable, it looks as
though Friedemann's story of his father, travel-stained and weary, being hurried
incontinent into the presence of the King is a piece of picturesque embroidery.


26 Johann Sebastian Bach


the Cantor. [103]


More worthy of record is the fact that the King gave up his
concert for that evening and invited Bach, already known as
Old Bach, to try the Silbermann pianofortes [104] which stood
in various parts of the Palace. [105] Accompanied from room to
room by the King and the musicians, Bach tried the instruments
and improvised upon them before his illustrious companion.
After some time he asked the King to give him a subject for a
Fugue, that he might treat it extempore. The King did so, and
expressed his astonishment at Bach's profound skill in developing
it. Anxious to see to what lengths the art could be carried, the
King desired Bach to improvise a six-part Fugue. But as every

[26] subject is not suitable for polyphonic treatment, Bach himself
chose a theme and, to the astonishment of all who were present,
developed it with the skill and distinction he had shown in
treating the King's subject. His Majesty expressed a wish to hear
him on the Organ also. Accordingly, next day, Bach inspected all
the Organs in Potsdam, [106] as the evening before he had tried the


103 Clearly this was a story that Wilhelm Friedemann prided himself on the
telling, and Forkel's remark suggests the need for caution in accepting all its
details. Frederick's courtesy to Bach, however, tends to discredit the story
that ten years earlier (1737) Handel deliberately refused to meet the King at
Aix-la-Chapelle owing to the peremptoriness of his summons. Mr. Streatfleld
(p. 145) also shows that Frederick was not at Aix until 1741, when Handel was
writing the _Messiah_ in London.
104 Gottfried Silbermann, a pioneer of the modern pianoforte. Bach was
already familiar with his Claviers with hammer action, and indeed had offered
useful criticism of which Silbermann had taken advantage. See Spitta, ii. 46.
105             - The pianofortes manufactured by Silbermann, of Freiberg, pleased the
King so much, that he resolved to buy them all. He collected fifteen. I hear
that they all now stand, unfit for use, in various corners of the Royal Palace.

[Robert Eitner, in 1873, found one of the pianos in Frederick the Great's room
at Potsdam.]
106 According to another account, which Spitta (iii. 232) follows, Bach played
before a large congregation in the Church of the Holy Spirit, Potsdam. The
King does not appear to have been present. The extemporisation of the six-part
Fugue took place in Frederick's presence on the evening of that day.


Chapter II. THE CAREER OF BACH 27


Silbermann pianofortes. On his return to Leipzig he developed
the King's theme in three and six parts, added Canones diversi
upon it, engraved the whole under the title _Musikalisches Opfer_
and dedicated it to the royal author of the theme. [107]

His visit to Potsdam was Bach's last journey. The indefatigable
diligence he had shown all his life, and particularly in his
younger years, when successive days and nights were given to
study, seriously affected his eye-sight. The weakness grew with
age and became very distressing in character. On the advice
of friends who placed great confidence in the skill of a London
oculist lately come to Leipzig, [108] Bach submitted to an operation, [27]
which twice failed. He lost his sight completely in consequence,
and his hitherto vigorous constitution was undermined by the
drugs administered to him. He sank gradually for full half a
year, and expired on the evening of July 30, 1760, in the sixtysixth year of his age. [109] Ten days before his death [110] he was


107 Bach's letter to Frederick accompanying the gift is dated 7th July 1747.
He calls it a musical offering, of which the noblest portion is the work of
Your Majesty's illustrious hand. In addition to Forkel's analysis it contains a
Sonata for Flute, Violin, and Clavier, and a canon perpetuus for the same three
instruments.
108 John Taylor (1703-72), oculist to George II. The operation took place in
the winter of 1749-50. Taylor is said to have operated on Handel in 1751
(see the article on him in the _Dict. Nat. Biography._ ). Streatfield ( _Handel,_ p.
212), however, does not mention Taylor, and his account suggests that Samuel
Sharp, of Guy's Hospital, was the operator in Handel's case.
109 The actual date was July 28, at 8.45 P.M. Bach was working to the very
moment of his collapse on July 18. Probably his last work was the Choral
Prelude (Novello bk. xvii. 85) on the melody _Wenn wir in hchsten Nthen_
_sein._ Facing eternity, he bade his son-in-law, Altnikol, inscribe the movement
with the title of the Hymn, _Vor deinen Thron tret ich hiemit,_ whose first stanza
filled his mind:


Before Thy throne, my God, I stand,
Myself, my all, are in Thy hand.


An addendum to the Genealogy, in C. P. E. Bach's hand, gives July 30 as
the date of his father's death.
110 July 18.


28 Johann Sebastian Bach


suddenly able to see again and to bear the light. A few hours
later he was seized by an apoplexy and inflammatory fever, and
notwithstanding all possible medical aid, his weakened frame
succumbed to the attack.

Such was the career of this remarkable man. I will only add
that he was twice married, and that he had by his first wife seven,
and by his second wife thirteen children; in all, eleven sons and

[28] nine daughters. [111] All of his sons had an admirable talent for
music, but only the elder ones fully developed it. [112]


111 See Genealogical Tables VII. and VIII.
112 The statement is misleading. Of the five sons of the first marriage, two
were famous, two died in infancy, and the fifth abandoned a promising musical
career for the law. Of the six sons of the second marriage, one was imbecile,
three died in infancy, two were famous.


Chapter II. THE CAREER OF BACH 29


The Church and School of St. Thomas, Leipzig, in 1723.


# CHAPTER IIA. [113] BACH AT LEIPZIG, 1723-1750


[28]
Bach was inducted into his office as Cantor of St. Thomas'

School at nine o'clock on the morning of Monday, May 31, 1723.
He died in his official residence there at a quarter to nine on
the evening of Tuesday, July 28, 1750. He was buried early on
the morning of Friday, July 31, in the churchyard of St. John's,
Leipzig.
The announcement of his death, made from the pulpit of St.
Thomas' on the day of his funeral, described him as Court
Composer to His Majesty the King of Poland and Electoral and
Serene Highness of Saxony, Kapellmeister to His Highness the
Prince of Anhalt-Cothen, and Cantor to St. Thomas' School of this
town. Bach usually designated himself Director Chori Musici
Lipsiensis, or shortly, Director Musices. Circumstances led
him to emphasise a title which asserted a musical prerogative not
confined to the School and the churches it served.

The Cantor of St. Thomas' was charged formerly with the
musical direction of four Leipzig churches: St. Thomas', St. [29]
Nicolas', St. Peter's, and the New Church. He was also
responsible for the music in the University Church of St. Paul,
the so-called old service, held originally on the Festivals of
Easter, Whit, Christmas, and the Reformation, and once during
each University quarter. On high days music also had to be
provided at St. John's Church.
Bach, as Cantor, succeeded to a more restricted responsibility,
which dated from the early years of the eighteenth century.


113 See Introduction, p. XXI, supra.


32 Johann Sebastian Bach


The New Church, originally the Church of the Franciscans,
had been restored to use in 1699. In 1704 Georg Philipp
Telemann, who came to Leipzig as a law student three years
before, was appointed Organist there. He also founded the
Collegium Musicum, or University Musical Society, a farther
slight upon the Cantor's position. Not until 1729 did the Society
pass under Bach's direction and its members become available as
auxiliaries in the church choirs under his charge. Notwithstanding
that Bach's predecessor Kuhnau had protested against Telemann's
independence, the direction of the New Church's music passed
out of the Cantor's control, though the School continued to
provide the choristers. Six years later the University Church
of St. Paul also began an independent course. In 1710 the
authorities resolved to hold a University service in the church
every Sunday. Kuhnau asserted his prerogative as Cantor. But

[30] he was only able to maintain it by offering to provide the music
for the new service as well as for the old service at the fee of

twelve thalers which the University so far had paid for the latter.
After his death the University appointed (April 3, 1723) Johann
Gottlieb Grner, already Organist of St. Nicolas' since 1721,
to control the music both of the old and new services, for
which the University provided the choir. Not until after a direct
appeal to the King did Bach succeed, in 1726, in compelling
the University to restore to the Cantor his emoluments in regard
to the old service, the conduct of which had been restored to
him on his appointment as Cantor. The new service remained
under Grner's direction. As to St. Peter's, its services, which
had entirely ceased, were revived in 1711. The music, however,
was simple, and consisted only of hymns.


Thus Bach, as Cantor, was responsible for the music in the two
principal churches, St. Thomas' and St. Nicolas'. The School also
provided the choir for St. Peter's and the New Church. The junior
and least competent singers sang at St. Peter's. The rest were
pretty equally distributed between the other three churches. At


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 33


the New Church the music was performed under the direction of
a Chorprfect. At St. Thomas' and St. Nicolas' Bach personally
directed the concerted music. On ordinary Sundays a Cantata or
Motet was performed in each church alternately. At the great [31]
Festivals, New Year, Epiphany, Ascension Day, Trinity Sunday,
and the Annunciation, Cantatas were sung at both churches, the
two choirs singing at Vespers in the second church the Cantata
performed by them in the morning at the other church. On these
occasions the second choir was conducted by a Chorprfect. The
principal Sunday service in both churches began at seven in the
morning, ended at eleven, and observed the following order:


1. Organ Prelude.
2. Motet, related to the Gospel for the Day; (omitted in Lent
and replaced by the Benedictus).
3. Introit.

4. Kyrie, sung alternately, in German and Latin.
5. The Lord's Prayer, intoned at the altar.
6. Gloria, intoned at the altar and answered either by the
Choir's Et in terra pax hominibus, or by the congregation
with the Hymn, Allein Gott in der Hh' sei Ehr, the German
version of the Gloria.

7. Collect, intoned in Latin; preceded by the preces Dominus
vobiscum and Et cum spiritu tuo.
8. Epistle.
9. Litany, in Advent and Lent only; intoned by four boys,
the Choir responding. [33]
10. Hymn, appropriate to the Gospel.
11. Gospel.
12. Credo, intoned; (in Lent, last three Sundays of Advent,
and Festivals of Apostles, the Nicene Creed, sung in Latin).
13. Prelude, followed by a Cantata, lasting about twenty
minutes; on alternate Sundays in each church.
14. The Creed in German, Wir glauben all' an einen Gott,
sung by the congregation.


34 Johann Sebastian Bach


15. Sermon, lasting one hour (8-9 A.M.).
16. Hymn, Herr Jesu Christ, dich zu uns wend, followed by
the reading of the Gospel, on which the Sermon had been
based.

17. General Confession, prayers, and Lord's Prayer.
18. Blessing.
19. Hymn.
20. Communion Service; Hymns and Organ extemporisation.

21. Benediction.


Vespers began at a quarter past one and was a comparatively
simple service; the music consisted of Hymns, a Motet, and
the Magnificat. On the last three Sundays in Advent and
throughout Lent neither Cantatas nor Motets were sung. The
Organ was silent. On the three great Festivals the appointed

[34] Hymn for the season was sung at the beginning of the principal
service, before the Organ Prelude: at Christmas, Puer natus
in Bethlehem; at Easter, Heut' triumphiret Gottes Sohn; at
Whitsuntide, Spiritus Sancti gratia. During the Communion
service the Sanctus and concerted music were sung. A festal
hymn followed the Benediction. The three great Festivals were
each observed for three consecutive days, on the first and second
of which Cantatas were sung at both churches. On the third day
concerted music was sung at only one of the two churches.
The other week-day Festivals for which Cantatas were
provided were the Feast of the Circumcision (New Year's
Day), Epiphany, Ascension Day, Purification of the B.V.M.,
Annunciation of the B.V.M., Visitation of the B.V.M., Feast of
St. John Baptist (Midsummer Day), Feast of St. Michael the
Archangel. The Reformation Festival was kept on October 31,
or if that date was a Saturday or Monday, on the previous or
following Sunday.
On Good Friday the Passion was performed in the two principal
churches alternately. Leipzig adopted no official Hymn-book.


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 35


The compilation from which the Hymns were chosen by Bach
was the eight-volumed Gesangbuch of Paul Wagner, published at
Leipzig for Dresden use in 1697. It contained over five thousand
Hymns but no music, merely the name of the tune being stated
above the Hymn. For the most part the Hymns for special, [35]
and even for ordinary, occasions were prescribed by custom.
Otherwise the power of selection was in the hands of the Cantor,
and Bach's exercise of it caused some friction with the clergy in

1728.

The provision and direction of the music at weddings and
funerals was in the Cantor's hands. He arranged the choirs
and the music sung at the scholars' annual processions and
perambulations of the town, which took place at Michaelmas,
New Year, and on St. Martin's and St. Gregory's Days.

Augmenting the School's choristers, the Town Musicians took
part in the Church services and were under the Cantor's direction.
Their numbers and efficiency were inadequate.

Upon the staff of the School the Cantor ranked third after the
Rector and Sub-Rector, and took a share in the general instruction
of the scholars. Class III. went to Bach for Latin lessons, a duty
which the Council eventually permitted him to fulfil by deputy.
Singing classes were held by the Cantor on three days of the
week, Mondays, Tuesdays, and Wednesdays, at nine and noon,
and on Fridays at noon. His instruction in singing was given to
the four upper classes only. On Saturday afternoons the Cantata
was rehearsed. Once in four weeks the Cantor took his turn to

inspect the scholars. Like the other masters, he was required
to conform to the regulations of the School House, in which he [36]
lived. He rose at five in summer, at six in winter, dined at ten
and supped at five in the afternoon.

Holidays were numerous. A week's vacation was given at
the Easter, Michaelmas, and New Year Fairs. At Midsummer
the School had a month of half-holidays. Whole holidays were
given on the birthdays of the four upper masters. There were


36 Johann Sebastian Bach


no morning lessons on Saints' Days, on the occasion of funeral
orations in the University Church, and on the quarterly Speech
Days. Hence, though Bach's office carried large responsibility, it
left him considerable leisure for composition.

As Cantor Bach had an official residence in the left wing
of the School House. In 1723, the Cantor's wing was of two
storeys only, dwarfed by the greater elevation of the main edifice
and under the shadow of the church. Bach brought to Leipzig
four children of his first marriage, and his second wife, Anna
Magdalena, presented him with a son or daughter annually from
1723 to 1729. The accommodation of the Cantor's lodging
therefore rapidly became inadequate. In the spring of 1731 Bach
found a house elsewhere while an additional storey was added
to it, which provided a new music-room, a good-sized apartment
whence a passage led to the big schoolroom in the main building.
The new wing was formally opened and dedicated on June

[37] 5, 1732, when Bach's secular Cantata Froher Tag, verlangte
Stunden was performed; the libretto being by his colleague
Winkler. From thenceforward till his death eighteen years later
Bach's occupancy was not disturbed. The wing continued to be
the official residence of the Cantor until the School moved to the

suburbs of the city in 1877.

In addition to his residence, which he occupied rent free, the
Cantor enjoyed a revenue from various and fluctuating sources,
amounting in gross to 700 thalers (=106 per annum). His fixed
stipend was only 100 thalers (=15). About 12 thalers came to
him from endowments. In kind he was entitled to 16 bushels

of corn and 2 cords of firelogs, together with 2 measures of
wine at each of the three great Festivals. From the University,
after his successful protest, he received 12 thalers for directing
the old service. By far the larger part of Bach's income was
derived from fluctuating sources. They were of three kinds: (1)
School monies, (2) funeral fees, (3) wedding fees. The School
monies represented perquisites derived from funds obtained by


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 37


the scholars, partly by their weekly collections from the public,
partly from the four annual processions or perambulations of the
city. From the weekly collections a sum of six pfennigs multiplied
by the number of the scholars was put aside for the four upper
masters, among whom the Cantor ranked third. From the money
collected at the New Year, Michaelmas, and St. Martin's Day [38]
processions the Rector took a thaler, the Cantor and the SubRector each took one-eleventh of the balance, sixteen thirty-thirds
went to the singers, and one-quarter of what remained fell to the
Cantor. Out of the money collected on St. Gregory's Day (March
12) the Rector took one-tenth for the entertainment of the four
upper masters, and the Cantor took one-third of the residue. For
funerals one thaler 15 groschen was paid when the whole school
accompanied the procession and a Motet was sung at the house
of the deceased. When no Motet was sung the Cantor's fee was
15 groschen. For weddings he received two thalers.

Reckoned in modern currency, and judged by the standard of
the period, the Cantor's income was not inadequate and served to
maintain Bach's large family in comfort. When he died in 1750,
in addition to a mining share valued at 60 thalers, he possessed
in cash or bonds about 360 thalers, silver plate valued at 251
thalers, instruments valued at 371 thalers, house furniture valued

at 29 thalers, and books valued at 38 thalers. His whole estate
was declared at 1158 thalers, or somewhat less than the savings
of two years' income. But for the inequitable distribution of his
property, owing to his intestacy, which left Anna Magdalena
only about 400 thalers and the mining share, Bach's widow
and unmarried daughters ought not to have been afflicted with [39]
excessive poverty, as in fact they were.

At the beginning of his Cantorate Bach worked amid
discouraging and unsatisfactory conditions. The Rector, Johann
Heinrich Ernesti, was over seventy years of age in 1723. The
School was badly managed, its discipline was relaxed, the betterto-do citizens withheld their sons from it, and its numbers were


38 Johann Sebastian Bach


seriously diminished. In 1717 the junior classes contained only
53 as against 120 in Ernesti's earlier years. The proximity
and operatic traditions of Dresden and Weissenfels also had
a bad effect; the St. Thomas' boys, after attaining musical
proficiency, were apt to become restless, demanding release
from their indentures, and even running away to more attractive
and lucrative occupations. Moreover, the governors of the School
were the Town Council, a body which had little sympathy with
or appreciation of Bach's artistic aims and temperament. To
these difficulties must be added another. The Town Musicians,

on whom Bach relied for the nucleus of his orchestra, were few

in number and inefficient.

So long as Ernesti lived, there was little prospect of
reform. But, after his death, in October 1729, Bach made
vigorous representations to the Town Council. Already he
had remonstrated with the Council for presenting to foundation
scholarships boys who lacked musical aptitude. The Council

[40] retaliated by accusing Bach of neglecting his singing classes,
absenting himself without leave, and of other irregularities. He
was declared to be incorrigible and it was resolved (August
2, 1730) to sequestrate the Cantor's income, in other words, to
withhold from him the perquisites to which he was entitled for
the conduct of the Church services. [114]


Bach was not deterred from offering, three weeks later (August
23, 1730), a sketch of what constitutes well-appointed Church
music, with a few impartial reflections on its present state of
decay in Leipzig. The document reveals the conditions amid
which Bach worked. Its representations may be summarised:

The foundation scholars of St. Thomas' are of four classes:

Trebles, Altos, Tenors, Basses.
A choir needs from four to eight concertists ( solo singers)
and at least two ripienists to each chorus part, i.e. a minimum


114 In view of Bach's memorial of August 23, 1730 (infra), this seems to be
the meaning of the resolution.


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 39


of twelve voices.

The foundation scholars number fifty-five, by whom the choirs
of the four Churches, St. Thomas', St. Nicolas', St. Peter's, and the
New Church are provided. For the instrumental accompaniments
at least twenty players are required: viz., 2 or 3 first Violins, 2
or 3 second Violins, 4 Violas, 2 Violoncelli, 1 Contrabasso, 2 or
more Flutes, 2 or 3 Oboi, 1 or 2 Fagotti, 3 Trombe, 1 Timpani. [41]
To fill these places there are eight Town Musicians, and at the
moment there are no players available for third Tromba, Timpani,
Viola, Violoncello, Contrabasso, third Oboe (or Taille).

To augment the Town Musicians the Cantor has been wont in
the past to employ University students and instrumental players
in the School. Upon the former at all times he relies for
Viola, Violoncello, and Contrabasso, and generally for the
second Violins. But the Council, by its recent resolution, no
longer affords the Cantor the means to employ them. To place
the scholars in the orchestra weakens the choir, to which they
naturally belong.
By presenting to foundation scholarships boys unskilled and
ignorant of music, the resources at the Cantor's disposal are still
farther lessened.

Hence, Bach concludes, in ceasing to receive my perquisites
I am deprived of the power of putting the music into a better
condition.

No answer was made to Bach's memorial, and he contemplated
resigning his position. But with the advent of Johann Matthias
Gesner as Rector in September 1730 a happier period dawned
upon the incorrigible Cantor. In 1732 Gesner procured the
withdrawal of the Council's ban on Bach's perquisites. The fallen
fortunes of the School revived, and Bach did not again make
an effort to leave Leipzig. In 1736 the grant of the post of [42]
Hof-Componist to the Saxon Court gave him at length a title
which compelled the deference of his civic masters.
Bach's early misunderstanding with the University cut him


40 Johann Sebastian Bach


off from association with the most dignified, if not the most
important, institution in Leipzig, and deprived him of opportunity
to display his genius beyond the radius of his Church duties. The
situation changed in 1729, when he became director of the
University Society, and he held the post for about ten years.
The Society gave weekly concerts on Fridays, from 8 to 10, and
an extra concert, during the Fair season, on Thursdays at the
same hour. It performed vocal and instrumental music and was
the medium through which Bach presented his secular Cantatas,
Clavier and Violin Concertos, and Orchestral Suites to the public.
The proficiency of his elder sons and pupils, and his wife's talent
as a singer, were a farther source of strength to the Society,
whose direction undoubtedly made these years the happiest in
Bach's life. He took his rightful place in the musical life of
the city, and relegated to a position of inferiority the smaller
fry, such as Grner, who had presumed on Bach's aloofness
from the University and Municipality to insinuate themselves.
His increasing reputation as an organist, gained in his annual
autumn tours, also enlightened his fellow-townsmen regarding

[43] the superlative worth of one whom at the outset they were
disposed to treat as a subordinate official.

The Leipzig of Bach's day offered various opportunities
for musical celebration; official events in the University,
gratulations or ovations of favourite professors by their
students, as well as patriotic occasions in which town and gown
participated. The recognised fee for piecs d'occasion of a
public character was fifty thalers. Bach's conductorship of the
University Society enabled him to perform festival works with
the resources they required, and to augment the band and chorus
needed for their adequate performance.

Even before he undertook the direction of the University
Society, Bach more than once provided the music for University
celebrations. On August 3, 1725, his secular Cantata, _Der zufried-_
_engestellte Aeolus,_ was performed at the students' celebration of


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 41


Doctor August Friedrich Mller's name-day. In 1726 he revived
an old Cantata [115] to celebrate the birthday of another of the
Leipzig teachers. In the same year the appointment of Dr.
Gottlieb Kortte as Professor of Roman Law was celebrated by
Bach's Cantata _Vereinigte Zwietracht der wechselnden Saiten._
In 1733 the birthday of another Professor was marked by the
performance of the Cthen Cantata to yet another text ( _Die_
_Freude reget sich_ ). On November 21, 1734, the lost Cantata [44]
_Thomana sass annoch betrbt_ was sung at the induction of
Gesner's successor, Johann August Ernesti, as Rector of St.
Thomas' School.

But Bach's activity as a secular composer at Leipzig was
chiefly expended on patriotic celebrations. His compositions of
this character are particularly numerous during the years 1733-36,
while he was seeking from the Dresden Court the post of HofComponist. The first of these celebrations took place on May 12,
1727, the birthday of Augustus II. of Poland-Saxony, when Bach's
Cantata, _Entfernet euch, ihr heitern Sterne,_ was performed in the
Market Place by the University Society. The King was present
and listened to the performance from a convenient window.
The music is lost. Six years elapsed before Bach was invited
to collaborate in another celebration of the royal House. On
September 5, 1733, less than two months after his application for
the post of Hof-Componist, the University Society celebrated the
eleventh birthday of the Electoral Prince by performing Bach's
dramma per musica, _Die Wahl des Herkules,_ or _Herkules auf_
_dem Scheidewege._ Barely three months later, on December 8,
1733, Bach produced another Cantata in honour of the royal
family, _Tnet, ihr Pauken, erschallet Trompeten,_ of which he
was both author and composer. On no less than three occasions
in 1734 Bach did homage to his unheeding sovereign. In January [45]
the University Society, under Bach's direction, performed his


115 _Steigt freudig in die Luft,_ first performed at Cthen, set to a new text,
_Schwingt freudig euch empor._


42 Johann Sebastian Bach


Cantata _Blast Larmen, ihr Feinde_ to celebrate the coronation of
Augustus III. The music had already done duty in Dr. Mller's
honour in 1725. On the following October 5, 1734, when the
King visited Leipzig, Bach's hurriedly written Cantata, _Preise_
_dein Glcke, gesegnetes Sachsen,_ whose first chorus became the
Osanna of the B minor Mass, was performed in the Market Place.
Two days later, on October 7, 1734, the King's birthday was
celebrated by another Bach Cantata, _Schleicht spielende Wellen,_
performed by the Collegium Musicum. In 1738, having received
the coveted title of Hof-Componist in the interval (1736), Bach
performed a work _Willkommen, ihr herrschenden Gtter der_
_Erden_ now lost, in honour of the marriage of the Princess Maria
Amalia of Saxony to Charles of Sicily, afterwards Charles III. of
Spain.


Apart from his musical activities and the house in which he
lived there is little that permits us to picture Bach's life at Leipzig.
Association with his friends Johann Christian Hoffmann, Musical
Instrument Maker to the Court, Marianne von Ziegler, J. C.
Gottsched and his musical wife, Johann Abraham Birnbaum,
among the Professoriate, Picander and Christian Weiss, Bach's
regular librettists, suggests the amenities of an academic and

[46] literary circle. But the claims of his art and the care of his large
family had the first call upon Bach's interest. And few men had
a happier home life. While his elder sons were at home the
family concerts were among his most agreeable experiences. As
his fame increased, his house became the resort of many seeking
to know and hear the famous organist. Late in the thirties he
resigned his directorship of the University Society. His sons
were already off his hands and out of his house, and he turned
again to the Organ works of his Weimar period. Their revision
occupied the last decade of his life, and the hitherto constant flow
of Church Cantatas ceased. Pupils resorted to him and filled his
empty house, to one of whom, Altnikol, he gave a daughter in
marriage.


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 43


A man of rigid uprightness, sincerely religious; steeped in
his art, earnest and grave, yet not lacking naive humour;
ever hospitable and generous, and yet shrewd and cautious;
pugnacious when his art was slighted or his rights were infringed;
generous in the extreme to his wife and children, and eager to
give the latter advantages which he had never known himself;
a lover of sound theology, and of a piety as deep as it was
unpretentioussuch were the qualities of one who towers above
all other masters of music in moral grandeur.
Four, perhaps only three, contemporary portraits of Bach are
known. One is in the possession of the firm of Peters at Leipzig [47]
and once belonged to Carl Philipp Emmanuel's daughter, who
with inherited impiety sold it to a Leipzig flute player. The
second hung in St. Thomas' School and is reproduced at p. 48
of this volume. It was painted in 1746 and restored in 1913.
Both portraits are by Elias Gottlieb Haussmann, Court Painter at
Dresden. The third portrait belonged to Bach's last pupil, Kittel,
and used to hang on the Organ at Erfurt, whence it disappeared
after 1809, during the Napoleonic wars. Recently Professor Fritz
Volbach of Mainz has discovered a fourth portrait, which is
printed at p. 92 of the present volume. He supposes it to be none
other than the Erfurt portrait, as indeed it well may be, since it
represents a man of some sixty years, austere in countenance, but
of a dignity that is not so apparent in Haussmann's portraiture. [116]

Bach left no will. In consequence his widow, Anna Magdalena,
burdened with the charge of a step-daughter and two daughters,
was entitled to only one-third of her husband's estate. Neither Carl [48]


116 The well-known portrait by C. F. Rr. Liszewski in the Joachimsthal
Gymnasium, Berlin, was painted in 1772, twenty-two years after Bach's death.
It represents him at a table with music-paper before him and an adjacent
Clavier. Pirro uses for his frontispiece a portrait by Geber, which bears no
resemblance whatever to the Haussmann or Volbach pictures. Mention must
also be made of a singularly engaging picture of Bach at the age of thirty-five.
It hangs in the Eisenach Bach Museum and is by Johann Jak. Ihle. It is
reproduced as the frontispiece of this volume.


44 Johann Sebastian Bach


Philipp Emmanuel nor Wilhelm Friedemann was her own child.
But the fact cannot excuse gross neglect of their father's widow.
Her own sons were in a position to make such a contribution to
her income as would at least have kept want from her door. In
fact she was permitted to become dependent on public charity,
and died, an alms-woman, on February 27, 1760, nearly ten years
after her great husband. The three daughters survived her. One
died in 1774, the second in 1781. The third, Regine Susanna,
survived them, her want relieved by gifts from a public that at
last was awakening to the grandeur of her father. Beethoven
contributed generously. Regine Susanna died in December 1809,
the last of Bach's children. In 1845 her nephew, Johann Christoph
Friedrich's son, also died. With him the line of Johann Sebastian
Bach expired.




[49]


CHAPTER IIA. BACH AT LEIPZIG, 1723-1750 45


Johann Sebastian Bach, circa 1746. _From the picture by_

_Haussmann._


# CHAPTER III. BACH AS A CLAVIER PLAYER

As a Clavier player Bach was admired by all who had the good
fortune to hear him and was the envy of the virtuosi of his
day. His method greatly differed from that of his contemporaries
and predecessors, but so far no one has attempted to explain in
what the difference consisted. The same piece of music played
by ten different performers equally intelligent and competent
will produce a different effect in each case. Each player will
emphasise this or that detail. This or that note will stand out with
differing emphasis, and the general effect will vary consequently.
And yet, if all the players are equally competent, ought not their
performances to be uniform? The fact that they are not so is
due to difference of touch, a quality which to the Clavier stands
as enunciation to human speech. Distinctness is essential for
the enunciation of vowels and consonants, and not less so for
the articulation of a musical phrase. But there are gradations of
distinctness. If a sound is emitted indistinctly it is comprehensible
only with effort, which occasions us to lose much of the pleasure [50]
we should otherwise experience. On the other hand, overemphasis of words or notes is to be avoided. Otherwise the
hearer's attention will be diverted from the tout ensemble. To

permit the general effect to be appreciated every note and every
vowel must be sounded with balanced distinctness.

I have often wondered why Carl Philipp Emmanuel Bach's
_Essay on the Right Manner of playing the Clavier_ [117] does not
elucidate the qualities that constitute a good touch. For he


117 His _Versuch ber die wahre Art des Klavier zu spielen_ was published (Part
I.) in 1753.


48 Johann Sebastian Bach


possessed in high degree the technique that made his father
pre-eminent as a player. True, in his chapter on Style in
Performance, he writes, Some persons play as if their fingers
were glued together; their touch is so deliberate, and they keep
the keys down too long; while others, attempting to avoid this
defect, play too crisply, as if the keys burnt their fingers. The
right method lies between the two extremes. But it would have
been more useful had he told us how to reach this middle path.
As he has not done so, I must try to make the matter as clear as
is possible in words.
Bach placed his hand on the finger-board so that his fingers
were bent and their extremities poised perpendicularly over the

[51] keys in a plane parallel to them. [118] Consequently none of his
fingers was remote from the note it was intended to strike, and
was ready instantly to execute every command. Observe the
consequences of this position. First of all, the fingers cannot
_fall_ or (as so often happens) be _thrown_ upon the notes, but are
_placed_ upon them in full control of the force they may be called
on to exert. In the second place, since the force communicated
to the note needs to be maintained with uniform pressure, the
finger should not be released perpendicularly from the key, but
can be withdrawn gently and gradually towards the palm of the
hand. In the third place, when passing from one note to another,
a sliding action instinctively instructs the next finger regarding
the amount of force exerted by its predecessor, so that the tone
is equally regulated and the notes are equally distinct. In other
words, the touch is neither too long nor too short, as Carl Philipp
Emmanuel complains, but is just what it ought to be. [119] Many


118 Forkel's meaning can be made clear in the following manner: place the
thumb and fingers of either hand upon the notes C D E F G of the pianoforte so
that the three middle fingers lie more or less flat upon the keys; then draw back
the three middle fingers until they form an arch having their tips approximately
in a straight line with the tips of the thumb and little finger upon the keys.
119 It must be remembered that Forkel is speaking of the Clavier and not of the
Pianoforte.


CHAPTER III. BACH AS A CLAVIER PLAYER 49


advantages arise from holding the hand in Bach's position and
from adopting his touch, on the Clavichord and Harpsichord, [120] [52]
and on the Organ as well. I point out merely the most important
of them. To begin with, if the fingers are bent, their movements
are free. The notes are struck without effort and with less risk

of missing or hitting too hard, a frequent fault with people who
play with their fingers elongated or insufficiently bent. In the
second place, the sliding finger-tip, and the consequently rapid
transmission of regulated force from one finger to another, tend
to bring out each note clearly and to make every passage sound
uniformly brilliant and distinct to the hearer without exertion. In
the third place, stroking the note with uniform pressure permits
the string to vibrate freely, improves and prolongs the tone, and
though the Clavichord is poor in quality, allows the player to
sustain long notes upon it. And the method has this advantage: it
prevents over-expenditure of strength and excessive movement
of the hand. We gather that the action of Bach's fingers was so
slight as to be barely perceptible. Only the top joint seemed to
move. His hand preserved its rounded shape even in the most
intricate passages. His fingers rested closely upon the keys, very
much in the position required for a shake. An unemployed
finger remained in a position of repose. It is hardly necessary [53]
to say that that other limbs of his body took no part in his
performance, as is the case with many whose hands lack the
requisite agility. [121]


120 The Harpsichord, as its name implies, was an instrument whose strings
were plucked by a plectrum. Bach preferred the older Clavier, or Clavichord,
which could be regulated, as the other could not, by nicety of touch. See note,
p. 68, infra.
121 Schweitzer (i. 208) points out that Bach's touch was modern, in that he
realised that singing tone depends not only upon the manner in which the
keys are struck, but, to a great extent, on the regulation of their ascent.
Of Handel's touch, Burney writes (quoted by Rockstro, p. 349): His
touch was so smooth, and the tone of the instrument so much cherished, that
his fingers seemed to grow to the keys. They were so curved and compact


50 Johann Sebastian Bach


A man may possess all these qualities, however, and remain an
indifferent performer on the Clavier, just as clear and agreeable
enunciation does not necessarily make a good speaker. To be a
first-rate performer many other qualities are needed, and Bach
possessed them all in a notable degree.

Some fingers are longer and stronger than others. Hence
players are frequently seduced to use the stronger whenever
they can readily do so. Consequently successive notes become
unequal in tone, and passages which leave no choice as to
the finger to be used may become impossible to play. Bach
recognised this fact very early in his career. To get over the
difficulty he invented exercises for his own use in which the
fingers of both hands were made to practise passages in every
conceivable position. By this means every finger on both hands

[54] equally became strong and serviceable, so that he could play
a rapid succession of chords, single and double shakes, and
running passages with the utmost finish and delicacy, and was
equally fluent in passages where some fingers play a shake
while the others on the same hand continue the melody.

Besides these improvements, Bach invented a new system of
fingering. [122] Before his time, and even in his early years, it


when he played, that no motion, and scarcely the fingers themselves, could be
discovered.
122 At the beginning of the seventeenth century, as Spitta points out (ii. 34),
the art of fingering had not developed. Speaking generally, neither thumb nor
little finger was employed. It was not until the beginning of the eighteenth
century that a scientific method emerged, a development rendered necessary
by the advance in the modes of musical expression. C. P. E. Bach, quoted by
Schweitzer (i. 206), puts this concisely: My late father told me that in his
youth he had heard great men who never used the thumb except when it was
necessary to make big stretches. But he lived in an epoch when there came
about gradually a most remarkable change in musical taste, and therefore found
it necessary to work out for himself a much more thorough use of the fingers,
and especially of the thumb, which, besides performing other good services,
is quite indispensable in the difficult keys, where it must be used as nature
intends.


CHAPTER III. BACH AS A CLAVIER PLAYER 51


was usual for the player to pay attention to harmony rather than
counterpoint. Even so it was not customary to use every one
of the twenty-four major and minor keys. The Clavichord was
still what we term gebunden; that is, several keys struck the
same string, which, therefore, could not be accurately tuned. [123]

Consequently it was usual to employ only those keys whose
notes were tuned with some approximation to accuracy. Again,
good players in those days hardly ever used the thumb, except [56]
when a large interval had to be stretched. But when Bach began
to melodise harmony so that his middle parts not merely filled in
but had a tune of their own, when, too, he began to deviate from
the Church modes then in general vogue in secular music, using
the diatonic and chromatic scales indifferently, and tuning the
Clavier in all the twenty-four keys, he found himself compelled to
introduce a system of fingering better adapted to his innovations
than that in use, and in particular, to challenge the convention
which condemned the thumb to inactivity. It is held by some
writers that Couperin forestalled Bach's method of fingering, in
his _L'Art de toucher le Clavecin,_ published in 1716. But that
is not the case. In the first place, Bach was above thirty years
old in 1716, and had already developed a distinctive method of
his own. And in the second place, Couperin's system differs
materially from Bach's, though both made more frequent use of
the thumb than was so far customary. When I say more frequent
use I do so advisedly; for whereas in Bach's system the thumb
is the principal fingerfor the difficult keys, as they are called,
are unplayable without itit is not equally indispensable with
Couperin, whose thematic material was not so intricate as Bach's,
nor did he compose or play in such difficult keys. Consequently
Couperin had not an equally urgent need to use the thumb. We [56]
need only compare Couperin's with Bach's system of fingering,


123 According to Mr. Arnold Dolmetsch, Clavichords with special strings for
each note (bundfrei) were known in Bach's time.


52 Johann Sebastian Bach


as Carl Philipp Emmanuel explains it, [124] to discover that Bach's
permits every passage, however intricate and polyphonic, to be
played with ease, whereas Couperin's is hardly effective even
for his own compositions. Bach was acquainted with Couperin's
works and highly esteemed them, [125] as he did those of other
French Clavier composers, for their finish and brilliance. But
he considered them affected in their excessive use of ornaments,
scarcely a single note being free from them. He held them, also,
superficial in matter.

Bach's easy, unconstrained use of the fingers, his musical
touch, the clearness and precision of every note he struck, the
resourcefulness of his fingering, his thorough training of every
finger of both hands, the luxuriance of his thematic material and
his original method of stating it, all contributed to give him almost
unlimited power over his instrument, so easily did he surmount
the difficulties of its keyboard. Whether he improvised or played
his compositions from notes, he systematically employed every
finger of each hand, and his fingering was as uncommon as the

[57] compositions themselves, yet so accurate that he never missed
a note. Moreover, he read at sight other people's compositions
(which, to be sure, were much easier than his own) with the
utmost facility. Indeed, he once boasted to a friend at Weimar
that he could play at sight and without a mistake anything put
before him. But he was mistaken, as his friend convinced him
before the week was out. Having invited Bach to breakfast one
morning, he placed on the Clavier, among other music, a piece
which, at a first glance, seemed perfectly easy. On his arrival,
Bach, as was his custom, sat down at the Clavier to play or look
through the music. Meanwhile his friend was in the next room
preparing breakfast. In a short time Bach took up the piece of


124 In the _Essay_ already referred to. For a discussion of Couperin's method see
Spitta, ii. 37 ff.
125 For instance, the Rondeau in B flat in Anna Magdalena's _Noten- buch_ (No.
6) (1725) is by Couperin.


CHAPTER III. BACH AS A CLAVIER PLAYER 53


music destined to change his opinion and began to play it. He
had not proceeded far before he came to a passage at which he
stopped. After a look at it he began again, only to stop at the
same place. No, he called out to his friend, who was laughing
heartily in the next room, the man does not exist who can play
everything at sight. It can't be done. With that he got up from
the Clavier in some annoyance. [126]


Bach also could read scores with remarkable facility and play
them on the Clavier. He found no more difficulty in piecing
together the separate parts when laid side by side before him. [127] [58]
He often did so when a friend brought him a new Trio or Quartet
for Strings and wished to hear how it sounded. If a Continuo part,
however badly figured, was put before him he could improvise a
Trio or Quartet upon it. Nay, when he was in the mood and at
the height of his powers, he would convert a Trio into a Quartet
by extemporising a fourth part. On such occasions he used a
Harpsichord with two manuals and pedal attachment.

Bach preferred the Clavichord to the Harpsichord, which,
though susceptible of great variety of tone, seemed to him
lacking in soul. The Pianoforte was still in its infancy and too
coarse. [128] Both for practice and intimate use he regarded the [59]


strings. It was for this instrument that the so-called Organ Sonatas of Bach
were written. He possessed five Clavicembali, but not a single Clavichord at
the time of his death. For that reason it has been questioned whether Forkel is
accurate in stating that Bach preferred the latter instrument. See Schweitzer, i.
200 ff.
126 No doubt the friend who prepared this trap for Bach was Johann Gottfried
Walther. His compositions frequently were characterised by intricacy.
127 Mozart had the same gift. When visiting St. Thomas' School in 1789, he
heard with astonishment a performance of Bach's Motet, _Singet dem Herrn_
_ein neues Lied._ At the conclusion he expressed his delight, and said, Now
that is something from which a man may learn. On being informed that Bach
was Cantor to this school, and that his Motets were venerated there as reliques,
he was eager to see them. No score being to be obtained, they handed him
the separate parts, and it was interesting to observe his manner of reading
them, holding some in his hands, some on his knees, placing some on chairs


54 Johann Sebastian Bach


Clavichord as the best instrument and preferred to express on it
his finest thoughts. He held the Harpsichord, or Clavicembalo,
incapable of the gradations of tone obtainable on the Clavichord,
an instrument which, though feeble in quality, is extremely
flexible.


No one could adjust the quill plectrums of his Harpsichord
to Bach's satisfaction; he always did it himself. He tuned his
Harpsichord and Clavichord, and was so skilful in the operation
that it never took him more than a quarter of an hour. It enabled
him to play in any key he preferred, and placed the whole twentyfour of them at his disposal, so that he could modulate into the
remoter as easily and naturally as into the more nearly related
keys. Those who heard him frequently could hardly detect the
fact that he had modulated into a distant key, so smooth were his
transitions. In chromatic movements his modulation was as easy
and sequent as in diatonic. His _Chromatic Fantasia,_ which is
now published, [129] bears out my statement. In his extemporisation

[60] he was even freer, more brilliant and expressive.


When he played his own music Bach usually adopted a brisk
pace. He contrived to introduce so much variety that every piece
became a sort of conversation between its parts. If he wished
to express deep emotion he did not strike the notes with great
force, as many do, but expressed his feeling in simple melodic


around him; seeming thoroughly lost to everything, and not rising till he had
thoroughly satisfied his curiosity (Holmes, _Life of Mozart,_ ed. Dent, p. 251).
128 There were in Bach's time three Clavier instruments in use. The oldest,
the Clavichord, as a rule, had two strings to every note, set in motion by a
tangent striking them from below. Its advantage was that it permitted the
tone to be regulated by the touch. For that reason, though its tone was weak,
Bach preferred it. The Clavicembalo, or Harpsichord, as it is called in the text,
was in general known as the Flgel, the strings being plucked, or flipped
by a quill or metal pin, after the manner of the modern mandoline. The third
instrument was the piano e forte, or Hammerclavier. The Clavicembalo was
also built with two keyboards, like an Organ, and a pedal-board provided with
129 Peters bk. 207 p. 4.


CHAPTER III. BACH AS A CLAVIER PLAYER 55


and harmonic figures, [130] relying rather on the internal resources
of his art than external dynamics. Therein he was right. True
emotion is not suggested by hammering the Clavier. All that
results is that the notes cannot be heard distinctly, much less be
connected coherently.


130 The truth of this remark is very evident in the _Orgelbchlein._


# CHAPTER IV. BACH THE ORGANIST

What has been said regarding Bach's admirable Clavier playing
applies generally to his skill as an organist. The Clavier and Organ
have points in common, but in style and touch are as different
as their respective uses. What sounds well on the Clavier is
ineffective on the Organ, and vice versa. The most accomplished
Clavier player may be, and usually is, a bad organist unless
he realises the differing natures of the two instruments and the
uses they serve. I have come across only two men who can
be regarded as exceptions to this general ruleBach and his
eldest son, Wilhelm Friedemann. Both were finished Clavier
performers, but no trace of the Clavier style was apparent when
they played the Organ. Melody, harmony, and pace were
carefully selected with due regard to the nature and distinctive
use of each instrument. When Wilhelm Friedemann played the
Clavier his touch was elegant, delicate, agreeable. When he
played the Organ he inspired a feeling of reverent awe. On the
one he was charming. On the other he was solemn, impressive. [62]
So also was his father, and to an even greater degree. Wilhelm
Friedemann was a mere child to him as an organist, and frankly
admitted the fact. [131] The music that extraordinary man wrote
for the Organ is full of dignity, awe-inspiring, saturated with
the atmosphere of devotion. His improvisation was even more
inspired, dignified, and impressive: for then his imagination
was untrammelled by the irksomeness of expressing himself


131 Forkel writes as though he were in a position by personal knowledge to
compare the gifts of Bach and his son. In fact he was born in 1749 and was
less than two years old when Bach died.


58 Johann Sebastian Bach


on paper. What is the essence of this art? Let me, though
imperfectly, attempt an answer.

When we compare Bach's Clavier compositions with those
written for the Organ it is at once apparent that they differ
essentially in melodic and harmonic structure. Hence we
conclude that a good organist must select fitting themes for
his instrument, and let himself be guided by its character and
that of the place in which it stands and by the objects of its
use. Its great body of tone renders the Organ ill-adapted to light
and jaunty music. Its echoes must have liberty to rise and fall
in the dim spaces of the church, otherwise the sound becomes
confused, blurred, and unintelligible. What is played upon it

[63] must be suited to the place and the instrument, in other words,
must be congruous to a solemn and majestic fabric. Occasionally
and exceptionally a solo stop may be used in a Trio, etc. But the
proper function of the Organ is to support church singing and to
stimulate devotional feeling. The composer therefore must not
write music for it which is congruous to secular surroundings.
What is commonplace and trite can neither impress the hearer
nor excite devotional feeling. It must therefore be banished from
the Organ-loft. How clearly Bach grasped that fact! Even his
secular music disdained trivialities. Much more so his Organ
music, in which he seems to soar as a spirit above this mortal
planet.

Of the means by which Bach attained to such an altitude as a
composer for the Organ we may notice his harmonic treatment
of the old Church modes, his use of the obbligato pedal, and
his original registration. The remoteness of the ecclesiastical
modes from our twenty-four major and minor keys renders them
particularly appropriate to the service of religion. Any one who
looks at Bach's simple four-part Hymn tunes (Choralgesnge)
will at once convince himself of the fact. But no one can

realise how the Organ sounds under a similar system of harmonic
treatment unless he has heard it. It becomes a choir of four or


CHAPTER IV. BACH THE ORGANIST 59


five parts, each in its natural compass. Compare the following [64]
chords in divided harmony:


with these:


which is the more usual form organists employ. We realise
instantly the effect when music in four or more parts is played in
the same manner. Bach always played the Organ so, adding the
obbligato pedal, which few organists know how to use properly.
He employed it not only to sound the low notes which organists
usually play with the left hand, but he gave it a regular part of
its own, often so complicated that many organists would find it
difficult to play with their five fingers.
To these qualities must be added the exquisite art Bach
displayed in combining the stops of the Organ. His registration
frequently astonished organists and Organ builders, who ridiculed
it at first, but were obliged in the end to admit its admirable results [65]
and to confess that the Organ gained in richness and sonority. [132]

Bach's peculiar registration was based on his intimate
knowledge of Organ building and of the properties of each
individual stop. Very early in his career he made a point of


132 On Bach's use of the stops see Spitta, i. 394 ff., and Pirro's _L'Orgue de J.-S._
_Bach._


60 Johann Sebastian Bach


giving to each part of the Organ the utterance best suited to
its qualities, and this led him to seek unusual combinations of
stops which otherwise would not have occurred to him. Nothing
escaped his notice which had the slightest bearing on his art
or promised to advance it. For instance, he made a point of
observing the effect of large musical compositions in different
surroundings. The practised ear, which enabled him to detect the
slightest error in music even of the fullest and richest texture,
and the art and rapidity with which he tuned his instrument, alike
attest his intuitive skill and many-sidedness. When he was at
Berlin in 1747 he was shown the new Opera House. He took in
its good and bad qualities at a glance, whereas others had done so
only after experience. He was shown the large adjoining Saloon
and went up into the gallery that runs round it. Merely glancing
at the roof he remarked, The architect has secured a novel effect
which, probably, neither himself nor any one else suspected.

[66] The Saloon, in fact, is a parallelogram. If a person puts his face
to the wall in one corner of it and whispers a few words, another
person at the corner diagonally opposite can hear them distinctly,
though to others between them the words are inaudible. The
effect arises from the span of the arches in the roof, as Bach saw
at a glance. These and similar observations suggested to him
striking and unusual combinations of Organ stops.


Bach brought the methods I have indicated to bear upon Church
music, and they help to explain his extraordinarily dignified and
inspired playing, which was at once so appropriate and filled the
listener with deep awe and admiration. His profound knowledge
of harmony, unfailing originality, freedom from a secular style,
his complete command of the instrument, both manuals and
pedals, whence flowed a generous stream of the richest and most
abundant fancy, the infallible and swift judgment which allowed
him always to select from the treasury of his mind precisely the
musical ideas best suited to the occasion immediately before him,
his intuitive grasp of every detail, and his power to make it serve


CHAPTER IV. BACH THE ORGANIST 61


his artistic endsin a word, his transcendent genius brought the
art of Organ playing to a degree of perfection which, till then, it
had never attained and hardly will attain again. Quantz [133] has
expressed the same opinion. The admirable Johann Sebastian [67]
Bach, he writes, brought the art of Organ playing to its highest
perfection. It is to be hoped that when he dies it will not be
suffered to decline or be lost, as is to be feared from the small
number of people who nowadays bestow pains upon it. [134]


Strangers often asked Bach to play to them between the hours
of divine service. On those occasions he was wont to select

and treat a theme in various ways, making it the subject of each
extemporisation even if he continued playing for two hours. As
a beginning he played a Prelude and Fugue on the Great Organ.
Then he developed it with solo stops in a Trio or Quartet. A
Hymn-tune followed, whose melody he interrupted in the subtlest
fashion with fragments of the theme in three or four parts. Last
came a Fugue, with full Organ, in which he treated the subject
alone or in association with one or more accessory themes. Here
we have the art which old Reinken of Hamburg considered to be
lost, but which, as he afterwards found, not only survived but
attained its greatest perfection in Bach.


Bach's pre-eminent position and his high reputation often
caused him to be invited to examine candidates for vacant

organistships, and to report on new Organs. In both cases he
acted so conscientiously and impartially that he generally made
enemies. Scheibe, late Director of Music at the Danish Court, [68]
who as a young man was examined by Bach on such an occasion,
was so incensed by Bach's unfavourable verdict that he afterwards


133 Johann Joachim Quantz, b. 1697; flute player and composer; taught
Frederick the Great the flute; settled at Berlin as Kammer-musikus and Court
Composer; d. 1773.
134 The _Nekrolog_ sums up more briefly than Forkel, in a judgment which,
without doubt, is the very truth: Bach was the greatest Organ player that had
yet been known.


62 Johann Sebastian Bach


avenged himself in his Critical Musician by violently attacking
his examiner. [135] In his examination of Organs Bach equally
exposed himself to trouble. He could as little prevail on himself
to praise a bad instrument as to recommend a bad organist. He
was, therefore, severe, though always fair, in the tests he applied,
and as he was thoroughly acquainted with the construction of the
instrument it was hopeless to attempt to deceive him. First of
all he drew out all the stops, to hear the Full Organ. He used to
say jokingly, that he wanted to find out whether the instrument
had good lungs! Then he gave every part of it a most searching
test. But his sense of fairness was so strong that, if he found

[69] the work really well done, and the builder's remuneration too
small, so that he was likely to be a loser, Bach endeavoured, and
often successfully, to procure for him an adequate addition to the
purchase price.

When the examination was over, especially if the instrument
pleased him, Bach liked to exhibit his splendid talent, both
for his own pleasure and the gratification of those who were
present. Such demonstrations of his powers invariably invited
the verdict, that he was conclusively the prince of Clavier and
Organ players, a title which Sorge, the late highly-esteemed
organist at Lobenstein, [136] once gave him in a dedicatory Preface.


135 Johann Adolph Scheibe, a native of Leipzig, was an unsuccessful candidate
for the Organistship of St. Thomas' Church in 1729. Bach was one of the
judges. In 1737 Scheibe published in the Kritische Musikus a criticism of
Bach which, while doing justice to his powers as an organist, characterised his
compositions as turgid and confused in character. Bach was incensed by the
criticism and asked his friend, Professor Birnbaum of Leipzig, to answer it.
Scheibe replied in 1739, with a wholly unjustified challenge of Bach's general
education and culture. In his Phoebus and Pan, performed in 1731, Bach
had already had the satisfaction of representing Scheibe as Midas and calling
him an ass. On the whole matter see Schweitzer, i. 178 ff. and Spitta, iii. 252.
Scheibe conducted the Court orchestra at Copenhagen from 1742-49 and died
there in 1776.
136 Georg Andreas Sorge, Court and Town Organist to the Count of Reuss
and Plau at Lobenstein, in his dedication thus commended Bach: The great


CHAPTER IV. BACH THE ORGANIST 63


musical virtue that Your Excellency possesses is embellished with the excellent
virtue of affability and unfeigned love of your neighbour. See Schweitzer, i.
155.




[70]


# CHAPTER V. BACH THE COMPOSER

Bach's first attempts at composition, like all early efforts, were
unsatisfactory. Lacking special instruction to direct him towards
his goal, he was compelled to do what he could in his own
way, like others who have set out upon a career without a
guide. Most youthful composers let their fingers run riot up and
down the keyboard, snatching handfuls of notes, assaulting the
instrument in wild frenzy, in hope that something may result
from it. Such people are merely Finger Composersin his riper
years Bach used to call them Harpsichord Knightsthat is to say,
their fingers tell them what to write instead of being instructed
by the brain what to play. [137] Bach abandoned that method
of composition when he observed that brilliant flourishes lead [71]
nowhere. He realised that musical ideas need to be subordinated

to a plan and that the young composer's first need is a model
to instruct his efforts. Opportunely Vivaldi's Concertos for the
Violin, [138] then recently published, gave him the guidance he


137 The following passage from the Autobiography of Hector Berlioz (ed. Dent,
p. 11) is relevant: My father would never let me learn the piano; if he had,
no doubt I should have joined the noble army of piano thumpersSometimes
I regret my ignorance, yet, when I think of the ghastly heap of platitudes for
which that unfortunate piano is made the daily excuseinsipid, shameless
productions, that would be impossible if their perpetrators had to rely, as they
ought, on pencil and paper alonethen I thank the fates for having forced me
to compose silently and freely by saving me from the tyranny of finger-work,
that grave of original thought.
138 Antonio Vivaldi, A. 1743; a master of form. That fact turned the attention
of German composers to him; while the popularity of his Violin Concertos also
attracted musicians, like Bach, whose work at Cthen was in close association
with the Court Kapelle or band.


66 Johann Sebastian Bach


needed. He had often heard them praised as admirable works
of art, and conceived the happy idea of arranging them for the
Clavier. [139] Hence he was led to study their structure, the musical
ideas on which they are built, the variety of their modulations,
and other characteristics. Moreover, in adapting to the Clavier
ideas and phrases originally written for the Violin Bach was
compelled to put his brain to work, and so freed his inspiration
from dependence on his fingers. Henceforth he was able to draw
ideas out of his own storehouse, and having placed himself on the
right road, needed only perseverance and hard work to succeed.

[72] And how persevering he was! He even robbed himself of sleep to
practise in the night what he had written during the day! But the
diligence he bestowed upon his own compositions did not hinder
him from studying the works of Frescobaldi, [140] Froberger, Kerl,
Pachelbel, Fischer, Strungk, [141] Buxtehude, Reinken, Bruhns,
Bhm, and certain French organists who were famed in those
days as masters of harmony and fugue. [142]


The models he selectedChurch musicians for the most

partand his own disposition inclined him to serious and exalted
subjects. But in that kind of music little can be accomplished
with inadequate technique. Bach's first object, therefore, was to
develop his power of expressing himself before he attempted to
realise the ideal that beckoned him. Music to him was a language,


139 Bach re-wrote sixteen Vivaldi Violin Concertos for the Clavier, four of
them for the Organ, and developed one into a Concerto for four Claviers and a
quartet of strings which Forkel enumerates ( infra, p. 132) as a composition of
Bach's (Peters bk. 260). Bach learnt from Vivaldi clearness and plasticity of
musical structure. See article _Vivaldi_ in Grove; Spitta, i. 411 ff; Schweitzer,
i. 192 ff. The Vivaldi Clavier Concertos are in Peters bk. 217; the Organ
Concertos in Novello bk. 11. Not all these transcriptions are based on Vivaldi.
See Schweitzer, i. 193.
140 Girolamo Frescobaldi, b. 1583, d. 1644; Organist of St. Peter's, Rome.
141 Delphin Strungk, b. 1601, d. 1694; Organist of St. Martin's, Brunswick;
composed for the Organ.
142 Purcell should be added to those whom Forkel mentions as Bach's models.

See infra, p. 261.


CHAPTER V. BACH THE COMPOSER 67


and the composer a poet who, whatever the idiom he affects,
must first of all have at his disposal the means of making himself
intelligible to others. But the technique of his period Bach found
limited in variety and insufficiently pliable. Therefore he set
himself at the outset to refashion the accepted harmonic system.
He did so in a manner characteristically individual and bearing
the impress of his personality. [73]

If the language of music is merely the utterance of a melodic
line, a simple sequence of musical notes, it can justly be accused
of poverty. The addition of a Bass puts it upon a harmonic
foundation and clarifies it, but defines rather than gives it
added richness. A melody so accompaniedeven though all
the notes are not those of the true Bassor treated with simple
embellishments in the upper parts, or with simple chords, used
to be called homophony. But it is a very different thing when
two melodies are so interwoven that they converse together
like two persons upon a footing of pleasant equality. In the
first case the accompaniment is subordinate, and serves merely
to support the first or principal part. In the second case the
two parts are not similarly related. New melodic combinations
spring from their interweaving, out of which new forms of
musical expression emerge. If more parts are interwoven in the
same free and independent manner, the apparatus of language is
correspondingly enlarged, and becomes practically inexhaustible
if, in addition, varieties of form and rhythm are introduced.
Hence harmony becomes no longer a mere accompaniment of
melody, but rather a potent agency for augmenting the richness
and expressiveness of musical conversation. To serve that end
a simple accompaniment will not suffice. True harmony is the
interweaving of several melodies, which emerge now in the [74]
upper, now in the middle, and now in the lower parts.

From about the year 1720, when he was thirty-five, until
his death in 1750, Bach's harmony consists in this melodic
interweaving of independent melodies, so perfect in their union


68 Johann Sebastian Bach


that each part seems to constitute the true melody. Herein Bach
excels all the composers in the world. [143] At least, I have found
no one to equal him in music known to me. Even in his four-part
writing we can, not infrequently, leave out the upper and lower
parts and still find the middle parts melodious and agreeable.

But in harmony of this kind each part must be highly plastic;
otherwise it cannot play its role as an actual melody and at the
same time combine with the other parts. To produce it Bach
followed a course of his own, upon which the textbooks of his
day were silent, but which his genius suggested to him. Its
originality consists in the freedom of his part writing, in which
he transgresses, seemingly, at any rate, rules long established and
to his contemporaries almost sacred. Bach, however, realised
their object, which was simply to facilitate the flow of pure
melody on a sound harmonic basis, in other words, successive
and coexistent euphony, and he succeeded with singular success

[75] though by unfamiliar means. Let me explain my meaning more
closely.

Between simple intervals there is little difficulty in deciding
whether the second note must rise or fall. And in regard to
phrases, or sections of a phrase, if we analyse their structure and
follow out their harmonic tendency, their resolution is equally
clear. But this sense of destination may be provoked in each part
by different intervals. As we have observed already, every one of
the four parts must flow melodically and freely. But to secure that
result it will be necessary to introduce between the notes which
begin a phrase and establish its general atmosphere other notes
which often are not consonant with those employed in the other
parts and whose incidence is governed by the accent. This is
what we call a transitus regularis et irregularis. [144] Each part starts


143             - See Kirnberger's Kunst des reinen Satzes, p. 157. [The work was
published in two volumes at Berlin in 1771, 1776.]
144 Transitus regularis= a passing note on the unaccented portions of the bar;
transitut irregularis=a passing note on the accented part of the bar.


CHAPTER V. BACH THE COMPOSER 69


from a fixed point, and returns to it, but travels freely between
them. No one has made more use of such progressions than Bach
in order to colour his parts and give them a characteristic melodic
line. Hence, unless his music is played with perfect fluency,
occasional passages will sound harshly and we may be tempted
to accuse him of exaggeration. But the charge is ill founded.
Once we play them as Bach intended them, such passages reveal [76 ]
their full beauty and their attractive though bizarre dissonance
opens up new vistas in the realm of sound.


But, to speak in detail of Bach's transgression of recognised
rules. To begin with, he admitted octaves and fifths provided they
sounded well; that is, when the cause of their being forbidden did
not arise. [145] Everybody knows that there are positions in which
they sound well, and others when they should be avoided, owing
to the harsh effect or thin harmony they produce. Bach's octaves
and fifths never produce bad or thin harmony, and he was very
definite as to when they could and could not be used. In certain
circumstances he would not permit hidden fifths and octaves
even between the middle parts, though we exclude them only
between the outer parts. Yet, on occasion he used them in such a
barefaced manner as to puzzle the beginner in composition. But
their use very soon commends itself. Even in the last revision
of his early compositions we find him altering passages, which
at first sight appear impeccable, with the object of enriching
their harmony and without scrupling to use hidden octaves. A
remarkable instance occurs in the first part of the _Well-tempered_ [77]
_Clavier,_ in the E major Fugue, between the fifth and fourth bars


145 Spitta (iii. 315 ff. ) prints a treatise by Bach, _Rules and Instructions for_
_playing Thorough-bass or Accompaniment in Four Parts,_ dated 1738. Rule 3
of chap. vi. states: Two fifths or two octaves must not occur next one another,
for this is not only a fault, but it sounds wrong. To avoid this there is an old
rule, that the hands must always go against one another, so that when the left
goes up the right must go down, and when the right goes up the left must go
down.


70 Johann Sebastian Bach


from the end. [146] I regret to this hour that, on looking over the
later text, from which Hoffmeister and Khnel's edition of that
work is printed, [147] I was so foolish as to reject Bach's amended
reading there, merely because the harmony is unorthodox though
more pleasing. I stupidly preferred the older, more correct, and
harsher reading, though in the later text the three parts run easily
and smoothly. And what more can one demand?

Again, there is a rule that every note raised by an accidental
cannot be doubled in the chord, because the raised note must,

from its nature, resolve on the note above. If it is doubled, it must
rise doubled in both parts and, consequently, form consecutive
octaves. Such is the rule. But Bach frequently doubles not
only notes accidentally raised elsewhere in the scale but actually
the semitonium modi or leading-note itself. Yet he avoids
consecutive octaves. His finest works yield examples of this.

Again, Bach's statement that over a pedal point all intervals
are permissible that occur in the three scales [148] should be

[78] regarded rather an expansion than a violation of the recognised
rule. In general what is called an Organ point is merely a retarded
close. Bach, however, did not hesitate to employ it in the middle
of a piece; a striking example occurs in the last Gigue of the
_English Suites._ [149] On a first hearing this Gigue, imperfectly
rendered, may not sound well. But it grows more beautiful as
it becomes more familiar, and what seemed harsh is found to
be smooth and agreeable, until one never tires of playing and
hearing it.

Bach's modulation was as original and characteristic as his
harmony, and as closely related to it. But the two things,
though closely associated, are not the same. By harmony we


146 Actually the third beat of the fourth bar from the end. P. bk. 1 p. 37 Fugue
no. 9.
147 Forkel edited the _Wohltemperirte Clavier_ for Hoffmeister in 1801.
148 The rule is not in the _Rules and Instructions_ already referred to.
149 Suite No. 6, in D minor (P. bk. 204 p. 84).


CHAPTER V. BACH THE COMPOSER 71


mean the concordance of several parts; by modulation, their
progression through keys. Modulation can take place in a single
part. Harmony requires more than one. I will endeavour to make
my meaning clearer.


Most composers stick closely to their tonic key and modulate
out of it with deliberation. In music that requires a large number
of performers, and in a building, for instance a church, where
the large volume of sound dies away slowly, such a habit shows
good sense in the composer who wishes his work to produce the
best possible effect. But in chamber or instrumental music it
is not always a proof of wisdom, but rather of mental poverty.
Bach saw clearly that the two styles demand different treatment. [79]
In his large choral compositions he bridles his exuberant fancy.
In his instrumental works he lets himself go. As he never
courted popularity, but always pursued his ideal, Bach had no
reason to suppress the nobility of his inspirations, or to lower
their standard for public consumption. Nor did he ever do so.
Therefore every modulation in his instrumental work is a new
thought, a constantly progressive creation in the plane of the
chosen keys and those related to them. He holds fast to the
essentials of harmony, but with every modulation introduces a
new suggestion and glides so smoothly to the end of a piece that
no creaking of machinery is perceptible; yet no single barI
might almost say no part of a baris like another. Every
modulation bears a strict relationship to the key from which it
proceeds, and springs naturally from it. Bach ignored, or rather
despised, the sudden sallies by which many composers seek
to surprise their hearers. Even in his chromatic passages his
progressions are so smooth and easy that we are hardly conscious
of them, however extreme they may be. He makes us feel that
he has not stepped outside the diatonic scale, so quick is he to
seize upon the consonances common to dissonant systems and
combine them to his sure purpose.


72 Johann Sebastian Bach


The Bach Statue at Eisenach


# CHAPTER VI. BACH THE COMPOSER (continued)


[80]
Bach's treatment of harmony and modulation powerfully
influenced his melody. The strands of his harmony are really
concurrent melodies. They flow easily and expressively, never
engross the hearer's attention, but divide his interest, as now one
now the other becomes prominent. Even when they are noticeable
they seem obscured by the melodic parts that accompany themI
say seem obscured, for if the hearer is sufficiently instructed to
distinguish the several melodies in the ensemble he will discover
them to be more clearly defined by their accompaniment.
The combination of several melodic lines obliges the composer
to use devices which are unnecessary in homophonic music. A
single melody can develop as it pleases. But when two or
more are combined each must be so delicately and cleverly
fashioned that it can be interwoven with the others in this

direction and in that. And here we detect one at least of the

reasons why Bach's melodies are so strangely original, and his
tunes so clearly distinguishable from those of other composers. [81]
Provided that novelty does not degenerate into eccentricity or
extravagance, and that clearness and facility of expression march
with agreeableness, a composer's meritoriousness is proclaimed
in his originality. [150] The one drawback is that the ordinary hearer


150 - Many people hold the opinion that the best melody is one which the
largest number of persons can understand and sing. But this cannot be admitted,
for if it were true, popular airs which are sung up and down the country by all
classes, even the lowest, must be accounted the finest and best. I should be
inclined to state the proposition conversely: a melody which attracts everybody
is invariably of the most ordinary kind. In that form the statement might,
perhaps, pass as a principle.


74 Johann Sebastian Bach


cannot appreciate melodic beauties which are patent only to the

expert.

But Bach's melodies are not invariably so handicapped. They
are always original, it is true. But in his free compositions the
melodies are so natural and spontaneous that, while they sound
differently from those of other composers, their naturalness, and
the sincerity of feeling that inspires them, make them intelligible
to every listener. Most of the Preludes in the _Well-tempered_
_Clavier_ as well as a number of movements in the Suites are of

this character.

Bach's melody, then, bears the unmistakable stamp of
originality. And so does his passage work, as it is called.
Such novelty, originality, and brilliancy are not found in any
other composer. Examples are to be found in all Bach's Clavier

[82] works. But the most striking and original are in the _Great_
_Variations,_ [151] in the first Part of the _Clavierbung,_ [152] in the
_English Suites,_ [153] and the _Chromatic Fantasia._ [154] In the last
particularly Bach's fertility impresses us. The greater part of
its passage work is in the form of harmonic arpeggios whose
richness and originality match the chords they represent.

In order to realise the care and skill Bach expended on
his melody and harmony, and how he put the very best of
his genius into his work, I need only instance his efforts to
construct a composition incapable of being harmonised with
another melodic part. In his day it was regarded as imperative to
perfect the harmonic structure of part-writing. Consequently the
composer was careful to complete his chords and leave no door
open for another part. So far the rule had been followed more
or less closely in music for two, three, and four parts, and Bach
observed it in such cases. But he applied it also to compositions


151 Forkel alludes to the _Goldberg Variations_ (P. bk. 209).
152 P. bks. 205, 206.
153 P. bks. 203, 204.
154 P. bk. 207.


CHAPTER VI. BACH THE COMPOSER (continued) 75


consisting of a single part, and to a deliberate experiment in
this form we owe the six Violin and the six Violoncello Solo
Suites, [155] which have no accompaniment and do not require one. [83]
So remarkable is Bach's skill that the solo instrument actually
produces all the notes required for complete harmony, rendering
a second part unnecessary and even impossible.


Bach's melody never palls on us, because of the presence in it
of those qualities to which I have referred. It remains ever fair
and young, like Nature herself. In his earlier works, in which
we find him still in bondage to the prevailing mode, there is a
good deal that to-day seems antiquated. But when, as in his later
works, he draws his melody from the living wells of inspiration
and cuts himself adrift from convention, all is as fresh and new
as if it had been written yesterday. Of how many compositions
of that period can the same be said? Even the works of ingenious
composers like Reinhard Keiser [156] and Handel have become
old-fashioned sooner than we or their composers might have
supposed. Like other caterers for the public, they were obliged
to pander to its taste, and such music endures no longer than
the standard which produced it. Nothing is more inconstant and
fickle than popular caprice and, in general, what is called fashion.
It must be admitted, however, that Handel's Fugues are not yet
out of date, though there are probably few of his Arias that we [84]
now find agreeable. [157]


155 Bach wrote three Suites (Partita) and three Sonatas for Solo Violin. They
date from about 1720 and are in the keys of G minor, B minor, A minor, D
minor, C major, and E major (P. bk. 228). The six Violoncello Suites date
from the same period and are in G major, D minor, C major, E flat major, C
minor, and D major (P. bks. 238a, 238b).
156 Reinhard Keiser, b. 1673, d. 1739; scholar of the Leipzig Thomas-schule;
settled at Hamburg, 1694; composed a number of Operas, and for a time had a

great vogue.
157 It was precisely his agreeable operatic Arias that expressed Handel's genius
in the eyes of his generation. With rare exceptions that branch of his work is
obsolete and his cult survives mainly in the _Messiah,_ which supports his quite


76 Johann Sebastian Bach


Bach's melody and harmony are rendered still more distinctive
by their inexhaustible rhythmic variety. Hitherto we have
discussed his music merely subjectively as harmony and melody.
But to display vivacity and variety music needs to be uttered with
rhythmic point and vigour. More than those of any other period
composers of Bach's time found no difficulty in this, for they
acquired facility in the management of rhythm in the Suite,
which held the place of our Sonata. Between the initial Prelude
and closing Gigue the Suite includes a number of characteristic
French dance measures, whose rhythm is their distinguishing
characteristic. Composers of Bach's day, therefore, were familiar
with measures and rhythms which are now obsolete. Moreover
skilful treatment was necessary in order that each dance might
exhibit its own distinctive character and swing. Herein Bach
exceeded his predecessors and contemporaries. He experimented
with every kind of key and rhythm in order to give variety and
colour to each movement. Out of his experience he acquired

[85] such facility that, even in Fugue, with its complex interweaving
of several parts, he was able to employ a rhythm as easy as it was
striking, as characteristic as it was sustained from beginning to
end, as natural as a simple Minuet.


The source of Bach's astonishing pre-eminence is to be sought
in his facile and constant application of the methods we have
discussed. In whatever form he chose to express himself, easy or
difficult, he was successful and seemingly effortless. [158] There is


posthumous reputation as musician in ordinary to the Protestant religion. See
Mr. R. A. Streatfield's _Handel,_ Introduction.
158 Schweitzer advances the opinion, which may perhaps be challenged, that
inevitable and natural as Bach's melodies are, they do not give the impression
of effortless invention. Bach, he holds, worked like a mathematician, who
sees the whole of a problem at once, and has only to realise it in definite values.
Hence, he agrees with Spitta, Bach's way of working was quite different from
Beethoven's. With Beethoven the work developed by means of episodes that
are independent of the theme. With Bach everything springs with mathematical
certainty from the theme itself. See Schweitzer (i. 211) on Bach's methods of


CHAPTER VI. BACH THE COMPOSER (continued) 77


not a note in his music that does not suggest consummate ease of
workmanship. What he sets out to do he concludes triumphantly.
The result is complete and perfect; no one could wish for a single
note to be other than it is. Some illustrations will make my point
clearer.

Carl Philipp Emmanuel, in the preface to his father's
_Vierstimmige Choralgesnge_ (Four-part Hymn-tunes), which
he edited, [159] says that the world was accustomed to look for [86]
nothing but masterpieces from Bach. Some reviewers thought
this praise exaggerated. But if the term masterpiece is restricted
to works written during the years of Bach's maturity [160] it is
nothing less than the truth. Others have produced masterpieces
in various forms which may be placed honourably by the side of
his. For instance, certain Allemandes, Courantes, etc., by Handel
and others are not less beautiful, though less richly wrought, than
Bach's. But in Fugue, Counterpoint, and Canon he stands alone,
in a grandeur so isolated that all around him seems desert and
void. No one ever wrote Fugues to compare with his; indeed,
persons unacquainted with them cannot imagine what a Fugue
is and ought to be. The ordinary Fugue follows a rule of thumb
development. It takes a theme, puts another beside it, passes
them into related keys, and writes other parts round them over a
Continuo. Certainly this is Fugue: but of what merit? Persons
who know no other not unnaturally hold the whole species in little
esteem, and the player who hopes to make such commonplace
material convincing will need all his skill and imagination.
Bach's Fugue is of quite another kind. It presents all the
characteristics we are accustomed to in freer musical forms: a [87]


working.
159 Johann Sebastian Bach's _Vierstimmige Choralgesnge_ were published in
1765 and 1769. C. P. E. Bach was concerned only with the first volume. Forkel
perhaps refers to an edition of the _Choralgesnge_ issued by Breitkopf in four
parts at Leipzig in 1784, 1785, 1786, and 1787, and edited by C. P. E. Bach.
160 Forkel indicates the period 1720-1750. But in 1720 Bach had already
completed the _Orgelbchlein_ and the greater part of his Organ works.


78 Johann Sebastian Bach


flowing and distinctive melody, ease, clarity, and facility in the
progression of the parts, inexhaustible variety of modulation,
purest harmony, the exclusion of every jarring or unnecessary
note, unity of form and variety of style, rhythm, and measure,
and such superabundant animation that the hearer may well
ask himself whether every note is not actually alive. Such
are the properties of Bach's Fugues, properties which excite
the admiration and astonishment of all who can appreciate the
intellectual calibre their composition demands. How great a
tribute of homage is due to work of this kind, which exhibits
all the qualities which lend distinction to compositions in other
musical forms! Moreover, while all Bach's Fugues of his
mature period have the foregoing properties in common, each
is endowed with peculiar excellencies of its own, has its own
distinctive individuality, and displays a melodic and harmonic
scheme in keeping with it. The man who can play one of Bach's
Fugues is familiar with, and can play, one only; whereas knowing
one, we can perform portfolios of Fugues by other performers of
Bach's period.
To what a height was the art of Counterpoint carried by Bach's
genius! It enabled him to develop out of a given subject a whole
family of related and contrasted themes, of every form and design.

[88] It taught him to develop an idea logically from the beginning to
the end. It gave him such a command of harmony and its infinite
combinations that he could invert whole themes, note by note,
in every part, without impairing in the least the flow of melody
or purity of his harmony. It taught him to write in canon at all
intervals and in movements of all kinds so easily and naturally
that the workmanship is not perceptible and the composition
sounds as smoothly as though it were in the free style. Lastly,
it has given to posterity a legacy of works immensely various,
which are, and will remain, models of contrapuntal form as long
as music endures. [161]


161             - There are people who conclude that Bach merely perfected harmony.


CHAPTER VI. BACH THE COMPOSER (continued) 79


I have written exclusively so far of Bach's Clavier and Organ
work. But in its expression music has two branches, instrumental
and vocal, and as Bach excels in both of them, the reader will
desire to hear somewhat respecting his vocal writings.


It was at Weimar that Bach first had occasion to write for the
voice, [162] upon his appointment to the Kapelle, which imposed [89]
on him the provision of music for the ducal chapel. His church
music, like his Organ works, is devout and serious, and in every
respect what church music ought to be. He makes a point also
of not elaborating individual words, which leads to mere trifling,
but interprets the text as a whole. [163] His choruses invariably
are magnificent and impressive, and he frequently introduces
Chorals into them, [164] making the other parts accompany their
Cantus fugally, as was the practice in a Motet. As elsewhere in his
works, the harmonic structure of his voice parts and instrumental
accompaniment is rich. The declamation of the recitatives is
expressive, and the latter have fine Continuo parts. [165] In his


But if we realise what harmony is, a means to extend and emphasise musical
expression, we cannot imagine it apart from melody. And when, as in Bach's
case, harmony is actually an association of melodies, such a view becomes the
more ridiculous. It might perhaps be reasonable to say of a composer that his
influence was restricted to the sphere of melody, because we may get melody
without harmony. But there cannot be real harmony without melody. Hence
the composer who has perfected harmony has influenced the whole, whereas
the melodist has left his mark only on a fraction of his art.
162 As has been pointed out already (supra, p. 14) Bach's earliest church
Cantatas date from the Arnstadt period.
163 The statement certainly needs a caveat. No composer of his period studied
his text more closely or reverently than Bach. No one, on the other hand, was
more readily fired by a particular word or image in his text to give it sometimes
irrelevant expression.
164 Of Bach's church Cantatas 206 have survived. In only 22 of them does
Bach fail to introduce movements based upon the Lutheran Chorals.
165 We must attribute to Forkel's general ignorance of Bach's concerted church
music his failure to comment upon a much more remarkable feature of the
recitatives, namely, their unique treatment of the human voice as a declamatory
medium, a development as remarkable as Wagner's innovations in operatic


80 Johann Sebastian Bach


Arias, hardly one of which is not beautiful and expressive,
Bach seems to have been handicapped by the inefficiency of
his singers and instrumentalists, who constantly complained of
the difficulty of his music. If he had been fortunate enough to

[90] have capable performers the merits of his church music would
have been established and, like his other works, they would still
be sung and admired; for they contain treasures which deserve
immortality. [166]


Among the works composed at Leipzig I single out two
Cantatas, one of which was performed at Cthen at the funeral
of Bach's beloved Prince Leopold, and the other in St. Paul's
Church, Leipzig, on the occasion of the funeral sermon in honour
of Christiana Eberhardine, Queen of Poland and Electress of
Saxony. [167] The first contains double choruses of uncommon
magnificence and most affecting sentiment. [168] The second has
only four-part choruses, but they are so delightful and fresh that
he who begins the work will not pause till he has reached the end
of it. It was written in October 1727.

Bach also composed a great number of Cantatas, chiefly for

[91] the choir of St. Thomas' School, Leipzig. [169] The choir ordinarily
numbered fifty singers, and sometimes more, over whose musical
training Bach presided like a father. He practised them so hard in


form a century later.
166 It was not the imperfections of the choir but the indifference of Bach's
successors at St. Thomas', Leipzig, that was chiefly responsible for the
neglect of his Cantatas in the latter half of the eighteenth century. Johann
Friedrich Doles (1716-89) was the only Cantor who realised the greatness of
his predecessor's concerted church music.
167 The _Trauer-Ode_ was performed on October 17, 1727. Bach finished the
score two days before the performance! A parallel case is that of Mozart, who
finished the overture of _Don Giovanni_ on the morning of the first performance
of the Opera, and actually played it unrehearsed that evening.
168 It has been pointed out already that Bach used the _St. Matthew Passion_
music, set to other words, for the occasion. No. 26 (I would beside my Lord
be watching) was sung to the words Go, Leopold, to thy rest!
169 Of the 206 surviving Cantatas, 172 were written for the Leipzig choir.


CHAPTER VI. BACH THE COMPOSER (continued) 81


Cantatas for single and double chorus that they became excellent
singers. Among these works are some which, in profundity of
conception, magnificence, richness of harmony and melody, and
animation, surpass everything of their kind. But, like all Bach's
works, and in common with other masterpieces, they are difficult
to perform and need a numerous orchestra to produce their full
effect.
Such are Bach's most important vocal compositions. [170] In
minor forms of the art, morceaux for social entertainments and
the like, he wrote little, [171] though he was of a most sociable
disposition. For instance, he is said never to have composed
a song. [172] And why should he? They produce themselves
so spontaneously that there is little call for genius to aid their
gestation.


170 Forkel's knowledge is very incomplete.
171 Elsewhere Forkel mentions only one of the secular Cantatas.
172 There is a tradition that Bach wrote a comic song, _Ihr Schnen, hret an,_
which was widely current about the time of his death (Spitta, iii. 181 n.). The
Aria, _So oft ich meine Tabakspfeife,_ in A. M. Bach's _Notenbuch_ of 1725, should
be mentioned. See B. G. xxxix. sec. 4.


82 Johann Sebastian Bach


Johann Sebastian Bach. _From the picture discovered by_
_Professor Fritz Volbach_


# CHAPTER VII. BACH AS A TEACHER

It not infrequently happens that talented composers and players
are incapable of imparting their skill to others. Either they have
never troubled to probe the mechanism of their own facility,
or, through the excellence of their instructors, have taken the
short cut to proficiency and allowed their teacher and not their
own judgment to decide how a thing should be done. Such
people are useless to instruct beginners. True, they may succeed
in teaching the rudiments of technique, assuming that they
have been properly taught themselves. But they are certainly
unqualified to teach in the full sense of the word. There is, in fact,
only one way to become a good teacher, and that is to have gone
through the discipline of self-instruction, a path along which
the beginner may go astray a thousand times before attaining to
perfection. For it is just this stumbling effort that reveals the
dimensions of the art. The man who has adventured it learns the

obstacles that obstruct his path, and how to surmount them. To
be sure, it is a lengthy method. But if a man has patience to [93]
persevere he will reap a sure reward after an alluring pilgrimage.
No musician ever founded a school of his own who has not

followed such a course, and to his experience his teaching has
owed its distinctive character.


This is so with Bach, who, only gradually discovering his full
stature, was thirty years old before unremitting application raised
him above the difficulties of his art. But he reaped his reward.
Self-discipline set him on the fairest and most alluring path that
it has ever been given to a musician to tread.


84 Johann Sebastian Bach


To teach well a man needs to have a full mind. He must have

discovered how to meet and have overcome the obstacles in his

own path before he can be successful in teaching others how
to avoid them. Bach united both qualities. Hence, as a teacher
he was the most instructive, clear, and definite that has ever
been. In every branch of his art he produced a band of pupils
who followed in his footsteps, without, however, equalling his
achievement.
First of all let me show how he taught the Clavier. [173] To
begin with, his pupils were made to acquire the special touch
of which I have already spoken. [174] To that end for months

[94] together he made them practise nothing but simple exercises for
the fingers of both hands, at the same time emphasising the need
for clearness and distinctness. He kept them at these exercises
for from six to twelve months, unless he found his pupils losing
heart, in which case he so far met them as to write short studies
which incorporated a particular exercise. Of this kind are the
_Six Little Preludes for Beginners,_ [175] and the _Fifteen Two-part_
_Inventions,_ [176] both of which Bach wrote during the lesson for
a particular pupil and afterwards improved into beautiful and
expressive compositions. Besides this finger practice, either in
regular exercises or in pieces composed for the purpose, Bach
introduced his pupils to the use of the various ornaments in both
hands.

Not until this stage was reached did Bach allow his pupils
to practise his own larger works, so admirably calculated, as he
knew, to develop their powers. In order to lessen their difficulty,


173 Bach's method has come down to us in treatises by two of his pupils, C. P.
E. Bach's _Essay_ and Kirnberger's _Die Kunst des reinen Satzes in der Musik,_ to
which reference has been made already.
174 Supra, p. 60.
175 Bach wrote eighteen Preludes for Beginners. They are all in P. bk. 200.
176 Most of these movements, which Bach called indifferently Inventions
(ideas) and Praeambula (Preludes), were written in 1723. They are in P. bk.
201.


CHAPTER VII. BACH AS A TEACHER 85


it was his excellent habit to play over to them the pieces they were
to study, with the remark, That's how it ought to sound. [177] It
would be difficult to exaggerate the helpfulness of this method.
The pupil's interest was roused by hearing the piece properly
played. But that was not the sole result. Without the help thus [95]
given the pupil could only hope to overcome the difficulties of
the piece after considerable effort, and would find it much less
easy to realise a proper rendering of it. As it was, he received
at once an ideal to aim at and was taught how to surmount
the difficulties the piece presented. Many a young performer,
still imperfect after a year's practice, probably would master his
music in a month if he once had it played over to him.


Bach's method of teaching composition was equally sure and
effective. [178] He did not begin with the dry details of counterpoint,
as was the custom of other teachers in his day. Still less did he
burden his pupils with the physical properties of sound, which
he held to be matter for the theorist and instrument-maker rather

than the composer. He started them off at once on four-part
harmony over a figured Bass, making his pupils write each part
on a separate stave in order to impress on them the need for
accurate harmonic progression. Then he passed to Hymn tunes,
setting the Bass himself and making his pupils write the Tenor
and Alto parts. In time he let them write the Bass also. He insisted
on correct harmony and on each part having a real melodic line.
Every musician knows what models Bach has left us in this [96]
form. The inner parts of his four-part Hymn-tunes are so smooth
and melodious that often they might be taken for the melody.
He made his pupils aim at similar tunefulness, and until they
showed a high standard of merit did not permit them to write


177 Heinrich Nikolaus Gerber, who was Bach's pupil from 1724 to 1727,
particularly emphasises this feature of Bach's teaching.
178 See on the whole matter Spitta, iii. 117 ff. Bach's method is illustrated by
his _Rules and Instructions_ (1738) printed by Spitta, iii. 315 ff., and also by the
_Einige hchst nthinge Regeln_ at the end of A. M. Bach's _Notenbuch_ (1725).


86 Johann Sebastian Bach


compositions of their own. Meanwhile he aimed at cultivating
their feeling for pure harmony and for the order and connection
of ideas and parts by familiarising them with the compositions
of others. Until they had acquired facility in those qualities he
neither permitted them nor held them competent to put pen to

paper.


Bach required his pupils in composition to work out their
musical ideas mentally. If any of them lacked this faculty he
admonished him not to compose and discountenanced even his
sons from attempting to write until they had first given evidence of
genuine musical gifts. Having completed their elementary study
of harmony, Bach took his pupils on to the theory of Fugue,
beginning with two-part writing. In these and other exercises
he insisted on the pupil composing away from the Clavier. [179]

Those who did otherwise he ridiculed as Harpsichord Knights.
In the second place he required rigorous attention to each part


179 Mozart wrote as follows to a correspondent who asked him what his
method of composition was: I can really say no more on this subject than
the following; for I myself know no more about it, and cannot account for
it. When I am, as it were, completely myself, entirely alone, and of good
cheersay, travelling in a carriage, or walking after a good meal, or during
the night when I cannot sleep; it is on such occasions that my ideas flow best
and most abundantly. _Whence_ and _how_ they come, I know not; nor can I force
them. Those ideas that please me I retain in memory, and am accustomed, as I
have been told, to hum them to myself. If I continue in this way, it soon occurs
to me how I may turn this or that morsel to account, so as to make a good dish
of it, that is to say, agreeably to the rules of counterpoint, to the peculiarities
of the various instruments, etc. All this fires my soul, and, provided I am not
disturbed, my subject enlarges itself, becomes methodised and defined, and the
whole, though it be long, stands almost complete and finished in my mind, so
that I can survey it, like a fine picture or a beautiful statue, at a glance. Nor do
I hear in my imagination the parts successively, but I hear them, as it were, all
together. What a delight this is I cannot tell!When I proceed to write down
my ideas, I take out of the bag of my memory, if I may use that phrase, what
has previously been collected into it in the way I have mentioned. For this
reason the committing to paper is done quickly enough, for everything is, as I
said before, already finished; and it rarely differs on paper from what it was in


CHAPTER VII. BACH AS A TEACHER 87


and its relation to the concurrent parts, permitting none, not even
an inner one, to break off before it had finished what it had to
say. He insisted upon a correct relation between each note and its
predecessor. If he came upon one whose derivation or destination
was not perfectly clear he struck it out as faulty. It is, indeed, a
meticulous exactitude in each individual part that makes Bach's [98]
harmony really multiple melody. Confused part-writing, where a
note that belongs to the Tenor is given to the Alto, or vice versa,
or the haphazard addition of extraneous parts to a chord which
suddenly shows an increase of notes as if fallen from the sky, to
vanish as suddenly as they came, are faults found neither in his
own nor his pupils' writing. He regarded his musical parts as so
many persons engaged in conversation. If there are three, each
of them on occasion may be silent and listen to the others until
it finds something relevant to say itself. But if, at an interesting
point of the conversation, an interloping voice intervened, Bach
regarded it as an intruder and let his pupils understand that it
could not be admitted.


Notwithstanding his strictness on this point, Bach allowed his
pupils considerable licence in other respects. In their use of
certain intervals, as in their treatment of harmony and melody, he
let them experiment within the limits of their ability, taking care to
discountenance ugliness and to insist on their giving appropriate
expression to the character of the composition. Beauty of


my imagination (Life, ed. Dent, p. 255).
Wagner, writing in 1851 to Uhlig, who could not understand how the
libretto of _Young Siegfried_ could be set to music, expresses the same idea as
Mozart: What you cannot possibly imagine is a-making of itself! I tell you,
the musical phrases build themselves on these verses and periods without my
having to trouble at all; everything springs as if wild from the ground (Life,
trans. Ellis, iii. p. 243).
Schumann writes in 1839: I used to rack my brains for a long time, but
now I scarcely ever scratch out a note. It all comes from within, and I often
feel as if I could go on playing without ever coming to an end (Grove, vol. iv.
p. 353).


88 Johann Sebastian Bach


expression, he postulated, was only attainable on a foundation of
pure and accurate harmony. Having experimented in every form
himself, he liked to see his pupils equally adventurous. Earlier

[99] teachers of composition, for instance, Berardi, [180] Buononcini, [181]
and Fux, [182] did not allow such liberty. They were afraid to
trust their pupils to encounter difficulties, and short-sightedly
prevented them from learning how to overcome them. Bach's
system was wiser, for it took his pupils farther, since he did
not limit their attention, as his predecessors did, to the harmonic
structure, but extended it to the qualities that constitute good
writing, namely, consistency of expression, variety of style,
rhythm, and melody. Those who would acquaint themselves
with Bach's method of teaching composition will find it fully set
forth in Kirnberger's _Correct Art of Composition._ [183]

As long as his pupils were under his instruction Bach did not
allow them to study any but his own works and the classics. The
critical sense, which permits a man to distinguish good from bad,
develops later than the aesthetic faculty and may be blunted and
even destroyed by frequent contact with bad music. The best
way to instruct youth is to accustom it early to consort with the
best models. Time brings experience and an instructed judgment

[100] to confirm the pupil's early attraction to works of true art.
Under this admirable method of teaching all Bach's pupils
became distinguished musicians, some more so than others,
according as they came early or late under his influence,
and had opportunity and encouragement to perfect and apply
the instruction they received from him. His two eldest sons,


180 Angela Berardi's _Documenti armonici._ _Nelli quali con varii discorsi,_
_regole, ed essempii si dimonstrano gli studii arteficiosi della musica_ was
published at Bologna in 1687.
181 Giovanni Maria Buononcini, b. c. 1640, d. 1678; Maestro di Capella at
Modena; published his _Musico prattico_ at Bologna in 1673, 1688.
182 Johann Joseph Fux, b. 1660, d. 1741; Kapellmeister at Vienna; published
his _Gradus ad Parnassum_ at Vienna in 1725.
183 See supra, p. 74.


CHAPTER VII. BACH AS A TEACHER 89


Wilhelm Friedemann and Carl Philipp Emmanuel, were his most
distinguished pupils, not because he gave them better instruction
than the rest, but because from their earliest youth they were
brought up amid good music at home. Even before they began
their lessons they knew what was good. On the other hand,
others, before they became Bach's pupils, either had heard no
good music or their taste had been already vitiated by contact
with bad. It at least attests the excellence of Bach's method

that even his pupils thus handicapped took high rank in their
profession and distinguished themselves in one or other of its
branches. [184]


Bach's first pupil was JOHANN CASPAR VOGLER, who
received instruction from him in his early days at Amstadt and
Weimar and, on Bach's testimony, was an exceedingly able
player. He became organist, and later burgomaster, at Weimar,
retaining his professional position. Some Choral Preludes by [101]
him for a two-manualed Organ with pedals were engraved about
1737. [185]


Other pupils of Bach who became famous were:


1. HOMILIUS, of Dresden. He was not only an excellent
organist but a distinguished composer of church music as
well. [186]


2. TRANSCHEL, of Dresden. He was a fine musician and
performer on the Clavier. There exist in MS. six Polonaises


184 - I speak here only of those pupils who made music their profession. But,
besides these, Bach had a great many other pupils. Every dilettante in the
neighbourhood desired to boast of the instruction of so great and celebrated a
man. Many gave themselves out to have been his pupils who had never been
taught by him.
185 See Spitta, i. 522; Schweitzer, i. 214 for farther details regarding Vogler,
who died circ. 1765.
186 Gottfried August Homilius, b. 1714, d. 1785; pupil of Bach, circ. 1735.
Cantor of the Kreuzschule, Dresden.


90 Johann Sebastian Bach


by him which perhaps are superior to those of any composer
but Wilhelm Friedemann Bach. [187]


3. GOLDBERG, of Knigsberg. He was a very finished
player on the Clavier, but without any marked talent for
composition. [188]


4. KREBS, Organist at Altenburg. He was not only a player
of the first rank, but also a prolific composer for the Organ,
Clavier, and of church music. He was fortunate in having

[102] Bach's instruction for nine years. [189]


5. ALTNIKOL, Organist at Naumburg. He was Bach's
son-in-law and is said to have been a very competent player
and composer. [190]

6. AGRICOLA, Court Composer at Berlin. [191] He is less
known as a composer than as a theorist. He translated
Tosi's [192] _II canto figurato_ from Italian into German and
provided the work with an instructive commentary.

7. MTHEL, of Riga. He was a good Clavier player and
wrote for that instrument. His Sonatas and a Duet for two
Claviers attest his ability as a composer. [193]


187 Christoph Transchel (1721-1800) taught music at Leipzig and Dresden;
Bach's pupil and friend, circ. 1742. See Spitta, iii. 245.
188 Johann Gottlieb (or Theophilus) Goldberg, clavicenist to Count Kaiserling
(infra, p. 119) for whom Bach wrote the so-called _Goldberg Variations._ He
was born circ. 1720 and was a pupil of Bach from 1733-46.
189 Johann Ludwig Krebs, b. 1713, d. 1780; Bach's pupil, 1726-35. Bach said
of him that he was the best crab (Krebs) in the brook (Bach).
190 Johann Christoph Altnikol, d. 1759.
191 Johann Friedrich Agricola, b. 1720, d. 1774; pupil of Bach circ. 1738-41;
Director of the Royal Chapel, Berlin.
192 Pier Francesco Tosi, b. circ. 1650; singing master in London. His _Opinioni_
_de' canton antichi e moderni, o sieno osservazioni sopra il canto figurato_ was
published at Bologna in 1723.
193 Johann Gottfried Mthel, b. circ. 1720, d. circ. 1790; pupil of Bach in
1750 and resident in his house at the time of his death; organist of the Lutheran
Church, Riga.


CHAPTER VII. BACH AS A TEACHER 91


8. KIRNBERGER, [194] Court Musician at Berlin to the
Princess Amalia of Prussia. [195] He was one of the most

distinguished of Bach's pupils, full of genuine enthusiasm
for his art and eager to assure its interests. Besides his
exposition of Bach's system of teaching composition, we
are indebted to him for the first logical treatise on harmony,
in which he sets forth his master's teaching and practice. [103]
The first work is entitled _Kunst des reinen Satzes,_ and the
second, _Wahre Grundstze zum Gebrauch der Harmonie._ [196]

He served the interests of his art also by other writings and
compositions, and was an excellent teacher. The Princess
Amalia was his pupil.


9. KITTEL, Organist at Erfurt. He is a sound, though not
a finished, player, and is distinguished as a composer by
several Organ Trios, so excellent that Bach himself might
have written them. He is the sole survivor (1802) of Bach's
pupils. [197]


10. VOIGT, of Anspach, [198] and an organist named
SCHUBART [199] were mentioned to me by Carl Philipp
Emmanuel as having been Bach's pupils. He knew nothing
about them except that they entered his father's house after


194 Johann Philipp Kirnberger, b. 1721, d. 1783; Bach's pupil, 1739-41.
195 Louisa Amalia, of Brunswick-Wolfenbttel, wife of Frederick the Great's
brother, and mother of his successor, Frederick William II. (1786-97).
196 The second work was published in 1773 at Berlin. For the first, see supra,
p. 74.
197 Johann Christian Kittel, b. 1732, d. 1809; one of Bach's latest pupils;
Organist of the Predigerkirche, Erfurt. He is said to have possessed a portrait
of his master and to have rewarded his pupils for good playing by drawing the
curtain which usually covered the picture and permitting them to look upon it.
It is, perhaps, the portrait, recently discovered by Dr. Fritz Volbach, which is
reproduced at p. 92 of this volume.
198 Nothing seems to be known of him.
199 Johann Martin Schubart succeeded Bach at Weimar in 1717. He was born

in 1690 and died in 1721. See Spitta, i. 343.


92 Johann Sebastian Bach


he left it. [200]

[104]

I have said already that Bach's sons were his most distinguished
pupils. The eldest, WILHELM FRIEDEMANN BACH, came
nearest to his father in the originality of his genius. His melodies
have quite a different character from those of other composers.
They are exceedingly clever, elegant, and spontaneous. When
performed with delicacy, as he played them, they cannot fail to
charm every hearer. It is greatly to be regretted that he preferred
to follow his fancy in extemporisation and to expend his genius
on fugitive thoughts rather than to work them out on paper.
The number of his compositions therefore is small, but all are
beautiful.

CARL PHILIPP EMMANUEL BACH, who comes next, went
out into the world sufficiently early to discover that it is a good
thing for a composer to have a large public behind him. Hence,
in the clearness and easy intelligibility of his compositions, he
approaches the popular style, though he scrupulously avoids the
commonplace. [201] Both he and his elder brother admitted that

[105] they were driven to adopt a style of their own by the wish to
avoid comparison with their incomparable father.


200 In addition to those mentioned by Forkel, the following pupils of Bach are
known: Johann Gotthilf Ziegler, of St. Ulrich's Church, Halle; J. Bernhard
Bach, of Ohrdruf; Heinrich Nikolaus Gerber, Organist at Sondershausen;
Samuel Anton Bach, of Meiningen; Johann Ernst Bach, of Saxe-Weimar;
Johann Elias Bach, Cantor at Schweinfurt; Johann Tobias Krebs, organist at
Buttelstdt, and his sons, Johann Ludwig, Johann Tobias, and Johann Carl;
Johann Schneider, organist of St. Nicolas', Leipzig; Georg Friedrich Einicke,
Cantor at Frankenhausen; Johann Friedrich Doles, Bach's second successor
in the Cantorate of St. Thomas'; Rudolph Straube, who afterwards settled in
England; Christoph Nichelmann, cembalist to Frederick the Great; Christian
Grbner, and Carl Hartwig.
For full information upon Bach's pupils see Spitta, i. 522 ff., ii. 47 ff., iii.
116 ff., 239 ff., and the relative articles in Grove's _Dictionary._
201 Forkel does not do justice to his friend. C. P. E. Bach is recognised as
the immediate precursor of Haydn and as the link between the latter and J. S.
Bach.


CHAPTER VII. BACH AS A TEACHER 93


JOHANN CHRISTOPH FRIEDRICH BACH, Concertmeister
at the Court of Bckeburg, imitated Carl Philipp's style, but was
not his equal. According to Wilhelm Friedemann, he was the
best player among the brothers, and the most effective performer
of their father's Clavier compositions.
JOHANN CHRISTIAN BACH, called Bach of Milan, and
afterwards Bach of London, was the youngest son of Bach's
second marriage and of too tender an age when his father died
ever to have had lessons from him. Hence, perhaps, the absence
of Bach's style in his music. He was, in fact, a popular composer
universally admired in his day. [202]


202 Mozart had a very particular regard for him. See Schweitzer i. 220 on his
brothers' abilities as composers.




[106]


# CHAPTER VIII. PERSONAL CHARACTERISTICS

Distinguished as a player, composer, and teacher, Bach was also
an indulgent father, a good friend, and a loyal citizen. His paternal
devotion is shown by his care for his children's education, and he
was equally assiduous in the performance of his civil and social
duties. His acquaintance was agreeable to everybody. Every
lover of music, whatever his nationality, was sure of a friendly
reception at his house, and his sociability and reputation caused
him to be seldom without visitors.

As an artist Bach was exceptionally modest. Notwithstanding
his pre-eminence in his profession, a superiority of which he
could not but be conscious, and in spite of the admiration and
respect daily shown him, he never gave himself airs. If he
was asked the secret of his mastership he would answer, I
was made to work; if you are equally industrious you will be
equally successful, [203] a remark which made no allowance for [107]
his own exceptional genius. His opinion of other composers and
their work was invariably fair and generous. Naturally, much of
their work struck him as somewhat trivial, viewed from his own

altitude. But he never uttered a harsh criticism, unless it were to a
pupil, to whom he held himself bound to say what he thought. Still
less did he presume on his acknowledged superiority to indulge
in braggadocio, as often happens with performers brought into
touch with those whom they regard as their inferiors. Herein
Bach's modesty went so far that he never spoke voluntarily of


203 Spitta (iii. 262) quotes a characteristic anecdote. To some one who praised
his skill on the Organ Bach replied: There is nothing wonderful about it. You
merely strike the right note at the right moment and the Organ does the rest.


96 Johann Sebastian Bach


his frustrated contest with Marchand, though the latter was the
challenger. [204] Many absurd stories are told of Bach; for instance
that, dressed up as a village schoolmaster, he liked to enter a
church and ask the organist to let him play a Choral, in order
to enjoy the astonishment excited by his playing, or to hear the
Organist declare, This must be Bach or the Devil. [205] He always
ridiculed such stories, and indeed had too much respect for his

[108] art to make it cloak his vanity.


At musical parties where Quartet or other instrumental music
was performed, Bach liked to play the Viola, an instrument which
put him, as it were, in the middle of the harmony in a position
from which he could hear and enjoy it on both sides. On those
occasions he would sometimes join in a Trio or other piece on
the Harpsichord. If he was in the mood and the composer was
agreeable, he would, as has been told already, extemporise a new
Trio from the Continuo part, or, adding a new part, convert the
Trio into a Quartet. But these were the only occasions on which
he was ready to display his great powers before others. One
Hurlebusch, of Brunswick, [206] a conceited and arrogant Clavier
player, once visited Bach at Leipzig, not to hear him play, but
to play to him. Bach received him politely and listened patiently
to his very indifferent performance. On taking leave Hurlebusch
made Bach's eldest sons a present of his published Sonatas,
exhorting them to study them diligently. Bach, knowing the kind
of music his sons were wont to play, smiled at Hurlebusch's


204 See supra, p. 19. Bach himself certainly was the challenger.
205 When Handel was at Venice in 1708, Domenico Scarlatti, hearing a stranger
touching the Harpsichord at a masquerade, exclaimed, That must either be
the famous Saxon or the Devil (Rockstro's _George Frederick Handel,_ p.
48). Streatfield (p. 145) mentions a similar event which took place in 1737.
Hearing a stranger playing a Fugue in one of the Flemish churches, the organist
embraced him, saying, You can be no other but the great Handel.
206 Heinrich Lorenz Hurlebusch was organist of three churches in Brunswick.
His visit to Bach took place in 1730, seemingly. See Schweitzer, i. 154.


CHAPTER VIII. PERSONAL CHARACTERISTICS 97


navet but did not permit him to suspect his amusement. [207]


Bach was fond of listening to the music of other composers.
If he and one of his elder sons happened to be in church when a [109]
Fugue was played, directly the subject had been stated he always
pointed out how it ought to be developed. If the composer knew
his business and fulfilled Bach's anticipations, he was pleased
and nudged his son to draw his attention to the fact. Is this not
evidence of his impartial interest in other people's compositions?


I have mentioned already the composers whom in his youth
Bach esteemed, loved, and studied. Later, when experience
ripened his critical faculty, he had other favourites, among
them Imperial Kapellmeister Fux, Handel, Caldara, [208] Reinhard
Keiser, Hasse, [209] the two Grauns, [210] Telemann, [211] Zelenka, [212]

Benda, [213] etc., and, in general, the distinguished musicians at
Dresden and Berlin. He was acquainted with all except the first
four of those I mention. In his youth Bach was intimate with
Telemann. [214] He also had a very warm regard for Handel and [110]
often expressed a desire to know him. As Handel, like himself,
was a famous performer on the Organ and Clavier, many in


207 Schweitzer prints an appreciation of Hurlebusch which suggests that he
was a man of distinct ability and a paragon of politeness.
208 Antonio Caldara, b. circ. 1670; vice-Kapellmeister at Vienna, 1716-36; d.
1736.
209 Johann Adolph Hasse, b. 1699, d. 1783; Kapellmeister and Director of the
Opera, Dresden.
210 Johann Gottlieb Graun, b. circ. 1698, d. 1771; conductor of the royal
Kapelle, Berlin.
Carl Heinrich Graun, b. 1701, d. 1759; like his brother, in Frederick the

Great's service.
211 Georg Philipp Telemann, b. 1681, d. 1767; Cantor and Musik-direktor in
Hamburg.
212 Johann Dismas Zelenka, b. 1679 or 1681, d. 1745; Court Composer at
Dresden.
213 Franz Benda, b. 1709, d. 1786; Concertmeister to Frederick the Great upon
the death of J. G. Graun.
214 On Telemann's influence on Bach see Spitta, ii. 437.


98 Johann Sebastian Bach


Leipzig and its neighbourhood wished to bring the two great
men together. But Handel, then living in London, never found
time for a meeting during the visits he paid to Halle, his native
town. On his first visit in 1719, Bach was at Cthen, only some
twenty miles distant. As soon as he was informed of Handel's
arrival he lost not a moment in setting out to visit him, but on
his arrival found that Handel had returned to England. At the
time of Handel's second visit, between 1730 and 1740, [215] Bach
was prevented from leaving Leipzig by indisposition. But no
sooner was he advised of Handel's arrival at Halle than he sent

his eldest son, Wilhelm Friedemann, to beg him to visit Leipzig,
an invitation which Handel was unable to accept. In 1752 or
1753, when Handel paid his third visit to Germany, [216] Bach was
dead. He had always expressed the strongest desire to know
Handel, and the Leipzig people were disappointed in their wish
to hear the two great men together.
While Hasse was Kapellmeister at Dresden both the Opera

[111] and Kapelle flourished. Bach had many friends at Dresden, who
held him in high regard. Among them may be mentioned Hasse
and his wife, the celebrated Faustina. [217] They often visited
Leipzig and were admirers of the Cantor's rare talents. Hence, at
Dresden he was always received in the most respectful manner
and often visited the Opera, generally accompanied by his eldest
son. When the time for their journey approached Bach would say
in fun, Well, Friedemann, shall we go to Dresden to hear the
pretty tunes [218] again? Innocent as the jest was, I am sure Bach
would not have uttered it to any but his son, who already could


215 Handel's second visit to Halle took place in June 1729. His mother's illness
detained him. See Streatfield, p. 110.
216 Handel's third visit took place in July-August 1760. He was laid up by a
severe accident in the course of it, and appears to have not recovered from it at
the time of Bach's death.
217 Faustina Bordoni, b. 1693, d. 1783; m. Hasse in 1730. She was one of the
most famous singers of the day.
218 The original has Liederchen.


CHAPTER VIII. PERSONAL CHARACTERISTICS 99


distinguish between great music and agreeable trifles.


Bach was never in a position to make what is called a brilliant
fortune. [219] He held a fairly lucrative office, but his income had
to maintain and educate a large family. He neither possessed
nor sought other means of livelihood, and was too absorbed in
his art and work to think of accepting engagements which, in
those days, and to a man of his genius, certainly would have
brought riches. Had he possessed a taste for travel he would, as
even one of his detractors admits, have drawn upon himself the [112]
admiration of the whole world. But he preferred a quiet domestic
life, constant occupation in his work, with contentment and a
moderate competence, like his forbears. His modesty, however,
did hot prevent him from receiving manifold proofs of regard and
affection and marks of honourable distinction. Prince Leopold of
Cthen, Duke Ernst August of Weimar, [220] and Duke Christian of
Weissenfels, all showed sincere regard for him, which must have
been the more agreeable to him seeing that they were all sound
judges of music. At Berlin, as at Dresden, he was universally
honoured and respected. If we add to these testimonies the fact
that he captured the admiration of all who heard him play or
were acquainted with his music, then we may be sure that Bach,
singing for himself and the Muses, received at the hands of
Fame the recognition he valued most, and cherished it far more
than the trivial honour of a ribbon or gold chain.


I add that, in 1747, Bach became a member of the Society
of the Musical Sciences, founded by Mizler, only because we
owe to the circumstance his admirable Choral Variations on
_Vom Himmel hoch._ [221] He presented them to the Society on his [113]


219 See supra, p. 37. Compare Handel's case. He received a royal pension of
600 per annum, and though he was twice a bankrupt, left 20,000.
220 The Duke was the nephew of, and succeeded, Duke Wilhelm Ernst in 1728.


221 The Canonic Variations on the melody are published by Novello bk. 19, p.
73. For the Mizler Society, see supra, p. xxiv.


[114]



100 Johann Sebastian Bach


admission and they were engraved subsequently. [222]


222 Spitta (iii. 294) regards the statement as incorrect and holds that the work
was engraved before Bach joined Mizler's Society in June 1747. Pirro (p. 215)
supports Spitta and regards the Variations as having been engraved at Nrnberg
vers 1746.


# CHAPTER IX. BACH'S COMPOSITIONS

To have produced so many great works in all forms of musical
expression Bach necessarily must have been a prolific writer.
For if a composer be the greatest genius in the world, unless
he constantly exercises his art he cannot hope to produce real
masterpieces. Superlative excellence is the fruit of indefatigable
application. Yet in Bach's case we should be wrong to acclaim
as masterpieces all the products of his great activity just because
masterpieces at length were the fruit of it. Already in his early
compositions we find undeniable evidence of genius. But they
are blemished by faults, passages poor in quality, extravagant,
insipid, that are hardly worth preserving, though of interest to the
student who wishes to trace from its source the development of
Bach's genius.
It is not difficult to distinguish with exactitude those of Bach's
early compositions which are of the first excellence; for he has
been at pains to give us the clue. As he did not publish his
first work until he was about forty years old [223] we are justified [115]
in assuming the merit of what, at so mature an age, he thought
worthy to put into print, and in concluding generally that all his
engraved works are of first-rate merit. [224]


223 The first of Bach's works to be engraved was the Mhlhausen Cantata, _Gott_
_ist mein Knig,_ (parts only). It was published in 1708, when Bach was twentythree years old. Forkel refers to Partita I. in the first Part of the _Clavierbung_
(P. bk. 205 p. 4). It was engraved in 1726, when Bach was forty-one years old.
In 1731 he republished it, with five others that had appeared in the interval, in
the first Part of the _Clavierbung_ (P. bks. 205, 206).
224 Forkel's rather casual critical axioms seem to be as follows: Publication

postulates excellence; An amended MS. implies that the original text was


102 Johann Sebastian Bach


With respect to his unpublished compositions, and they are by
far the most numerous, we must in order to distinguish their merit
rely partly on a critical examination of their texts, partly on Bach's
own judgment. Like all great composers, he was continually
working on his compositions with a view to making them still
more finished. Indeed, he actually attempted to improve some
of them that were already perfect. Any that were susceptible of
improvement he improved, even those already engraved. Such is
the origin of the variant readings of his works found in older and
more recent texts. By constantly retouching his compositions
Bach aimed at making them indisputable masterpieces. In
this category I place most of what he wrote before the year
1725, as I show in detail in the following catalogue. A great

[116] many compositions subsequent to 1725, which for reasons easily
understood are still in MS., bear too evidently the stamp of
perfection to leave us in doubt whether to class them as early
essays or as the finished work of an accomplished master.

The following are those of Bach's works which have been
engraved:


1. _Clavierbung_, or Exercises for the Clavier, consisting
of Preludes, Allemandes, Courantes, Sarabandes, Gigues,
Minuets, etc., for the Diversion of Amateurs. Opus I.
Published by the Composer, 1731. This was Bach's first
published work and contains six Suites. The first of them
came out in 1726; [225] the others followed in successive years
until all were engraved together in 1731. [226] The work was
much noticed at the time. Such compositions for the Clavier


not a finished work of art.
225 It was the first work engraved by Bach himself, though the parts of the
Cantata _Gott ist mein Knig_ had been published by the Town Council at
Mhlhausen in 1708.
226 The work was published at Leipzig in Commission bey Boetii Seel,
hinderlassenen Tochter, unter den Rath-hause. The Suites, or Partitas (P. bks.
205, 206), are in B flat major, C minor, A minor, D major, G major, E minor.


CHAPTER IX. BACH'S COMPOSITIONS 103


had not been seen or heard before, and the man who could
play them was sure of a success. Our young players to-day
would profit by the study of them, so brilliant, agreeable,
expressive, and original are they. In the new edition [227] they
are entitled, Exercises for the Clavier. [117]

2. _Clavierbung_, or Exercises for the Clavier, Part II.,
consisting of a Concerto in the Italian style and an Overture
in the French manner [228] for a Clavier with two manuals.
Published by Christopher Weigel, Junior, in Nrnberg. [229]

3. _Clavierbung_, or Exercises for the Clavier, Part III.,
consisting of various Organ Preludes to the Catechism and
other Hymns, composed for the diversion of amateurs and
particularly of competent judges of such works. Published
by the Composer. Besides the Preludes and Fugues for the
Organ, all of which are masterly, the book contains four
Duetti for the Clavier, [230] models of their kind.

4. _Sechs Chorle_, or Six Choral Melodies of different
kinds, for an Organ with two manuals and pedal. Zella, in
the Thuringian Forest. Published by Johann G. Schbler. [231]

They are full of dignity and religious feeling. In some of
them, too, we have instances of Bach's original management
of the stops. [232] Thus, in the second Choral, _Wo soll ich_ [118]


227 In 1801 Hoffmeister and Khnel unsuccessfully attempted to publish Bach's
works by subscription.
228 The Partita in B minor (P. bk. 208 p. 20).
229 The work was published in 1735. The Italian Concerto in F major is
published by Novello and P. bk. 207.
230 The work appeared in 1739. It was intended to contain works for the Organ
only; the four Duetti are incongruous and seem to have crept in by mistake.
See the scheme of the work discussed in Terry, _Bach's Chorals,_ Part III. The
Choral Preludes are in Novello's ed., bk. xvi.
231 The work was published circ. 1747-50. Five of the six movements
certainly, and the sixth with practical certainty, are adaptations to the Organ
of movements out of Bach's Church Cantatas. See Parry, _Bach,_ p. 535. The
Chorals are in Novello's ed., bk. xvi.
232 See supra, p. 65.


104 Johann Sebastian Bach


_fliehen hin,_ he gives to the first manual an 8 foot, to the
second a 16 foot, and to the pedal a 4 foot stop. The pedal
has the cantus firmus. [233]


5. _Clavierbung_, or Exercises for the Clavier, consisting
of an Aria with several Variations, for a Clavier with two
manuals. Published by Balthasar Schmidt at Nrnberg. [234]

This admirable work consists of thirty Variations, some
in canon, in a variety of movements and at all intervals
from the unison to the ninth, with easy flowing melody.
It includes a regular fourpart Fugue, [235] several extremely
brillant Variations for two Claviers, [236] and concludes with
a Quodlibet, as it is called, which alone would render its
composer immortal, though it is not the best thing in the
volume. [237]


The Variations are models of what such compositions ought
to be, though no one has been so rash as to attempt to

[119] follow Bach's footsteps. We owe them to Count Kaiserling,
formerly Russian Ambassador at the Saxon Electoral Court,
who frequently visited Leipzig with Goldberg, already
mentioned [238] among Bach's pupils. The Count was a
great invalid and suffered from insomnia. Goldberg lived in
the Ambassador's house, and slept in an adjoining room, to
be ready to play to him when he was wakeful. One day the
Count asked Bach to write for Goldberg some Clavier music


233 Thus the pedal sounds above the part given to the second manual and is
often the topmost part. See Novello's ed., bk. xvi. 4.
234 Published circ. 1742; the so-called Goldberg Variations. They are in P.
bk. 209.
235 Variation No. 10 is a Fughetta in four parts.
236 Ten of the Variations are marked a 2 Clav., that is, for two keyboards or
manuals: Nos. 8, 11, 13, 14, 17, 20, 23, 25, 26, 28. Nos. 5, 7, 29 are marked a

1 ovvero 2 Clav.
237 The movement is constructed upon two merry folk-songs, _Kraut and Rben_
_haben mich vertrieben,_ and _Ich bin so lang nicht bei dir gewirt_ .
238 See supra, p. 101.


CHAPTER IX. BACH'S COMPOSITIONS 105


of a soothing and cheerful character, that would relieve the
tedium of sleepless nights. Bach thought a set of Variations
most likely to fulfil the Count's needs, though, on account of
the recurrence of the same basic harmony throughout, it was
a form to which he had hitherto paid little attention. Like
all his compositions at this period, however, the Variations
are a masterpiece, and are the only example he has left
us of this form. [239] The Count always called them my
Variations and was never weary of hearing them. For long
afterwards, when he could not sleep, he would say, Play
me one of my Variations, Goldberg. Perhaps Bach was [120]
never so well rewarded for any composition as for this. The
Count gave him a golden goblet containing one hundred
louis d'ors, though, as a work of art, Bach would not have
been overpaid had the present been a thousand times as
large. It may be observed, that in the engraved copy of the
Variations there are serious mistakes, which the composer
has corrected in his own copy. [240]

6. _Einige kanonische Verdderungen,_ Canonic Variations
on the Christmas Hymn Vom Himmel hoch da komm ich
her, for an Organ with two manuals and pedal. Published
at Nrnberg by Balthasar Schmidt. The work contains five
canonic variations of the utmost ingenuity. [241]


239 In fact Bach wrote the early _Aria variata alla maniera Italiana_ (Peters bk.
215, p. 12) for the Clavier. For the Organ he wrote four sets of Variations
upon as many Choral melodies (Novello bk. xix.). But all except the Goldberg
Variations are youthful works, and in his maturity Bach clearly had no liking
for the form. The theme of the Goldberg Variations, moreover, is itself a
youthful idea; at least it dates back to as early as 1725, and is found in A. M.
Bach's _Notenbuch_ (No. 26, Aria in G major).
240 There is no reference to these corrigenda in the B. G. edition.
241 The work has been referred to already in connection with Bach's
membership of Mizler's Society (supra, p. 112). It was composed presumably
circ. 1746 and in point of technical skill is the most brilliant of Bach's
instrumental works. Forkel states that it was engraved after June 1747, when
Bach joined Mizler's Society. Spitta (iii. 295) is of opinion that it was already


106 Johann Sebastian Bach


7. _Musikalisches Opfer_, or A Musical Offering, dedicated
to Frederick II., King of Prussia. The theme received by
Bach from the King [242] is treated first as a three-part Fugue
under the acrostic title Ricercare (Regis iussu cantio et
reliqua canonica arte resoluta). There follows a six-part

[121] Ricercare and Thematis regii elaborationes canonicae of
various kinds. [243] The work includes a Trio for Flute, Violin,
and Clavier upon the same subject. [244]


8. _Die Kunst der Fuge_, or The Art of Fugue. This work,
unique of its kind, did not appear till about 1752, after Bach's
death, though the greater part of it had been engraved by
his sons during his lifetime. [245] Marpurg, [246] the leading
German musical critic of that day, contributed a preface
to this edition which contains many just observations on
the value and utility of such treatises. [247] But, being too
good for the general public, the work found only a small


engraved by then. It is in bk. xix. of Novello's edition.
242 Supra, p. 25.
243 The presentation copy of the work, which Bach sent to Frederick along
with a dedicatory letter (July 7, 1747), is in the Berlin Amalienbibliothek and
proves that only the first third of the work, as far as the Ricercare a sei voci
(see B.G. XXXI. (2)) was sent then. The latter and the remaining canons were
dispatched subsequently probably by the hand of C. P. E. Bach. The six-part
Ricercare was a particular compliment to the King. Frederick had desired Bach
on his visit to play a Fugue in six parts but left it to the player to select his
theme. Bach now employed the thema regium for the purpose. The first reissue
of the work was by Breitkopf and Haertel in 1832. Peters (bk. 219) brought it
out in 1866. See Schweitzer, i. 417 IV. and Spitta, iii. 191 ff. and 292.
244 In C minor (P. bk. 237 p. 3).
245 The statement is inaccurate. The work was written for the most part in
1749 and the greater part of it was prepared for engraving by Bach himself
during his last illness. None of his elder sons was with him at his death, and
the blunders that disfigure the engraved copy show that they clumsily finished
their father's work. It is in P. bk. 218.
246 Friedrich Wilhelm Marpurg, b. 1718, d. 1795.
247 The work was published shortly after Bach's death, but had no sale. C. P.
E. Bach then commissioned Marpurg to write a preface, and the new edition


CHAPTER IX. BACH'S COMPOSITIONS 107


circulation among those who discerned its merit and eagerly
bought copies. The plates were never used again and [122]
eventually were sold [248] by Bach's heirs at the price of old
copper. Written by a man of Bach's transcendent genius, and
commended as a masterpiece by a critic so highly regarded
as Marpurg, a work of this kind, if published in any other
country than Germany, would have passed through at least
ten editions by now, if only at the bidding of patriotism. But
in Germany not a sufficient number of copies was sold to
pay for the plates used in engraving the work!
The work consists of fugal Variations planned on the most
elaborate scale. [249] The composer's intention was to show
in what a variety of ways the same theme can be treated
fugally. The Variations (here called Contrapunctus) [250]

are complete Fugues upon the same theme. The last Fugue
of all has three subjects, in the third of which the composer
signs his name, B A C H. [251] Bach was prevented from


finishing it by the disorder of his eyes, and as an operation
brought no relief the movement was never completed. It is
said that Bach intended to introduce four themes into it and

to bring it to an impressive conclusion by inverting them


was published at the Leipzig Fair, Easter, 1762. In four years only about thirty
copies were sold. See Spitta, iii. 197 ff. and Schweitzer, i. 423 ff.
248 In 1756. See C. P. E. Bach's advertisement in Felix Grenier, p. 232.
249 The work contains six Fugues and four canons upon the same theme; an
unfinished Fugue a tre soggetti, the first four notes of the third of which spell
B A C H; and the Choral Prelude Wenn wir in hchsten Nthen sein.
250 Schweitzer explains: His purpose in this work being a purely theoretical
one, Bach writes the Fugues out in score, and calls them counterpoints 
251


108 Johann Sebastian Bach


all. All the Fugues in the work are equally smooth and
melodious.


To make up for the unfinished Fugue Bach concluded
the work with a Choral Prelude upon the tune Wenn
wir in hchsten Nthen sein, which he dictated to his
son-in-law, Altnikol, a few days before his death. [252] Of
the extraordinary skill it displays I do not speak, save to
remark that even in his last illness it proclaims Bach's
skill undiminished. The pious resignation and devotion
that characterise it move me deeply whenever I play it.
Nor should I find it easy to say which I had rather had
been omitted, the Choral Prelude, or the conclusion of the
unfinished Fugue.


9. Lastly, after Bach's death, his four-part Chorals were
collected by his son, Carl Philipp Emmanuel, and were
published by Birnstiel (Berlin and Leipzig), Part I. in 1765,
Part II. in 1769. [253] Each Part contains one hundred Chorals,

[123] mostly taken from the composer's church Cantatas.


More recently Kirnberger edited, in four volumes, a
collection of Bach's Chorals. They are published by
Breitkopf. [254]


Bach's works, still in MS., consist of compositions for the
Clavier, Organ, with and without other instruments, Strings,
and the voice. I will enumerate them in that order.


252 Supra, p. 27. The movement is in N. bk. 17 p. 85. It is not certain that
Bach intended the Prelude or the unfinished Fugue to be included.
253 C. P. E. Bach was only concerned with the first volume. Erk, in his
edition of the _Choralgesnge,_ conjectures that Kirnberger was responsible for
the second.
254 The four volumes were published at Leipzig between 1784-87. Spitta
states that C. P. E. Bach was the editor. Erk joins Kirnberger with him in that
position. As C. P. E. Bach died in 1788 Kirnberger's association with the work
is probable, especially if he had already been responsible for the 1769 volume.


CHAPTER IX. BACH'S COMPOSITIONS 109

### I. Compositions For The Clavier


1. _Six Little Preludes far Beginners_ . [255]

2. _Fifteen Two-part Inventions_ . An Invention is a musical
theme so constructed that by imitation and inversion a whole
movement can be evolved from it. The subject having been
first stated, the rest develops naturally out of it. For the
instruction of a young Clavier player these fifteen Inventions
are of great value, seeing that the composer has been careful
not only to provide exercises for both hands but for every
finger as well. They were composed at Cthen in 1723, [124]
with a long title which begins: An honest Guide, in which
lovers of the Clavier are shown a clear method of playing
correctly in two parts, etc. [256]

It cannot be denied that, among other blemishes, the
Inventions occasionally exhibit melodic poverty and
roughness. But finding them useful to his pupils, Bach
eventually revised them and removed from them everything
that offended his maturer taste, so that they now stand as
masterpieces of pure music. Moreover they are invaluable
exercises for the fingers and hands and are sound instructors
of taste. There is no better introduction to Bach's larger
works than they afford.


255 Bach's Clavier school consisted of eighteen Preludes for beginners (all in
B.G. XXXVI.); the two-part and three-part Inventions; and the _Well-tempered_
_Clavier._ The six Preludes mentioned by Forkel, and which alone he knew,
were published by him for the first time. Seven more are found in Wilhelm
Friedemann's _Clavierbchlein_ (B.G. XLV. (1)), and the remaining five have
survived in texts handed down by others of Bach's pupils. The eighteen are in
P. bk. 200.
256 The Autograph was written at Cthen and is dated 1723. It also contains
the fifteen Symphonies, or three-part Inventions mentioned in paragraph 3.
Both Inventions and Symphonies are in F. bk. 201. According to Spitta (ii. 57
n.) the Inventions were published at Leipzig in 1763. See also Schweitzer, i.
328 ff.


110 Johann Sebastian Bach


3. _Fifteen three-part Inventions_, also called Symphonies.
They were written for the same purpose as the Inventions,
but are more advanced. [257]


4. _The Well-tempered Clavier_, or, Preludes and Fugues in
all tones and semitones, composed for the profit and use of
young musicians desirous of knowledge, as also for those
who are skilled already in this studio. Part I. was finished
in 1722. Part II., like Part I., contains twenty-four Preludes

[125] and twenty-four Fugues in every key, and was composed
at a later period. [258] Every number of it, from first to last,
is a masterpiece. In Part I., however, certain Preludes and
Fugues bear marks of immaturity and are included probably
only in order to complete the series. But here again Bach
eventually corrected whatever seemed to him lacking in
finish. He altered or rewrote entire passages, so that in the
later texts few movements are not perfect. Among these
few I reckon the Fugues in A minor, [259] G major and G
minor, [260] C major, [261] F major and F minor. [262] The rest
are excellent, some of them so superlatively good as to be
not inferior to those in Part II. [263] Even Part II., for all its


257 See the previous note.
258 The second Part was compiled in 1744 and Bach's Autograph of it, though
not the earliest Autograph, is in the British Museum. See Schweitzer, i. 331 ff.
and Spitta, ii. 161 ff. The whole work is in P. bks. 1, 2; or 1a, 1b; or 2790a,
2790b.
259 No. 20. Spitta (ii. 164) attributes it to the years 1707 or 1708. Schweitzer
(i. 332) also regards it as a youthful piece written, moreover, for the pedal
Clavicembalo.
260 Nos. 15 and 16. Spitta, admitting that the two do not rank with the most
interesting in the collection, finds no indication of their being of different date
from the best movements.
261 No. 1. Here Spitta (ii. 165 n.) challenges Forkel.
262 Nos. 11 and 12. In regard to No. 12 (F minor) Spitta holds Forkel to be in
error. As to No. 11, he expresses the same opinion as in note 3, supra.
263 The date 1744 places the second Part among Bach's latest compositions.
On the other hand, like the first Part, it contained work of earlier date.


CHAPTER IX. BACH'S COMPOSITIONS 111


original perfection, has been improved by the composer, as
may be observed by comparing the original and later texts.
Both Parts contain treasures of art not to be found outside

Germany. [126]
5. _Chromatic Fantasia and Fugue._ [264] I have taken considerable pains to discover a similar piece of music by Bach,
but without success. The Fantasia is unique and unequalled.
Wilhelm Friedemann sent it to me from Brunswick inscribed

with these words by a mutual friend. Anbey kommt an
etwas Musik von Sebastian, sonst genannt: Fantasia chromatica; bleibt schn in alle Saecula.

It is remarkable that this piece, for all its technical skill,
appeals to the most unpractised hearer, if it is performed at
all tolerably.

6. A _Fantasia in C minor_ . It is not of the same character

as the preceding work, but resembles rather the Allegro of
a Sonata. It is divided into two parts, but must be played
as a single movement. It is an excellent work, and in
old copies an unfinished Fugue follows, which, however,
cannot belong to it. [265] The first thirty bars certainly are
by Bach, for they are marked by an extremely bold use of
augmented and diminished intervals and their inversions, in
three-part harmony. None but Bach attempted such things.
The rest of the movement seems to have been added by [127]
another hand and bears no trace of Bach's style.
7. _Six large Suites_, consisting of Preludes, Allemandes,
Courantes, Sarabandes, etc. They are known as the En

264 Chromatic Fantasia and Fugue in D minor (P. bk. 207 p. 4). It probably
dates from circ. 1720-23.
265 The MS. was discovered in 1876 and is now at Dresden. It was written

circ. 1738 and disproves Forkel's conjecture that the fugue did not belong to
the Fantasia and is only partially by Bach. The Fugue contains forty-seven
bars. As the Autograph is a fair copy the Fugue cannot be called unfinished.
See Spitta, iii. 182. The Fantasia is in P. bk. 207 p. 50; the Fugue in P. bk. 212
p. 88. See B.C. xxxvi., xxxviii., and xlii. for other Clavier Fantasias.


112 Johann Sebastian Bach


glish Suites, because the composer wrote them for an
Englishman of rank. [266] All of them are of great merit as
works of art, and some movements, in particular the Gigues
of the fifth and sixth Suites, are perfect masterpieces of
harmony and melody.

8. _Six small Suites_, consisting of Allemandes, Courantes,
etc. They are generally called the French Suites, because
they are written in the French style. [267] The composer
is intentionally less academic in them than in his larger
Suites, and their melodies are more than usually pleasant
and agreeable. In particular the fifth Suite deserves to
be noticed: all its movements are most melodious, and in

[128] the concluding Gigue only consonant intervals, especially
thirds and sixths, are used.


These are Bach's principal works for the Clavier which
can be considered classics. [268] A great number of single
Suites, [269] Toccatas and Fugues, [270] besides those already
mentioned, have great and varying merit, but are youthful


266 The true explanation seems to be that the Prelude of the first Suite (A
major) is based upon a Gigue by Charles Dieupart (d. circ. 1740), a popular
teacher and composer in England. The words fait pour les Anglois, which head
the A major Suite in an early MS., have been wrongly interpreted as applying
to the whole set of six. They merely indicate Dieupart's borrowed Gigue. See
Grove, vol. i. 701, and Parry, _J. S. Bach,_ p. 463. A copy of the work exists, of
date 1724-27, made by one of Bach's pupils. But the composition of the Suites
may certainly be assigned to the Cthen period. They are published in P. bks.
203, 204.
267 The French Suites undoubtedly date back to the Cthen period, since they
figure, though incomplete, in the _Notenbuch_ of A. M. Bach (1722). They are
published in P. bk. 202.
268 Forkel's incomplete catalogue may be compared with the Bachgesellschaft
volumes III., XIV., XXV. (1), XXXI. (2), XXXVI., XLIL, XLIII. (1 and 2),
XLV. (1). See generally Schweitzer, ch. 15, and Pirro, pp. 218 ff.
269 P. bks. 205, 206, 208, 212 (fragment in F minor), 214, 215, 1959.
270 P. bks. 200, 210, 211, 212, 214, 215, 1959.


CHAPTER IX. BACH'S COMPOSITIONS 113


works. [271] At the most, ten or twelve of them seem to me
worth preserving, some of them because they would be useful
as finger exercises, for which their author originally intended
them, others because they are at least better than similar works
by other composers. As an exercise for the fingers of both hands
I particularly single out a Fugue in A minor, [272] in which the
composer has been at great pains to write florid passages in
order to give equal strength and suppleness to both hands. For
beginners a little two-part Fugue [273] should also prove useful. It
is melodious, flowing, and not at all old-fashioned.

### II. Music For The Clavier With Other Instruments


1. _Six Sonatas for Clavier with Violin obbligato_ . Composed
at Cthen, they are among Bach's masterpieces in this form
and display fugal and canonic writing which is both natural
and full of character. The Violin part needs a master to
play it; for Bach knew the capabilities of the instrument and
spared it as little as the Clavier. The six Sonatas are in the
keys of B minor, A major, E major, C minor, F minor, and
G major. [274]

2. _Several Sonatas for Harpsichord and Violin_, [275] _Harp-_
_sichord and Flute_, [276] _Harpsichord and Viol da Gamba_ . [277]


271 For the most part these youthful works will be found in B.G. XXXVI.
272 P. bk. 207 p. 16.
273 In C minor (P. bk. 200 p. 10).
274 In P. bks. 232, 233.
275 Suite in A major (P. bk. 236), Sonata in E minor (P. bk. 236), Fugue in G
minor (P. bk. 236), four Inventions (P. bk. 2957), Sonata in G minor (BG. ix.
274; not in P.), Sonata in C major for 2 Violins and Clavier (P. bk. 237).
276 There are six Sonatas for Flute and Clavier, in B minor, E flat major, A
minor, C major, E minor, E major (P. bks. 234, 235).
277 There are three Sonatas for Clavier and Gamba, in G major, D major, G
minor (P. bk. 239).




[129]


114 Johann Sebastian Bach


They are admirably written and most of them are pleasant
to listen to even today. [278]


3. _Several Concertos for the Clavier and other instruments_ .

[130] They contain real gems of art but are antiquated in form. [279]


4. _Two Concertos for two Claviers_, with an accompaniment
of two Violins, Viola, and Violoncello. The first, in C
minor, [280] has an antique flavour. But the second, in C
major, [281] is as fresh as if it had been written yesterday. [282]

It may be played without the String quartet and still sounds
admirable. The final Allegro is a majestic movement and
strictly fugal. Compositions of this form were first perfected,
indeed, we may conjecture, were first attempted, by Bach.
At least, I have met with only a single example by another
composer that may perhaps be oldernamely, Pachelbel of
Nrnberg's Toccata, as he called it. Pachelbel, however,
was a contemporary of Bach and may have taken the idea
from him. However, his work is not worth considering. One
instrument merely repeats the other's phrases without being
at all concertante. It almost seems as if Bach at this period
had made up his mind to discover what could be done with


278 Forkel omits two Sonatas for Violin, Flute, and Clavier, in G major and C
minor (both in P. bk. 237).
279 As Forkol mentions in secs. 4, 5, 6 the Concertos for two, three, and
four Claviers, perhaps he had in mind here seven Concertos for Clavier and
Orchestra (P. bks. 248-254). A Concerto for Clavier, Violin, Flute, and
Orchestra (P. bk. 255 p. 4) in A minor also should be mentioned. Also an
Overture, in G minor, for Clavier and Strings (B.G. XLV. (1) p. 190; not in P.)
280 P. bk. 257 p. 4.
281 P. bk. 256 p. 4.
282 There are, in fact, three Concertos for two Claviers and Orchestra: two
in C minor and one in C major. Forkel refers to only one of the former and
regards it as antiquated by comparison with the one in C major. Spitta (iii.
144) attributes the C major to 1730. Forkel's C minor in its original form was
a Concerto for two Violins, now lost. The other C minor Concerto is identical
with the Concerto in D minor for two Violins and is in P. 257b. Spitta (iii. 138)
dates it 1736. See Schweitzer, i. 413.


CHAPTER IX. BACH'S COMPOSITIONS 115


any number of parts. Having already written for a single [131]
solo instrument music which required no accompaniment,
he next experimented in dividing his material between as
large a number of solo instruments as possible. Hence the
Concertos for two Claviers were followed by
5. _Two Concertos for three Claviers_ with an accompaniment of Strings. [283] These Concertos present a remarkable
characteristic: besides the concertante combination of three

Claviers, the stringed instruments also have concertante
parts distinct from the accompaniment. It is difficult to
realise the art involved in this achievement. For, in spite
of their technical skill, the two works are so delicate, full
of character, and expressive, that the composer might be
treating a simple melody (note particularly the Concerto in
D minor). Words are inadequate to express the admiration
they arouse. But Bach was not satisfied. Hence he wrote
6. _A Concerto for four Claviers_ and four stringed instruments. [284] I cannot judge the effect of this composition, for
I have never been able to get together the four instruments
and four performers it requires. But that it is admirably [132]
written can be seen from the parts.

### III. Compositions For The Organ


The pedal is the distinctive feature of the Organ which places
it above all other instruments, and gives it its magnificence,


283 In D minor and C major (P. bks. 258, 259). The tradition is that Bach wrote
these two Concertos in order to play them with his elder sons. Spitta (iii. 144)
finds the tradition trustworthy. Hence the two works must have been written
by c. 1733 at latest, before the sons left home. See also Schweitzer, i. 414.
284 In A minor (P. bk. 260). This is not an original composition, but is an
arrangement by Bach of a Vivaldi Concerto for four Violins. Spitta (iii. 149)
assigns it to the same period as the Concertos for three Claviers, c. 1733. See
B.G. XLIII. (1) infra.


116 Johann Sebastian Bach


sonority, and majesty. Deprive it of the pedal and you take
from it the solemn and imposing tones which are its distinctive
utterance, reducing it to the level of a positiv, or Chamberorgan, an instrument relatively insignificant.
But an Organ equipped with a pedal must be able to employ it
in its full compass, [285] and both composer and organist must know
the proper use of it. No one excelled Bach in this knowledge.
Not only is his rich harmony and melody singularly adapted to
the instrument, but he gave the pedal a part of its own, even in his
early compositions. Yet it was only gradually that he mastered
its technique; for his Organ masterpieces belong to the period
in which those for the Clavier began to be classics. His early
and immature Organ works are widely dispersed; for as soon
as a composer begins to be distinguished everybody is anxious
to possess a specimen of his art. Public curiosity, however,
generally dies down long before a composer comes to maturity,

[133] particularly if his work is over the heads of the public. And this
seems to have been Bach's fortune. Consequently his mature
Organ works are less familiar than his early efforts. The latter,
however, cannot possibly be admitted to a correct and critical
edition of his works, and I mention here only those whose merit
is as incontestable as that of the Clavier works enumerated in the

preceding paragraphs.
Bach's finest Organ music falls into three groups:


1. _The Great Preludes and Fugues_, with obbligato pedal.
Their number cannot be stated, but I believe it not to exceed
a dozen. [286] At least, after prolonged search I have not been
able to collect more than that number. [287] To these I must


285 The pedal on the small German Organ had only the compass of an octave.
286 The Great Preludes and Fugues are, with one exception, in B.G. XV. The
Prelude and Fugue in E flat was published by Bach in the third Part of the
_Clavierbung._ Its Fugue is known as the St. Anne's.
287 From the figures printed by Forkel the twelve can be identified as follows
(the references in parentheses are to the Novello edition of Bach's Organ


CHAPTER IX. BACH'S COMPOSITIONS 117


add a very clever and original Passacaglia, which, however, [134]
seems suitable rather for a two-manual Clavicembalo and
pedal than for the Organ. [288]


2. _Preludes on Choral Melodies_ . It was at Arnstadt that Bach

began to compose Variations on Choral melodies, under the
title _Partite diverse._ [289] Most of them can be played on
the manuals alone. Those which I include here are an

exception and require the obbligato pedal. Their number
may amount to one hundred. I myself possess above seventy,


works):


Prelude and Fugue in C minor, the Great (bk. vii. 64).
Prelude and Fugue in A minor, (bk. vii. 42).
Prelude and Fugue in G major, (bk. viii. 112).
Prelude and Fugue in E minor, (bk. viii. 98).
Prelude and Fugue in B minor, (vii. 52).
Prelude and Fugue in C major, (bk. ix. 156).
Prelude and Fugue in D minor, (bk. ix. 150).
Prelude and Fugue in C major (bk iii. 70).
Tocatta and Fugue in D minor (bk. x. 196).
Tocatta and Fugue in F major (bk. ix. 176).
Prelude and Fugue in G minor (bk. viii. 120).
Prelude and Fugue in E minor (bk. ii. 44).


288 The Passacaglia in C minor (Novello bk. 10 p. 214) was written originally
for the Clavicembalo and pedal. It belongs to the later Weimar period, i.e. circ.
1715. See Spitta, i. 588 and Schweitzer, i. 280.
289 They are all printed in Novello bk. 19, and are three in number, on the
melodies Christ, der du bist der helle Tag, O Gott, du frommer Gott, and
Sei gegrsset, Jesu gtig. The pedal is only required in one movement of the
first, in none of the second, and considerably in the third. Without question


118 Johann Sebastian Bach


and more survive elsewhere. [290] No other Choral Preludes

approach them in religious feeling, dignity, and sublimity
of expression. I cannot notice them individually; they are
too numerous. Besides the larger, there is a great number
of shorter and easier ones, particularly useful for young
players. MSS. of them exist in considerable number. [291]


3. _Six Sonatas_, or Trios, for two manuals and an obbligato
pedal. [292] Bach wrote them for his eldest son, Wilhelm
Friedemann, whom they helped to become the great performer he was when I knew him. It is impossible to
overpraise their beauty. Bach composed them when he was
in the full vigour of his powers, and they may be considered
his chef d'oeuvre in this form. [293] He also wrote other Organ
Sonatas, the MSS. of which are in various collections. They
are fine compositions, though they do not equal the Six in


all three date from Bach's earliest period, but whether they were written at
Arnstadt or Lneburg cannot be stated.
290 The fullest collection of these miscellaneous Organ Choral Preludes is
in B.G. XL. Not counting variant readings they number fifty-two, besides
two fragments and thirteen of doubtful authenticity, of which two are sets of
Variations. The Novello edition contains fifty-two in bks. 18 and 19. To these
must be added the Eighteen Preludes on Choral Melodies, which Forkel
nowhere mentions, as well as the third Part of the _Clavierbung,_ the _Schbler_
_Chorals,_ and the Variations on _Vom Himmel hoch,_ to which he has already
made reference in the first section of this chapter. As he does not mention it
specifically, it is to be inferred that Forkel was ignorant of the existence of
the _Orgelbchlein_ ; otherwise he could hardly have failed to introduce it in this
section. All Bach's Choral Preludes, miscellaneous and in collections made by
himself, are in Novello's edition, bks. 15-19. A useful key to their melodies is
provided by bk. 20. For more detailed information see Terry, _Bach's Chorals,_

Part III.
291 The large number of MSS. of many of the miscellaneous Preludes is made
evident in the introduction to B.G. XL.
292 The Sonatas in E flat major, C minor, and D minor are in N. bk. 4; E minor,
C major, G major in N. bk. 5.
293 The so-called Sonatas were actually written for a Clavicembalo with


CHAPTER IX. BACH'S COMPOSITIONS 119


merit. [294]

### IV. Instrumental Music


There are few instruments for which Bach did not write. In his

day it was usual to play a Concerto or instrumental Solo during
the Communion office. [295] Bach composed many of these pieces
himself, and always with a view to their improving the technique
of the player. Most of them are lost. But two important works
of another kind survive and to some extent compensate us. They

are:


1. Six Solos for Violin, unaccompanied. [296]

2. Six Solos for Violoncello, unaccompanied. [297] The Violin
Solos have long been considered by the finest players to be


two manuals and a pedal. Bach's Autograph of them belonged to his second
son and an earlier copy of them to Wilhelm Friedemann. Both are now in the
Berlin Royal Library. Friedemann went to Dresden as Organist in 1733 and
Spitta is of opinion that the whole of the six Sonatas were in existence by or
soon after 1727. If so, they must be regarded as the outcome of Bach's early
years at Leipzig. See Spitta, iii. 212 ff. and Schweitzer, i. 278.
294 None are extant. Spitta, iii. 213 n., conjectures that Forkel refers to the
Trios in D minor and C minor (N. bks. 2 p. 54, 12 p. 108) and the Pastorale in
F major (N. bk. 12 p. 102.) His incomplete knowledge of the Organ works is
revealed by Appendix V. infra.
295 This is a pure conjecture and Schweitzer scouts it (i. 416 n.).
296 The oldest copy of them dates from circ. 1720; they belong therefore to
the late Cthen period. The 1720 MS. is in A. M. Bach's handwriting and was
discovered in 1814 at Petrograd among old papers about to be sent away to a
butter dealer. The Sonatas are in P. bk. 228.
297 They also date from the Cthen period and are in P. bk. 238a, 238b.


120 Johann Sebastian Bach


the best instructor for the instrument. The Violoncello Solos
are equally effective. [298]

### V. Vocal Music


1. Five complete sets of church Cantatas for the Sundays
and Festivals of the year. [299]


2. Five compositions for Holy Week, one of which is for
double chorus. [300]


298 Forkel omits to mention the Brandenburg Concertos (P. bks. 261-266);
the Overtures in C major (P. bk. 267), B minor (P. bk. 268), D major (P.
bk. 269), D major (P. bk. 2068); and the Violin Concertos in A minor (P.
bk. 229), E major (P. bk. 230), and (for two Violins) in D minor (P. bk.
231). In B.G. XXI. (1) is a Symphonic movement, in D major, for Violin and
orchestra. A Sinfonia in F major (B.G. XXXI. 96) is another version of the first
Brandenburg Concerto. The Clavier Concertos have been mentioned supra.
299 The set of five is complete only for Christmas Day, Feast of the
Circumcision, Whitsunday (one of the five is of doubtful authenticity),
Purification of the B.V.M., and Feast of St. Michael the Archangel. See
Terry, _Bach's Chorals,_ Part II. 2 ff.
300 In giving the number of _Passions_ as five, Forkel repeats the statement of the
_Nekrolog._ The number corresponds with the five sets of Church Cantatas which
Bach is known to have written. It is, however, exceedingly doubtful whether
Bach wrote more than four _Passions._ Only those according to St. Matthew
and St. John have come down to us from C. P. E. Bach, who was left the
Autographs of both by his father. The _St. John Passion_ was first performed in
1724 and the _St. Matthew Passion_ in 1729. Picander, Bach's librettist, certainly
wrote two other Passion texts, one of which was written for Good Friday 1725,
and the second, based on St. Mark's Gospel, was actually performed at St.
Thomas', Leipzig, on Good Friday 1731. Spitta (ii. 505) gives good reason


CHAPTER IX. BACH'S COMPOSITIONS 121


3. Several Oratorios, [301] Masses, [302] a _Magnificat,_ settings
of the Sanctus, [303] compositions for birthdays and Saints'


to hold that Bach's music for this Passion was adapted from the _Trauer-Ode,_
which he had written in 1727 in memory of Queen Christiane Eberhardine.
But of the 1725 _Passion_ there is no trace. If it ever existed, its loss probably
may be assigned to Wilhelm Friedemann's carelessness, to whom presumably
it was assigned in the division of Bach's property after his death. But even so,
we have no more than four _Passions._ There exists, however, a fifth _Passion_
_according to St. Luke,_ which is undoubtedly in Bach's Autograph, and which
Spitta is inclined to attribute to Bach himself. It is published by Breitkopf and
Haertel, but is generally regarded as being by another composer than Bach,
who probably copied it for use at Leipzig. On the whole matter see Spitta, ii.
504 ff., Schweitzer, chap. xxvi., and the Bach-Jahrbuch for 1911 (Publications
of the New Bachgesellschaft XII. (2)).
301 Other than the _Passions,_ the only Oratorios are the _Christmas Oratorio_,
(1734), the _Easter Oratorio_ (c. 1736), and _Ascension Oratorio_ (c. 1735).
302 Besides the B minor Mass (1733-? 38) Bach wrote four miscalled short
Masses, in F major, A major, G minor, and G major. They all belong to the
Leipzig period (c. 1739).
303 Besides the setting of the Sanctus in the B minor Mass there are four
detached settings, in C major, D major, D minor, and G major. Of these only
that in D major is probably by Bach (c. 1723).


122 Johann Sebastian Bach


Days, [304] funerals, [305] marriages, [306] and some Italian Cantatas. [307]


4. Several Motets for single and double chorus. [308]


Most of these works are now dispersed. The Church Cantatas
were divided between his elder sons after their composer's death.
Wilhelm Friedemann had the larger share because, being organist
at Halle, he could make use of them. Later, circumstances
compelled him to part with them gradually. I know of no other
collection of Bach's larger choral works. There exist, however,
eight or ten Motets for double chorus, but they are dispersed in
various hands. [309] In the collection bequeathed by the Princess
Amalia of Prussia to the Joachimsthal Gymnasium at Berlin there
are some of Bach's vocal compositions. [310] Their number is not
considerable, but among them are the following:


304 The music for Saints' Days is included in the church Cantatas. For the
Birthday Odes see supra, Chap. IIA.
305 Besides the _Trauer-Ode,_ three or four of the church Cantatas and certainly
three of the Motets were written for funerals. See Terry, op. cit., pp. 24, 44.
306 Among the church Cantatas there are at least five for use at weddings. Bach
wrote also three secular wedding Cantatas: _Weichet nur, betrbte Schatten_ (c.
1730); _O holder Tag_ (11749); the third (1728) has disappeared.
307 Two Italian Cantatas _Amore traditore_ and _Non sa che sia dolore_ have

come down to us. A third, _Andro dall colle al prato,_ is lost. See B.G. XI. (ii.),

XXIX.
308 Only six are genuine. See infra, p. 141.
309 Of the Motets that have come down to us as his, only six are Bach's.
Forkel mentions five of them in secs. 7 and 3 of the next paragraph; he omits
_Lobet den Herrn, alle Heiden._ In 1802-3 Breitkopf and Haertel published six
Motetsthe five mentioned by Forkel and another, _Ich lasse dich nicht,_ of
which Bach made a copy, but whose composer actually was Johann Christoph
Bach. We know that Bach composed at least one Latin Motet for double
chorus, and Friedemann's share of his father's autographs may have contained
it and others known to Forkel but no longer extant.
310 The Amalienbibliothek of the Joachimsthal Gymnasium, Berlin, contains
one of the most important Bach collections, but it has long been superseded by


CHAPTER IX. BACH'S COMPOSITIONS 123


1. Twenty-one Church Cantatas. [311] In one of them, set to the
words, _Schlage doch, gewnschte Stunde,_ [312] the composer
introduces a bell obbligato. From that fact we may conclude
that the Cantata was not composed in the period of Bach's
maturity, [313] for the use of bells is of doubtful taste.


2. Two Masses for five voices with instrumental accompaniment. [314]


3. A Mass for double chorus, the first being accompanied [135]
by Strings and the second by wind instruments. [315]


4. A _Passion,_ for double Chorus, [316] the text by Picander. [317]


5. A _Sanctus,_ for four voices and instrumental accompaniment. [318]


6. A Motet, for four voices, _Aus tiefer Noth schrei ich zu_


the Royal Library there as the chief repository of Bach's Autographs.
311 The Amalienbibliothek has only one Autograph, namely, Cantata 34, _O_
_ewiges Feuer._ The rest are early copies.
312 Cantata 53. No Autograph of this Cantata exists, and the copies from which
the B.G. edition was printed are in the Amalienbibliothek.
313 On the contrary, the Cantata belongs to the Leipzig period, 1723-34.
314 None of the four short Masses is in five parts. All have instrumental
accompaniments. The autograph scores of the Masses in A major and G
major are in Messrs. Breitkopf and Haertel's possession. Copies of the other
two scores, in Altnikol's handwriting, are in the Berlin Royal Library. See
Introduction to B.G. VIII.
315 An eight-part Mass in G was performed at a Leipzig Gewandhaus Concert
on March 7, 1805, and was published later in the year by Breitkopf and Haertel.
The score is admittedly, for the greater part of the work, in Bach's hand and is in
the Berlin Royal Library. The publication of the work was under consideration
by the Bachgesellschaft in 1858. That it is not by Bach is generally held. It has
been attributed to Johann Ludwig Bach (d. 1741). See Genealogical Table II.
316 The _St. Matthew Passion._
317 A nom de plume for Christian Friedrich Henrici (1700-64), who wrote a
large number of Bach's Leipzig texts.
318 Perhaps Forkel indicates the short _Sanctus_ in Richter's edition of the


124 Johann Sebastian Bach


_dir._ [319]


7. A Motet for five voices, _Jesu, meine Freude._
8. Four Motets, for eight voices in double chorus:


(a) _Frchte dich nicht, ich bin dei dir._
(b) _Der Geist hilft unserer Schwachheit auf._
(c) _Komm, Jesu, komm._
(d) _Singet dem Herrn ein neues Lied._ [320]


9. A detached four-part fugal chorus, _Nimm was dein ist,_

[141] _und gehe hin._ [321]
10. A bucolic Cantata, with Recitatives, Aria, Duet, and
Chorus. A note is prefixed to it. [322]

On the MS. of the last-named Cantata and of the Mass for

double chorus (No. 3 supra) there is a note by Kirnberger
analysing the skill and merit of the compositions.


[142]


_Choralgesnge_, No. 123, or that in B.G. XLI. p. 177.
319 This is the first Chorus of Cantata No. 38. It is printed as a separate Motet
in Erk, No. 150.
320 Forkel's list is complete except for _Lobet den Herrn, alle Heiden._
321 The opening Chorus of Cantata 144.
322 Forkel refers to the _Peasant Cantata,_ or _Mer hahn en neue Oberkeet,_
performed on August 30, 1742. Forkel clearly was not familiar with Bach's
other secular Cantatas. See B.G. XI. (ii.), XX. (ii.), XXIX. The Autograph
score of the Peasant Cantata is in the Berlin Royal Library.


# CHAPTER X. BACH'S MANUSCRIPTS

It has been remarked more than once that Bach, throughout
his life, devoted much thought to the improvement of his
compositions. I have had frequent occasion to compare the
original and subsequent texts of his works, and confess to have
experienced both surprise and pleasure in observing his care to
improve whatever he thought faulty, to make good better, and
better perfect. Nothing is more instructive than a collation of
this kind, whether to the experienced musician or the instructed
amateur. I should like to see a supplement to the complete edition
of Bach's works showing these variant readings. [323] The collation
would be in the highest degree instructive, and to attempt it is as
appropriate to the works of the composer, a poet in sound, as to
those of the poet in words.

In Bach's early texts he often repeats a phrase to other words
with some melodic variety, in a lower or even in the same octave. [144]
In his riper experience he could not tolerate such poverty of
workmanship, and cut out these passages remorselessly, without
regard for the number and quality of the persons who had
approved them in their original state. There occur to me two
good examples of this, the C major and C sharp minor Preludes in
the first part of the _Well-tempered Clavier._ Bach revised them so
drastically as to cut them down by one-half, sacrificing passages
that he thought redundant. [324]


323 Forkel's suggestion was carried out, with varying thoroughness, in the
Bachgesellschaft edition.
324 Forkel's judgment is at fault. See Schweitzer, i. 336.


126 Johann Sebastian Bach


In other places Bach tends to be over-concise; he expresses
an idea, but does not fully develop it. The best illustration that
occurs to me is the D minor Prelude in the second part of the
_Well-tempered Clavier._ I possess several texts of it. In the
oldest the first transposition of the theme in the Bass and several
other details essential to a complete development of the idea are
wanting. A second MS. gives the theme to the Bass wherever
the latter is in a key nearly related to that of the tonic. In a third
MS. these addenda are developed more fully and are joined more
skilfully. But melodic details are present of doubtful relevance
to the rest of the composition. In a fourth MS. these disappear or
are amended, so that, as we have it, the Prelude stands as one of
the most beautiful and least faulty in the _Well-tempered Clavier._

[145] Many people, no doubt, preferred the movement in its original
form. But Bach was not a man to be influenced by approbation
or criticism. He went on correcting until he satisfied himself.
In the early part of the seventeenth century it was the fashion in
instrumental music to overload single notes with ornaments and
add florid runs. Lately it has become the fashion to do so in vocal
music as well. That Bach shared this disposition may be inferred
from certain pieces that he wrote in this style. An instance is the
Prelude in E minor in the first part of the _Well-tempered Clavier._
But he soon returned to his natural better taste, and altered the
movement to the form in which it is engraved. [325]

Every decade has its own style of melody, distinctive of itself
and evanescent. A composer must carefully avoid it if he hopes
to be listened to by posterity. In his young days even Bach ran
upon this rock. His early compositions for the Organ, and the
two-part _Inventions_ in their original form, are full of fiorituri
such as the taste of his period approved. His Organ compositions
remain comparatively untouched, but the _Inventions_ he closely
revised. The public will soon be able to compare them in their


325 Also in Wilhelm Friedemann's _Clavierbchlein._ See Schweitzer, i. 279;
Spitta, ii. 166.


CHAPTER X. BACH'S MANUSCRIPTS 127


first and later forms, as the publishers, with admirable spirit,
have resolved to discontinue the present edition and to send out [146]
to subscribers a revised one based on Bach's corrected text.

Bach's processes of revision so far mentioned, however,
merely correct faults of form, that is, diffuseness or incomplete
development of a musical thought. But Bach employed other
methods which are less easy to describe because they are more
subtle. He often rivets the style and character of a piece by
changing a single note, strictly correct grammatically and yet
disagreeable to an artist such as himself. Even commonplace
passages he could convert into phrases of beauty by the addition
or alteration of a single note. Only the most sensitive taste and
trained experience can decide in such cases, and Bach possessed
both in the highest perfection. He developed them to such a
pitch, indeed, that his brain eventually rejected any idea which,
in all its properties and relations, did not accord inevitably and
naturally with the whole composition. Consequently his later
works display such consistency of merit that all of them seem
to have been cast complete in a mould, so smooth, facile and
abundant is the flow of his rich fancy. It is on the highest summits
of the art that harmony and melody find their ideal union, and as
yet Bach dwells there in majestic isolation.


[147]


# CHAPTER XI. THE GENIUS OF BACH

It is surely unnecessary to ask whether that artist is a genius
who, in every form of his art, has produced masterpiece
after masterpiece, of an originality which sets them above the
achievements of all other ages, distinguished also by a wealth
of originality and agreeableness that enslaves every hearer. The
most fertile fancy, invention inexhaustible, a judgment so nice as
to reject intuitively every irrelevant and jarring detail, unerring
ingenuity in employing the most delicate and minute resources
of his art, along with an unrivalled techniquethese qualities,
whose expression demands the outpouring of a man's whole
soul, are the signboards of genius. The man who cannot find
them in Bach's music either is not acquainted with it at all or
knows it imperfectly. One needs to be steeped in it thoroughly
to appreciate the genius of its author. For the greater the work
the closer study is demanded for its apprehension. The butterfly
method, a sip here and there, is of little use. But admirable as
were the gifts Bach received from nature, he could never have [148]
become an accomplished genius had he not learned betimes to
avoid the rocks on which many artists, some of them perhaps not
less gifted than he, too often founder. I will communicate to the
reader some scattered thoughts on the subject and conclude this
essay with an indication of the characteristics of Bach's genius.
Even the largest natural gifts, coupled with the strongest
propensity for a particular art, offer no more than fruitful soil
on which that art may thrive by patient cultivation. Industry,
the true begetter of every art and science, is an indispensable
factor. Not only does it enable genius to master technique, but it


130 Johann Sebastian Bach


stimulates the critical and reflective faculties also. The very ease
with which genius acquires and applies the apparatus of musical
composition frequently entices it to leap over root principles
in its plunge into deeper waters, or to fly before its wings are
grown. In such a case, unless genius is guided back to neglected
fundamentals and forced to build itself upon the great examples
of the past, it will inevitably expend its treasure uselessly and
never attain to its promised dimensions. For it is an axiom, that
real progress can never be made, nor the highest perfection be
attained, if the foundations are insecure. If arduous heights are
to be achieved, the easier obstacles must first be approached and

[149] overcome. Guided by his own inexperience no one ever can hope
to become great. He must profit by the practice and example of
others.

Bach did not founder on this rock. His soaring genius
attended an equally ardent industry which incessantly impelled
him, whenever he found his own equipment insufficient, to seek
guidance from others. Vivaldi and his Concertos were the first
from whom he sought counsel. From them he turned to the
principal Organ and Clavier composers of the period. Nothing
is more intellectually stimulating than counterpoint, and the
composers Bach studied were distinguished by their mastery of
it, as their fugal writing attests. Hence Bach's diligent study and
imitation of them pointed his taste and imagination to perceive
wherein himself was lacking and what steps were needed to take
him farther in his art.

A second rock upon which genius often comes to grief is
the public's undiscriminating applause. To be sure, I do not
undervalue public approval or commend without reserve the
remark of a Greek teacher to his pupil, You performed badly,
otherwise the audience would not have applauded you. Yet it is
none the less true that many artists are thrown off their balance
by exaggerated and often unmerited plaudits, particularly in their
early careers before they have acquired self-discipline and sound


CHAPTER XI. THE GENIUS OF BACH 131


judgment. The public merely asks for what it can understand,
whereas the true artist ought to aim at an achievement which [150]
cannot be measured by popular standards. How, then, can popular
applause be reconciled with the true artist's aspirations towards
the ideal? Bach never sought applause, and held with Schiller:


Kannst du nicht allen gefallen durch deine That und dein
Kunstwerk,
Mach' es wenigen recht; vielen gefallen ist schlimm. [326]


Like every true artist, Bach worked to please himself in his
own way, obeying the summons of his own genius, choosing his
own subjects, and finding satisfaction only in the approval of
his own judgment. He could count on the applause of all who
understood good music, and never failed to receive it. Under what
other conditions can sound works of art emerge? The composer
who debases his muse to the popular mood either lacks real
genius or, having it, abuses it. For to catch the ear of the public
is not a difficult task and merely connotes an agreeable facility.
Composers of that class are like artisans who frankly fashion
their goods to suit their market. But Bach never condescended
to such artifices. The artist, in his judgment, is the dictator of
public taste, not its slave. If, as often happened, he was asked
to write something simple for the Clavier he would answer, I [151]
will do what I can. He would choose an easy theme. But when
he began to develop it he always found so much to say that the
piece soon became anything but simple. If his attention was
drawn to the fact, he would answer smilingly, Practise it well
and you will find it quite easy. You have as many good fingers
on each hand as I have. Nor was he prompted in this by mere
contradictoriness, but exhibited the true artist spirit.


326 Since you cannot please everybody by your actions and work, strive at
least to satisfy a few; popular appreciation encourages bad art.Schiller's
_Votiftafeln_


132 Johann Sebastian Bach


It was, in fact, the artist temperament that led Bach to make
the great and sublime his goal. For that reason his music is not
merely agreeable, like other composers', but transports us to the
regions of the ideal. It does not arrest our attention momentarily
but grips us the stronger the oftener we listen to it, so that after
a thousand hearings its treasures are still unexhausted and yield
fresh beauties to excite our wonder. Even the beginner who
knows but the A B C of his art warms with pleasure when he
hears Bach's music and can open his ear and heart to it. It was
the true artist spirit, too, that guided Bach to unite majesty and
grandeur of design with meticulous care for detail and the most
refined elegance, characteristics which we rather seek, perhaps,
in works whose object is merely to give pleasure. Bach held
strongly that if the strands are imperfect, the whole design is
faulty. His genius is sublime and impressive, and he never

[152] condescends to be frivolous even when he touches the lighter
forms of art.

To conclude: it was the union of astounding genius and
indefatigable application that enabled Bach to widen at every
point the domain of musical expression. His successors have
failed to maintain the art at the level to which he raised it. If

Bach was more successful, if he was able to produce great work
of convincing beauty and imperishable as a model for those who
came after him, we owe it as much to his application as to his
genius.
This man, the greatest orator-poet that ever addressed the
world in the language of music, was a German! Let Germany be
proud of him! Yes, proud of him, but worthy of him too!


CHAPTER XI. THE GENIUS OF BACH 133


The Bach Statue at Leipzig


[153]


# APPENDIX I. CHRONOLOGICAL CATALOGUE OF BACH'S COMPOSITIONS

### I. CATALOGUE OF BACH'S COMPOSITIONS PRIOR TO HIS APPOINTMENT TO WEIMAR IN JUNE 1708, in his twenty-fourth year. [327] VOCAL:

Motet: Lobet den Herrn, alle Heiden.

### CLAVIER [328] :


Capriccio sopra la lontananza del suo fratello dilettissimo
(bk. 208 p. 62) (1704).
Capriccio in honorem Joh. Christoph Bachii, Ohrdruf (bk.
216 p. 34) (c. 1704).


327 The Cantatas are classified under Appendix II.
328 The references are to Peters' edition. Excepting bk. 1959, which contains
pieces of doubtful authenticity, every number printed by Peters is entered in
the Chronological Catalogue.


138 Johann Sebastian Bach


Sonata in D major (bk. 215 p. 44) (c. 1704). [329]


B.G. XXXVI. prints a number of pieces which, in general, may
be assigned to Bach's immature years. They are reproduced in
Peters' edition:


Book 200:


Fughetta in C minor (p. 10).
Prelude and Fughetta in D minor (p. 40).
Prelude and Fughetta in E minor (p. 42).

[153] Prelude and Fughetta in A minor (p. 47).
Fugue in C major (p. 54).
Fugue in C major (p. 56).


Book 207:


Fantasia in C minor (p. 50).


Book 212:


Fantasia in C minor (p. 58).
Fugue in D minor (p. 59).
Fugue in D minor (p. 61).
Fugue in E minor (p. 68).


Book 214:


Prelude and Fughetta in F major (p. 76).
Prelude and Fughetta in G major (p. 78).
Prelude in G major (p. 80).


Book 215: Three Minuets (p. 62).


To these may be added (? authentic) from B.G. XLII.:


Book 212:


329 There are three other Sonatas, in A minor, C major, D minor, none of
which is an original composition. They are printed in P. bk. 213. The first and
second are adaptations of material in Reinken's _Hortus Musicus._ The third is a
transcription of the second Solo Sonata for Violin.


139


Fantasia and Fughetta in B flat major (p 58).
Do. do. D major (p. 60).

### Organ [330] :


Prelude and Fugue in C minor (bk. 2 p. 48) (c. 1704).
Do. do. C major (bk. 8 p. 88) (? 1707). [331]

Do. do. the Short, A minor (bk. 10 p. 208).
Fugue in C minor (bk. 12 p. 95) (c. 1704).
Do. C minor, on a theme by Legrenzi (bk. 10 p. 230) (c.
1708).
Do. B minor, on a theme by Corelli (bk. 3 p. 60).
Do. D major (bk. 12 p. 83).
Do. G major (bk. 12 p. 55).
Do. G major (bk. 12 p. 86).
Do. G minor (bk. 2 p. 41).
Prelude in A minor (bk. 10 p. 238) (by 1706).
Do. C major (bk. 12 p. 94). [155]
Fantasia and Fugue in A minor (bk. 12 p. 60).
Fantasias in 6 major (bk. 9 p. 168; bk. 12 p. 75).
Pastorale in F major (bk. 12 p. 102).
Choral Partita: Christ, der du bist der helle Tag (bk. 19 p.
36).
Do. O Gott, du frommer Gott (bk. 19 p. 44).


330 The references are to Novello's twelve Books of Bach's Organ Works,
edited by J. F. Bridge and J. Higgs. The edition is complete, and contains every
movement included in Alfred Dorffel's Thematisohos Verzeichniss (second
edition, 1882) except his No. 24 on p. 72; Nos. 6 and 8 on page 85; the Kleines
harmonisches Labyrinth (Drffel, p. 88, tigs. 131-33), the genuineness of
which is questioned by Spitta (ii. 43); and figs. 136-37 on p. 88. The Novello
edition also follows Rust, against Spitta's judgment, in printing the Fantasia
con Imitazione (bk. 12 p. 71) as an Organ instead of as a Clavier piece. Books
15-19 print the Choral Preludes. See the Peters and Novello editions collated
in Appendix V.
331 Printed as a Toccata in E major in B.G. XV. p. 276.


140 Johann Sebastian Bach


Do. Sei gegrsset, Jesu gtig (bk. 19 p. 55).


Generally speaking, the Choral Preludes, other than those in the
maturer collections made by Bach himself, may be regarded as
youthful works (bks. 18, 19).

### II. Catalogue Of Bach's Compositions At Weimar, 1708-17, from his twenty-fourth to his thirty-third year. Vocal:


Secular Cantata: Was mir behagt (1716), _or_, Verlockender
Gtterstreit.

### Clavier:


Sixteen Concertos after Vivaldi (bk. 217) (c. 1708-12).
Toccatas in D major (bk. 211 p. 28), G major (bk. 215 p.
19), D minor (bk. 210 p. 68), G minor (bk. 211 p. 4), E
minor (bk. 210 p. 23) (c. 1708-12).
Aria variata alia maniera Italiana (bk. 215 p. 12) (c.
1708-12).
Prelude and Fugue in A minor (bk. 211 p. 14) (c. 1715).
Fugues in A major (bk. 215 pp. 52, 57).
Do. B minor (bk. 214 p. 48).
Do. A major (bk. 212 p. 66).
Do. A minor (bk. 212 p. 70).
Fantasia in G minor (bk. 215 p. 32).
Do. B minor (bk. 215 p. 41). (For Organ, N. bk. 12 p. 71.)


141


Do. D major (bk. 211 p. 28).
Do. A minor (bk. 215 p. 5) (c. 1710).

### Organ:


Passacaglia and Fugue in C minor (bk. 10 p. 214).
Four Concertos after Vivaldi (bk. 11). [156]
Eight Short Preludes and Fugues (bk. 1).
Orgelbchlein (bk. 15) (1717).
Aria in F major (bk. 12 p. 112).
Fantasia con Imitazione (bk. 12 p. 71).
Do. C major (bk. 12 p. 92).
Do. C minor (bk. 3 p. 57).
Trio in C minor (bk. 12 p. 108).
Do. D minor (bk. 2 p. 54).
Canzona in D minor (bk. 2 p. 34) (c. 1714).
Allabreve in D major (bk. 2 p. 26).
Prelude and Fugue in C major (bk. 7 p. 74).
Do. do. the Short, E minor (bk. 2 p. 44).
Do. do. D major (bk. 6 p. 10).
Do. do. the Great, A minor (bk. 7 p. 42).
Do. do. A major (bk. 3 p. 64).
Do. do. the Great, C minor (bk. 7 p. 64).
Do. do. F minor (bk. 6 p. 21).
Do. do. G major (bk. 7 p. 80).
Do. do. G minor (bk. 8 p. 120) (c. 1712).
Toccata and Fugue in D minor (bk. 6 p. 2).
Do. do. the Great, C major (bk. 9 p. 137).
Do. do. the Great, F major (bk. 9 p. 176).
Do. do. the Dorian, D minor (bk. 10 p. 196).
Fantasia and Fugue in C minor (bk. 3 p. 76).
Prelude in G major (bk. 2 p. 30).
Do. C major (bk. 12 p. 91).


142 Johann Sebastian Bach


Fugue, the Short, in G minor (bk. 3 p. 84).
Do. C major (bk. 12 p. 100).

### III. Catalogue Of Bach's Compositions At Cthen, 1717-23, from his thirty-third to his thirty-ninth year. Vocal:


Secular Cantata: Durchlaucht'ster Leopold (1717).

Do. Mit Gnaden bekrne der Himmel die Zeiten
(?1721). Do. Weichetnur, betrbte Schatten (?1717-23). [332]

### Clavier:


Clavier-Bchlein vor Wilhelm Friedemann Bach (1720).
Chromatic Fantasia and Fugue (bk. 207 p. 4) (c. 1720-23).
Clavier-Bchlein vor A. M. Bachin (bk 1959) (1722).
The Well-tempered Clavier (Part i.) (bk. 2790a) (1722).
Six French Suites (bks. 202 and 2793) (c. 1722).
Six English Suites (bks. 203-4 and 2794-95) (before 1726).
Fantasia and Fugue in A minor (bk. 208 p. 50).
Fugue in A minor (bk. 207 p. 16) (B.G. III. p. 334).
Twelve Little Preludes and Six Preludes for Beginners (bks.
200 and 2791) (c. 1722).
Inventions and Symphonies (bks. 201 and 2792) (1723).
Toccatas in F sharp minor and C minor (bk. 210 pp. 30 and
40).


332 Spitta (ii. 620, 718) mentions a Birthday Cantata written in 1717-1721(?),
the title of which is lost.


143


Suites in A minor, E flat major, E minor, F major, and F
minor (fragment) (bk. 214 pp. 54,62, 68; bk. 215 p. 27; bk.
212 p. 84).
Prelude and Fugue in E flat major (bk. 214 p. 40).

### Chamber [333] :


Six Sonatas (Suites) for Violin Solo (bk. 228) (c. 1720). [334]

Six Sonatas (Suites) for Violoncello Solo (bk. 238a) (c.
1720).
Six Sonatas for Violin and Clavier (bks. 232-33-232a-33a).
Suite in A major for Violin and Clavier (bk. 236).
Four Inventions for Violin and Clavier (bk. 2957).
Sonata in E minor and Fugue in G minor for Violin and
Clavier (bk. 236) (?early work).
Six Sonatas for Flute and Clavier (bks. 234-35).
Sonata in C major for two Violins and Clavier (bk. 237).
Three Sonatas for Viol da Gamba and Clavier (bk. 239).
Sonata in G major for two Flutes and Clavier (bk. 239 p. 2).
Sonata in G major for Violin, Flute, and Clavier (bk. 237).

### Orchestral: [335] 


Six Brandenburg Concertos (bks. 261-66) (1721).
Four Suites (Overtures) (bks. 267-69, 2068). [336]


333 The references are to Peters' edition.
334 The D minor contains the famous Chaconne.
335 The references are to Peters' edition. In the B.G. edition the Orchestral

music is included in the Chamber Music volumes.
336 Pirro, p. 228, holds that the first two (C major and B minor) were written
at Cthen and the last two (D major and D major) at Leipzig. Schweitzer (i.
402) regards it as not clear in which period the Overtures were written.


144 Johann Sebastian Bach


Three Concertos for Violin and Orchestra (bks. 229, 230). [337]

Concerto in D minor for two Violins and Orchestra (bk.
231). [338]

### Organ:


Prelude (Fantasia) and Fugue, the Great, in G minor (bk.
8 p. 127) (?1720).

### IV. Catalogue Of Bach's Compositions At Leipzig, 1723-34, from his thirty-ninth to his fiftieth year. Vocal:


Magnificat in D (?1723). [339]

Sanctus in C major, D major (c. 1723), D minor, and G
major (P. bk. 29b). [340]

St. John Passion (1723).
Trauer-Ode (1727).
St. Matthew Passion (1729).


337 In A minor, E major, G major. The G major figures as the fourth
Brandenburg (bk. 264) and as the Clavier Concerto in F major (bk. 248). The
A minor and E major were also converted into Clavier Concerti (G minor and
D major) (bks. 249, 251). The D minor Clavier Concerto (bk. 264) preserves
a lost Violin Concerto in the same key, and the one in F minor (bk. 250)
corresponds with a lost Violin Concerto in G minor (bks. 3068, 3069).
338 Also arranged as a Concerto for two Claviers (C minor) in P. bk. 257b.
339 Bach wrote another Magnificat, the music of which is lost. See Spitta, ii.
374.
340 All except the Sanctus in D major are of doubtful authenticity. See
Schweitzer, ii. 328 and Spitta, iii. 41 n.


145


Mass in B minor (1733-?1738).

Christmas Oratorio (1734).

Three Wedding Chorals (P. bk. 1654).
Motet: Jesu, meine Freude (1723).

Do. Der Geist hilft unsrer Schwachheit auf (1729).

Do. frchte dich nicht.

Do. Singet dem Herrn ein neues Lied. [159]

Motet: Komm, Jesu, komm.

Secular Cantata: Der zufriedengestellte Aeolus (1725); also
entitled Blast Larmen, ihr Feinden (1734).

Do. Vereinigte Zwietracht der wechselnden Saiten (1726),
or, Auf schmetternde Tne der muntern Trompeten (after
1733).

Do. Schwingt freudig euch empor; _also entitled_ Die Freude
reget sich, _or_ Steigt freudig in die Luft (1726).
Do Entfernet euch, ihr heitern Sterne (1727; music lost).

Do. Vergngte Pleissenstadt (1728; music lost).
Do. Von der Vergngsamkeit, _or_ Ich bin in mir vergngt
(c. 1730).

Do. Weichet nur, betrbte Schatten (c. 1730).

Do. Der Streit zwischen Phoebus und Pan 1731).

Do. Froher Tag, verlangte Stunden (1732; music lost).
Do. Schweigt stille (Coffee Cantata) (c. 1732).
Do. Herkules auf dem Scheidewege, _or_ Die Wahl des
Herkules (1733).

Do. Tnet, ihr Pauken! Erschallet, Trompeten (1733).
Do. Preise dein Glcke, gesegnetes Sachsen (1734).
Do. Schleicht, spielende Wellen (1734).
Do. Thomana sass annoch betrbt (1734; music lost).

Graduation Cantata: Siehe, der Hter Israels (music lost).

### Clavier:


[160]



146 Johann Sebastian Bach


Notenbuch vor Anna Magdalena Bach (bk. 1959) (1725).
Clavierbung, Part I. containing the six Partitas, or German
Suites (bks. 205-6 or 2796-97) (1731).

### Orchestral:


Concertos in C major, C minor, and C minor for two
Claviers and Orchestra (bks. 256, 257, 257b) (1727-36). [341]

Seven Concertos for Clavier and Orchestra (bks. 248-54)
(1729-36).
Concerto in A minor for Violin, Flute, Clavier, and Orchestra (bk. 255) (c. 1730). [342]

Concerto in A minor for four Claviers and Orchestra (bk.
260) (c. 1733).
Concertos in D minor and C major for three Claviers and
Orchestra (bks. 258, 259) (c. 1733).

### Organ:


Prelude and Fugue, the Great, in G major (bk. 8 p. 112)
(1724 or 1725). [343]


341 The Concerto in C minor (P. bk. 257) is an arrangement of one for two
Violins now lost. The third, also in C minor, is identical with the D minor
Concerto for two Violins and is published in that key in the Peters edition.
The remaining Concerto, in C major, is the only one originally written for the
Clavier. See Schweitzer, i. 413.
342 The work is an amplification of the Prelude and Fugue in A minor, already
catalogued among the Clavier works of the Cthen period. Schweitzer (i. 340)
concludes that it was rearranged as an orchestral Concerto early in the thirties,
when Bach needed Concertos for the Telemann Society's Concerts.
343 The scheme of the G major and C major Preludes and Fugues dates back
to the Weimar period. See Spitta, iii. 208; Parry, p. 67.


147


Six Sonatas in E flat major, C minor, D minor, E minor, C
major, G major (bks. 4 and 5) (1727-33). [344]

Prelude and Fugue in C major (bk. 3 p. 70) (c. 1730).
Do. do. D minor (bk. 9 p. 150).

### V. Catalogue Of Bach's Compositions At Leipzig, 1735-50, from his fifty-first year to his death. Vocal:


Ascension Oratorio (Cantata 11) (c. 1735).

Schemelli's Hymn-book (1736).
Easter Oratorio (c. 1736). [161]

Four Masses, in P major, A major (c. 1739), G minor, G
major (c. 1739).
Secular Cantata: Angenehmes Wiederau (1737).
Do. Willkommen, ihr herrschenden Gtter der Erden (1738)
(music lost).

Do. Mer hahn en neue Oberkeet (Peasant Cantata) (1742).

Do. O holder Tag (?1749), _or_, O angenehme Melodei.

Italian Cantata: Amore traditore.

Do. Andro dall' colle al prato (lost).

Do. Non sa che sia dolore.

### Clavier:


344 These so-called Organ Sonatas were written for the Pedal Clavicembalo.


148 Johann Sebastian Bach


Clavierbung, Part II. containing the Italian Concerto (bk.
207) and Partita in B minor (bk. 208) (1735).
Fantasia and Fugue in C minor (bk. 207 p. 50 and bk. 212
p. 88) (c. 1738).
Clavierbung, Part III. containing the four Duetti (bk. 208)
(1739).
Clavierbung, Part IV. containing the Goldberg Variations
(bk. 209) (c. 1742).
The Well-tempered Clavier, Part II. (bk. Ib or 2790b)
(1744).

### Chamber:


Sonata for Violin, Flute, and Clavier, in C minor (in the
Musical Offering) (bk. 237 p. 3) (1747).
Three Partitas for the Lute (?1740). [345]

### Organ:


The Catechism Choral Preludes (in Clavierbung, Part III.)
(bk. 16) (1739).
Fugue in D minor (in ditto) (bk. 16 p. 49) (1739).
Prelude and Fugue in E flat major (in ditto) (bk. 6 p. 28)
(1739).
Do. do. the Great, in C major (bk. 9 p. 156).
Do. do. the Great, in B minor (bk. 7 p. 52) (1727-36).

[162] Do. do. the Great, in E minor (bk. 8 p. 98).
Canonic Variations on Vom Himmel hoch (bk. 19)
(1746).
The Schbler Choral Preludes (bk. 16) (c. 1747-50).


345 The Clavier Suites in E minor, E major, and C minor are arrangements of
these, otherwise lost, Lute Partitas. See Schweitzer, i. 344.


149



The Eighteen Choral Preludes (bk. 17) (c. 1747-50).
The Musical Offering (P. bk. 219) (1747).
The Art of Fugue (P. bk. 218) (1749).




[163]


# APPENDIX II. THE CHURCH CANTATAS ARRANGED CHRONOLOGICALLY

We have the statement of Carl Philipp Emmanuel Bach, [346]

confirmed by Forkel, [347] Bach's earliest biographer, that his
father composed five Cantatas for every Sunday and Festival of
the ecclesiastical year. Concerted music was sung at Leipzig
annually on forty-three Sundays and sixteen week-days. [348] Bach
therefore must have written at least 295 Cantatas. Of this number

he composed at least thirty before 1723. Hence approximately
265 were written at Leipzig. But Bach's fertility does not appear
to have outlived the year 1744. We have reason, therefore,
to conclude that the 265 Leipzig Cantatas were written in the
course of twenty-one years, that is, between 1723 and 1744. To
complete that number Bach must have composed a new Cantata
every month, a surprising but demonstrable conclusion.

Of the 295 Cantatas only 202 have come down to us, three of
them in an incomplete state. [349] Of those written before 1723 the
survivors are too scanty to indicate a rate of productivity. But
thereafter we have fuller materials for a calculation. Bach, as
Cantor, conducted his first Leipzig Cantata on May 30, 1723, and
in the following sixteen months produced twenty-four Cantatas,
at the rate of more than one a month. [350] Beginning at the New [164]


346 In Mizler's _Nekrolog._
347 Supra, p. 138.
348 See the present writer's _Bach's Chorals,_ Part II. p. 1.
349 Ibid., p. 4. Four more Cantatas, of doubtful authenticity, are published by
the Bachgesellschaft, Jahrgang XLI.


152 Johann Sebastian Bach


Year of 1725 he wrote eighteen Cantatas in nine months, some
of which, however, may belong to the years 1726-7-8-9. But
even so, his monthly average seems to have been maintained.
For 1730 we have, perhaps, ten Cantatas. For 1731 about
twenty survive, of which half a dozen may belong to 1732, a
deduction which still preserves Bach's steady average. In 1735 he
produced actually nineteen Cantatas between the New Year and
the following November, though not all of them are positively
dated. Thereafter his activity is less certainly measured. But from
1736 till the end of 1744 he composed fifty-three Cantatas, at the
rate, that is, of at least six every year, without making allowance
for Cantatas written and lost.


There are few phenomena in the record of art more
extraordinary than this unflagging cataract of inspiration, in
which masterpiece followed masterpiece with the monotonous
periodicity of a Sunday sermon. Its musical significance has
been presented with illuminating exegesis by more than one
commentator. But its literary apparatus has captured little
attention. Yet Bach's task must have been materially eased
or aggravated according as the supply of libretti was regular
or infrequent, while the flow of his inspiration must have been
governed by their quality. Moreover, the libretto was the medium
through which he offered the homage of his art to the service of
God. The subject therefore deserves attention. However trivial,
measured against the immensities of Bach's genius, the study
will at least provide a platform from which to contemplate it.


At the outset the opinion may be hazarded that the provision
of his weekly libretti caused Bach greater anxiety than the setting
of them to music, a task which he accomplished with almost

[165] magical facility. It is true that from the early part of the 18th
century cycles of Cantata texts for the Church's year were not
infrequently published. Bach was in more or less intimate touch


350 See the Table of Cantatas set out in chronological order.


153


with the authors of four, perhaps five, printed collections of the
kind. But he used them with surprising infrequency. Neumeister's
published cycles provided him with seven libretti, [351] Franck's
with sixteen, [352] Picander's with ten, [353] Marianne von Ziegler's
with nine, [354] and Helbig's with two. [355] He took three libretti
from the Bible, [356] and the hymn-book furnished him with eleven
more. [357] But all these published sources together only account for
fifty-eight texts. Bach possessed only one book that could assist
his own efforts at authorshipPaul Wagner's eight-volumed
Hymn-bookwhence he took the stanzas which decorate his
Cantatas like jewels in the rare settings he gave them. It was,
therefore, mainly upon writers with whom he was brought into
occasional or official contact that Bach depended for his texts.


At the beginning of his career Bach was thrown upon his
inexperience. His earliest libretti, consequently, are tentative and
transitory in their construction. His first Cantata was written
at Arnstadt for the Easter Festival of 1704. [358] The core of the

libretto is a seven-stanzaed Easter song by an unknown poet,
eked out by two passages of Scripture, a Excitativo, Aria, and a
verse of a congregational hymn. The Aria and Recitativo are the
only original numbers of the libretto, and there is little doubt that [166]
Bach wrote them himself. [359] But the whole libretto is stamped
by his personality, and reveals the inveterate subjectivity of his


351 Nos. 18, 24, 28, 59, 61, 142, 160.
352 Nos. 31, 70, 72, 80, 132, 147, 152, 155, 161, 162, 163, 164, 166, 168, 185,
186 (part).
353 Nos. 145, 148 (part), 156, 157, 159, 171, 174, 188, 190 (one version), _Ehre_
_sei Gott_ (incomplete).
354 Nos. 68, 74, 87, 103, 108, 128, 175, 176, 183.
355 Nos. 47, 141.
356 Nos. 50, 191, 196.
357 Nos. 4, 97, 100, 107, 112, 117, 118, 129, 137, 177, 192.
358 No. 15: _Denn du wirst meine Seele nichfc in der Hlle lassen._
359 The intimate personal note of the opening words of the RecitativeMein
Jesus ware totreveals him.


154 Johann Sebastian Bach


religion. For, disregarding the general message of the Festival,
the libretto opens on the soul's personal longing for immortality
and closes on its song of victory over death. In construction
it is archaic, a survival of traditions acquired from central and
northern Germany through Bach's earlier residence at Lneburg
and intercourse with Hamburg. [360]


Three years passed before Bach produced his next extant
Cantata. In the interval, on 29th June 1707, he resigned his
Arnstadt appointment to become organist of the Church of
St. Blasius at Mhlhausen. [361] Here, within the space of ten
months, he produced three Cantatas, the uniform character of
whose libretti points to local and transitory influence upon the
composer. The first of them, [362] written in August 1707, is a
setting of Psalm 130, with the addition of two hymn-stanzas.
The second [363] was performed on 4th February 1708, at the
inauguration of the Mhlhausen Town Council, and consists of
Old Testament passages, a verse of a hymn, and three original
stanzas. The third, [364] a wedding Cantata, was performed at
Dornheim, near Arnstadt, on 5th June 1708, at the marriage of
Pastor Johann Lorenz Stauber to Frau Bach's aunt, and is set to

four verses of Psalm 115.

We can have little doubt regarding the authorship of these
singularly austere libretti, so far removed in atmosphere from
those of Bach's subsequent periods. In fact, the clue is furnished
by Bach himself. A note in his handwriting on the score of the

[167] first of the three Cantatas (No. 131) states that he composed it
at the request of Georg Christian Eilmar. The man was a close
friend, godfather of Bach's eldest daughter, Katharina Dorothea
(b. 1708), chief pastor of the Church of the Blessed Virgin, and


360 Spitta, i. 231.
361 Schweitzer, i. 103.
362 No. 131: _Aus der Tiefe rufe ich, Herr, zu dir._
363 No. 71: _Gott ist mein Konig._
364 No. 196: _Dorr Herr denket an uns._


155


Consistorial Assessor, at Mhlhausen. He was, moreover, an
aggressive foe of Pietism, of which Mhlhausen was the citadel,
and Bach's minister, Frohne, the protagonist. Indeed, the two
men waged so public and wordy a warfare [365] that Bach's social
relations with the one and official connection with the other

must have been rendered difficult. To his settled convictions

regarding the fellowship of music and worship Pietism offered
Puritan opposition. In fact, its lack of sympathy eventually drove
him from Mhlhausen, in hope, in his own words, to realise my
views upon the right ordering of Church music without vexation
from others. [366] Eilmar, on the other hand, though he admitted
the aesthetic value of music, conspicuously lacked the warmth
and emotionalism of Bach's religious temperament. To him
undoubtedly we must attribute the cold austerity of the three
Mhlhausen libretti and the suppression of the personal note
already sounded in Bach's Arnstadt Cantata. Nor did Eilmar's
influence pass with Bach's departure from Mhlhausen. [367] It is
to be traced in the early libretti of the Weimar period.


The Weimar Cantatas are twenty-two in number, of which
all but three were written subsequently to Bach's appointment
as Concertmeister early in 1714. He had been organist to the
Ducal Court of Weimar since June 1708, a position which did not
require him to compose for the Ducal Chapel. On the other hand,
three Cantatas are attributed to the early Weimar years. But they
cannot be positively dated, and their libretti bear such clear traces [168]
of Eilmar's influence that their composition may belong rather to
the Mhlhausen period. Their texts display Eilmar's preference
for strictly Biblical material and a disinclination to employ secular
forms. The first of them [368] is a paraphrase of the Magnificat. The


365 See Spitta, i. 359 ff.
366 Ibid., i. 374. On the other hand, Baoh's art was visibly affected by Pietistic
influences, as Schweitzer, i. 169, shows.
367 Eilmar died in 1715 (Spitta, i. 361).
368 No. 189: _Meine Seele rhmt und preist._


156 Johann Sebastian Bach


second [369] consists of four verses of Psalm 25, along with three
simple rhymed stanzas which we have no difficulty in attributing
to Bach himself. The third, _Gottes Zeit ist die allerbeste Zeit_
(No. 106), was composed, Spitta conjectures, [370] for the funeral
of Philipp Grossgebauer, Rector of Weimar School, in 1711. But
more recently, and more probably, Pirro [371] has expressed the
opinion that Bach wrote it for the funeral of his uncle, Tobias
Lammerhirt, who was buried at Erfurt in September 1707. The
theory accords with the suggestion that all three Cantatas belong
to the Mhlhausen period. If so, it is probable that the libretto, a
very ingenious mosaic of Scripture texts, was written by Eilmar
for the occasion. It is the last in which we detect his influence.

Bach's appointment as Ducal Concertmeister at Weimar can
be placed between 14th January and 19th March 1714 [372] and,
it is probable, was nearer the former date. He seems to have
produced the first Cantata his new post required him to write
on Sexagesima Sunday, which fell on 4th February in that year.
From thence to the end of 1716 he produced nineteen Cantatas
and collaborated with a writer whose libretti at length gave him
a satisfactory literary medium.
The new poet, Erdmann Neumeister, four of whose libretti

[169] Bach set to music immediately after his appointment, and a fifth
a year later, [373] was considerably Bach's senior. [374] As far back
as 1700 he had begun to write a cycle of Cantata texts for the
Ducal Chapel at Weissenfels, and pubushed it in 1704, with
an explanatory Preface referred to later. [375] In 1708 he issued
a second cycle for the Court of Rudolstadt, while in 1711 and


369 No. 150: _Nach dir, Herr, verlanget mich._
370 Vol. i. 456.
371 _J.S. Bach,_ p. 87.
372 The conclusion is based on letters printed by Spitta, i. 517.
373 Nos. 18, 61, 142, 160, and 69. See Table.
374 He was born May 12, 1671 (Spitta, i. 470).
375 The volume is entitled _Erdmann Neumeisters Geistliche Cantaten statt_

_einer Kirchen-Musik. Die zweyte Auflage._


157


1714 third and fourth cycles were written for the Ducal Chapel
at Eisenach. All four cycles were reissued in 1716, [376] with the
addition of a fifth and a Preface, which lauded Neumeister as
the first German to give sacred music its fitting position by
introducing and perfecting the Church Cantata. [377]

Spitta has dealt exhaustively [378] with the evolution and
construction of the Neumeister libretto. It need only be remarked
that it adapted a secular or operatic apparatus to the service of
religion, and that the innovation, hateful to many, triumphed
because of Neumeister's delicate handling of it. He perfected the
new form, however, in stages. A Cantata, he insisted in his
1704 Preface, is simply a fragment of Opera made up of Aria and
Recitativo. But the restriction excluded from the Cantata its most

appropriate material. In his 1708 cycle he found a place for the
chorus. Finally, he admitted the Bible stanza and congregational
hymn. With their inclusion the Cantata libretto assumed the form
familiar to us in Bach's use. It represents a combination of secular
Opera and ecclesiastical Motet. The free Arias and Recitativi
are derived from the one, the Bible stanzas and congregational
hymns perpetuate the traditions of the other. Unity of design
is stamped on the whole by its general subordination to the [170]
Gospel for the Day. Thus, at the moment when Bach was about
to devote his genius to the Cantata, Neumeister opportunely
provided him with a libretto singularly adapted to the end Bach
had in view, and appropriate to the musical expression by which
he proposed to secure it. He adhered to it almost to the end of
his life, and found unfailing inspiration in Neumeister's sincerity,
delicacy, and uniformly religious outlook. Neumeister's Arias,
with a single exception, [379] are hymn-like in mood and metre.


376 Entitled _Herrn Erdmann Neumeisters Fnffache Kirchen-Andachten,_
Leipzig, 1716.
377 Spitta, i. 474.
378 Vol. i. 466 ff.
379 See the Aria (Duetto) of Cantata No. 28.


158 Johann Sebastian Bach


His Recitativi are reflective and prayerful, rarely oratorical or
pictorial, simple communings upon the Gospel themes which the
libretto handles. [380]


Bach's early introduction to Neumeister's texts is explained by
the close relations between the Courts of Weimar and Eisenach,
by his associations with his own birthplace, and his intimacy
with Georg Philipp Telemann, Kapellmeister there, for whose
use Neumeister's third and fourth cycles were written. [381] Bach
set, in all, seven of the librettifour from the fourth cycle, [382] one
from the third, [383] and two from the first, [384] one of which (No.
142) differs so much from the published version as to raise the
question whether Bach did not receive it direct from Neumeister
in the form in which he set it. [385]


That Bach should have set no more than seven of Neumeister's
texts [386] is strange. He shrank, perhaps, from appropriating libretti
on which his friend Telemann had a prior claim. [387] But the reason
is found rather in the fact that at Weimar Bach discovered in

[171] 1715 a local poet of first-rate ability who, with perhaps but one
exception, wrote the libretti of all the Cantatas he composed
during the last two years of his Weimar appointment.

Salomo Franck, Bach's new collaborator, was Curator of the
Ducal Museum of Coins and Medals at Weimar. He was twentysix years older than Bach. But Spitta's conjecture, [388] that the two
men were not acquainted, is hardly tenable. Both resided in the
same small provincial town, both were in the Duke's service, and
throughout 1715 and 1716 collaborated in at least ten Cantatas


380 See particularly the Litanei in Cantata No. 18.
381 Telemann was Carl Philipp Emmanuel Bach's godfather (Spitta, i. 486).
382 Nos. 24, 28, 69, 61.
383 No. 18.
384 Nos. 142, 160.
385 See Spitta, i. 630.
386 His influence is also detected in Nos. 27, 56, 199.
387 Telemann also set the libretti of Bach's Nos. 18 and 142. See Spitta, i. 487.
388 Vol. i. 530.


159


performed in the Ducal Chapel. Moreover, though the Preface of
Franck's first cycle is dated 4th June 1715, [389] Bach had already
set one of its libretti for Easter of that year. A second cycle of
texts, of which Bach made little use, [390] was published by Franck
in 1717. [391]

Schweitzer, no doubt, is correct in his conclusion [392] that Bach
was drawn to Franck by his poetic insight, his mysticism, and
innate feeling for nature. It must be remembered, too, that his
libretti were, in some degree, official. On the other hand, Franck
was Neumeister's inferior in ability to conceive a picture fit to
express Bach's larger moods, and on occasion could descend to
sheer bathos. [393] But his texts have a rhythmic swing and melody
which Bach found agreeable. He set at least sixteen of them, and
returned to them even after he settled at Leipzig.
The circumstances which terminated Bach's service at Weimar

are familiar, and need not be restated. He received a new
appointment at Cthen on 1st August 1717, and took up his duties
there, probably at Christmas, that year. [394] His position was that
of Capellmeister to the princely Court. He never styles himself
Court Organist, [395] and his duties severed him for five years from
the service of the Church, to which he had declared his particular
dedication in 1708. The Cthen Court was unpretentious. The
Prince was a Calvinist. Figurate music was not permitted in the
Court Chapel, and its Organ was small and inadequate. Hence


389 Wustmann, _Joh. Seb. Bach's Kantaten-Texte_ (1913), p. xxii n. The cycle is
entitled _Evangelisches Andachts-Opffer._
390 Only Nos. 70, 147, and 186 are taken from it.
391 Entitled _Evangelische Sonn- und Fest-Tages Andachten._
392 Vol. ii. 131.
393 For instance, the Aria in Cantata No. 168, beginning:


Kapital und Interessen Meiner Schulden gross und klein,

Mussen einst verrechnet sein.


394 Spitta, ii. 5; Schweitzer, i. 106.
395 Spitta, ii. 3.


160 Johann Sebastian Bach


Bach devoted himself chiefly to chamber music, and only two
genuine Church Cantatas belong to this period of his career. Both
must have been written for performance elsewhere, possibly in
connection with Bach's frequent Autumn tours as a performer. [396]


For both Cantatas Bach employed a librettist, otherwise little
known, named Johann Friedrich Helbig, State Secretory to the
Eisenach Court. In March 1720, [397] more than two years after
Bach's arrival at Cthen, Helbig published a cycle of Musical
Texts on the Sunday and Saints' Day Gospels throughout the
year, for performance in God's honour by the Prince's Kapelle
at Eisenach. [398] How they came into Bach's hands we do not
know, but can readily conjecture. They are indifferent poetry,
judging them by the two specimens Bach made use of, and are
uniform in construction. The first movement invariably is a
Chorus upon a text from the Gospel for the Day, or a Scripture
passage closely related to it. Two Arias separated by a Recitative
follow. A Choral brings the libretto to an end. [399]


[173] The first of the two Cantatas written to Helbig's words was
designed for the Seventeenth Sunday after Trinity, which fell
in 1720 on September 22. [400] Spitta conjectures [401] that Bach
intended it for performance at Hamburg. In fact, his wife's death
postponed Bach's visit to that town until November, by which
date the Sunday appropriate to the Cantata had passed. Spitta
holds that the Cantata may have been performed, after all, during
the visit. Schweitzer is sceptical. [402] But Bach certainly expended
great pains upon the score.


396 The two Cantatas are Nos. 47 and 141.
397 Wustmann, p. xxiii.
398 Spitta, ii. 12 n.
399 The Choral is absent from No. 141. It should be Christe, du Lamm

Gotten.
400 Schweitzer, ii. 147. The Cantata is No. 47, _Wer sich selbst erhhet._
401 Vol. ii. 13.
402 Vol. ii. 147.


161


The second Helbig Cantata [403] is for the Third Sunday in
Advent, and the date of it would appear to have been 1721. It
is one of the least agreeable of Bach's works. Spitta [404] declares
it a juvenile composition hastily adapted to a new libretto.
Schweitzer [405] expresses the same opinion, and Sir Hubert
Parry [406] finds the work rather commonplace. Its genuineness
is discussed by Max Schreyer in the Bach-Jahrbuch for 1912,
and more recently Rudolf Wustmann has insisted that it does not
bear the stamp of Bach's genius. [407] If it actually was composed
in 1721, its production must have coincided with Bach's second
marriage on December 3 of that year. [408] In that case, his resort
to old material is explicable.

Only these two Cantatas were composed at Cthen. But later,
at Leipzig, two others were manufactured out of secular material
written there. [409] It is unnecessary to refer to them, except to
remark that in each case Bach appears to have been the author
of the new libretto. In the first of them [410] it is clear that he

was handicapped by the frankly secular metre of the original
stanzas. The second of them, [411] originally a Birthday Ode to [174]
Prince Leopold of Anhalt-Cthen, is a masterly conversion into
a Whit-Monday text which, assuming that Bach wrote it, puts his
literary facility beyond question.

Bach made the last move in his professional career on May
31, 1723, when he was inducted Cantor of St. Thomas' School
at Leipzig, with particular charge of the Churches of St. Thomas
and St. Nicolas. Here by far the greater number of his Cantatas


403 No. 141: _Das ist je gewisslich wahr._
404 Vol. ii. 15.
405 Vol. ii. 148.
406 _Johann Sebastian Bach,_ p. 108.
407 Op. cit., Note 195.
408 Spitta, ii. 147.
409 Nos. 134 and 173.
410 No. 134: _Ein Herz, das seinen Jesum lebend weiss._
411 No. 173: _Erhtes Fleisch und Blut._


162 Johann Sebastian Bach


appeared, and 172 of them survive. They are too numerous to
be considered individually, and their classification is rendered
difficult by the fact that the authorship of most of their libretti
is conjectural and not ascertained. They fall, however, into two
large categories, each of which exhibits characteristics of its own.

The dividing year, clearly but not arbitrarily, is 1734. Before it
and after it Bach was aided by new writers. But the earlier period
pre-eminently was one of experiment, out of which emerged the
glorified hymn-libretto, or Choral Cantata, of Bach's last years.
That it sprang, in some degree, from the difficulty of finding
good original texts in sufficient number may be granted. That it
was adopted as an avenue of escape from Picander's coarser work
is a conjecture based, apparently, upon a prevalent exaggeration
of Bach's dependence on that writer. The fundamental reason
which led Bach to the hymn-libretto undoubtedly was the fact
that it most closely fulfilled the ideals which informed his work.
The first Cantata performed during Bach's Cantorship [412]

reveals a new author, whose assistance, if the conclusion is
well grounded, was at Bach's disposal throughout the whole of
the earlier Leipzig period. Spitta's keen insight failed him in

[175] this instance. He betrays no recognition of the new writer, and
occasionally [413] attributes his libretti to Picander. The credit of
the discovery belongs to Rudolf Wustmann, though he fails to
work it out to its fullest conclusions. [414]


No one can read the early Leipzig libretti without being struck
by the number of them that are not only uniform in structure,
but similar in tone and point. They all begin with a Bible text,
chosen frequently, but not invariably, from the Gospel for the


412 No. 75: _Die Elenden sollen essen,_ sung on May 30, the day preceding
Bach's formal induction.
413 For instance, Nos. 67 and 102.
414 Wustmann, by implication, only associates eight libretti (Cantatas Nos. 37,
44, 75, 76, 86, 104, 166, 179) with Weiss. All of them belong to the early
years, 1723-27.


163


Day. Every one of them ends with a hymn-stanza. Their Arias,
with hardly an exception, [415] are written in what, compared with
Picander's rollicking dactyls, may be held hymn-metres. Their
Recitativi, almost invariably, are didactic or exegetical. [416] They
do not display the vapid rhetoric of Picander. Nor do they
express the reflective or prayerful mood that reveals Bach. They
are essentially expositive and, it is noticeable, are studded with
direct or veiled references to Bible passages which expand or
enforce the lesson of the initial text. In a word, they suggest
the work of a preacher casting his sermon notes into lyrical
form, an impression which is strengthened by the fact that the
libretto invariably opens with a Scripture passage and frequently
blends the Gospel and Epistle for the Day in one harmonious
teaching. Spitta detected this characteristic. But he failed to
follow up the clue. He speaks [417] of one of these texts [418] as
a moralising homily, a phrase concisely appropriate to them
all. Moreover, a remark of his, [419] pointing the significance of [176]
the god-parents chosen by Bach for his childrenEilmar, for
instanceas revealing Bach's intimate associates at the moment,
affords another clue to the personality of the new writer.


Among the clergy of St. Thomas' during Bach's Cantorate
were two men, father and son, each of whom bore the name

Christian Weiss. The elder was Pastor of the Church from 1714

till his death in 1737. He was a cultured man, in touch with the
University, and possibly formed a link between it and Bach, to
whom he showed greater cordiality than the Cantor received from
other clerical colleagues. In 1732 his daughter, Dorothea Sophia
stood godmother to Bach's son, Johann Christoph Friedrich,


415 See Nos. 75 and 105.
416 See Nos. 25, 42, 77. As an extreme illustration, the first Recitative of No.
25 begins with the words, _Die ganze Welt ist nur ein Hospital._
417 Vol. ii. 388.
418 Cantata No. 65: _Sie werden aus Saba Alle kommen._
419 Vol. i. 361.


164 Johann Sebastian Bach


afterwards famous as the Bckeburg Bach. [420] In 1737 his son
stood sponsor to Bach's daughter, Johanna Caroline. [421] Nor can
it be altogether without significance that the names Dorothea,
Sophia, Christian, are borne by others of Bach's children by his
second marriage. There is sufficient evidence, therefore, that
Bach's relations with the elder Weiss were intimate enough to
support a literary partnership. Moreover, circumstances lend
weight to the inference. For some years before Bach's arrival in
Leipzig, Weiss suffered from an affection of the throat which
kept him from the pulpit. But, during the first year of Bach's
Cantorate, he was able to resume his preaching. If he was, in
fact, the author of the libretti, we can have little difficulty in
concluding that they and his sermons were built on the same text.


So far as they can be identifiedthe attempt is somewhat
speculativeWeiss provided Bach with at least thirty-three
libretti. He set five of them in 1723, three in 1724, nine in
or about 1725, one in 1727, two in 1730, six in 1731, three in
1732, and four in the later Leipzig period. [422] Fourteen others

[177] bear a constructional resemblance to Weiss's texts, [423] but their

character refers them rather to Bach or Picander. Even so, if we
do not exaggerate his activity, Weiss seems to have written at
least one-sixth of the Leipzig libretti and more than a quarter of
those of the earlier period. Without a doubt he eased a difficult
situation in Bach's experience before his regular association with
Picander began.


Apart from their revelation of Christian Weiss, the libretti of
Bach's first year at Leipzig do not call for comment. Franck and
Neumeister appear among them, and we trace Bach's hand in


420 Wustmann, p. xxiv.
421 Ibid.
422 See the Table.
423 They ore Nos. 6, 17, 22, 43, 48, 57, 144, 148, 157, 159,171, 190,195, and
the incomplete Cantata, _Ehre sei Gott in der Hhe._


165


nine. [424] But at Easter, 1724, he broke new ground with a libretto
whence developed the Cantata form of his latest period.
The Cantata for Easter Day 1724, [425] is Bach's earliest setting
of an entire congregational hymn. Spitta suggests [426] that he felt
the fitness of giving the libretto an antique character to match
the hymn's melody. However that may be, Bach would appear
already to have been groping towards the Choral Cantata of the
late '30's. And though he did not repeat the experiment until the
Easter of 1731, [427] he treated three hymn-libretti in the interval
in a manner which shows him already to have worked out the
essentials of the Choral Cantata form. [428]


Another landmark meets us a year and a half after the Easter
experiment. On September 23, 1725(?)the Seventeenth Sunday
after TrinityBach produced a Cantata [429] whose Arias are set to
words which had appeared in print in the preceding year. Their
author was a hack writer named Christian Friedrich Henrici, or,
as he preferred to style himself, Picander. His hand probably
is also traced in the libretto used by Bach on the preceding [178]
Sunday [430] and again in that for Sexagesima in the same year. [431]

But the evidence is only inferential. That he collaborated with
Bach on September 23, 1725 (?), is incontestable, and the work
defines the beginning of a long and fruitful partnership.
Spitta, [432] who tells us all that is known of Picander,
has sufficiently exposed his superficial literary facility. He
commenced to write sacred poetry in 1724, and on Advent
Sunday of that year began a cycle of Profitable Thoughts, so


424 Nos. 16, 23, 63, 81, 83, 153, 154, 184, 194. See the Table.
425 No. 4: _Christ lag in Todesbanden._
426 Vol. ii. 393.
427 See the Table: No. 112, _Derr herr ist mein getreuer Hirt._
428 Nos. 8, 20, 93.
429 No. 148: _Bringet dem Herrn Ehre seines Namens._
430 No. 8: _Liebster Gott, wann werd' ich sterben._
431 No. 181: _Leichtgesinnte Flattergeister._
432 Vol. ii. 340 ff.


166 Johann Sebastian Bach


he termed them, upon the Sunday and Saints' Day Gospels. He
published them in 1725, when the cycle was complete. [433] Three
years later he issued a cycle of Cantata texts for 1728-29 in
the Neumeister form. [434] That he intended them for Bach's use

is apparent in the fact that he expressly dedicated them to the
service of our incomparable Capellmeister. But Bach made the
sparest use of them and of the earlier Profitable Thoughts alike.
From the latter he took not one libretto. [435] Of the 1728-29 cycle
he used only eight texts. [436] One more libretto can be referred
to Picander's later publications, [437] and of six others we can be
sure that they are based upon his texts. [438] In other words, of
the original libretti of the Leipzig period we can trace Picander's
hand positively in no more than fifteen.

It is necessary to emphasise this point. For Spitta [439] has stated
positively that Picander wrote most of the Leipzig libretti, and

[179] his opinion has been generally accepted. But its correctness may
be contested. It is suspicious, to begin with, that Picander never
published the texts which Spitta asserts him to have poured out in
such profusion. He placed no value, Spitta answers readily, on
these manufactured compositions, put together hastily to please
his friend. But the argument cannot stand. Why should Picander
have thought less of libretti actually used by his incomparable
Capellmeister than of those published for and rejected by
him?for Spitta does not venture to declare that as literature the
rejected were superior to the accepted texts. If out of a published


433 The volume is entitled _Sammlung Erbaulicher Gedancken, Bey und ber_
_gewohnlichen Sonn- und Festtags-Evangelien,_ Leipzig.
434 _Cantaten auf die Sonn- und Fest-Tage durch das gantze Jahr,_ Leipzig,
1728. He reprinted them in 1732 in his _Satyrische Gedichte._
435 But see Cantata No. 148 and Spitta, ii. 693. Also No. 19.
436 Cantatas Nos. 145, 156, 159, 171, 174, 188, 190 (one version), and the

Cantata _Ehre sei Gott._
437 No. 157.
438 Nos. 19, 30, 36, 84, 148, 197.
439 Vol. ii. 346.


167


cycle of libretti expressly written for him Bach chose only eight
texts, are Picander's manufactured compositions, as Spitta calls
them, likely to have attracted him to a greater degree? We can
detect his hand perhaps in six Cantatas [440] besides those already
mentioned, and Bach relied on him exclusively for his secular
texts. One concludes, none the less, that Bach rarely accepted
an original Cantata libretto from Picander, and employed him
chiefly on the Choral Cantatas of his latest period. Excluding
them, and adding the probable to the actual original Picander
texts, they total only twenty-one, a fraction inadequate to support
Spitta's sweeping statement.

From the advent of Picander in 1725, to the end of the first
Leipzig period nine years later, Bach does not seem to have gone
outside the circle of familial authors for his regular Cantata texts.
On October 17, 1727, however, he produced a funeral Cantata,
or Trauer-Musik, in memory of the late Queen of Poland, the
libretto of which was written by Professor J. C. Gottsched. The
partnership, in fact, was accidental: the libretto was supplied to
Bach with the commission to set it to music, and, so far as is
known, Gottsched and he did not collaborate again. [180]

So, reviewing Bach's activities during his first eleven years at
Leipzig, we find that of the hundred libretti set by him to music
Christian Weiss heads the list as the presumed author of twentynine. Bach follows him with eighteen. [441] Picander's hand appears
in fifteen, Franck's in eight, [442] Neumeister's and Gottsched's in
one each. Fifteen libretti are congregational hymns in their
original or paraphrased form. One is the _Gloria in Excelsis_ of the
B minor Mass adapted as a Christmas Cantata (No. 190). Twelve
are by authors not identified.


440 Nos. 32, 48, 67, 90, 144, 181.
441 Nos. 16, 22, 23, 27, 35, 51, 56, 58, 63, 66, 81, 82, 83, 153, 154, 194, 195.
No. 184 is an adaptation. See also Nos. 19, 36, 84, 144, 145, 148, for Bach's
collaboration with Picander.
442 Besides No. 80, a Choral Cantata.


168 Johann Sebastian Bach


Passing to the later Leipzig period, seventy-two surviving
Cantatas are attributed to the years 1735-50. They reveal one,
perhaps two, new writers. The first of them, Marianne von
Ziegler, was identified by Spitta in 1892. She was the widow of
an officer, resident in Leipzig, a cultured woman, in touch with
University life, her house a salon for music and musicians. [443]

There is no reason to suppose Bach to have been of her circle,
or that he was acquainted with her literary gifts. Indeed the
contrary is to be inferred from the fact that, though she published
her poems in 1728, [444] he does not seem to have known them
until seven years later, when he used them for nine consecutive
Sundays and Festivals in 1735, beginning on the Third Sunday
after Easter, and ending on Trinity Sunday.
In addition to these nine libretti, both Spitta [445] and
Schweitzer [446] attribute to her the text of Bach's Cantata for
the Second Sunday after Easter in the same year. [447] It is
uniform in construction with the authentic nine, but is not

[181] among the authoress's published works. Wustmann [448] finds
the tone of the libretto less ardent and its rhythm rougher than
those published under her name. Admitting the soundness of
Wustmann's criticism, one hazards the opinion that the challenged
text was written at the period when Bach set it, namely, in 1735,
eight years after the poetess published her earlier texts. The
difference of time may account for the difference of texture
to which Wustmann draws attention, but leaves undecided the
question whether Bach was drawn to the earlier through the later
and unpublished texts or vice versa. It is quite probable that
he set other libretti by the same writer, though Schweitzer's [449]


443 Schweitzer, ii. 332 ff.
444 Entitled _Versuch in gebundener Schreibart._
445 Vol. iii. 71.
446 Vol. ii. 331 n.
447 No. 85: _Ich bin ein guter Hirt._
448 Note 60.
449 Vol. ii. 331 n.


169


attribution to her of a second text for Ascension Day, 1735, must
be rejected. [450]

It is worth noticing, since it certainly reveals Bach's preference,
that Marianne von Ziegler's libretti are constructed almost
invariably in the Weiss form. Every one of them but three [451]

opens with a Bible passage, invariably taken from St. John's
Gospel, which provides the Gospel for the Day from the First
Sunday after Easter down to Trinity Sunday, excepting Ascension
Day. All but one (No. 68) of the libretti conclude with a Choral,
and their Arias are hymn-like in metre. The tone of them,
however, is warmer, more personal, less didactic than the Weiss
texts. That Bach regarded them with particular favour is apparent
in the circumstance that he took the trouble to revise all but one
of them. [452] That they stirred his genius deeply is visible in the
settings he gave them.
After 1735 the chronology of the Cantatas is not certainly
ascertained. Of those that fall after the Ziegler year, as we may
term it, the majority can only be dated approximately as circa
1740, that is, anywhere between 1735 and 1744. Nor, except
rarely, can we detect in their libretti the work of those on whom
Bach elsewhere relied. Weiss, who died late in 1737, is only an [182]
occasional contributor. The texts of this period, in fact, are the
outcome of Bach's own experiments in libretto form. Thirty-three
of them are Choral Cantatas, whose evolution it remains to trace
concisely.
That Bach should have turned to Lutheran hymnody, chiefly
of the fifteenth and sixteenth centuries, and that the Cantatas
built upon it should be his most perfect religious work is not
surprising. The hymns and their melodies were the foundations
upon which the temple of German Protestantism had been reared.
They appealed vividly and powerfully to Bach's spiritual nature,


450 No. 33: _Gott fret auf mit Jauchzen._
451 See Table.
452 No. 74.


170 Johann Sebastian Bach


and profoundly influenced his musical utterance. His whole
career, as Sir Hubert Parry points out, [453] was an effort to widen
his means for self-expression. And the Choral Cantata, in effect,
was the reconciliation or blending of this self-discipline. It was
the supreme achievement of Bach's genius to assert the faith and
idealism of Lutheran hymnody with the fullest resources of his
technique.


It is not our task to consider the hymn libretto in its relation
to the structure of Bach's latest Cantatas. Necessarily it tied
him to a stereotyped design, which he clung to with greater
persistency because it exactly fulfilled his devotional purpose.
But experience compelled him, after a brief trial, to discard the
simple hymn libretto. In the earlier Leipzig years as many as eight
Choral Cantatas [454] are set to the unaltered text of a congregational
hymn. In the later Leipzig period only two [455] libretti are of that
character. Bach, in fact, soon realised that, while the unaltered
hymn-stanza, with its uniform metre and balanced rhyme, was
appropriate to the simple Choral or elaborate Fantasia, it was
unmalleable for use as an Aria or Recitative. Hence, retaining the

[183] unaltered Hymn-stanza for the musical movements congruous to
it, he was led to paraphrase, in free madrigal form, those stanzas
which he selected for the Arias and Recitativi.


As early as September 16, 1725, [456] Bach was moving towards
this solution. And it is significant that Picander's hand is visible
in the libretto. The next example [457] occurs three years later, and
again reveals Picander's authorship. Two other instances also
occur in the early Leipzig period. [458] To that point, however,
it is clear that Bach was not satisfied as to the most effective


453 Op. cit., p. 377.
454 See Table.
455 Nos. 100 and 107, both of them c. 1735.
456 No. 8, for the Sixteenth Sunday after Trinity.
457 No. 93, for the Fifth Sunday after Trinity (1728).
458 Nos. 9 (? 1731), 99 (c. 1733).


171


treatment of the hymn-libretto. But in the second Leipzig period,
after his collaboration with Marianne von Ziegler, he arrived at
and remained constant to a uniform design. Of the thirty-nine
Choral Cantatas of the whole period only two exhibit the earlier
form. Of all the others the libretto consists partly of unaltered
hymn-stanzasinvariably used for the first and last movements,
and occasionally elsewherebut chiefly of paraphrased stanzas
of the hymn, whose accustomed melody, wherever else it may
be introduced, is associated invariably with the hymn when the
text is used in its unaltered form. We, to whom both words and
melody are too frequently unfamiliar, may view the perfections of
the Choral Cantata with some detachment. But Bach's audience

listened to hymns and tunes which were in the heart of every
hearer and a common possession of them all. The appeal of his
message was the more arresting because it spoke as directly to
himself as to those he addressed.


It would be satisfactory and interesting to point positively to
Bach's own handiwork in these libretti, of which he set fifty-four
in the period 1724-44. Unfortunately it is impossible to do so,
except, perhaps, in a single case, [459] where we can reasonably [184]
infer that the libretto is his. Of the rest, one is by Franck. [460] In
eighteen of them the hand of Picander is more or less patent. [461]

Nineteen [462] we can only venture to mark anonymous, though
Picander is probably present in most of them. Ten are unaltered
congregational hymns. [463] There remain, however, five [464] in
which, perhaps, we detect another, and the last, of Bach's literary
helpers.


459 No. 122.
460 No. 80.
461 Nos. 1, 2, 5, 8, 20, 26, 62, 78, 91, 92, 93, 96, 115, 121, 124, 127, 138, 140.
462 Nos. 7, 9, 10, 14, 33, 41, 94, 99, 101, 111, 113, 114, 116, 125, 126, 130,
139, 178, 180.
463 Nos. 4, 97, 100, 107, 112, 117, 129, 137, 177, 192.
464 Nos. 3, 38, 123, 133, 135.


172 Johann Sebastian Bach


Wustmann draws attention [465] to the libretto of Cantata No. 38,
a paraphrase of Luther's Psalm 130. He finds in it, and reasonably,
an expression of Jesus religion very alien to Picander's muse,
and suggests the younger Christian Weiss as the author of it.
Like his father, he was Bach's colleague, the godfather of his
daughter, and undoubtedly on terms of close friendship with
him. But if he wrote the libretto of Cantata No. 38, probably
it is not the only one. The same note rings in four more of the
Choral Cantatas, [466] which may be attributed tentatively to Weiss,
though their ascription to Bach would be equally congruous.

Returning, however, to the seventy-two libretti of the later
Leipzig period we reach this result: More than half of them
(thirty-nine) are congregational hymns, all but two of which
are of the paraphrased type in which we detect the work of
Picander, Bach himself, and perhaps the younger Weiss. Of
the remaining thirty-three original libretti Marianne von Ziegler
heads the list with nine, and perhaps ten. [467] Bach follows with

[185] a problematical six, [468] Picander with five, [469] the elder Weiss
with four, [470] Neumeister with one. [471] One text is taken from the
Bible. [472] Another consists of a single stanza of a hymn by Martin
Behm. [473] Five are by authors unknown or undetected. [474]


But, as was said at the outset, the attribution of
particular libretti to individual writers is conjectural, except
in comparatively few cases. Yet, unsatisfying as it is, this guesswork reveals with approximate correctness the extent to which


465 P. xxiv.
466 Nos. 3, 123, 133, 135.
467 See supra, p. 180.
468 Nos. 17, 34, 43, 151, 197, and _Herr Gott, Beherrsoher aller Dinge._
469 Nos. 30, 32, 48, 57, 90.
470 Nos. 45, 79, 110, 143.
471 No. 28.
472 No. 50.
473 No. 118.
474 Nos. 6, 11, 13, 146, 193.


173


Bach drew upon his own and other people's abilities for the texts
he needed. Summarising our conclusions, we discover that about
one-quarter (fifty-four) of the 202 libretti set by Bach between
the years 1704 and 1744 were provided by the hymn-book. It is
shown elsewhere [475] that all but eleven of them are taken from

Paul Wagner's volumes. The elder Weiss comes next with thirtythree libretti. Bach follows with thirty, Salomo Franck with
twenty-one, Picander with twenty (exclusive of his arrangements
of Choral Cantata texts). Marianne von Ziegler contributes ten,
Neumeister seven, Eilmar and Helbig two each, Gottsched and
Martin Behm one each. Three libretti are taken from the Bible or

Church liturgy. Eighteen remain anonymous.


The literary qualities of the libretti are not under discussion
here. They have a characteristic, however, on which one cannot
forbear from remarking. Indifferent literature as, for the most
part, they arechildren of their period and blemished with
its imperfectionsthey enshrine an extraordinarily interesting
anthology of the religious poetry of the sixteenth, seventeenth,
and eighteenth centuries. They expose the evangelical thought
of Germany from the age of Luther to that of Bach, and are [186]
particularly rich in the lyrical fervour of the Reformation itself.
Of the seventy-seven hymn-writers whom Bach includes in his
collection, so many as forty-four belong to the sixteenth century.
Only thirteen of them touch Bach's own period. And a similar
bias to the Reformation epoch is observable in his choice of the
tunes of the Chorals, which are absent from only twenty-one of
the Cantatas. By far the greater number of them are coeval with
the hymns themselves; that is, they date from the Reformation
and behind it.


Here clearly is the source of Bach's inspiration, the master-key
of his art. He touches Luther, is in a sense his complement, his art
builded on the foundations Luther laid, consecrated to the ends


475 See _Bach's Chorals,_ Part II., Introduction.


[187]



174 Johann Sebastian Bach


Luther vindicated, inspired by a dedication of himself to God's
service not less exalteda great artist, a great Protestant, a great
man. [476]


NOTE.Cantatas distinguished by an asterisk (*) are for Soli
voices only (S.A.T.B. unless the particular voices are stated);
those marked () include, in addtion, simple four-part Chorals:
the rest contain concerted Choruses.

### (1) COMPOSED AT ARNSTADT (see also Nos. 150, 189.)



No. Date. Title. Author of

Libretto.



Composition
of the Text.



476 The above article and the Table that follows were communicated originally
to the Musical Association on March 28, 1918.


15 1704.

Easter Day
(revised for
subsequent
performance).



Den du

wirst meine

Seele nicht

in der Hlle

lassen

(Psalm xvi.
10).



175


?Bach _Part_ _I._

Psalm xvi.

10; St.

Mark xvi.

6; _Part II._
seven (six)

stanzas

of the

anonymous
hymn,
Auf freue

dich, Seele,

du bist nun

getrst;
Stanza iv.

of Nikolaus

Hermann's

hymn

Wenn

mein

Stndlein

vorhanden

ist. The

rest of the

libretto

perhaps is
by Bach.


### (2) COMPOSED AT MLHAUSEN (see also Nos. 150, 189.)


176 Johann Sebastian Bach












|No.|Date.|Title.|Author of<br>Libretto.|Composition<br>of the Text.|
|---|---|---|---|---|
|131|1707.<br>?<br>for<br>llth,<br>19th, 21st,<br>or<br>22nd<br>S.<br>after<br>Trinity.|Aus<br>der<br>Tiefe<br>rufe<br>ich,<br>Herr,<br>zu<br>dir<br>(Psalm<br>cxxx.)|Georg<br>Christian<br>Eilmar.|Psalm<br>cxxx.;<br>Stanzas<br>ii.<br>and v.<br>of<br>Bartholomu<br>Ring-<br>waldt's<br>hymn,<br>Herr Jesu<br>Christ,<br>du<br>hchstes<br>Gut. T. B.<br>Soli.|


177
















|71|1708. Feb.<br>4. Town<br>Council In-<br>auguration.|Gott ist<br>mein<br>Konig<br>(Psalm<br>lxxiv. 12).|Bach (or<br>Eilmar).|Psalm<br>lxxiv. 12,<br>16, 17,<br>19; 2 Sam.<br>xix. 35, 37;<br>Deuteron-<br>omy xxxiii.<br>25; Gen.<br>xxi. 22;<br>Stanza vi.<br>of Johann<br>Heer-<br>mann's<br>hymn, O<br>Gott, du<br>frommer<br>Gott; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|196|1708. June<br>5. Wedding<br>of<br>Johann<br>Lorenz<br>Stauber (at<br>Dornheim).|Der<br>Herr<br>denket<br>an<br>uns (Psalm<br>cxv. 12).|Psalm cxv.<br>12-15.|The libretto<br>consists ex-<br>clusively of<br>the<br>Psalm<br>verses.<br>S.<br>T. B. Soli.|


### (3) COMPOSED AT WEIMAR. (See also Nos. 12, 72, 80, 164, 168, 186.)


178 Johann Sebastian Bach
















|No.|Date.|Title.|Author of<br>Libretto.|Composition<br>of the Text.|
|---|---|---|---|---|
|*189|c.<br>1707-<br>10. Visita-<br>tion of the<br>B.V.M.|Meine<br>Seele<br>rhmt und<br>preist.|Author<br>unknown.<br>?Com-<br>posed<br>at<br>Muhlhausen.|A<br>para-<br>phrase<br>of<br>the<br>Mag-<br>nificat.<br>Tenor Solo.|
|150|c.<br>1710.<br>?Occasion.|Nach<br>dir,<br>Herr,<br>ver-<br>langet mich<br>(Psalm<br>xxv. 1).|?Bach.<br>?Com-<br>posed<br>at<br>Mhlhausen.|Psalm xxv.<br>1,<br>2,<br>5,<br>15;<br>rest<br>of<br>libretto<br>perhaps<br>by<br>Bach.<br>See<br>_Bach-_<br>_Jahrbuch_<br>for 1913, p.<br>39, on au-<br>thenticity<br>of Cantata.|


106 ?1711.

Funeral

of Rector

Philipp

Gross
gebauer
(Weimar);

or ?1707

(Sept.)
funeral of

Thomas

Lam
merhirt

(Erfurt).



Gottes

Zeit ist die

aller-beste

Zeit (Actus
tragicus).



?G. C.

Eilmar

(or Bach).

?Com
posed at
Mhlhausen.



179


Acts xvii;.

28; Psalm

xc. 12; Isa
iah xxxviii.

1; Ecclesi
asticus xiv.

17; Rev.

xxii; 20;

Psalm xxxi.

5; St. Luke

xxiii. 43;

Stanza i.

of Luther's

hymn,
Mit Fried'

und Freud'

ich fahr'

dahin;

Stanza vii;.

of Adam

Reissner's

hymn, In
dich hab'

ich gehoffet, Herr.

A. B. Soli.


180 Johann Sebastian Bach
















|18|1714 (or<br>1713). Sex-<br>agesima.|Gleich wie<br>der Regen<br>und Schnee<br>vom Him-<br>mel fllt<br>(Isaiah lv.<br>10-11).|Erdmann<br>Neumeister<br>Fnffache<br>Kirchen-<br>Andachten<br>(Leipzig,<br>1716) (Ser.<br>iii.).|Isaiah lv.<br>10, 11; four<br>clauses of<br>the Litany;<br>Stanza viii.<br>of Lazarus<br>Spengler's<br>hymn,<br>Durch<br>Adams Fall<br>ist ganz<br>verderbt;<br>rest of<br>libretto<br>original. S.<br>T. B. Soli.|
|---|---|---|---|---|
|*160|1714<br>(or<br>1713).<br>Easter Day.|Ich<br>weiss,<br>dass<br>mein<br>Erlser<br>lebt.|Erdmann<br>Neumeister<br>(Ibid., Ser.<br>I.).<br>Slight<br>verbal<br>alterations<br>by Bach.|Original<br>throughout.<br>Tenor Solo.|


181


















|21|1714.<br>Third S.<br>after Trin-<br>ity and<br>General<br>Use.|Ich hatte<br>viel<br>Bekm-<br>mernis<br>(Psalm<br>xciv. 19)|Spitta (i.<br>531) at-<br>tributes text<br>to Salomo<br>Franck.|Part I,:<br>Psalm xciv.<br>19; Psalm<br>xlii. 5. Part<br>ii.: Psalm<br>cxvi. 7;<br>Rev. v. 12,<br>13; Stanzas<br>ii. and v.<br>of Georg<br>Neumark's<br>hymn,<br>Wer nur<br>den lieben<br>Gott lasst<br>walten;<br>rest of<br>libretto<br>original.|
|---|---|---|---|---|
|*199<br>N.B.G.|c.<br>1714.<br>Eleventh S.<br>after Trin-<br>ity.|Mein Herze<br>schwimmt<br>im Blut.|The<br>title<br>is<br>from<br>a<br>Neumeister<br>text for this<br>Sunday.<br>?By Bach.|Stanza<br>iii.<br>of<br>Johann<br>Heer-<br>mann's<br>hymn, Wo<br>soll<br>ich<br>fliehen<br>hin;<br>rest<br>of<br>libretto<br>original.<br>Soprano<br>solo.|


182 Johann Sebastian Bach



61 1714. First

S. in Ad
vent.



Nun

komm, der

Heiden

Heiland.



Stanza i.

of Luther's

hymn,

Nun

komm, der

Heiden

Heiland;

Rev. iii.

20; part of
stanza vii.

of Philipp
Nicolai's

hymn,
Wie schn

leuchtet der

Morgenstern; rest
original. S.
T. B. Soli.



Erdmann

Neumeis
ter, Fnf
fache

Kirchen
Andachten

(Leipzig,
1716),
(Ser. IV).


183








|142|1714 (or<br>1712).<br>Christmas<br>Day.|Uns ist ein<br>Kind ge-<br>boren (Isa-<br>iah ix. 6).|Erdmann<br>Neumeister<br>(Ibid., Ser.<br>I.). Tex-<br>tually, the<br>last three<br>movements<br>are altered,<br>perhaps<br>by Bach,<br>whose<br>authorship<br>of the<br>Cantata,<br>however, is<br>questioned<br>(Bach-<br>Jahrbuch,<br>1912, p.<br>132).|Isaiah ix.<br>9; Psalm<br>lxix. 30;<br>Stanza v.<br>of Caspar<br>Fuger's<br>hymn,<br>Wir<br>Christen-<br>leut; rest<br>of libretto<br>original<br>(see Spitta<br>i. 630<br>on Bach's<br>emenda-<br>tions). A.<br>T. B. Soli.|
|---|---|---|---|---|
|182|1715<br>(or<br>l714).Palm<br>Sunday<br>(used<br>also<br>for<br>the<br>Annuncia-<br>tion).|Himmelskn<br>sei wilkom-<br>men.|ig,<br>Spitta<br>(i.<br>539)<br>suggests<br>Salomo<br>Franck,<br>whose<br>character-<br>istics<br>it<br>displays.|Psalm<br>xl.<br>7, 8; Stanza<br>xxxiii.<br>of<br>Paul Stock-<br>mann's<br>hymn,<br>Jesu<br>Lei-<br>den,<br>Pein<br>und<br>Tod;<br>rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


184 Johann Sebastian Bach
















|31|1715.<br>Easter Day.<br>Revised<br>in ?1723.<br>(Schweitzer,<br>ii. 141n).|Der Him-<br>mel lacht,<br>die Erde ju-<br>biliret.|Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachts-<br>Opffer<br>Weimar,<br>1715, p.<br>75).|Stanza v.<br>(posthu-<br>mous) of<br>Nikolaus<br>Herman's<br>hymn,<br>Wenn<br>mein<br>Stndlem<br>vorhanden<br>ist; rest<br>of libretto<br>original. S.<br>T. B. Soli.|
|---|---|---|---|---|
|l85|1716.<br>Fourth<br>S.<br>after<br>Trinity.|Barmherzige<br>Herze<br>der<br>ewigen<br>Liebe.|s<br>Salomo<br>Franck<br>(Ibid.,p.<br>128).|Stanza i. of<br>Johannes<br>Agricola's<br>hymn, Ich<br>ruf' zu dir,<br>Herr<br>Jesu<br>Christ;<br>rest<br>of<br>libretto<br>original.|


185
















|161|1715. Six-<br>teenth S.<br>after Trin-<br>ity (also for<br>Purifica-<br>tion).|Komm,<br>du ssse<br>Todesstunde.|Salomo<br>Franck<br>(Ibid.,<br>p. 162);<br>verbal<br>alterations<br>by Bach.|Stanza<br>iv. of<br>Christoph<br>Knoll's<br>hymn,<br>Herzlich<br>thut mich<br>verlangen;<br>rest origi-<br>nal. A. T.<br>Soli.|
|---|---|---|---|---|
|162|1715.<br>Twentieth<br>S.<br>after<br>Trinity.|Ach,<br>ich<br>sehe,<br>jetzt<br>da ich zur<br>Hochzeit<br>gehe.|Salomo<br>Franck<br>(Ibid.,<br>p.<br>172).|Stanza vii.<br>of<br>Johann<br>Georg<br>Albinus'<br>hymn,<br>Alle<br>Menschen<br>mssen<br>sterben;<br>rest<br>of<br>libretto<br>original.|


186 Johann Sebastian Bach






















|163|1715.<br>Twenty-<br>third S.<br>after Trin-<br>ity.|Nur Jedem<br>das Seine.|Salomo<br>Franck<br>(Ibid., p.<br>182).|Stanza xi.<br>(suggested<br>by Spitta<br>i. 557)<br>of Johann<br>Heer-<br>mann's<br>hymn, Wo<br>soll ich<br>fliehen<br>hin; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|*132|1715.<br>Fourth<br>S.<br>in Advent.|Bereitet<br>die<br>Wege,<br>bereitet die<br>Bahn.|Salomo<br>Franck<br>(Ibid., p. 8)|Stanza v. of<br>Elisabethe<br>Cruciger's<br>hymn,<br>Herr<br>Christ,<br>der<br>einig'<br>Gott's<br>Sohn; rest<br>of<br>libretto<br>original.|
|*152|1715<br>(or<br>1714).<br>S.<br>after<br>Christmas|Tritt auf die<br>Glaubens-<br>bahn.|Salomo<br>Franck<br>(Ibid.,<br>p.<br>19).|Original<br>throughout.<br>S. and B.<br>Soli.|


187
















|155|1716. Sec-<br>ond S.<br>after the<br>Epiphany.|Mein Gott,<br>wie lang',<br>ach lange.|Salomo<br>Franck<br>(Ibid., p.<br>32).|Stanza xii.<br>of Paul<br>Speratus'<br>hymn, Es<br>ist das<br>Heil uns<br>kommen<br>her; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|59|1716.<br>Whit-<br>Sunday<br>Expanded<br>in<br>?1736<br>(No.74<br>infra).|Wer<br>mich<br>liebet,<br>der<br>wird<br>mein<br>Wort halten<br>(St.<br>John<br>xiv. 23).|Erdmann<br>Neumeister<br>(Funf-<br>fache<br>Kirchen-<br>Andachten,<br>Ser. IV.).|St.<br>John<br>xiv.<br>23;<br>Stanza<br>i.<br>of Luther's<br>hymn,<br>Komm,<br>heiliger<br>Geist,<br>Herre<br>Gott; rest<br>of<br>libretto<br>original. S.<br>and B. Soli.|


188 Johann Sebastian Bach



70 1716. Sec
ond S. in

Advent;
later (c.
1723).
Twentysixth

S. after

Trinity.



Wachet,

betet, betet,

wachet.



Salomo

Franck

(Evangelische

Sonn
und Fest
Tages Andachten,

Weimar,
1717, p. 4)
(opening
chorus

and Arias

only).
Recitativi

added by
a later (c.
1723) hand
(? Bach).



_Part_ _I.:_

Stanza

x. of the

anonymous
hymn,

Freu'

dich sehr,

O meine

Seele.

_Part._ _ii.:_

Stanza v. of

Christian

Keimann's

hymn,
Meinen

Jesum lass'

ich nicht.

Rest of

libretto,
both parts,
original.


147 1716.

Fourth S.

in Advent;
later (c.
?1727).

Feast of the

Visitation.



Herz und

Mund und

That und

Leben.



Salomo

Franck

(Ibid.).
(Opening
chorus

and first

three Arias

only).
Recita
tivi and

fourth Aria

added by a
later hand

(?Bach).



189


_Part_ _I.:_

Stanza vi.

of Martin

Janus'

hymn,
Jesu,

meiner

Seelen

Wonne.

_Part_ _II.:_

Stanza xvii.

of the same

hymn. Rest
of libretto,
both parts,
original.


190 Johann Sebastian Bach




- 158 c. 1708-16.

Purifica
tion of the

B.V.M.;
later (at
Leipzig)
adapted

to Easter

Tuesday



Der Friede

sei mit dir.



Spitta
(ii. 688)

suggests
Franck

as author

of the

Aria and

following
Recitativo,

both of

which bear

on the

Gospel for
the Purifi
cation. The

opening
Recitative

and choice

of the

concluding
Choral,

both of

which are

relevant to

the Gospel
for Easter

Tuesday,
must be at
tributed to

a later hand

(?Bach).



Stanza i.

of Johann

Georg
Albinus'

hymn,
Welt, ade!

ich bin dein

mde;

Stanza v.

of Luther's

hymn,
Christ lag
in Todes
banden;

rest of

libretto

original. S.
and B. Soli.


191

### (4) COMPOSED AT CTHEN. (See also Nos. 22 and 23.)












|No.|Date.|Title.|Author of<br>Libretto.|Composition<br>of the Text.|
|---|---|---|---|---|
|173|c.<br>1718.<br>Birthday<br>Serenade;<br>new<br>text<br>(c.<br>1730)<br>for<br>Whit<br>Monday.|Erhtes<br>Fleisch und<br>Blut.|The music<br>of<br>the<br>Cantata<br>is<br>that of the<br>Birthday<br>Serenade,<br>Durehlauch<br>ster<br>Leopold<br>(omitting<br>numbers<br>5<br>and<br>6).<br>Cantata<br>text<br>prob-<br>ably<br>by<br>Bach.|t'-<br>Original<br>throughout.|


192 Johann Sebastian Bach
















|47|?1720.<br>Seven-<br>teenth<br>S. after<br>Trinity.|Wer sich<br>selbst<br>erhhet,<br>der soll<br>erniedriget<br>werden (St.<br>Luke xiv.<br>11).|Johann<br>Friedrich<br>Helbig<br>(Auf-<br>munterung<br>zur An-<br>dacht,<br>Eisenach,<br>1720, p.<br>114.|St. Luke<br>xiv. 11;<br>Stanza<br>xi. of<br>anonymous<br>(?Hans<br>Sachs)<br>hymn,<br>Warum<br>betrubst du<br>dich, mein<br>Herz; rest<br>original. S.<br>B. Soli.|
|---|---|---|---|---|
|141|1721<br>or<br>1722.<br>Third S. in<br>Advent.|Das ist je<br>gewisslich<br>wahr<br>(I.<br>Timothy i.<br>15).|Johann<br>Fr.<br>Helbig<br>Ibid.,<br>p.<br>5).<br>Bach's<br>authorship<br>of<br>the<br>music<br>is<br>questioned<br>(_Bach-_<br>_Jahrbuch,_<br>1912).|1 Timothy<br>i.<br>15; rest<br>of<br>libretto<br>is<br>origi-<br>nal.<br>The<br>concluding<br>Choral<br>is<br>omitted by<br>Bach.<br>It<br>should<br>be<br>Christe,<br>du<br>Lamm<br>Gottes<br>(Spitta.<br>ii.<br>15n.). A. T.<br>B. Soli.|


193


?Bach Text

original
throughout.
A. T. Soli.



134 c. 1717-22.

Secular

Can
tata; later
adapted
for Easter

Tuesday (c.
1731).



Ein Herz,

das seinen

Jesum

lebend

weiss.


### (5) COMPOSED AT LEIPZIG. 1723-34. (See also Nos. 31, 70, 134, 147, 158, 173.)












|No.|Date.|Title.|Author of<br>Libretto.|Composition<br>of the Text.|
|---|---|---|---|---|
|22|1723.<br>Quinqua-<br>gesima.<br>(Es-<br>tomihi).|Jesus nahm<br>zu sich die<br>Zwlfe (St.<br>Luke xviii.<br>31).<br>[See<br>No.<br>31<br>(1715).]|?Bach<br>(composed<br>at Cthen).<br>Trial<br>Cantata<br>(February<br>7, 1723).|St.<br>Luke<br>xviii.<br>31,<br>34; Stanza<br>v.<br>of<br>Elisabothe<br>Gruciger's<br>hymn,<br>Herr<br>Christ,<br>der<br>einig'<br>Gott's<br>Sohn; rest<br>original. A.<br>T. B. Soli.|


194 Johann Sebastian Bach



75 1723 (May
30). First S.

after Trin
ity.



Die Elen
den sollen

essen

(Psalm
xxii. 26).



?Christian

Weiss,

senr.



_Part_ _I.:_

Psalm

xxii. 26;

Stanza v.

of Samuel

Rodigast's
hymn,

Was Gott

thut, das ist
wohlgethan;

_Part_ _II.:_

Stanza

v. of the

same hymn
(repeated);
rest of

libretto,
both parts,
original.


195
















|76|1723. Sec-<br>ond S. after<br>Trinity.<br>Also for<br>Refor-<br>mation<br>Festival.|?Christian<br>Weiss,<br>senr.|Die<br>Himmel<br>erzahlon<br>die Ehre<br>Gottes<br>(Psalm xix.<br>1, 3).|Part I.:<br>Psalm<br>xix. 1,3;<br>Stanza i.<br>of Luther's<br>hymn,<br>Es woll'<br>uns Gott<br>gendig<br>sein; Part<br>II.: Stanza<br>iii. of<br>the same<br>hymn; rest<br>of libretto<br>original.<br>See Spitta<br>ii. 357n.|
|---|---|---|---|---|
|24|1723.<br>Fourth<br>S.<br>after<br>Trinity.|Ein<br>unge-<br>farbt<br>Gemthe.|Erdmann<br>Neumeister<br>(Fnf-<br>fache<br>Kirchen-<br>Andachten)<br>(Ser. IV.).|St.<br>Matthew<br>vii.<br>12;<br>Stanza<br>i.<br>of<br>Johann<br>Heer-<br>mann's<br>hymn,<br>O<br>Gott,<br>du<br>frommer<br>Gott; rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


196 Johann Sebastian Bach



186 1723. Sev
enth S. after

Trinity.



Aergre
dich, O

Seele,

nicht.



The opening chorus
and first

two Arias

are by
Salomo

Franck

(Evangelische

Sonn
und Fest
Tages, p.
6), written

for the

Third S.

in Advent,
perhaps
composed
by Bach at
Weimar.

The re
mainder of

the libretto

was added

in 1723

for the

Seventh S.

after Trin
ity. Both
Gospels relate Christ's

miracles.



_Part_ _I.:_

Stanza xii.

of Paul

Speratus'
hymn, Es
ist das

Heil uns

kommen

her.


197
















|164|1723 (or<br>1724).<br>Thirteenth<br>S. after<br>Trinity.|Ihr, die<br>ihr euch<br>von Christo<br>nennet.|Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachts-<br>Opffer,<br>1715, p.<br>152).|Stanza v. of<br>Elisabethe<br>Cruciger's<br>hymn,<br>Herr<br>Christ,<br>der einig'<br>Gott's<br>Sohn; rest<br>of libretto<br>original.<br>Perhaps<br>written at<br>Weimar.|
|---|---|---|---|---|
|119|1723.<br>In-<br>auguration<br>of<br>Town<br>Council<br>(Aug. 30).|Preise,<br>Jerusalem,<br>den<br>Herrn<br>(Psalm<br>cxlvii. 12.)|?Christian<br>Weiss,<br>senr.|Psalm<br>cxlvii.<br>12-<br>14; clauses<br>xxii.<br>and<br>xxiii.<br>of<br>the<br>Te<br>Deum;<br>rest<br>of<br>libretto<br>original.|


198 Johann Sebastian Bach



194 1723.

Opening
of the

Organ at
Strmthal

(November
2); later
(1731) for
Trinity
Sunday.

[See No.
70 (1716).]



Hchsterwnschtes?Bach. _Part_ _I.:_

Freuden- Stanzas vi.

fest. and vii.


of Johann

Heer
mann's

hymn,

Treuer

Gott, ich

muss dir

klagen;

_Part_ _II.:_

Stanzas

ix. and

x. of Paul

Gerhardt's

hymn,
Wach auf,

mein Herz,
und singe.
Rest of

libretto

original. S.
T. B. Soli.


63 ?1723.

Christmas

Day.



Christen

tzet diesen

Tag.



?Bach. The

opening
two lines

suggested
by a poem
in Joh.

Jakob

Bambach's

Geistliche

Poesien

(Halle,
1720).



199


Original
throughout.


200 Johann Sebastian Bach



Christian

Weiss,

senr. Wust
mann (note
8) suggests
Bach. Cer
tainly same
author as

Nos. 64, 65
_infra._



1 John iii.

8; Stanza

iii. of Cas
par Fuger's
hymn,
Wir

Chris
tenleut';

Stanza ii.

of Paul

Gerhardt's

hymn,
Schwing'
dich auf

zu deinem

Gott;

Stanza iv.

of Christian

Keimann's

hymn,

Freuet

euch, ihr

Christen

alle; rest

of libretto

original. A.
T. B. Soli.



40 ?1723.

Feast of St.

Stephen.



Dazu ist

erschienen

der Sohn

Gottes (1
John iii. 8).


64 ?1723.

Feast of St.

John the

Evangelist.



Sehet,

welch'

eine Liebe

hat uns

der Vater

erzeiget (1
John iii. 1).



Christian

Weiss,

senr. Cer
tainly same
author as

Nos. 40

supra and
65 infra.



201


1 John i.

1; Stanza

v. of

Luther's

hymn,
Gelo
bet seist

du, Jesu

Christ;

Stanza i.

of Georg
Michael Pf
efferkorn's

hymn,
Was frag
ich nach

der Welt;

Stanza v.

of Johann

Franck's

hymn,
Jesu,

meine

Freude;

rest of

libretto

original. S.
A. B. Soli.


202 Johann Sebastian Bach



16 ?1724.

New Year's

Day. Spitta
(ii. 386,
413) regards No.
190 (infra) as

Bach's first

Leipzig

New Year

Cantata,

and dates

No. 16,

1723-27.



Herr Gott

dich loben

wir.



?Bach. Clauses i.

and ii. of

Luther's

Te

Deum;

Stanza

vi. of

Paul Eber's

hymn,
Helft mir

Gott's Gte

preisen;
rest of

libretto

original. A.
T. B. Soli.


- 153 1724. Sunday after
the Cir
cumcision.



Schau',

lieber Gott,

wie meine

Feind'.



203


?Bach. Stanza i.

of David

Denicke's

(?) hymn,
Schau',

lieber Gott,

wie meine

Feind';

Isaiah xli.

10; Stanza

v. of Paul

Gerhardt's

hymn,
Befiehl

du deine

Wege;
Stanzas xi.

and xii.

(as three
verses)

of Martin

Moller's

(?) hymn,
Ach

Gott, wie

manches

Herzeleid;

rest of

libretto

original. A.
T. B. Soli.


204 Johann Sebastian Bach



65 1724. Feast

of the

Epiphany.



Sie werden

aus Saba

Alle kom
men (Isaiah
lx. 6).



?Christian

Weiss,

senr. Wust
mann (note
23) at
tributes

text to

author of

Nos. 40

and 64

_supra,_ _i.e._

Bach.



Isaiah lx.

6; Stanza

iv. of the

anonymous
hymn,
Ein Kind

geborn
zu Beth
lehem;

Stanza x.

of Paul

Gerhardt's

hymn,
Ich hab'

in Gottes

Herz und

Sinn; rest
original. A.
T. B. Soli.


- 154 1724. First

S. after the

Epiphany.



Mein lieb
ster Jesus

ist verloren.



?Bach.

Wustmann

(note 25)

attributes

it to an

anonymous
author.



205


Stanza ii.

of Martin

Janus'

hymn,
Jesu,

meiner

Seelen

Wonne;

St. Luke .

49; Stanza

vi. of

Christian

Keimann's

hymn,
Meinen

Jesum

lass' ich

nicht; rest
original. A.
T. B. Soli.


206 Johann Sebastian Bach














|81|1724.<br>Fourth S.<br>after the<br>Epiphany.|Jesus<br>schlaft,<br>was soll ich<br>hoffen?|?Bach.<br>Wustmann<br>regards<br>texts of<br>Nos. 81<br>and 154 as<br>being by<br>the same<br>hand (note<br>35).|St.<br>Matthew<br>viii. 26;<br>Stanza ii.<br>of Johann<br>Franck's<br>hymn,<br>Jesu,<br>meine<br>Freude;<br>rest of<br>libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|83|?1724.<br>Feast of the<br>Purifica-<br>tion.|Erfreute<br>Zeit<br>im<br>neuen<br>Bunde.|?Bach.|St.<br>Luke<br>ii.<br>29, 30;<br>Stanza<br>iv.<br>of Luther's<br>hymn,<br>Mit Fried'<br>und Freud'<br>ich<br>fahr'<br>dahin; rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


207






|23|1724.<br>Quinqua-<br>gesima<br>(Es-<br>tomihi).<br>?Com-<br>posed at<br>Cthen.<br>Spitta (ii.<br>679) holds<br>this, and<br>not No.<br>22, to<br>have been<br>Bach's first<br>Quinqua-<br>gesima<br>Cantata at<br>Leipzig.|Du wahrer<br>Gott und<br>Davids<br>Sohn.|?Bach|Three<br>stanzas of<br>Christe,<br>du Lamm<br>Gottes;<br>rest of<br>libretto<br>original. S.<br>A. T. Soli.|
|---|---|---|---|---|
|4|1724.<br>Easter Day<br>(Am<br>Os-<br>terfeste)|Christ<br>lag<br>in<br>Todes-<br>banden|Luther.|Choral<br>Cantata.<br>The<br>seven<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form.|


208 Johann Sebastian Bach
















|12|1724 (or<br>1725).<br>Third S.<br>after Easter|Weinen,<br>Klagen,<br>Sorgen,<br>Zagen.|?Salomo<br>Franck.|Acts xiv.<br>22; Stanza<br>vi. of<br>Samuel<br>Rodigast's<br>hymn,<br>Was Gott<br>thut, das ist<br>wohlgethan<br>rest of li-<br>bretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|172|1724<br>(or<br>1725).<br>Whit<br>Sunday.<br>Perhaps<br>revised<br>c.<br>1727-<br>30<br>(see<br>Schweitzer,<br>ii. 162).|Erschallet<br>ihr Lieder.|?Salomo<br>Franck<br>(Spitta<br>ii.<br>398).<br>Wustmann<br>(note<br>73)<br>does<br>not<br>support the<br>conjecture.|St.<br>John<br>xiv.<br>23<br>Stanza<br>iv.<br>of<br>Philipp<br>Nicolai's<br>hymn,<br>Wie schn<br>leuchtet der<br>Morgen-<br>stern; rest<br>of<br>libretto<br>original.<br>Organ<br>obbligato.|


209
















|184|1724. Whit<br>Tuesday.|Erwunschtes<br>Freuden-<br>licht.|?Bach. An<br>adaptation<br>of an ear-<br>lier secular<br>Cantata<br>(Spitta, ii.<br>399).|Stanza vi.<br>of Anark of<br>Wildenfeis'<br>(?) hymn,<br>O Herre<br>Gott, dein<br>gttlich<br>Wort; rest<br>of libretto<br>original. S.<br>A. T. Soli.|
|---|---|---|---|---|
|165|?1724.<br>Trinity<br>Sunday.|O<br>heil'ges<br>Geist<br>und<br>Wasserbad|Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachte-<br>Opffer,<br>1715,<br>p.<br>111)|Stanza<br>v.<br>of Ludwig<br>Helmbold's<br>hymn Nun<br>lasst<br>uns<br>Gott<br>dem<br>Herren,<br>rest<br>of<br>libretto<br>original.|


210 Johann Sebastian Bach
















|179|?1724.<br>Eleventh<br>S. after<br>Trinity.|Siehe zu,<br>dass deine<br>Gottes-<br>furcht nicht<br>Heuchelei<br>sei (Eccle-<br>siastes i.<br>28)|?Christian<br>Weiss,<br>senr.|Ecclesiastes<br>i. 28,<br>Stanza i.<br>of Christph<br>Tietze's<br>hymn,<br>Ich armer<br>Mensch,<br>ich armer<br>Snder,<br>rest origi-<br>nal S. T. B.<br>Soli.|
|---|---|---|---|---|
|69|?1724.<br>Twelfth<br>S.<br>after<br>Trinity,<br>c.<br>1730<br>adapted as<br>a Ratswahl<br>cantata.|Loben dem<br>herren,<br>meine<br>Seele<br>(Psalm<br>cxlix. 1).|As<br>ex-<br>tended<br>in<br>1730<br>the<br>text<br>is<br>in<br>Picander's<br>Can-<br>taten,<br>1728-29.<br>His<br>au-<br>thorship of<br>the<br>1725<br>text is not<br>therefore<br>estab-<br>lished.|Psalm<br>cxlix.<br>1,<br>Psalm<br>cl.<br>4,6;<br>Clauses<br>i.<br>and ii.<br>of<br>the<br>Te<br>Deum,<br>Stanza<br>ii.<br>of<br>Johann<br>Hermann's<br>hymn,<br>Jesu,<br>nun<br>sei<br>gepreiset;<br>rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


190 c. 1725

(or 1724).

New Year's

Day; revised

to cele
brate the

Augsburg
Confession

Jubilee on

June 25,

1730.



Singet dein
Herrn ein

neues Lied

(Psalm
cxlix. 1).



As ex
tended in

1730 the

text is in

Picander's

Can
taten,

1728-29.

His au
thorship of
the 1725

text is not

therefore

estab
lished.



211


Psalm cxlix

1; Psalm

cl. 4,6;

Clauses i.

and ii. of

the Te

Deum;

Stanza

ii. of of

Johann

Hermann's

hymn,
Jesu,

nun se

gepreiset,
rest of

libretto

original. A.
T. B. Soli.


212 Johann Sebastian Bach




- 73. c. 1725.

Third S.

after the

Epiphany



Herr, wie

du willt, so

shick's mit

mir.



Author

unknown.

Spitta's
(ii. 414)

attribution

of the text

to Picander

is inad
equately
founded.



Stanza i. of

Caspar Bi
enemann's

hymn,
Herr, wie

du willt,

so shick's

mit mir;

Stanza ix.

of Ludwig
Helmhold's

hymn,

Von

Gott will

ich nich

lassen;
rest original. S. T.

B. Soli


213














|144|c. 1725.<br>Septuages-<br>ima|Nimm was<br>dein ist,<br>und gehe<br>hin (St.<br>Matthew<br>xx. 14).|Wustmann<br>(note 37)<br>suggests<br>Picander,<br>with Bach's<br>additions.<br>Schweitzer<br>(ii. 200)<br>supposes<br>that the<br>music is<br>adapted.|St.<br>Matthew<br>xx. 14;<br>Stanza i.<br>of Samuel<br>Rodigast's<br>hymn,<br>Was Gott<br>thut, das ist<br>wohlgethan<br>Stanza i. of<br>Albrecht of<br>Brandenburg<br>Culmbach's<br>hymn,<br>Was mein<br>Gott will,<br>das g'scheh'<br>allzeit;<br>rest of<br>libretto<br>original. S.<br>A. T. Soli.|
|---|---|---|---|---|
|181|1725. Sex-<br>agesima.|Leichtgesinn<br>Flattergeis-<br>ter.|te<br>?Picander.|Original<br>throughout.|


214 Johann Sebastian Bach



67 c. 1725.

First S.

after Easter

(Quasimodogeniti).



Halt' im

Gedacht
niss Jesum

Christ (2
Timothy ii.
8).



?Christian

Weiss,

senr. Cer
tainly not
Picander,
as Spitta
(ii. 417)

suggests.



2 Timothy
. 8;

Stanza i. of

Nikolaus

Herman's

hymn, Erschienen

ist der her
rlich' Tag;
Stanza i.

of Jakob

Ebert's

hymn, Du
Frieden
frst,

Herr Jesu

Christ;

rest of

libretto

original. A.
T. B. Soli.


104 c. 1725.

Second S.

after Easter

(Miseri
cordias

Domini).



Du Hirte

Israel, hre
(Psalm
lxxi. 1).



?Christian

Weiss,

senr.



215


Psalm

lxxx. 1;

Stanza i. of

Cornelius

Becker's

hymn,

Der Herr

ist mein

getreuer
Hirt; rest

of libretto

original. T.
B. Soli.


216 Johann Sebastian Bach




- 166 c. 1725.

Fourth S.

after Easter

(Cantate).



Wo gehest
du hin? (St.

John xvi.

6).



?Christian

Weiss,

senr.



St. John

xvi. 5;

Stanza

iii. of

Bartholomus

Ringwaldt's

hymn,

Herr Jesu

Christ, ich
weiss gar
wohl;

Stanza i.

of Emilie

Juliane of

SchwarzburgRudolstadt's

hymn,

Wer

weiss,

wie nahe

mir mein

Ende; rest

of libretto

original.


- 86 c. 1725.

Fifth S. af
ter Easter

(Rogate).



Wahrlich,

wahrlich,
ich sage
euch (St.

John xvi.

23).



?Christian

Weiss,

senr.



217


St. John

xvi. 23;

Stanza xvi.

of Georg

Gren
wald's

hymn,

Kommt

her zu mir,
spricht

Gottes

Sohn;

Stanza xi.

of Paul

Speratus'
hymn, Es
ist das

Heil uns

kommen

her; rest

of libretto

original.


218 Johann Sebastian Bach



44 c. 1725.

Sixth S.

after Easter

(S. after the
Ascension)
(Exaudi).



Sie werden

euch in den

Bann thun

(St. John
xvi. 2)



?Christian

Weiss,

senr.



St. John

xvi. 2;

Stanza i.

of Martin

Moller's(?)
hymn,
Ach

Gott, wie

manches

Herzeleid;

Stanza

xv. of

Paul Flem
ming's
hymn,
In allen

meinen

Thaten;

rest of the

libretto

original.


219
















|20|c. 1725.<br>First S. af-<br>ter Trinity.<br>In its ex-<br>isting form<br>the work is<br>c. 1735.|O<br>Ewigkeit,<br>du Donner-<br>wort.|Johann Rist<br>(arranged).<br>(?Pican-<br>der).|Choral<br>Cantata<br>(2 Parts).<br>Stanzas i.,<br>xi., xvi. are<br>retained<br>in thoir<br>original<br>form. Stan-<br>zas ii.-x.<br>are para-<br>phrased in<br>the Arias<br>and Recita-<br>tivi. A. T.<br>B. Soli.|
|---|---|---|---|---|
|167|c.<br>1725.<br>Feast<br>of<br>St.<br>John<br>Baptist<br>(Midsum-<br>merDay)|Ihr<br>Men-<br>schen, rh-<br>met Gottes<br>liebe.|Author<br>unknown.<br>Spitta<br>(ii.<br>423)<br>re-<br>marks<br>on<br>the vapid<br>emptiness<br>of the text.|Stanza<br>v.<br>of<br>Johann<br>Grau-<br>mann's<br>hymn,<br>Nun<br>lob',<br>mein' Seel',<br>den<br>Her-<br>ren;<br>rest<br>of<br>libretto<br>origi-<br>nal.<br>The<br>Choral<br>is<br>extended.|


220 Johann Sebastian Bach
















|136|c. 1725<br>(or later).<br>Eighth S.<br>after Trin-<br>ity.|Erforsche<br>mich, Gott,<br>und erfahre<br>mein Herz<br>(Psalm<br>cxxxix.<br>23).|?Christian<br>Weiss,<br>senr.<br>Schweitzer<br>(ii. 200)<br>supposes<br>that the<br>music is<br>adapted.|Psalm<br>cxxxix. 23;<br>Stanza ix.<br>of Johann<br>Heer-<br>mann's<br>hymn, Wo<br>soll ich<br>fliehen<br>hin; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|168|c.<br>1725.<br>Ninth S. af-<br>ter Trinity.<br>Perhaps<br>composed<br>at Weimar.|Thue Rech-<br>nung! Don-<br>nerwort!|Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachts-<br>Opffer,<br>1715,<br>p.<br>141).|Stanza<br>viii.<br>of<br>Bartholo-<br>maus<br>Ring-<br>waldt's<br>hymn,<br>Herr Jesu<br>Christ,<br>du<br>hochstes<br>Gut;<br>rest<br>of<br>libretto<br>original.|


221
















|105|c. 1725.<br>Ninth S. af-<br>ter Trinity.|Herr, gehe<br>nicht in's<br>Gericht<br>(Psalm<br>cxliii. 2).|?Christian<br>Weiss,<br>senr.|Psalm<br>cxliii. 2;<br>Stanza<br>xi. of Jo-<br>hann Rist's<br>hymn,<br>Jesu, der<br>du moine<br>Seele; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|46|c.<br>1725.<br>Tenth S. af-<br>ter Trinity.|Schauet<br>doch<br>und<br>sehet,<br>ob<br>irgend<br>ein<br>Schmerz<br>sei (Lam. i.<br>12).|?Christian<br>Weiss,<br>senr.|Lamentation<br>i.<br>12;<br>Stanza<br>ix.<br>(apoc-<br>ryphal)<br>of<br>Balthasar<br>Schnurr's<br>hymn,<br>O<br>grosser<br>Gott<br>von<br>Macht;<br>rest<br>origi-<br>nal.<br>A. T.<br>B. Soli.|


222 Johann Sebastian Bach
















|77|1725. Thir-<br>teenth S. af-<br>ter Trinity.|Du sollst<br>Gott,<br>deinen<br>Herren,<br>lieben (St.<br>Luke x.<br>27).|?Christian<br>Weiss,<br>senr.|St. Luke<br>x. 27;<br>Stanza viii.<br>of David<br>Denicke's<br>(?) hymn,<br>Wenn<br>einer alle<br>Ding ver-<br>stnd<br>(posthu-<br>mously<br>added to<br>Bach's<br>text); rest<br>of libretto<br>original.|
|---|---|---|---|---|
|8|c.<br>1725.<br>Sixteenth<br>S.<br>after<br>Trinity.|Liebster<br>Gott, wann<br>werd'<br>ich<br>sterben?|Caspar<br>Neumann<br>(arranged<br>by ?Pican-<br>der).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and v.<br>are<br>retained<br>in<br>their<br>original<br>form. Stan-<br>zas<br>ii.-iv.<br>are<br>para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativi.|


148 c. 1725.

Seven
teenth

S. after

Trinity.



Bringet
dem Herrn

Ehre seines

Namens

(Psalm
xcvi. 8).



The

groundwork is by
Picander

(Sammlung
Erbaulicher

Gedancken,
Leipzig,
1725, p.
428), arranged
by Bach.
This is the

earliest

ascertained

association

of Bach

and Pican
der (date
?Sept. 23,
1725).



223


Psalm xcvi.

8, 9; Stanza

xi. of

Johann

Heer
mann's

hymn, Wo
soll ich

fliehen

hin (suggested by
Spitta, ii.
694; wanting in the
score); rest

of libretto

original. A.
T. B. Soli.


224 Johann Sebastian Bach
















|72|c. 1726<br>(or earlier).<br>Third S.<br>after the<br>Epiphany.|Alles nur<br>nach Gottes<br>Willen.|Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachts-<br>Opffer,<br>1715, p.<br>35).|Stanza i. of<br>Albrecht of<br>Brandenburg<br>Culmbach's<br>hymn,<br>Was mein<br>Gott will,<br>das g'scheh'<br>allzeit;<br>rest origi-<br>nal. A. S.<br>B. Soli.|
|---|---|---|---|---|
|19|1726.<br>Feast of St.<br>Michael the<br>Archangel.|Es<br>erhub<br>sich<br>ein<br>Streit.|The<br>ground-<br>work of the<br>text<br>is<br>a<br>libretto for<br>the season<br>published<br>by Picander<br>in<br>1725.<br>The<br>Can-<br>tata version<br>probably<br>is by Bach<br>himself.<br>Spitta's<br>(ii.<br>344)<br>attribution<br>of<br>it<br>to<br>Picander<br>is<br>ill-<br>founded.|Stanza<br>ix.<br>of the<br>anonymous<br>hymn,<br>Freu'<br>dich<br>sehr,<br>O<br>meine<br>Seele; rest<br>of<br>libretto<br>original. S.<br>T. B. Soli.|


225
















|195|?c. 1726.<br>For a Wed-<br>ding.|Dem<br>Gerechten<br>muss das<br>Licht<br>(Psalm<br>xcvii. 11).|?Bach.<br>Spitta (ii.<br>469) sup-<br>poses that<br>the music<br>is adapted.|Psalm<br>xcvii. 11,<br>12; Stanza<br>i. of Paul<br>Gerhardt's<br>hymn,<br>Nun dan-<br>ket all'<br>und bringet<br>Ehr'; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|157|1727. Feast<br>of the Pu-<br>rification.<br>Also for a<br>Funeral.|Ich<br>lasse<br>dich nicht,<br>du<br>seg-<br>nest<br>mich<br>denn (Gen.<br>xxxii. 26).|Picander<br>(Satyrische<br>Gedichte,<br>vol.<br>i.<br>p.<br>210).|Genesis<br>xxxii.<br>26;<br>Stanza<br>vi.<br>of Christian<br>Keimann's<br>hymn,<br>Meinen<br>Jesum lass'<br>ich nicht;<br>rest<br>by<br>Picander.<br>T. B. Soli|


226 Johann Sebastian Bach
















|37|c. 1727.<br>(Schweitzer<br>ii. 260,<br>dates it<br>1728-34).<br>Ascension<br>Day. [See<br>Nos. 147<br>(1716)<br>and 172<br>(1724).]|Wer da<br>glaubet<br>und getauft<br>wird (St.<br>Mark xvi.<br>16).|?Christian<br>Weiss,<br>senr.|St. Mark<br>xvi. 16;<br>Stanza v.<br>of Philipp<br>Nicolai's<br>hymn,<br>Wie schn<br>leuchtet<br>der Mor-<br>genstern;<br>Stanza iv.<br>of Johann<br>Kolross'<br>hymn,<br>Ich dank'<br>dir, lieber<br>Herre; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|198|1727.<br>Oc-<br>tober 17.|Trauer-<br>Musik:<br>for<br>Queen<br>Christiane<br>Eberhar-<br>dine<br>of<br>Poland 477|Prof. J. C.<br>Gottsched.<br>(d. Sept. 7,<br>1727).|Original<br>throughout.|



0 General mourning for the Queen lasted from Sept. 7, 1727, to Jan. 6, 1728.
No Cantatas were sung in the period.


227
















|93|?1728.<br>Fifth S. af-<br>ter Trinity.|Wer nur<br>den lieben<br>Gott lsst<br>walten.|Georg Neu-<br>mark (ar-<br>ranged by<br>?Picander).|Choral<br>Cantata;<br>Stanzas<br>i., iv., v.,<br>vii. of<br>Neumark's<br>hymn are<br>retained in<br>their orig-<br>inal form;<br>Stanzas ii.,<br>iii., vi. are<br>inserted<br>or para-<br>phrased<br>in the<br>Arias and<br>Recitativi.|
|---|---|---|---|---|
|Incomplete|?1728.<br>Christmas<br>Day.|Ehre<br>sei<br>Gott in der<br>Hhe<br>(St.<br>Luke<br>ii.<br>14).|Picander<br>(Can-<br>taten,<br>1728-29, p.<br>71).|St.<br>Luke<br>ii.<br>14;<br>Stanza<br>iv.<br>of<br>Caspar<br>Ziegler's<br>hymn, Ich<br>freue mich<br>in dir; rest<br>original. A.<br>B. Soli.|


228 Johann Sebastian Bach




- 159 ?1729.
Quinquagesima
(Estomihi).



Sehet,
wir geh'n
hinauf nach

Jerusalem

(St. Luke
xviii. 31).



Picander

(Ibid., p.
106).



St. Luke

xviii. 31;

Stanza vi.

of Paul

Gerhardt's

hymn, O
Haupt voll
Blut und

Wunden;

Stanza

xxxiii. of

Paul Stock
mann's

hymn,

Jesu

Leiden,

Pein und

Tod; rest
original.


145 1729 (or
1730).

Easter

Tuesday
(Am Osterfeste)



So du mit

deinem

Munde

bekennest

Jesum

(Romans x.
9), _or_ Auf,

mein Herz!

des Herren

Tag, _or_ Ich
lebe, mein

Herze.



Picander

(Cantaten,
1728-29, p.
125), with

the addi
tion (by
Bach) of
the opening
Choral

and Bible

verse. See

Spitta, ii.

442 n.



229


Stanza i.

of Caspar

Neumann's

hymn,
Auf, mein

Herz! des

Herren

Tag; Romans x. 9;

Stanza xiv.

of Nikolaus

Herman's

hymn, Erschienen

ist der her
rlich' Tag;
rest of

libretto by
Picander.

S. T. B.

Soli.


230 Johann Sebastian Bach
















|171|1730 (or<br>1731) Feast<br>of the<br>Circumci-<br>sion (New<br>Year's<br>Day).|Gott, wie<br>dein Name,<br>so ist auch<br>dein Ruhm<br>(Psalm<br>xlviii. 10).|Picander<br>(Ibid. p.<br>81).|Psalm<br>xlviii. 10;<br>Stanza iii.<br>of Johann<br>Heer-<br>mann's<br>hymn,<br>Jesu,<br>nun sei<br>gepreiset;<br>rest of<br>libretto<br>original.|
|---|---|---|---|---|
|156|1730<br>(or<br>1729).<br>Third<br>S.<br>after<br>the<br>Epiphany. [S<br>No.<br>173<br>(1718).]|ee<br>Ich<br>steh'<br>mit<br>einem<br>Fuss<br>im<br>Grabe.|Picander<br>(Ibid.Ibid.,<br>p. 91).|Stanza<br>i.<br>of<br>Joh.<br>Hermann<br>Schein's<br>hymn,<br>Mach's<br>mit<br>mir,<br>Gott, nach<br>deiner<br>Gt';<br>Stanza i. of<br>Caspar Bi-<br>enemann's<br>hymn,<br>Herr, wie<br>du will't, so<br>schick's mit<br>mir;<br>rest<br>of<br>libretto<br>original.|


231








|120|1730. Inau-<br>guration of<br>the Town<br>Council<br>(Aug.<br>24). Used<br>also for<br>Augsburg<br>Confession<br>celebration<br>on June 26,<br>1730. [See<br>Nos. 69<br>(1724), 190<br>(1725).]|Gott, man<br>lobet dich<br>in der Stille<br>(Psalm lxv.<br>1).|?Christian<br>Weiss,<br>senr.|Psalm lxv.<br>i.; clauses<br>xx.-xxiii.<br>of the Te<br>Deum;<br>rest of<br>libretto<br>original.|
|---|---|---|---|---|
|l88|1730<br>(or<br>1731).<br>Twenty-<br>first S. after<br>Trinity. In-<br>corporates<br>older<br>in-<br>strumental<br>material.|Ich<br>habe<br>meine<br>Zuver-<br>sicht.|Picander<br>(Can-<br>taten,<br>1728-29, p.<br>47). Music<br>proba-<br>bly<br>by<br>Wilhelm<br>Friede-<br>mann Bach<br>to a large<br>extent.|Stanza i. of<br>Sigismund<br>Weingrt-<br>ner's<br>(?)<br>hymn,<br>Auf<br>meinen<br>lieben<br>Gott; rest<br>of<br>libretto<br>original.<br>Organ<br>obbligato.|


232 Johann Sebastian Bach
















|80|1730. Ref-<br>ormation<br>Festival (c.<br>Oct. 31).<br>Composed<br>mainly at<br>Weimar<br>(1716).|Ein' feste<br>Burg ist<br>unser Gott.|Luther and<br>Salomo<br>Franck<br>(Evan-<br>gelisches<br>Andachts-<br>Opffer, p.<br>60).|Choral<br>Cantata.<br>Stanzas i.,<br>ii., iii., iv.<br>of Luther's<br>hymn,<br>Ein' feste<br>Burg ist<br>unser<br>Gott, are<br>set in their<br>original<br>form; rest<br>of libretto<br>by Franck.|
|---|---|---|---|---|
|89|c.<br>1730.<br>Twenty-<br>second<br>S.<br>after<br>Trinity.|Was<br>soll<br>ich aus dir<br>machen,<br>Ephraim?<br>(Hosea<br>xi.<br>8).|?Christian<br>Weiss,<br>senr.|Hosea<br>xi.<br>8;<br>Stanza<br>vii.<br>of<br>Johann<br>Heer-<br>mann's<br>hymn, Wo<br>soll<br>ich<br>fliehen<br>hin;<br>rest<br>of<br>libretto<br>original. S.<br>A. B. Soli.|


- 52 _c._ 1730.
Twentythird

S. after

Trinity. In
corporates
older in
strumental

material.



Falsche

Welt, dir

trau ich

nicht.



Author un
known.



233


Stanza i.

of Adam

Reissner's

hymn,
In dich

hab' ich

gehoffet,
Herr; rest

of libretto

original.
Soprano
Solo.


234 Johann Sebastian Bach



36 c. 1730.

First S. in

Advent.



Schwingt
freudig
euch em
por.



The opening Chorus
and three

Arias are

adaptations
by Bach
of a sec
ular Ode,
having the
same title,
written by
Picander

and performed

Nov. 30,

1720.

The four

Chorals

replace
Picander's

original
Recitativi.

The music

(excepting the
Recitativi

and final

Chorus of

the Ode)

of the two

works is

identical.



_Part_ _I.:_

Stanza i.

of Luther's

hymn,

Nun

komm, der

Heiden

Heiland;

Stanza vi.

of Philipp
Nicolai's

hymn,
Wie schon

leuchtet der

Morgenstern; _Part_

_II.:_ Stanzas

vi. and viii.

of Luther's

hymn;
remaining

movements

adapted by
Bach from

Picander.


235














|Incomplete|c. 1730?<br>For a Wed-<br>ding.|O ewiges<br>Feuer, O<br>Ursprung<br>der Liebe.|Author<br>unknown.<br>See No. 34<br>infra (c.<br>1740).|Psalm<br>cxxviii.<br>4, 5, 6;<br>Benedic-<br>tion; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|*82|c.<br>1731.<br>Feast of the<br>Purifica-<br>tion.|Ich<br>habe<br>genug.|?Bach.|Original<br>throughout.<br>Spitta<br>(ii.<br>346) points<br>out<br>that<br>the<br>Aria<br>Schlum-<br>mert<br>ein<br>seems<br>to<br>have<br>been<br>suggested<br>by<br>a<br>text<br>by<br>Johann<br>Jakob<br>Rambach<br>for<br>the<br>same<br>sea-<br>son.<br>Bass<br>Solo.|


236 Johann Sebastian Bach














|84|1731 (or<br>1732). Sep-<br>tuagesima.|Ich bin<br>vergngt<br>mit<br>meinem<br>Glcke.|A revision<br>(?by Bach)<br>of a text by<br>Picander<br>(Can-<br>taten,<br>1728-29, p.<br>101).|Stanza xii.<br>of Emilie<br>Juliane of<br>Schwarzburg<br>Rudolstadt's<br>hymn,<br>Wer<br>weiss,<br>wie nahe<br>mir mein<br>Ende; rest<br>original.<br>Soprano<br>Solo.|
|---|---|---|---|---|
|66|1731<br>(not<br>1735).<br>Easter<br>Mon-<br>day.<br>[See<br>No.<br>134<br>(1717-22).]|Erfreut<br>euch,<br>ihr<br>Herzen.|?Bach.|Stanza<br>iii.<br>of<br>the<br>hymn,<br>Christ<br>ist<br>erstanden;<br>rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


237
















|42|1731 (not<br>c. 1740).<br>First S. af-<br>ter Easter.<br>(Quasi-<br>modogeniti)|Am Abend<br>aber dessel-<br>bigen Sab-<br>baths (St.<br>John xx.<br>.19).|?Christian<br>Weiss,<br>senr. Wust-<br>mann<br>(note 37)<br>suggests<br>Bach.|St. John xx.<br>19; Stanza<br>i. of Joh.<br>Michael<br>Altenburg's<br>hymn,<br>Verzage<br>nicht, du<br>Hauflein<br>klein;<br>Stanza i.<br>of Luther's<br>Antiphon,<br>Ver-<br>leih' uns<br>Frieden<br>and adden-<br>dum; rest<br>original.|
|---|---|---|---|---|
|112|1731. Sec-<br>ond<br>S.<br>after Easter<br>(Miseri-<br>cordias<br>Domini).|Der<br>Herr<br>ist<br>mein<br>getreuer<br>Hirt (Psalm<br>xxiii.).|Wolfgang<br>Meusel.|Choral<br>Cantata.<br>The<br>five<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form.|


238 Johann Sebastian Bach










|174|1731 (or<br>1732).<br>Whit<br>Monday.<br>Incorpo-<br>rates older<br>instru-<br>mental<br>mate-<br>rial. [See<br>No. 194<br>(1723).]|Ich liebe<br>den<br>Hochsten<br>von<br>ganzem<br>Gemthe.|Picander<br>(Can-<br>taten,<br>1728-29, p.<br>147).|Stanza i.<br>of Martin<br>Schalling's<br>hymn,<br>Herzlich<br>lieb hab'<br>ich dich, O<br>Herr; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|9|?1731<br>Sixth<br>S.<br>after<br>Trinity|Es ist das<br>Heil<br>uns<br>kommen<br>her.|Paul<br>Speratus<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and xii. are<br>set in their<br>original<br>form.<br>The<br>intermedi-<br>ate stanzas<br>are<br>para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativi.|


239
















|102|?1731.<br>Tenth<br>S. after<br>Trinity.|Herr, deine<br>Augen<br>sehen<br>nach dem<br>Glauben<br>(Jeremiah<br>v. 3).|?Christian<br>Weiss,<br>senr. Spitta<br>(ii. 464)<br>suggests<br>Picander.|Part I.:<br>Jeremiah v.<br>3; Romans<br>ii. 4, 5;<br>Part II.:<br>Stanzas vi.<br>and vii.<br>of Johann<br>Heer-<br>mann's<br>hymn, So<br>wahrich-<br>lebe,<br>spricht dein<br>Gott; rest<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|*35|?1731.<br>Twelfth<br>S.<br>after<br>Trinity.|Geist<br>und<br>Seele wird<br>verwirret.|The<br>prob-<br>ability<br>that<br>the<br>Cantata is a<br>converted<br>chamber<br>music com-<br>position<br>supports<br>the<br>infer-<br>ence<br>that<br>Bach wrote<br>the<br>text.<br>See Spitta,<br>ii. 447.|Original<br>throughout<br>(2<br>parts).<br>Alto<br>Solo<br>and Organ<br>obbligato.|


240 Johann Sebastian Bach
















|25|c. 1731.<br>Fourteenth<br>S. after<br>Trinity.|Es ist nichts<br>gesundes<br>an meinem<br>Leibe<br>(Psalm<br>xxxviii. 3).|?Christian<br>Weiss,<br>senr.|Psalm<br>xxxviii. 3;<br>Stanza xii.<br>of Johann<br>Heer-<br>mann's<br>hymn,<br>Treuer<br>Gott, ich<br>muss dir<br>klagen;<br>rest of<br>libretto<br>original. S.<br>T. B. Soli.|
|---|---|---|---|---|
|29|1731. Inau-<br>guration of<br>the<br>Town<br>Council<br>(Aug. 27).<br>Incorpo-<br>rates older<br>instru-<br>mental<br>material.|Wir danken<br>dir,<br>Gott<br>(Psalm<br>lxxv. i).|?Christian<br>Weiss, Sr.|Pslam lxxv.<br>1;<br>Stanza<br>v. (posthu-<br>mous)<br>of<br>Johann<br>Grau-<br>mann's<br>hymn Nun<br>lob'<br>mein<br>Seel'<br>den<br>Herren,<br>rest<br>of<br>libretto<br>original.<br>Organ<br>obbligato.|


*51 1731 (or
1732). Fif
teenth S. af
ter Trinity.



Jauchzet

Gott in

allen

Landen.



?Bach. A

version for

Michael
mas

(?1737)

also exists.

See Spitta,
ii. 473n.



241


Stanza v.

of Johann

Grau
mann's

hymn,
Nun lob',

mein' Seel',

den Her
ren; rest

of libretto

original.
Soprano
Solo.


242 Johann Sebastian Bach




- 27 1731. Sixteenths, after Trinity.



Wer weiss,

wie nahe

mir mein

Ende.



?Bach. The

first Aria

is suggested by a
Neumeister

stanza

(KirchenAndachten,
p. 294).
See Spitta,
ii. 451.



Stanza i.

of Emilie

Juliane of

SchwarzburgRudolstadt's

hymn,

Wer

weiss,

wie nahe

mir mein

Ende;

Stanza i. of

Joh. Georg
Albinus'

hymn,
Welt ade!

ich bin dein

mde; rest

of libretto

original.
Organ
obbligato.
Choral

extended.


243
















|169|1731 (or<br>1732).<br>Eighteenth<br>S. after<br>Trinity.|Gott soll<br>allein mein<br>Herze-<br>haben.|Author un-<br>known.|Stanza iii.<br>of Luther's<br>hymn,<br>Nun bitten<br>wir den<br>heiligen<br>Geist; rest<br>of libretto<br>original.<br>Alto Solo<br>and Organ<br>obbligato.|
|---|---|---|---|---|
|149|1731. Feast<br>of<br>St.<br>Michael<br>the<br>Arch-<br>angel.|Man<br>singet<br>mit<br>Freuden<br>vom<br>Sieg<br>(Psalm<br>cxviii. 15).|Christian<br>Weiss,<br>senr.<br>First<br>Chorus<br>borrowed<br>from<br>Was<br>mir<br>behagt.|Psalm<br>cxviii.<br>15,<br>16; Stanza<br>iii.<br>of<br>Martin<br>Schalling's<br>hymn,<br>Herzlich<br>lieb<br>hab'<br>ich dich, O<br>Herr; rest<br>of<br>libretto<br>original.|


244 Johann Sebastian Bach
















|56|1731 (or<br>1732).<br>Nineteenth<br>S. after<br>Trinity.|Ich will den<br>Kreuzstab<br>gerne<br>tragen.|?Bach,<br>working on<br>a Neumeis-<br>ter text<br>(Kirchen-<br>Andachten,<br>p. 514).|Stanza vi.<br>of Johann<br>Franck's<br>hymn, Du,<br>O schones<br>Weltge-<br>bude;<br>rest of<br>libretto<br>original.<br>Bass Solo.|
|---|---|---|---|---|
|*49|c.<br>1731.<br>Twentieth<br>S.<br>after<br>Trinity. In-<br>corporates<br>older<br>in-<br>strumental<br>material.|Ich<br>geh'<br>und<br>suche<br>mit Verlan-<br>gen.|Author un-<br>known.|Stanza vii.<br>of<br>Philipp<br>Nicolai's<br>hymn,<br>Wie schn<br>leuchtet der<br>Morgen-<br>stern; rest<br>of<br>libretto<br>original.<br>S. B. Soli<br>and Organ<br>obbligato.|


245
















|109|c. 1731.<br>Twenty-<br>first S. after<br>Trinity.|Ich glaube,<br>lieber<br>Herre, hilf<br>meinem<br>Unglauben<br>(St. Mark<br>ix. 24).|?Christian<br>Weiss,<br>senr.|St. Mark<br>ix. 24;<br>Stanza vii.<br>of Lazarus<br>Spengler's<br>hymn,<br>Durch<br>Adams Fall<br>ist ganz<br>verderbt;<br>rest origi-<br>nal. A. T.<br>Soli.|
|---|---|---|---|---|
|55|1731<br>(or<br>1732).<br>Twenty-<br>second<br>S.<br>after<br>Trinity.|Ich<br>armor<br>Mensch,<br>ich<br>Sn-<br>denknecht.|Author un-<br>known.|Stanza<br>vi.<br>of Jo-<br>hann Rist's<br>hymn,<br>Werde<br>munter,<br>mein<br>Gemuthe;<br>rest<br>of<br>libretto<br>original.<br>Tenor Solo.|


246 Johann Sebastian Bach
















|140|1731 (or<br>later).<br>Twenty-<br>seventh<br>S. after<br>Trinity.|Wachet<br>auf, ruft<br>uns die<br>Stimme.|Philipp<br>Nicolai (ar-<br>ranged by<br>?Picander).|Choral<br>Cantata.<br>All three<br>stanzas of<br>the hymn<br>are set<br>in their<br>original<br>form. The<br>rest of the<br>libretto is<br>original. S.<br>T. B. Soli.|
|---|---|---|---|---|
|129|1732. Trin-<br>ity Sunday.|Gelobet sei<br>der Herr.|Johannes<br>Olearius.|Choral<br>Cantata.<br>The<br>five<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form. S. A.<br>B. Soli.|


247
















|39|1732 (not<br>c. 1740).<br>First S. af-<br>ter Trinity.|Brich dem<br>Hungrigen<br>dein Brod<br>(Isaiah<br>lviii. 7).|?Christian<br>Weiss,<br>senr.<br>Schweitzer<br>(ii. 343)<br>attributes<br>the text to<br>Picander.|Part I.: Isa-<br>iah lviii. 7,<br>8; Part II.:<br>Hebrews<br>xiii. 16;<br>Stanza vi.<br>of David<br>Denicke's<br>hymn,<br>Kommt,<br>lasst euch<br>den Herren<br>lehren;<br>rest of<br>libretto<br>original. S.<br>A. B. Soli.|
|---|---|---|---|---|
|177|1732.<br>Fourth<br>S.<br>after<br>Trinity.|Ich ruf' zu<br>dir,<br>Herr<br>Jesu Christ.|Johannes<br>Agricola.|Choral<br>Cantata.<br>The<br>five<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form. S. A.<br>T. Soli.|


248 Johann Sebastian Bach
















|88|1732. Fifth<br>S. after<br>Trinity.|Siehe, ich<br>will viel<br>Fischer<br>aussenden<br>(Jer. xvi.<br>16).|?Christian<br>Weiss,<br>senr.|Part I.:<br>Jeremiah<br>xvi. 16;<br>Part II.: St.<br>Luke v. 10;<br>Stanza vii.<br>of Georg<br>Neumark's<br>hymn,<br>Wer nur<br>den lieben<br>Gott lasst<br>walten;<br>rest of<br>libretto<br>original.|
|---|---|---|---|---|
|*170|?1732.<br>Sixth<br>S.<br>after<br>Trinity.|Vergngte<br>Ruh,<br>be-<br>liebte<br>Seelenlust.|Author un-<br>known.|Original<br>throughout.<br>See Spitta,<br>ii.<br>453n.<br>Alto<br>Solo<br>and Organ<br>obbligato.|


249
















|187|1732. Sev-<br>enth S. after<br>Trinity.|Es wartet<br>Alles auf<br>dich (Psalm<br>civ. 27).|?Christian<br>Weiss,<br>senr.<br>Schweitzer<br>(ii. 343)<br>attributes<br>the text to<br>Picander.|Part I.:<br>Psalm<br>civ. 27,<br>28; Part<br>II.: St.<br>Matthew<br>vi. 31, 32;<br>Stanzas<br>iv. and<br>vi. of the<br>anonymous<br>hymn,<br>Singen<br>wir aus<br>Herzens-<br>grund;<br>rest origi-<br>nal. S. A.<br>B. Soli.|
|---|---|---|---|---|
|137|?1732.<br>Twelfth<br>S.<br>after<br>Trinity.|Lobe<br>den<br>Herren, den<br>mchtigen<br>Knig<br>der Ehren.|Joachim<br>Neander.|Choral<br>Cantata.<br>The<br>five<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form. S. A.<br>T. Soli.|


250 Johann Sebastian Bach



95 ?1732. Six
teenth S. af
ter Trinity.



Christus,

der ist mein

Leben.



Author un
known.



Stanza

i. of the

anonymous
hymn,
Christus,

der ist mein

Leben;

Stanza i.

of Luther's

hymn,
Mit Fried'

und Freud'

ich fahr'

dahin;

Stanza i.

of Valerius

Herberger's
hymn,
Valet will

ich dir

geben;
Stanza iv.

of Nikolaus

Herman's

hymn,

Wenn

mein

Stndlein

vorhanden

ist; rest
original. S.
T. B. Soli.


251
















|98|c. 1732.<br>Twenty-<br>first S. after<br>Trinity.|Was Gott<br>thut, das ist<br>wohlgethan.|Author un-<br>known.|Stanza i.<br>of Samuel<br>Rodigast's<br>hymn,<br>Was Gott<br>thut, das ist<br>wohlgethan<br>rest of li-<br>bretto<br>original.|
|---|---|---|---|---|
|60|1732.<br>Twenty-<br>fourth<br>S.<br>after<br>Trinity.|O<br>Ewigkeit,<br>du Donner-<br>wort.|Author un-<br>known.|Stanza<br>i.<br>of Jo-<br>hann Rist's<br>hymn,<br>O<br>Ewigkeit<br>du<br>Don-<br>nerwort;<br>Psalm cxix.<br>166; Reve-<br>lation<br>xiv.<br>13; Stanza<br>v. of Franz<br>Joachim<br>Burmeis-<br>ter's hymn,<br>Es<br>ist<br>genug;<br>rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


252 Johann Sebastian Bach














|102|c. 1733.<br>Occa-<br>sion not<br>specified.|Nun danket<br>alle Gott.|Martin<br>Rinkart.|Choral<br>Cantata.<br>The three<br>stanzas of<br>the hymn<br>are set<br>in their<br>original<br>form. S. A.<br>B. Soli.|
|---|---|---|---|---|
|*58|1733. Sun-<br>day<br>after<br>the<br>Cir-<br>cumcision.|Ach<br>Gott,<br>wie<br>manches<br>Herzeleid.|?Bach.|Stanza<br>i.<br>of<br>Martin<br>Moller's(?)<br>hymn,<br>Ach<br>Gott,<br>wie<br>manches<br>Herzeleid;<br>Stanza<br>ii.<br>of<br>Martin<br>Behm's<br>hymn,<br>O<br>Jesu Christ,<br>mein's<br>Lebens<br>Licht; rest<br>original. S.<br>B. Soli.|


253
























|99|c. 1733.<br>Fifteenth S.<br>after Trin-<br>ity.|Was Gott<br>thut, das ist<br>wohlgethan.|Samuel<br>Rodigast<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>vi. of the<br>hymn are<br>set in their<br>original<br>form. The<br>intervening<br>stanzas<br>are para-<br>phrased<br>in the<br>Arias and<br>Recitativi.|
|---|---|---|---|---|
|191|_c._<br>1733.<br>Christmas<br>Day (Am<br>Weinachts-<br>feste).|Gloria<br>in<br>excelsis<br>Deo.|St. Luke ii.<br>14.|The<br>Glo-<br>ria of the<br>B<br>minor<br>Mass.|
|117|_c._<br>1733.<br>Occa-<br>sion<br>not<br>specified.|Sei<br>Lob<br>und<br>Ehr'<br>dem<br>hochsten<br>Gut.|Johann<br>Jakob<br>Schtz.|Choral<br>Cantata.<br>The<br>nine<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form. A. T.<br>B. Soli.|


254 Johann Sebastian Bach






















|97|1734. ?For<br>a Wedding,<br>or general<br>use.|In allen<br>meinen<br>Thaten.|Paul Flem-<br>ming. See<br>Schweitzer,<br>ii. 242n.|Choral<br>Cantata.<br>The nine<br>stanzas of<br>the hymn<br>are set<br>in their<br>original<br>form.|
|---|---|---|---|---|
|*54|1723-34.<br>Occa-<br>sion<br>not<br>specified.|Wideratehe<br>doch<br>der<br>Sunde.|Author un-<br>known.|Original<br>throughout.<br>Alto Solo.|
|*53|1723-34.<br>?For<br>a<br>Funeral.|Schlage<br>doch,<br>gewn-<br>schte<br>Stunde.|?Salomo<br>Franck.|A<br>single<br>eight-lined<br>original<br>stanza.<br>Alto Solo.|




[212]


### (6) COMPOSED AT LEIPZIG: 1735-50

No. Date. Title. Author of

Libretto.



Composition
of the Text.


255
















|43|1735. New<br>Year's Day.|Lobe den<br>Herrn,<br>meine<br>Seele<br>(Psalm<br>cxlvi. 1).|?Christian<br>Weiss,<br>senr. Wust-<br>mann<br>(note 19)<br>suggests<br>Bach.|Psalm<br>cxlvi. 1, 5,<br>10; Stanzas<br>i. and iii.<br>of Jakob<br>Ebert's<br>hymn, Du<br>Friedefurst,<br>Herr Jesu<br>Christ;<br>the rest of<br>the libretto<br>(two Arias)<br>original. S.<br>T. B. Soli.|
|---|---|---|---|---|
|14|1735.<br>Fourth<br>S.<br>after<br>the<br>Epiphany.|War'<br>Gott<br>nicht<br>mit<br>uns<br>diese<br>Zeit (Psalm<br>cxxiv.).|Luther (ar-<br>ranged).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and iii.<br>are set in<br>their<br>orig-<br>inal<br>form.<br>Stanza<br>ii.<br>is<br>para-<br>phrased<br>in<br>the<br>intervening<br>Arias<br>and<br>Recitativo.<br>S.<br>T.<br>B.<br>Soli.|


256 Johann Sebastian Bach




- 85 1735. Sec
ond S. after

Easter.

(Miseri
cordias

Domini).



Ich bin ein

guter Hirt
(St. John x.
11).



Spitta (iii.
71) and

Schweitzer

(ii. 331n)

attribute

the text

to Mari
anne von

Ziegler.

Wustmann

(note 60)
disagrees.



St. John

x. 11;

Stanza i. of

Cornelius

Becker's

hymn,

Derr Herr

ist mein

getreuer
Hirt;

Stanza iv.

of Ernst

Christoph
Homburg's
hymn, Ist
Gott mein

Schild und

Helfers
mann; rest

of libretto

original.


257
















|103|?1735.<br>Third S.<br>after Easter<br>(Jubi-<br>late).|Ihr werdet<br>weinen und<br>heulen (St.<br>John xvi.<br>20).|Marianne<br>von Ziegler<br>(Ver-<br>such in<br>gebundener<br>Schreibart,<br>Leipzig,1728<br>Emended<br>by Bach.|St. John<br>xvi. 20;<br>Stanza ix.<br>of Paul<br>Gerhardt's<br>hymn,<br>).Barmherzge<br>Vater,<br>hochster<br>Gott; rest<br>of libretto<br>original. A.<br>T. Soli.|
|---|---|---|---|---|
|108|?1735.<br>Fourth<br>S.<br>after<br>Easter.<br>(Can-<br>tate).|Es ist euch<br>gut,<br>dass<br>ich hingehe<br>(St.<br>John<br>xvi. 7).|Marianne<br>von Ziegler<br>_(Ibid.)._<br>Emended<br>by Bach.|St.<br>John<br>xvi.<br>7,<br>13; Stanza<br>x.<br>of Paul<br>Gerhardt's<br>hymn,<br>Gott<br>Vater,<br>sende<br>deinen<br>Geist; rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


258 Johann Sebastian Bach




- 87 ?1735.

Fifth S.

after Easter

(Rogate)



Bisher habt

ihr nichts

gebeten in
meinem

Namen (St.

John xvi.

24).



Marianne

von Ziegler
_(Ibid.)._

Emended

by Bach.



St. John

xvi. 24,33;

Stanza ix.

of Heinrich

Mller's

hymn
Selig ist
die Seele;

rest of

libretto

original. A.
T. B. Soli.


43 1735. As
cension

Day.



Gott fhret

auf mit

Jauchzen

(Psalm
xlvii. 5).



?Bach.

Schweitzer

(ii. 331n)
wrongly
attributes

text to Mar
ianne von

Ziegler.



259


_Part_ _I._ :

Pslm xlvii.

5,6; St.

Mark xvi.

19; _Part_

_II._ : Stanzas

i. and

xiii. of Jo
hann Rist's

hymn, Du
Lebenfst,

Herr Jesu

Christ,

rest of

libretto

original,
excepting
the second,

third, and

fourth

Arias.

Original
portion
perhaps by
Bach.


260 Johann Sebastian Bach



11 c. 1735.

Ascension

Day.



Lobet Gott

in seinen

Reichen.



Author un
known.



St. Luke

xxiv. 50
52; Acts

i. 9-11;

Stanza

iv. of Jo
hann Rist's

hymn, Du
Lebenfst,

Herr Jesu

Christ;

Stanza vii.

of Gottfried

Wilhelm

Sacer's

hymn

Gott

fhret auf

gen Himmel; rest

of libretto

original.


261
















|128|?1735.<br>Ascension<br>Day.|Auf Christi<br>Him-<br>melfahrt<br>allein.|Marianne<br>von Ziegler<br>(Ibid.).<br>Emended<br>by Bach.|Stanza i.<br>of Josua<br>Wegelin's<br>hymn,<br>Auf<br>Christi<br>Him-<br>melfahrt<br>allein;<br>Stanza<br>iv. of<br>Matthus<br>Avenar-<br>ius's hymn,<br>O Jesu,<br>meine<br>Lust; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|183|?1735.<br>Sunday<br>after<br>the<br>Ascension<br>(Exaudi)|Sie werden<br>euch in den<br>Bann thun<br>(St.<br>John<br>xvi. 2)|Marianne<br>von Ziegler<br>_(Ibid.)._<br>Emended<br>by Bach.|S. John xvi.<br>2;<br>Stanza<br>v.<br>of Paul<br>Gerhardt's<br>hymn<br>Zeuch ein<br>zu<br>deinen<br>Thoren;<br>rest<br>of<br>libretto<br>original.|


262 Johann Sebastian Bach
















|74|?1735.<br>Whit Sun-<br>day. An<br>expansion<br>of No. 59<br>(1716).|Wer mich<br>liebst, der<br>wird mein<br>Wort halten<br>(St. John<br>xiv. 23).|Marianne<br>von Ziegler<br>(Ibid.).<br>Emended<br>by Bach.|St. John<br>23, 28;<br>Romans<br>viii. 1;<br>Stanza ii.<br>of Paul<br>Gerhardt's<br>hymn,<br>Gott<br>Vater,<br>sende<br>deinen<br>Geist rest<br>of libretto<br>original.|
|---|---|---|---|---|
|68|?1735.<br>Whit<br>Monday.<br>Contains<br>old (1716)<br>secular<br>material.|Also<br>hat<br>Gott<br>die<br>Welt<br>geliebt.|Marianne<br>von Ziegler<br>_(Ibid.)._<br>Emended<br>by<br>Bach.<br>See<br>Was<br>mir<br>be-<br>hagt.|Stanza<br>i.<br>of Salomo<br>Liscow's<br>hymn,<br>Also<br>hat<br>Gott<br>die<br>Welt<br>geliebt;<br>St.<br>John<br>iii. 18; rest<br>of<br>libretto<br>original. S.<br>B. Soli.|


263
















|175|?1735.<br>Whit<br>Tuesday.|Er rufet<br>seinen<br>Schafen<br>mit Namen<br>(St. John x.<br>3).|Marianne<br>von Ziegler<br>(Ibid.).<br>Emended<br>slightly by<br>Bach.|St. John x.<br>3, 6; Stanza<br>ix. of Jo-<br>hann Rist's<br>hymn, O<br>Gottes<br>Geist, mein<br>Trost und<br>Rath ; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|176|?1735.<br>Trinity<br>Sunday.<br>[See<br>No.<br>20 (1725).]|Es ist ein<br>trotzig und<br>verzagt<br>Ding.<br>(Cf.<br>Jer.<br>xvii.<br>9).|Marianne<br>von Ziegler<br>_(Ibid.)._<br>Emended<br>by Bach.|Stanza viii.<br>of<br>Paul<br>Gerhardt's<br>hymn,<br>Was<br>alle<br>Weisheit<br>in<br>der<br>Welt; rest<br>original. S.<br>A. B. Soli.|


264 Johann Sebastian Bach
















|107|c. 1735.<br>Seventh S.<br>after Trin-<br>ity.|Was willst<br>du dich be-<br>trben.|Johann<br>Heermann.|Choral<br>Cantata.<br>Six stanzas<br>of the hymn<br>are set in<br>their orig-<br>inal form.<br>The final<br>Choral is<br>stanza xiv.<br>of David<br>Denicke's<br>hymn, Ich<br>will zu aller<br>Stunde. S.<br>T. B. Soli.|
|---|---|---|---|---|
|94|?1735.<br>Ninth<br>S.<br>after<br>Trinity.|Was<br>frag<br>ich<br>nach<br>der Welt.|Georg<br>Michael<br>Pfefferkorn<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i., iii., v.,<br>vii.,<br>viii.<br>are set in<br>their<br>orig-<br>inal<br>form.<br>Stanzas<br>ii., iv., vi.<br>are<br>para-<br>phrased in<br>the Arias.|


265
















|133|1735 (or<br>1737).<br>Feast of St.<br>John the<br>Evangelist.|Ich freue<br>mich in dir.|Caspar<br>Ziegler<br>(arranged<br>by ?Chris-<br>tian Weiss,<br>junr.).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>iv. of the<br>hymn are<br>set in their<br>original<br>form. The<br>intervening<br>stanzas<br>are para-<br>phrased<br>in the<br>Arias and<br>Recitativi.|
|---|---|---|---|---|
|100|c.<br>1735.<br>?Fifteenth<br>S.<br>after<br>Trinity, for<br>a Wedding.|Was<br>Gott<br>thut, das ist<br>wohlgethan.|Samuel<br>Rodigast.|Choral<br>Cantata.<br>The<br>six<br>stanzas<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form.|


266 Johann Sebastian Bach



5 1735.

Nineteenth

S. after

Trinity.



Wo soll ich

fliehen hin.



Johann

Heermann

(arranged
by ?Picander).



Choral

Cantata.

Stanzas

i. and

xi. of the

hymn are
set in their

original
form. The

intervening
Arias and

Recitativi

are based

particularly

on stanzas

iii., iv., vii.,

viii., ix.


79 1735. Ref
ormation

Festival

(Oct. 30).



Gott, der

Herr, ist

Sonn und

Schild

(Psalm

Ixxxiv.

11).



?Christian

Weiss,

senr.



267


Psalm

lxxxiv. 11;

Stanza i.

of Martin

Rinkart's

hymn,
Nun dan
ket alle

Gott;

Stanza viii.

of Ludwig
Helmbold's

hymn,
Nun lasst

uns Gott

dem Her
ren; rest

of libretto

original. S.
A. B. Soli.


268 Johann Sebastian Bach



41 ?1736.

New Year's

Day.



Jesu,

nun sei

gepreiset.



Choral

Cantata.

Stanzas i.

and iii. of

the hymn
are set in

their original form.

Stanza ii.

is paraphrased
in the

intervening
Arias and

Recitativi.



Johann

Heermann

(arranged).


269














|13|c. 1736.<br>Second S.<br>after the<br>Epiphany.|Meine<br>Seufzer,<br>meine<br>Thrnen.|Author un-<br>known.|Stanza ii.<br>of Johann<br>Heer-<br>mann's<br>hymn,<br>Zion<br>klagt mit<br>Angst und<br>Schmerzen;<br>Stanza xv.<br>of Paul<br>Flem-<br>ming's<br>hymn,<br>In allen<br>meinen<br>Thaten;<br>rest origi-<br>nal.|
|---|---|---|---|---|
||[1736.<br>Easter<br>Day]|Kommt,<br>eilet<br>und<br>laufet.|?Picander.]||


270 Johann Sebastian Bach



6 1736.

Easter

Monday.



Bleib' bei

uns, denn

es will

Abend

werdeu (St.

Luke xxiv.

29).



Author

unknown.

Wustmann

(note 53)

suggests
Picander.



St. Luke

xxiv. 29;

Stanzas i.

and ii. of

Nikolaus

Selnecker's

hymn,
Ach bleib'

bei uns,

Herr Jesu

Christ;

Stanza ii.

of Luther's

hymn,
Erhalt'

uns, Herr,

bei deinem

Wort; rest
original.


28 c. 1736.

Sunday
after

Christmas.

Spitta, ii.
433, dates

it 1725-27.



Gottlob!

nun geht
das Jahr zu

Ende.



Erdmann

Neumeister

(Fnf
fache

Kirchen
Andachten,

1716. Ser.

IV.



271


Stanza i.

of Johann

Grau
mann's

hymn,

Nun

lob', mein

Seel', den

Herren;

Jeremiah

xxxii. 41;

Stanza

vi. of

Paul Eber's

hymn,
Helft

mir Gott's

Gtte

preisen;
rest of

libretto

original.


272 Johann Sebastian Bach
















|17|c. 1737.<br>Fourteenth<br>S. after<br>Trinity.|Wer Dank<br>opfert, der<br>preiset<br>mich<br>(Psalm 1.,<br>23).|?Bach.<br>Schweitzer<br>(ii. 343)<br>attributes<br>the text to<br>Picander.|Part I.:<br>Psalm 1.<br>23; Part<br>II.: St.<br>Luke xvii.<br>15, 16;<br>Stanza iii.<br>of Johann<br>Grau-<br>mann's<br>hymn,<br>Nun lob',<br>mein' Seel',<br>den Her-<br>ren; rest<br>original.|
|---|---|---|---|---|
|118|c.<br>1737.<br>?For a Fu-<br>neral.|O<br>Jesu<br>Christ,<br>mein's<br>Lebens<br>Licht.|Martin<br>Behm.|Stanza<br>i.<br>of<br>Martin<br>Behm's<br>hymn,<br>O<br>Jesu Christ,<br>mein's<br>Lebens<br>Licht.<br>A<br>Motet;<br>cf.<br>No. 50 (c.<br>1740.|


273
















|197|?1737. For<br>a Wedding.<br>Contains<br>older<br>material<br>(?1728).|Gott ist<br>uns're<br>Zuversicht.|?Bach. Pt.<br>II.'s Arias<br>are based<br>on the<br>Christmas<br>Cantata<br>Ehre<br>sei Gott<br>(?1728).|Stanza iii.<br>of Luther's<br>hymn,<br>Nun bitten<br>wir den<br>heiligen<br>Geist;<br>Stanza<br>vii. (partly<br>rewritten)<br>of Georg<br>Neumark's<br>hymn,<br>Wer nur<br>den lieben<br>Gott lsst<br>walten;<br>rest origi-<br>nal. S. A.<br>B. Soli.|
|---|---|---|---|---|
|30|1738. Feast<br>of St. John<br>Baptist<br>(Mid-<br>summer<br>Day).|Freue dich,<br>erloste<br>Schaar.|Reconstructi<br>by ?Pican-<br>der,<br>of<br>his<br>An-<br>genehmes<br>Wiederau,<br>1737, from<br>which<br>the<br>music also<br>is<br>in<br>part<br>borrowed.|on,<br>_Part_<br>_I.:_<br>Stanza<br>iii.<br>of Johannes<br>Olearius'<br>hymn,<br>Trstet,<br>trstet,<br>meine<br>Lieben;<br>rest<br>of<br>libretto<br>original.|


274 Johann Sebastian Bach














|123|1740. Feast<br>of the<br>Epiphany.|Liebster<br>Immanuel,<br>Herzog der<br>Frommen.|Ahasuerus<br>Fritsch<br>(arranged<br>by ?Chris-<br>tian Weiss,<br>junr.).|Choral<br>Cantata.<br>Stanzas i.<br>and v. of<br>the hymn<br>are set in<br>their orig-<br>inal form.<br>Stanzas<br>ii., iii., iv.<br>are para-<br>phrased<br>in the<br>intervening<br>Arias and<br>Recitativi.<br>A. T. B.<br>Soli.|
|---|---|---|---|---|
|32|c.<br>1740.<br>First<br>S.<br>after<br>the<br>Epiphany.|Leibster<br>Jesu, mein<br>Verlangen.|?Picander.|St. Luke ii.<br>49; Stanza<br>xii. of Paul<br>Gerhardt's<br>hymn,<br>Weg,<br>mein Herz,<br>mit<br>den<br>Gedanken;<br>rest of li-<br>bretto<br>original. S.<br>B. Soli.|


275
















|124|c. 1740.<br>First S.<br>after the<br>Epiph-any.|Meinen Je-<br>sum lass'<br>ich nicht.|Christian<br>Keimann<br>(arranged<br>by ?Pican-<br>der).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>vi. of the<br>hymn are<br>set in their<br>original<br>form. Stan-<br>zas ii.-v.<br>are para-<br>phrased<br>in the<br>intervening<br>Arias and<br>Recitativi.|
|---|---|---|---|---|
|3|c.<br>1740.<br>Second<br>S.<br>after<br>the<br>Epiphany.|Ach<br>Gott,<br>wie<br>manches<br>Herzeleid.|Martin<br>Moller<br>(arranged<br>by ?Chris-<br>tian Weiss,<br>junr.).|Choral<br>Cantata.<br>Stanzas<br>i.,<br>ii., xii.<br>of<br>the<br>hymn<br>are set in<br>their<br>orig-<br>inal<br>form.<br>Stanzas<br>iv.-vi., ix.,<br>x. are para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativo.|


276 Johann Sebastian Bach
















|111|c. 1740.<br>Third S.<br>after the<br>Epiphany.|Was mein<br>Gott will,<br>das g'scheh'<br>allzeit.|Albrecht,<br>Mar-<br>grave of<br>Brandenburg<br>Culmbach<br>(arranged).|Choral<br>Cantata.<br>Stanzas i.<br>-and iv. of<br>the hymn<br>are set in<br>their orig-<br>inal form.<br>Stanzas<br>ii. and iii.<br>are para-<br>phrased<br>in the<br>Arias and<br>Recitativi.|
|---|---|---|---|---|
|92|c.<br>1740.<br>Septuages-<br>ima.|Ich<br>hab'<br>in<br>Gottes<br>Herz<br>und<br>Sinn.|Paul<br>Ger-<br>hardt<br>(ar-<br>ranged<br>by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i.,<br>ii.,<br>v.,<br>x.,<br>xii.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form. Stan-<br>zas iii., iv.,<br>vi.-viii., ix.<br>are<br>para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativo.|


125 c. 1740.

Feast of the

Purifica
tion.



Mit Fried'

und Freud'

ich fahr'

dahin.



Luther (arranged).



277


Choral

Cantata.

Stanzas i.,

ii., iv.

are set in

their original form.

Stanza iii.

is paraphrased in
the second

Aria and

Recitative.

A. T. B.

Soli.


278 Johann Sebastian Bach



126 c. 1740.

Sexagesima.



Erhalt' uns,

Heir, bei

deinem

Wort.



Luther (arranged).



Choral

Cantata.

Stanzas i.,

iii., and

Luther's

Verleih'

uns Frieden

gndiglich
are set in

their original form.

The other

stanzas

are paraphrased in
the Arias

and second

Recit. A. T.

B. Soli.


279


Choral

Cantata.

Stanzas

i. and

viii. of the

hymn are
set in their

original
form. The

intervening

stanzas

are paraphrased in
the Recita
tivi and

Arias. S. T.

B. Soli.



127 c. 1740.

Quinquagesima
(Estomihi).



Herr Jesu

Christ,

wahr'r

Mensch

und Gott.



Paul Eber

(arranged
by ?Picander).


280 Johann Sebastian Bach
















|1|c. 1740.<br>Feast of the<br>Annuncia-<br>tion.|Wie schn<br>leuchtet der<br>Morgen-<br>stern.|Philipp<br>Nicolai (ar-<br>ranged by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>vii. of the<br>hymn are<br>set in their<br>original<br>form. Stan-<br>zas ii.-vi.<br>are para-<br>phrased<br>in the<br>intervening<br>Recitativi<br>and Arias.<br>S. T. B.<br>Soli.|
|---|---|---|---|---|
|146|c.<br>1740.<br>Third<br>S.<br>after Easter<br>(Jubi-<br>late).<br>Incorpo-<br>rates older<br>instru-<br>mental<br>material.|Wir<br>mssen<br>durch<br>viel<br>Trbsal<br>in<br>das<br>Reich<br>Gottes<br>eingehen<br>(Acts<br>xiv.<br>22).|Author<br>unknown.<br>Schweitzer<br>(ii.<br>343)<br>names<br>Picander.|Acts<br>xiv.<br>22;<br>ex-<br>cepting the<br>concluding<br>Choral<br>(words<br>wanting in<br>the<br>score)<br>the rest of<br>the libretto<br>is original.|


281










|34|c. 1740<br>(or 1741).<br>Whit Sun-<br>day (Am Pfi<br>feste. In-<br>corporates<br>(modified)<br>parts of the<br>Wedding<br>Cantata<br>(c. 1730)<br>bearing the<br>same title|O ewiges<br>Feuer, O<br>Ursprung<br>ngdsetr- Liebe.|?by Bach.|Original<br>throughout.<br>Move-<br>ments 1,<br>3, 5, fol-<br>low the<br>Wedding<br>Cantata,<br>words and<br>music. A.<br>T. B. Soli.|
|---|---|---|---|---|
|2|c.<br>1740.<br>Second<br>S.<br>after Trin-<br>ity.|Ach<br>Gott,<br>vom Him-<br>mel<br>sieh<br>darein.|Luther (ar-<br>ranged<br>by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>vi.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form.<br>The<br>intervening<br>stanzas<br>are<br>para-<br>phrased in<br>the<br>Arias<br>and Recita-<br>tivi.<br>A. T.<br>B. Soli.|


282 Johann Sebastian Bach



135 c. 1740.

Third S. af
ter Trinity.



Ach Herr,

mich armen

Sunder.



Cyriacus
Schnee
gass.
Also at
tributed to

Christoph
Demantius

(arranged
by ?Christian Weiss,
junr.).



Choral

Cantata.

Stanzas i.

and vi. of

the hymn
(see Psalm
vi.) are

set in their

original
form. The

intervening

stanzas

are paraphrased in
the Arias

and Recita
tivi. A. T.

B. Soli.


283
















|7|c.1740.<br>Feast of<br>St. John<br>Baptist<br>(Mid-<br>summer<br>Day).|Christ<br>unser Herr<br>zum Jordan<br>kam.|Luther (ar-<br>ranged).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>vii. of the<br>hymn are<br>set in their<br>original<br>form. The<br>intervening<br>stanzas<br>are para-<br>phrased in<br>the Arias<br>and Recita-<br>tivi. A. T.<br>B. Soli.|
|---|---|---|---|---|
|10|c.<br>1740.<br>Feast of the<br>Visitation.|Meine Seel'<br>erhebt den<br>Herren. (St.<br>Luke,<br>i.<br>46).|St.<br>Luke,<br>i. 46-55 (ar-<br>ranged).|Choral<br>Cantata.<br>Verses<br>46-48,<br>54,<br>and<br>the<br>Doxology,<br>are set in<br>their<br>orig-<br>inal<br>form.<br>The<br>other<br>verses<br>are<br>para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativi.|


284 Johann Sebastian Bach
















|45|c. 1740.<br>Eighth S.<br>after Trin-<br>ity.|Est ist dir<br>gesagt,<br>Mensch,<br>was gut ist<br>(Micah vi.,<br>8).|?Christian<br>Weiss,<br>senr.<br>Schweitzer<br>(ii. 343)<br>attributes<br>the text to<br>Picander.|Part I.:<br>Micah vi.<br>8; Part<br>II.: St.<br>Matthew<br>vii. 22, 23;<br>Stanza ii.<br>of Johann<br>Heer-<br>mann's<br>hymn, O<br>Gott, du<br>frommer<br>Gott; rest<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|178|c.<br>1740.<br>Eighth<br>S.<br>after Trin-<br>ity.|Wo<br>Gott<br>der<br>Herr<br>nicht<br>bei<br>uns<br>halt<br>(Psalm<br>cxxiv.).|Justus<br>Jonas<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i.,<br>ii., iv., v.,<br>vii., viii., of<br>the<br>hymn<br>are set in<br>their<br>orig-<br>inal<br>form.<br>The<br>other<br>stanzas<br>are<br>para-<br>phrased. A.<br>T. B. Soli.|


285
















|101|c. 1740.<br>Tenth S. af-<br>ter Trinity.|Nimm von<br>uns, Herr,<br>du treuer<br>Gott.|Martin<br>Moller<br>(arranged).<br>Schweitzer<br>(ii. 375)<br>names<br>Picander.|Choral<br>Cantata.<br>Stanzas i.,<br>iii., v., vii.<br>are set in<br>their orig-<br>inal form.<br>Stanzas<br>ii., iv., vi.<br>are para-<br>phrased in<br>the Arias.|
|---|---|---|---|---|
|113|c.<br>1740.<br>Eleventh S.<br>after Trin-<br>ity.|Heir<br>Jesu<br>Christ,<br>du<br>hchstes<br>Gut.|Bartholoma<br>Ring-<br>waldt(arrang|ws<br>ed).<br>Choral<br>Cantata.<br>Stanzas<br>i., ii., iv.,<br>viii.<br>of<br>the<br>hymn<br>are set in<br>their<br>orig-<br>inal<br>form.<br>Stanzas<br>iii.,<br>v.-vii.<br>are<br>para-<br>phrased<br>in<br>the<br>Arias<br>and<br>Recitativo.|


286 Johann Sebastian Bach










|193|c. 1740.<br>Inaugu-<br>ration of<br>the Town<br>Council<br>(c. August<br>24). In-<br>complete.|Ihr Pforten<br>[Tore] zu<br>Zion|Author un-<br>known.|Original<br>throughout.<br>S. A. T. (or<br>B.) Soli.|
|---|---|---|---|---|
|33|c.<br>1740.<br>Thirteenth<br>S.<br>after<br>Trinity.|Allein<br>zu<br>dir,<br>Herr<br>Jesu Christ.|Johannes<br>Schneesing.<br>Attributed<br>also<br>to<br>Conrad<br>Hubert.<br>Arranged.|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>iv.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form.<br>The<br>intervening<br>stanzas<br>are<br>para-<br>phrased. A.<br>T. B. Soli.|


287
















|78|c. 1740 (or<br>after 1734)<br>Fourteenth<br>S. after<br>Trinity.|Jesu, der<br>du meine<br>Seele.|Johann<br>Rist (ar-<br>ranged by<br>?Picander).|Choral<br>Cantata.<br>Stanzas i.<br>and xii. of<br>the hymn<br>are set in<br>their orig-<br>inal form.<br>Four lines<br>of Stanza x.<br>are inserted<br>into the last<br>Recitativo.|
|---|---|---|---|---|
|138|c.<br>1740<br>(or earlier).<br>Fifteenth S.<br>after Trin-<br>ity.|Warum be-<br>trbst<br>du<br>dich, mein<br>Herz.|?Hans<br>Sachs<br>and<br>?Picander.|Choral<br>Cantata.<br>Stanzas<br>i.,<br>ii., iii.<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form. Rest<br>of<br>libretto<br>original. A.<br>T. B. Soli.|


288 Johann Sebastian Bach
















|114|c. 1740.<br>Seven-<br>teenth<br>S. after<br>Trinity.|Ach, lieben<br>Chris-<br>ten, seid<br>getrost.|Johannes<br>Gigas<br>(arranged).|Choral<br>Cantata.<br>Stanzas i.,<br>iii., vi. of<br>the hymn<br>are set in<br>their orig-<br>inal form.<br>The other<br>stanzas<br>are para-<br>phrased<br>in the<br>remaining<br>move-<br>ments.|
|---|---|---|---|---|
|96|c.<br>1740.<br>Eighteenth<br>S.<br>after<br>Trinity.|Herr<br>Christ,<br>der<br>ein'ge<br>Gottes-<br>Sohn.|Elisabethe<br>Cruciger<br>(arranged<br>by ?Pican-<br>der).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>v.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form.<br>The<br>intervening<br>stanzas<br>are<br>para-<br>phrased in<br>the Recita-<br>tivi<br>and<br>Arias.|


289
















|130|c. 1740.<br>Feast of St.<br>Michael the<br>Archangel.|Herr Gott,<br>dich loben<br>alle wir.|Paul Eber<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i., xi., xii.<br>(in score<br>only) of the<br>hymn are<br>set in their<br>original<br>form. The<br>remaining<br>stanzas<br>are para-<br>phrased.|
|---|---|---|---|---|
|50|c.<br>1740.<br>Feast of St.<br>Michael the<br>Archangel.|Nun ist das<br>Heil<br>und<br>die Kraft.|Revelation<br>xii 10.|Rev.<br>xii.<br>10; a single<br>Bible<br>pas-<br>sage.<br>A<br>Motet. Cf.<br>No. 118 (c.<br>1737).|


290 Johann Sebastian Bach














|48|c.1740.<br>Nineteenth<br>S. after<br>Trinity.|Ich elender<br>Mensch,<br>wer wird<br>mich<br>erlosen<br>(Rom. vii.<br>24).|?Picander.|Romans<br>vii. 24;<br>Stanza<br>iv. of the<br>anonymous<br>hymn,<br>Ach Gott<br>und Herr;<br>Stanza<br>xii. of the<br>anonymous<br>hymn,<br>Herr Jesu<br>Christ, ich<br>schrei zu<br>dir; rest<br>original. A.<br>T. Soli.|
|---|---|---|---|---|
|180|c.<br>1740.<br>Twentieth<br>S.<br>after<br>Trinity.|Schmucke<br>dich,<br>O<br>liebe Seele.|Johann<br>Franck<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i.,<br>iv., ix.<br>of<br>the<br>hymn<br>are<br>set<br>in<br>their<br>original<br>form.<br>The<br>remaining<br>stanzas<br>are<br>para-<br>phrased.|


291
















|38|c. 1740.<br>Twenty-<br>first S. after<br>Trinity.|Aus tiefer<br>Noth schrei<br>ich zu dir<br>(Psalm<br>cxxx.).|Luther (ar-<br>ranged by<br>?Christian<br>Weiss,<br>junr.).|Choral<br>Cantata.<br>Stanzas<br>i. and<br>v. of the<br>hymn are<br>set in their<br>original<br>form. The<br>intervening<br>stanzas<br>are para-<br>phrased.|
|---|---|---|---|---|
|115|c.<br>1740.<br>Twenty-<br>second<br>S.<br>after<br>Trinity.|Mache<br>dich, mein<br>Geist,<br>bereit.|Johann<br>Burchard<br>Freystein<br>(arranged<br>by ?Pican-<br>der.|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>x.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form.<br>The<br>interven-<br>ing<br>ones<br>are<br>para-<br>phrased.|


292 Johann Sebastian Bach
















|139|c. 1740.<br>Twenty-<br>third S.<br>after Trin-<br>ity.|Wohl dem,<br>der sich<br>auf seinen<br>Gott.|Johann<br>Christoph<br>Rube<br>(arranged).|Choral<br>Cantata.<br>Stanzas i.<br>and v. are<br>set in their<br>original<br>form. The<br>interven-<br>ing ones<br>are para-<br>phrased.|
|---|---|---|---|---|
|26|c.<br>1740.<br>Twenty-<br>fourth<br>S.<br>after<br>Trinity.|Ach<br>wie<br>fluchtig.|Michael<br>Franck (ar-<br>ranged<br>by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>xiii. of the<br>hymn<br>are<br>set in their<br>original<br>form. Stan-<br>zas<br>ii.-xii.<br>are<br>para-<br>phrased.|


293














|90|c. 1740.<br>Twenty-<br>fifth S. after<br>Trinity.|Es reifet<br>euch ein<br>sohrecklich<br>Ende.|?Picander.|Stanza vii.<br>of Martin<br>Holler's<br>hymn,<br>Nimm<br>von uns,<br>Herr, du<br>treuer<br>Gott; rest<br>of libretto<br>original. A.<br>T. B. Soli.|
|---|---|---|---|---|
|62|c. 1740 (af-<br>ter<br>1734).<br>First S. in<br>Advent.|Nun<br>komm, der<br>Heiden<br>Heiland.|Luther (ar-<br>ranged<br>by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and viii. are<br>set in their<br>original<br>form.<br>The<br>intervening<br>stanzas<br>are<br>para-<br>phrased.|


294 Johann Sebastian Bach
















|91|c. 1740.<br>Christmas<br>Day.|Gelobet<br>seist du,<br>Jesu Christ.|Luther (ar-<br>ranged by<br>?Picander).|Choral<br>Cantata.<br>Stanzas i.,<br>ii., vii. of<br>the hymn<br>are set<br>in their<br>original<br>form. The<br>remaining<br>stanzas<br>are para-<br>phrased.|
|---|---|---|---|---|
|110|Unser<br>Mund<br>sei<br>voll<br>Lachens<br>(Psalm<br>cxxvi. 2).|After 1734.<br>Christmas<br>Day.<br>Has<br>older<br>in-<br>strumental<br>material.|?Christian<br>Weiss,<br>senr.<br>Schweitzer<br>(ii.<br>343)<br>suggests<br>Picander.|Psalm<br>cxxvi.<br>2,<br>3; Jeremiah<br>x.<br>6; St.<br>Luke ii. 14;<br>Stanza<br>v.<br>of<br>Caspar<br>Fuger's<br>hymn,<br>Wir<br>Christen-<br>leut';<br>rest<br>of<br>libretto<br>original.|


295














|57|c. 1740.<br>Feast of St.<br>Stephen.|Selig ist<br>der Mann<br>(St. James<br>i. 12).|?Picander.|St. James i.<br>12; Stanza<br>vi. of<br>Ahasuerus<br>Fritsch's<br>hymn,<br>Hast du,<br>denn, Jesu,<br>dein An-<br>gesicht<br>gantzlich<br>verbor-<br>gen; rest<br>of libretto<br>original. S.<br>B. Soli.|
|---|---|---|---|---|
|121|c.<br>1740.<br>Feast of St.<br>Stephen.|Christum<br>wir<br>sollen<br>loben<br>schon.|Luther (ar-<br>ranged<br>by<br>?Picander).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>viii. of the<br>hymn<br>are<br>set in their<br>original<br>form. Stan-<br>zas<br>ii.-vi.<br>are<br>para-<br>phrased. A.<br>T. B. Soli.|


296 Johann Sebastian Bach












|l51|c. 1740.<br>Feast of St.<br>John the<br>Evangelist.|Ssser<br>Trost,<br>main Jesus<br>kommt.|?Bach.|Stanza viii.<br>of Nikolaus<br>Herman's<br>hymn,<br>Lobt Gott,<br>ihr Christen<br>alle gle-<br>ich; rest<br>of libretto<br>original.|
|---|---|---|---|---|
|Incomplete|c. 1740 (af-<br>ter<br>1734).<br>For a Wed-<br>ding.|Herr<br>Gott,<br>Beherrse-<br>her<br>aller<br>Dinge.|?Bach.|Stanzas iv.<br>and v.<br>of<br>Joachim<br>Neander's<br>hymn,<br>Lobe den<br>Herren;<br>rest<br>origi-<br>nal.<br>S. B.<br>Soli.|


297
















|122|c. 1742.<br>Sunday af-<br>ter Christ-<br>mas Day.|Das neuge-<br>bor'ne<br>Kindelein.|Cyriacus<br>Schneegass<br>and ?Bach.|Choral<br>Cantata.<br>Stanzas i.,<br>iii., iv. of<br>the hymn<br>are set in<br>their orig-<br>inal form.<br>Stanza ii.<br>is para-<br>phrased in<br>the first<br>Aria. The<br>two Recita-<br>tivi are<br>original.|
|---|---|---|---|---|
|116|1744<br>(Nov. 15).<br>Twenty-<br>fifth S. after<br>Trinity.|Du Friede-<br>frst, Herr<br>Jesu Christ.|Jakob<br>Ebert. Also<br>attributed<br>to Ludwig<br>Helmbold<br>(arranged).|Choral<br>Cantata.<br>Stanzas<br>i.<br>and<br>vii.<br>of the<br>hymn<br>are<br>set in their<br>original<br>form.<br>The<br>intervening<br>stanzas<br>are<br>para-<br>phrased.|




[143]


# APPENDIX III. THE BACHGESELLSCHAFT EDITIONS OF BACH'S WORKS

The Bachgesellschaft was founded on December 15, 1850, issued
its first volume in 1851, and was dissolved on January 27, 1900,
upon the publication of its sixtieth and concluding volume. The
Society had fulfilled its fundamental purposethe publication of
Bach's worksand on the very date of its dissolution the Neue
Bachgesellschaft was founded with the object of popularising
Bach's music by publishing it in practicable form and by
holding Bach Festivals. A secondary object, the foundation
of a Bach Museum at Eisenach, in the house in which Bach
was born, already has been achieved. Bach Festivals have been
held at regular intervalsat Berlin in 1901, Leipzig in 1904,
Eisenachin connection with the opening of the Museumin
1907, at Chemnitz in 1908, Duisburg in 1910, Breslau in 1912,
Vienna in 1914. The publications of the new Society necessarily
are unimportant by the side of those of its predecessor. It has,
however, brought to light and published a Cantata overlooked by
the old Bachgesellschaft. (See New B.G. XIII. (2).)
The publications of both Societies are quoted here by their
year of issueI., II., III., and so forth. When more than one
volume has been published in a single year they are differentiated
thus: XV.(1), XV.(2). When a volume appeared upon a date
subsequent to the Vereinsjahr it bears, the date of the Preface is [226]
indicated in a bracket, e.g. 1872[1876].
The editorial work of the original Bachgesellschaft was
undertaken, in unequal proportions, by ten editors during fifty


300 Johann Sebastian Bach


years. Of the Society's sixty volumes three were edited by
Moritz Hauptmann (1851-58), one by Carl F. Becker (1853),
two by Julius Rietz (1854-56), twenty-seven by Wilhelm Rust
(1855-81), one by Franz Kroll (1866), eleven by Alfred Drffel
(1876-98), six by Paul Graf Waldersee (1881-94), five by Ernst
Naumann (1886-94), two by Franz Wllner (1887-92), and two
by Hermann Kretzschmar (1895-1900).

### (A) PUBLICATIONS OF THE BACHGESELLSCHAFT


I. 1851. Kirchencantaten. Erster Band. Ed. Moritz Hauptmann. [478]


No. *1. Wie schn leuchtet der Morgenstern.
No. *2. Ach Gott, vom Himmel sieh darein.
No. *3. Ach Gott, wie manches Herzeleid (c. 1740).
No. *4. Christ lag in Todesbanden.
No. 5. Wo soll ich fliehen hin.

No. *6. Bleib' bei uns, denn es will Abend werden.

No. 7. Christ unser Herr zura Jordan kam.

No. *8. Liebster Gott, warm werd' ich sterben?

No. 9. Es ist das Heil uns kommen her.

No. *10. Meine Seel' erhebt den Herren!

Frontispiece: G. Haussmann's portrait of Bach, in the
possession of St. Thomas' School, Leipzig.

[227]


478 The Church Cantatas are published by Peters and also by Breitkopf and
Haertel. A prefixed asterisk indicates that an English edition of the Cantata or
Oratorio is published by Novello or Breitkopf and Haertel.
The Organ music is published by Novello, to whose edition references
are given (N.), Peters, and Breitkopf and Haertel. collation of the Peters and
Novello editions is given in Appendix V.
The Clavier and Instrumental music is published by Peters, to whose edition
references are given (P.).


301


II. 1852. Kirchencantaten. Zweiter Band. Ed. Moritz

Hauptmann.


*No. 11. Lobet Gott in seinen Reichen.

No. *12. Weinen, Klagen, Sorgen, Zagen.
No. 13. Meine Seufzer, meine Thrnen.

No. 14. War' Gott nicht mit uns diese Zeit.

No. 15. Denn du wirst meine Seele nicht in der Hlle

lassen.

No. 16. Herr Gott dich loben wir.

No. 17. Wer Dank opfert, der preiset mich.
No. 18. Gleich vie der Begen uud Schnee vom Himmel
fallt.

No. 19. Es erhub sich ein Streit.

No. 20. O Ewigkeit, du Donnerwort (c. 1725).


III. 1853. Clavierwerke. Erster Band. Ed. Carl F. Becker.


(1) Fifteen Inventions and Fifteen Symphonies (Sinfonie)
(P. bk. 201). [479]

(2) Clavierbung, Part I.:


Partiten 1-6 (P. bka. 205, 206).


(3) Clavierbung, Part II.:


Concerto, in F major, in the Italian style (P bk.
207).
Partita (Overture) in B minor (P. bk. 208).


(4) Clavierbung, Part III.:


Organ Prelude and Fugue in E flat major (N. bk.
16 pp. 19, 83).
Four Duetti (P. bk. 208 p. 78).
Catechism Choral Preludes (Organ):


479 A Variant of the first Invention is on p. 342 of the volume. A Variant of
Sinfonia ix. is on p. vi. of the Nachtrag.


302 Johann Sebastian Bach


1.


Kyrie, Gott Vater in Ewigkeit (N. bk.
16 p. 28).
Christe, aller Welt Trost (ib. p. 30).
Kyrie, Gott heiliger Geist (ib. p. 33).


2.


Kyrie, Gott Vater in Ewigkeit (alio
modo) (ib. p. 36).
Christe, aller Welt Trost (ib. p. 37).
Kyrie, Gott heiliger Geist (ib. p. 38).


3. Allein Gott in der Hoh' sei Ehr' (ib. p. 39).

[228] 4. Ditto (ib. p. 40*). [480]
5. Allein Gott in der Hoh' sei Ehr' (Fughetta)
(N. bk. 16 p. 41).
6. Dies sind die heil'gen zehn Gebot' (ib. p. 42).
7. Ditto (Fughetta) (ib. p. 47).
8. Wir glauben all' an einen Gott (ib. p. 49).
9. Ditto (Fughetta) (ib. p. 52).
10. Vater unser im Himmelreich (ib. p. 53).
11. Ditto (ib. p. 61). [481]

12. Christ unser Herr zum Jordan kam (ib. p.
62).
13. Ditto (ib. p. 67).
14. Aus tiefer Noth schrei ich zu dir (ib. p. 68).
15. Ditto (ib. p. 72).
16. Jesus Christus unser Heiland (ib. p. 74).
17. Ditto (Fugue) (ib. p. 80).


(5) Clavierbung, Part IV.:


Aria and thirty Variations (Goldberg) (P. bk. 209).


480 A Variant is in B.G. XI.
481 A Variant is in P. bk. 244 p. 109.


(6)



303


Toccata in F sharp minor (P. bk. 210 p. 30).
Ditto. C minor (P. bk. 210 p. 40).
Fugue (with Fantasia) in A minor (P. bk. 207 p.
16).



IV. 1854. *Passionsmusik nach dem Evangelisten Matthus.
Ed. Julius Rietz.

V(1). 1855. Kirchencantaten. Dritter Band. Ed. Wilhelm Rust.


*21. Ich hatte viel Bekmmerniss.

22. Jesus nahm zu sich die Zwlfe.

*23. Du wahrer Gott und Davids Sohn.

24. Ein ungefrbt Gemthe.
*25. Es ist nichts Gesundes an meinem Leibe.

26. Ach wie flchtig, ach wie nichtig.
*27. Wer weiss, wie nahe mir mein Ende.
*28. Gottlob! nun geht das Jahr zu Ende.
29. Wir danken dir, Gott, wir danken dir.

*30. Freue dich, erlste Schaar.


V(2). 1855 [1856]. Weinachts-Oratorium. Ed. Wilhelm Rust.

VI. 1856. *Messe. H moll. Ed. Julius Rietz.

VI. VII. 1857. Kirchencantaten. Vierter Band. Ed. Wilhelm

Rust.


No. 31. Der Himmel lacht, die Erde jubiliret.
*32. Liebster Jesu, mein Verlangen.
33. Allein zu dir, Herr Jesu Christ.
*34. O ewiges Feuer, O Ursprung der Liebe.
35. Geist und Seele wird verwirrt.

36. Schwingt freudig euch empor.
37. Wer da glaubet und getauft wird.

*38. Aus tiefer Noth schrei ich zu dir.

*39. Brich dem Hungrigen dein Brod.

*40. Dazu ist erschienen der Sohn Gottes.


304 Johann Sebastian Bach


VIII. 1858. Vier Messen. F dur, *A dur, G moll, G dur. Ed.
Moritz Hauptmann.
IX. 1859 [I860]. Kammermusik. Erster Band. Ed. Wilhelm

Rust.


Three Sonatas, in B minor, E flat major, A minor (and
Variant), for Clavier and Flute (P. bk. 234).
Suite in A major, for Clavier and Violin (P. bk. 236).
Six Sonatas, in B minor, A major, E major, C minor,
F minor (and Variant), G major (and Variants), for
Clavier and Violin (P. bks. 232, 233).
Three Sonatas, in G major (or 2 Flutes), D major, G
minor for Clavier and Viola da Gamba (P. bk. 239).
Sonata in G major, for Flute, Violin, and Clavier (P.
bk. 237).
Sonata in C major, for two Violins and Clavier (P. bk.
237).
Sonata in G minor, for Clavier and Violin (not in P.). [482]


X. 1860. Kirchencantaten. Fnfter Band. Ed. Wilhelm Rust.


No. *41. Jesu, nun sei gepreiset.
42. Am Abend aber desselbigen Sabbaths.

*43. Gott fahret auf mit Jauchzen.

*44. Sie werden euch in den Bann thun (c. 1725).
45. Es ist dir gesagt, Mensch, was gut ist.
46. Schauet doch und sehet, etc.

47. Wer sich selbst erhhet, der soll emiedriget werden
48. Ich elender Mensch, wer wird mich erlsen?

49. Ich geh' und suche mit Verlangen.

*50. Nun ist das Heil und die Kraft.


XI (1). 1861 [1862]. *Magnificat, D dur, und vier Sanctus, C dur,
D dur, D moll, G dur. Ed. Wilhelm Rust.


482 If genuine, the Sonata is a youthful work, remarks Schweitzer, i. 401 n.


305


The Appendix contains four additional numbers which
are found in one of the two Autograph scores of the
Magnificat.


XI (2). 1861 [1862]. Kammermusik fr Gesang. Erster Band. Ed.
Wilhelm Rust.


Secular Cantata: *Phoebus und Pan.

Secular Cantata: Weichet nur, betrbte Schatten.

Secular Cantata: Amore traditore.

Secular Cantata: Von der Vergngsamkeit, or, Ich bin
in mir vergngt.
Secular Cantata: Der zufriedengestellte Aeolus, or, Zer
reisset, zersprenget, zertrmmert die Gruft.


XII (1). 1862 [1863]. *Passionsmusik nach dem Evangelisten Johannes. Ed. Wilhelm Rust.

XII (2). 1862 [1863]. Kirchencantaten. Sechster Band. Ed. Wilhelm

Rust.


No. 51. Jauchzet Gott in allen Landen.

52. Falsche Welt, dir trau ich nicht.
*53. Schlage doch, gewnschte Stunde.
*54. Widerstehe doch der Snde.

55. Ich armer Mensch, ich Sndenknecht.
*56. Ich will den Kreuzstab gerne tragen.
57. Selig ist der Mann.
58. Ach Gott, wie manches Herzeleid (1733).
59. Wer mich liebet, der wird mein Wort halten (1716).
60. O Ewigkeit, du Donnerwort (1732).


XIII (1). 1863 [1864]. Trauungs-Cantaten. Ed. Wilhelm Rust.


No. *195. Dem Gerechten muss das Licht.

196. Der Herr denket an uns.

197.


Gott ist uns're Zuversicht.


306 Johann Sebastian Bach


Drei Chorale zu Trauungen : (1) Was Gott thut,
(2) Sei Lob und Ehr', (3) Nun danket alle Gott.


XIII (2). 1863. Clavierwerke. Zweiter Band. Ed. Wilhelm Rust.


Six Great Suites, in A major, A minor, G minor,
F major, E minor, D minor, known as the English
Suites (P. bks. 203,204).
Six Small Suites, in D minor, C minor, B minor, E
flat major, G major, E major, known as the French
Suites (P. bk. 202). [483]


XIII (3). 1863 [1865]. *Trauer-Ode. Ed. Wilhelm Rust.
XIV. 1864 [1866]. Clavierwerke. Dritter Band. Das wohltemperirte Clavier (P. bks. 2790 a-b.). Ed. Franz Kroll. [484]


Erster Theil, 1722.

Zweiter Theil, 1744.


XV. 1865 [1867]. Orgelwerke. Erster Band. Ed. Wilhelm Rust.


Six Sonatas, in E flat major, C minor, D minor, E
minor, C major, G major (N. bks. 4, 5), for 2 Claviers
and Pedal.

Eighteen Preludes and Fugues:


Prelude and Fugue in C major (N. bk. 7 p. 74).
Prelude and Fugue in D major (N. bk. 6 p. 10).
Prelude and Fugue in E minor (N. bk. 2 p. 44).
Prelude and Fugue in F minor (N. bk. 6 p. 21).
Prelude and Fugue in G minor (N. bk. 8 p. 120).
Prelude and Fugue in A major (N. bk. 3 p. 64).
Prelude (Fantasia) and Fugue in C minor (N. bk.
3 p. 76).


483 Additional movements of the second, third, and fourth Suites are in
Appendix II. of B.G. XXXVI.
484 The volume contains an Appendix of Variants, etc. See also B.G. XLV.
(1) Appendix. Variants of Nos. 1, 3, 6 of Part II. are in Appendix I. of B.G.

XXXVI.


307


Prelude (Toccata) in D minor (N. bk. 10 p. 196).
Prelude and Fugue in D minor (N. bk. 9 p. 150).
Prelude and Fugue (Toccata) in F major (N. bk. 9
p. 176).
Prelude and Fugue the Great, in G major (N. bk.
8 p. 112).
Prelude (Fantasia) and Fugue in G minor (N. bk.
8 p. 127). [485]

Prelude (Fantasia) and Fugue in A minor (N. bk.
7 p. 42). [486]

Prelude (Fantasia) and Fugue in B minor (N. bk.
7 p. 52).
Prelude (Fantasia) and Fugue in C minor (N. bk.
7 p. 64).
Prelude (Fantasia) and Fugue in C major (N. bk.
9 p. 156).
Prelude (Fantasia) and Fugue in E minor (N. bk.
8 p. 98).
Prelude and Fugue in C major (N. bk. 3 p. 70).


Three Toccatas and Fugues, in C major, the
Great (N. bk. 9 p. 137).
Toccata and Fugue D minor (N. bk. 6 p. 2).
Toccata and Fugue E major (N. bk. 8 p. 88, as
Prelude and Fugue in C major)


Passacaglia, in C minor (N. bk. 10 p. 214).


XVI. 1866 [1868]. Kirchencantaten. Siebenter Band. Ed.

Wilhelm Rust.


No. *61. Nun komm, der Heiden Heiland (1714).
62. Nun komm, der Heiden Heiland (c. 1740).


485 See publications of the N.B.G. xiv. (2) no. 5.
486 See publications of the N.B.G. vii. (3) no. 3.


308 Johann Sebastian Bach


63. Christen, tzet diesen Tag.
64. Sehet, welch' eine Liebe.

*65. Sie werden aus Saba Alle kommen.

66. Erfreut euch, ihr Herzen.

*67. Halt' im Gedachtniss Jesum Christ.

*68. Also hat Gott die Welt geliebt.
69. Lobe den Herren, meine Seele.

*70. Wachet, betet, seid bereit allezeit.


XVII. 1867 [1869]. Kammermusik. Zweiter Band. Ed. Wilhelm

Rust.


Seven Concertos, in D minor (and Variant), [487] E major
(and Variant), D major (and Variant), A major (and
Variant), F minor, F major, G minor, for Clavier and
Orchestra (Strings; two flutes added in Concerto VI.
(P. bks. 248-254). [488]

Triple Concerto in A minor, for Flute, Violin, Clavier,
and Orchestra (Strings). (P. bk. 255).


XVIII. 1868 [1870]. Kirchencantaten. Achter Band. Ed. Wilhelm

Rust.


No. 71. Gott ist mem Konig.
72. Alles nur nach Gottes Willen.

73. Herr, wie du willt, so schick's mit mir.
74. Wer mich liebet, der wird mein Wort halten (?
1735).

75. Die Elenden sollen essen.

76. Die Himmel erzahlen die Ehre Gottes.

77. Du sollst Gott, deinen Herren, lieben.

78. Jesu, der du meine Seele.


487 For this work, in its original form as a Violin Concerto, see N.B.G. XVIII.
(1 and 2).
488 The D major (No. 3) and G minor (No. 7) Concertos are identical with the
Violin Concertos in E major and A minor. See B.G. XXI. (1). No. 6 (F. major)
is the fourth Brandenburg Concerto (in G.). See B.G. XIX. no. 4.


309


*79. Gott, der Herr, ist Sonn' und Schild.
*80. Ein' feste Burg ist unser Gott.


XIX. 1869 [1871]. Kammermusik. Dritter Band. Ed. Wilhelm

Rust.

Six Concertos (Brandenburg) for Orchestra and
Continuo:


No. I. in F major (Strings, 3 Ob., Fag., 2 Cor. (P. bk.
261). [489]

No. II. in F major (Strings, Flute, Oboe, Tromba) (P.
bk. 262).
No. III. in G major (Strings) (P. bk. 263). [N.B.G. IX.
(3)].
No. IV. in G major (Strings and 2 Flutes) (P. bk. 264).
No. V. in D major (Strings, Flute, Clavier) (P. bk.
265).
No. VI. in B flat major (2 Violas, 2 Violas da Gamba,
Violoncello, Contrabasso) (P. bk. 266).


XX (1). 1870 [1872]. Kirchencantaten. Neunter Band. Ed. Wilhelm

Rust.


No. *81. Jesus schlft, was soll ich hoffen?
*82. Ich habe genug.

83. Erf route Zeit im neuen Bunde.

84. Ich bin vergngt mit meinem Glcke.
85. Ich bin ein guter Hirt. [Score, N.B.G. IX. (1)].
86. Wahrlich, wahrlich, ich sage euch.
87. Bisher habt ihr nichts gebeten in meinem Namen.
88. Siehe, ich will viel Fischer aussenden. [Score,
N.B.G. VII. (1)].
89. Was soll ich aus dir machen, Ephraim?

90. Es reifet euch ein schrecklich Ende.


489 In a shortened form this work appears also as a Sinfonia in F major. See
B.G. XXXI. (1) no. 5, and N.B.G. X. (2).


310 Johann Sebastian Bach


XX (2). 1870 [1873]. Kammermusik fr Gesang. Zweiter Band. Ed.
Wilhelm Rust.


Secular Cantata: Schleicht, spielende Wellen.
Secular Cantata: Vereinigte Zwietracht der wechsehiden Saiten.

Secular Cantata: Auf, schmetternde Tone der muntern
Trompeten. [See B.G. XXXIV].


XXI (1). 1871 [1874]. Kammermusik. Vierter Band. Ed. Wilhelm

Rust.


Three Concertos for Violin and Orchestra (Strings):


No. I. in A minor (P. bk. 229). [490]

No. II. in E major (P. bk. 230). [491]

No. III. in D minor (two Violins) (P. bk. 231). [492]


Symphonic movement, in D major, for Violin and
Orchestra (Strings, 2 Ob., 3 Trombe, Timp.). [493]


XXI (2). 1871 [1874]. Kammermusik. Fnfter Band. Ed. Wilhelm

Rust.


Three Concertos for two Claviers and Orchestra

(Strings):
No. I. in C minor (P. bk. 257).
No. II. in C major (P. bk. 256).
No. III. in C minor (P. bk. 257b). [494]


490 Identical with the G minor Clavier Concerto. See B.G. XVII. no. 7, and
also B.G. XLV. (1), Appendix, p. 233.
491 Identical with the D major Clavier Concerto. See B.G. XVII. no. 3, and
N.B.G. VIII. (1)
492 Identical with the Concerto for two Claviers in C minor. See B.G. XXI. (2)

no. 3.
493 The movement is described as being from einer unbekannten
Kirchencantate for four voices and Orchestra. The Autograph is incomplete.
The movement is not published elsewhere than in the B.G. edition.
494 Identical with the Concerto for 2 Violins, in D minor. See B.G. XXI. (1)
no. 3. Also pp. 131, 158, 160, supra.


311


XXI (3). 1871 [1874]. *0ster-0ratorium: Kommt, eilet und laufet.

Ed. Wilhelm Rust.

XXII. 1872 [1875]. Kirchencantaten. Zehnter Band. Ed. Wilhelm

Rust.


No. 91. Gelobet seist du, Jesu Christ.

92. Ich hab' in Gottes Herz und Sinn.

*93. Wer nur den lieben Gott lsst walten.

94. Was frag ich nach der Welt.
95. Christus, der ist mein Leben.
96. Herr Christ, der ein'ge Gottes-Sohn.

97. In allen meinen Thaten.

98. Was Gott thut, das ist wohlgethan, in B major (c.
1732).
99. Was Gott thut, das ist wohlgethan, in G major (c.
1733).
100. Was Gott thut, das ist wohlgethan, in G major (c.
1735).


XXIII. 1873 [1876]. Kirchencantaten. Elfter Band. Ed. Wilhelm

Rust.


No. 101. Nimm von uns, Herr, du treuer Gott.
102. Herr, deine Augen sehen nach dem Glauben.

103. Ihr werdet weinen und heulen.

*104. Du Hirte Israel, hre.
105. Herr, gehe nicht in's Gericht.
*106. Gottes Zeit ist die allerbeste Zeit (Actus tragicus).

107. Was willst du dich betrben.

108. Es ist euch gut, dass ich hingehe.
109. Ich glaube, lieber Herre.

110. Unser Mund sei voll Lachens.


XXIV. 1874 [1876]. Kirchencantaten. Zwlfter Band. Ed. Alfred

Drffel.


312 Johann Sebastian Bach


No. 111. Was mein Gott will, das g'scheh' allzeit.
*112. Der Herr ist mein getreuer Hirt.
113. Herr Jesu Christ, du hchstes Gut.
114. Ach, lieben Christen, seid getrost.
*115. Mache dich, mem Geist, bereit.

*116. Du Friedefrst, Herr Jesu Christ.

117. Sei Lob und Ehr' dem hchsten Gut.
118. O Jesu Christ, mein's Lebens Licht. [495]


*119. Preise, Jerusalem, den Herrn.

120. Gott, man lobet dich in der Stille.


XXV (1). 1875 [1878]. Die Kunst der Fuge: 1749-1750 Ed. Wilhelm
Rust. (P. bk. 218)


Contrapunctus 1-14

Four Canons I

Two Fugues for two Claviers)
Fugue on three subjects )


XXV (2) 1875 [1878], Orgelwerke. Zweiter Band. Ed. Wilhelm

Rust.


(1) Orgelbchlein (N. bk. 15), containing Preludes on
the following melodies: [496]


_Advent_


1. Nun komm der Heiden Heiland.

2. Gott, durch deine Gte, or, Gottes Sohn ist

kommen.

3. Herr Christ, der ein'ge Gottes-Sohn, or, Herr
Gott, nun sei gepreiset.
4. Lob sei dem allmchtigen Gott.


495 Also in N.B.G. XVII. (1 and 2).
496 For an exposition of Bach's design in the Orgelbchlein, see the present
writer's articles in The Musical Times for January_March 1917, and Bach's
Chorals, Part III. See N.B.G. II. (1) for an arrangement of the Preludes for
two pianofortes.


313


_Christmas_


5. Puer natus in Bethlehem.

6. Gelobet seist du, Jesu Christ.
7. Der Tag, der ist so freudenreich.
8. Vom Himmel hoch, da komm' ich her.
9. Vom Himmel kam der Engel Schaar.
10. In dulci jubilo.
11. Lobt Gott, ihr Christen, allzugleich.
12. Jesu, meine Freude.

13. Christum wir sollen loben schon.

14. Wir Christenleut'.


_New Year_


15. Helft mir Gottes Gte preisen.
16. Das alte Jahr vergangen ist.
17. In dir ist Freude.


_Feast of the Purification of the B.V.M._


18. Mit Fried' und Freud' ich fahr' dahin.

19. Herr Gott, nun schleuss den Himmel auf.


_Passiontide_


20. O Lamm Gottes, unschuldig.
21. Christe, du Lamm Gottes.
22. Christ us, der uns selig macht.
23. Da Jesus an dem Kreuze stund.

24. O Mensch, bewein' dein' Snde gross.
25. Wir danken dir, Herr Jesu Christ.
26. Hilf Gott, dass mir's gelinge.


_Easter_


27. Christ lag in Todesbanden.
28. Jesus Christus, unser Heiland, der den Tod.
29. Christ ist erstanden (three verses).
30. Erstanden ist der heil'ge Christ.


314 Johann Sebastian Bach


31. Erschienen ist der herrliche Tag.
32. Heut' triumphiret Gottes Sohn.


_Whitsunday_


33. Komm, Gott, Schpfer, heiliger Geist.


_Trinity Sunday_


34. Herr Jesu Christ, dich zu uns wend'.
35-6. Liebster Jesu, wir sind hier (two settings).


_The Catechism_


37. Dies sind die heil'gen zehn Gebot.

38. Vater unser im Himmelreich.


_Penitence and Amendment_


39. Durch Adam's Fall ist ganz verderbt.

40. Es ist das Heil uns kommen her.


_Christian Conduct and Experience_


41. Ich ruf' zu dir, Herr Jesu Christ.


_In Time of Trouble_


42. In dich hab' ich gehoffet, Herr.

43. Wenn wir in hchsten Nothen sein.

44. Wer nur den lieben Gott lsst walten.


_Death and the Grave_


45. Alle Menschen mssen sterben.


_The Life Eternal_


46. Ach wie nichtig, ach wie flchtig.


(2) Six Chorals (Schbler) (N. bk. 16) on the following
melodies:


Wachet auf, ruft uns die Stimme.


315


Wo soll ich fliehen hin, _or_, Auf meinen lieben

Gott.

Wer nur den lieben Gott lsst walten.

Meine Seele erhebt den Herren.

Ach bleib bei uns, Herr Jesu Christ.

Kommst du nun, Jesu, vom Himmel herunter.


(3) Eighteen Chorals (N. bk. 17) on the following
melodies:


1., 2. Komm, heiliger Geist, Herre Gott (two settings).
3. An Wasserflssen Babylon.
4. Schmcke dich, O liebe Seele.

5. Herr Jesu Christ, dich zu uns wend'.

6. O Lamm Gottes unschuldig (three verses).

7. Nun danket Alle Gott.

8. Von Gott will ich nicht lassen.

9, 10, 11. Nun komm der Heiden Heiland (three settings).
12, 13, 14. Allein Gott in der Hh' sei Ehr' (three settings).
15, 16. Jesus Christus, unser Heiland, der von uns (two
settings).
17. Komm, Gott, Schpfer, heiliger Geist.
18. Vor deinen Thron tret' ich, or, Wenn wir in

hchsten Nthen sein.


(4) Older texts of the Orgelblein and Eighteen
Chorals:


1. Christus, der uns selig macht (Orgelblein No.
22) (P. bk. 244 p. 108).
2. Komm, Gott, Schpfer, heiliger Geist (Orgelblein No. 33) (P. bk. 246 p. 86A).
3. Komm, heiliger Geist, Herre Gott (Eighteen No.
1) (P. bk. 246 p. 86).
4. Ditto (Eighteen No. 2) (P. bk. 246 p. 88).


316 Johann Sebastian Bach


5. An Wasserflssen Babylon (Eighteen No. 3) (P.
bk. 245 p. 103).
6. Herr Jesu Christ, dich zu uns wend' (Eighteen No.
5) (P. bk. 245 pp. 107, 108 prints two of the three
Variants).
9. O Lamm Gottes unschuldig (Eighteen No. 6)(P.
bk. 246 p. 97).
10. Von Gott will ich nicht lassen (Eighteen No. 8)
(P. bk. 246 p. 102).
11. Nun komm der Heiden Heiland (Eighteen No. 9)
(P. bk. 246 p. 92).
12. Ditto (Eighteen No. 10) (P. bk. 246 pp. 93, 94).
14. Ditto (Eighteen No. 11) (P. bk. 246 p. 96).
15. Allein Gott in der Hh' sei Ehr' (Eighteen No. 13)
(P. bk. 245 p. 100).
16. Allein Gott in der H' sei Ehr' (Eighteen No. 14)
(P. bk. 245 p. 97).
17. Jesus Christus unser Heiland (Eighteen No. 15)
(P. bk. 245 p. 112).


XXVI. 1876 [1878]. Kirchencantaten. Dreizehnter Band. Ed.

Alfred Drffel.


121. Christum wir sollen loben schon.

122. Das neugebor'ne Kindelein.
123. Liebster Immanuel, Herzog der Frommen.
124. Meinen Jesum lass' ich nicht.

125. Mit Fried' und Freud' ich fahr' dahin.

126. Erhalt' uns, Herr, bei deinem Wort.

127. Herr Jesu Christ, wahr'r Mensch und Gott.

128. Auf Christi Himmelfahrt allein.

129. Gelobet sei der Herr.

130. Herr Gott, dich loben alle wir.


XXVII (1). 1877 [18791. Kammermusik. Sechster Band. Ed. Alfred

Drffel.


317


Three Sonatas (Suites), in G minor, A minor, [497] C
major, [498] for Violin Solo (Nos. 1, 3, 5 in P. bk. 228).
Three Partitas (Suites, Sonatas), in B minor, D minor,
E major,1 for Violin Solo (Nos. 2, 4, 6 in P. bk. 228).
Six Suites (Sonatas), in G major, D minor, C major, E
flat major, C minor, D major, for Violoncello Solo (P.
bks. 238a, 238).


XXVII (2). 1877 [1878]. Thematisches Verzeichniss der Kirchencan
taten No. 1-120. Ed. Alfred Drffel.

[Note.The Thematic Catalogue is completed in B.G.
XLVI. (P. bk. 270b).]
XXVIII. 1878 [1881]. Kirchencantaten. Vierzehnter Band Ed.

Wilhelm Rust.


131. Aus der Tiefe rufe ich, Herr, zu dir.
132. Bereitet die Wege, bereitet die Bahn.

133. Ich freue mich in dir.

134. Ein Herz, das seinen Jesum lebend weiss [and Variant].

135. Ach Herr, mich armen Sunder.

136. Erforsche mich, Gott.
137. Lobe den Herren, den mchtigen Konig.
138. Warum betrbst du dich, mein Herz?

139. Wohl dem, der sioh auf seinen Gott.
*140. Wachet auf, ruft uns die Stimme. [499] Mit Gnaden
bekrone der Himmel die Zeiten (No. 134 adapted).


XXIX. 1879 [1881]. Kammermusik fr Gesang, Dritter Band. Ed.
Paul Graf Waldersee.


Secular Cantata: Was mir behagt, ist nur die muntre
Jagd.

Secular Cantata: Non sa che sia dolore.


497 See B.G. XLII. for a Clavier version.
498 See B.G. XLII. for a Clavier version.
499 Boosey and Co. also publish an English edition.


318 Johann Sebastian Bach


Secular Cantata: O holder Tag, erwnschte Zeit (Wedding).

Church Cantata No. 194: Hochsterwnschtes Freuden
fest.

Secular Cantata: Schweigt stille, plaudert nicht.

Secular Cantata: Mer hahn en neue Oberkeet.

Secular Cantata: Mit Gnaden bekrne der Himmel die

Zeiten.

Secular Cantata: O angenehme Melodei.
Instrumental Piece for Violin, Flute, and Continuo.
(Not in P.).


XXX. 1880 [1884]. Kirchencantaten. Fnfzehnter Band. Ed. Paul

Graf Waldersee.


141. Das ist je gewisslich wahr.
142. Uns ist ein Kind geboren.
143. Lobe den Herren, meine Seele.
144. Nimm, was dein ist, und gehe hin.

145. So du mit deinem Munde bekennest Jesum.

146. Wir mssen durch viel Trbsal in das Reich

Gottes eingehen.

147. Herz und Mund und That und Leben.

148. Bringet dem Herrn Ehre seines Namens.
*149. Man singet mit Freuden vom Sieg.
150. Nach dir, Herr, verlanget mich.

[242]
XXXI (1). 1881 [1885] Orchesterwerke. Ed. Alfred Drffel. (P. bk.
219)


Overture in C major (Strings, Ob. 1 and 2, Fagotto) (P.
bk. 267).
Overture B minor (Strings, Flauto traverso) (P. bk.
268).
Overture D major (Strings, Ob. 1 and 2, Trombe 1, 2,
3, Timpani) (P. bk. 269).


319


Overture D major (Strings, Ob. 1, 2, 3, Fagotto,
Trombe 1, 2, 3, Timpani) (P. bk. 2068).
Sinfonia in F major (Strings, Ob. 1, 2, 3, Fagotto,
Corno da caccia 1 and 2). [500]


XXXI (2). 1881 [1885] Musikalisches Opfer. 1747. Ed. Alfred Drffel.


Ricercare a tre voci.

Canon perpetuus super thema regium.

Canones diversi 1-5.

Fuga canonica in Epidiapente.

Ricercare a sei voci.

Two Canons.

Sonata in C minor, for Flute, Violin, Clavier
Canone perpetuo (Flute, Violin, Clavier) [501]


XXXI (3). 1881 [1885]. Kammermusik. Siebenter Band. Ed. Paul

Graf Waldersee.


Two Concertos for three Claviers and Orchestra
(Strings): No. 1 in D minor (P. bk. 258). [502]

No. 2 in C major (P. bk. 259).). [503]

[243]
XXXII. 1882 [1886]. Kirchencantaten. Sechzehnter Band. Ed. Ernst

Naumann.


151. Ssser Trost, mein Jesus kommt.

*152. Tritt auf die Glaubensbahn.

153. Schau', lieber Gott, wie meine Feind'.

154. Mein liebster Jesus ist verloren.

155. Mein Gott, wie lang', ach lange.


500 This is a shortened form of the first Brandenberg Concerto (see B.G. XIX.
no. 1). It consists of the Allegro, Adagio, Minuet, Trio I. and Trio II. of the
latter, and omits its second Allegro and Polacca.
501 The Appendix contains Joh. Philipp Kernberger's solutions of the Canons
and his expansion of the figured bass of the Clavier part of the Sonata.
502 See publications of the N.B.G. XIV. (2) no. 2.
503 See publications of the N.B.G. XIV. (2) no. 2.


320 Johann Sebastian Bach


156. Ich steh' mit einem Fuss im Grabe.

157. Ich lasse dich nicht.

158. Der Friede sei mit dir.

159. Sehet, wir geh'n binauf gen Jerusalem.
160. Ich weiss, das mein Erlser lebt.


XXXIII. 1883 [1887]. Kirchencantaten. Siebzehnter Band: Ed. Franz

Wlner.


161. Komm, du ssse Todesstunde.
162. Ach, ich sehe, jetzt da ich zur Hochzeit gehe.
163. Nur Jedem das Seine.

164. Ihr, die ihr euch von Christo nennet.
165. O heil'ges Geist- und Wasserbad.
166. Wo gehest du bin?
*167. Ihr Menschen, rhmet Gottes Liebe.
168. Thue Rechnung! Donnerwort.
169. Gott soll allein mein Herze haben.

170. Vergngte Ruh', beliebte Seelenlust.


XXXIV. 1884 [1887]. Kammermusik fr Gesang. Vierter Band. Ed.
Paul Graf Waldersee.


Secular Cantata: Durchlaucht'ster Leopold.
Secular Cantata: Schwingt freudig euch empor, _or_, Die
Freude reget sich.
Secular Cantata: Hercules auf dem Scheidewege, _or_,
Lasst uns sorgen, lasst uns wachen.
Secular Cantata: Tnet, ihr Pauken! Erschallet,
Trompeten.
Secular Cantata: Preise dein Glcke, gesegnetes Sach
[244] sen.

Secular Cantata: Angenehmes Wiederau.
Secular Cantata: Auf, schmetternde Tne der muntern
Trompeten. [504]


504 Text and music are identical with the version in B.G. XX. (2).


321


XXXV. 1885 [1888]. Kirchencantaten. Achtzehnter Band. Ed.

Alfred Drffel.


171. Gott, wie dein Name, so ist auch dein Ruhm.

172. Erschallet, ihr Lieder.

173. Erhtes Fleisch und Blut.

174. Ich liebe den Hchsten von ganzem Gemthe.

175. Er rufet seinen Schafen mit Namen.

176. Es ist ein trotzig und verzagt Ding.

177. Ich ruf' zu dir, Herr Jesu Christ.

178. Wo Gott der Herr nicht bei uns hlt.

179. Siehe zu, dass deine Gottesfurcht nicht Heuchelei

sei.

*180. Schmcke dich, O liebe Seele.


XXXVI. 1886 [1890]. Clavierwerke. Vierter Band. Ed. Ernst

Naumann.


1. Suite in A minor (Appendix version in P. bk. 214).
2. Suite in E flat major (P. bk. 214). [505]

3. Suite (Overture), in F major (P. bk. 215).
4. Sonata in D major (P. bk. 215).
10. Chromatic Fantasia and Fugue in D minor (P. bk. 207).
11. Fantasia and Fugue in A minor (P. bk. 208).
12. Prelude and Fugue in E flat major (not in P.).
13. Prelude and Fugue in A minor (P. bk. 211).
14. Prelude and Fugue in A minor (P. bk. 200).
15. Prelude and Fughetta in D minor (P. bk. 200).
16. Prelude and Fughetta in E minor (P. bk. 200).
17. Prelude and Fughetta in F major (P. bk. 214). [506]


505 Another Allemande to the Suite is in B.G. XXXVI. 217 (also in P.).
506 The subject of the Fughetta is the same as that of Fugue No. 17 in the
second part of the Well-tempered Clavier.


322 Johann Sebastian Bach


18. Do. do. G major (P. bk. 214). [507]

19. Twelve Preludes for Beginners (P. bk. 200). 20 Six
Little Preludes (P. bk. 200).
21. Prelude in C major (for Organ, N. bk. 12 p. 94).
22. Do. (Fantasia) in C minor (not in P.).
23. Do. do. in A minor (P. bk. 215).
24. Fantasia in G minor (P. bk. 215).
25. Do. C minor (P. bk. 207).
26. Do. (on a Rondo), in C minor (not in P.).
27. Do. C minor (P. bk. 212).
28. Fughetta in C minor (two-parte) (P. bk. 200).
29. Fugue in E minor (P. bk. 212).
30. Do. A major (P. bk. 212).
31. Do. C major (for Organ, N. bk. 12 p. 100).
32. Do. A minor (P. bk. 212).
33. Do. D minor (P. bk. 212 p. 61).
34. Do. A major (P. bk. 215 p. 52).
35. Do. A major (P. bk. 215 p. 57).
36. Do. B minor (Theme by Albinoni) (P. bk. 214).
37. Do. C major (P. bk. 200 p. 54).
38. Do. C major (P. bk. 200 p. 56).
39. Do. D minor (P. bk. 212 p. 59).
40. Capriccio in B flat major, sopra la lontananza del suo
fratello dilettissimo (P. bk. 208).
41. Do. E major, in honorem J.C.Bach (P. bk. 215).
42. Aria variata in A minor (P. bk. 215).
43. Three Minuets, in G major, G minor, G major (P. bk.
215).
44. Fragment of a Suite in F minor (P. bk. 212).
45. Do. do. A major (P. bk. 1959, p. 3).


507 The Prelude is No. 11 in Peters (B.G. xxxvi. 220). The Fughetta is his
No. 10. It is the same subject an that of Fugue 16 in the second part of
the Well-tempered Clavier. An alternative Prelude (P. 214 p. 78) is in the
Appendix (p. 220).


323


46. Prelude, Gavotte II, and Minuet in E flat major. [508] [246]
47. Two Minuet-Trios, in C minor and B minor. [509]

48. Applicatio in C major. [510]

49. Prelude in A minor (not in P.).

50. Do. (unfinished) in E minor (not in P.).
51. Fugue (unfinished) in C minor (P. bk. 212 p. 88). [511]


XXXVII. 1887 [1891]. Kirchencantaten. Neunzehnter Band. Ed.

Alfred Drffel.


181. Leichtgesinnte Flattergeister.
182. Himmelsknig, sei willkommen.
183. Sie werden euch in den Bann thun (?1735).

184. Erwnschtes Freudenlicht.

185. Barmherziges Herze der ewigen Liebe.
186. Aergre dich, 0 Seele, nicht.

187. Es wartet Alles auf dich.

188. Ich habe meine Zuversicht. [512]


189. Meine Seele rhmt und preist.
*190. Singet dem Herrn ein neues Lied.


XXXVIII. 1888 [1891]. Orgelwerke. Dritter Band. Ed. Ernst

Naumann.


1. Prelude and Fugue in C minor (N. bk. 2 p. 48).
2. Prelude and Fugue in G major (N. bk. 7 p. 80).
3. Prelude and Fugue in A minor (N. bk. 10 p. 208).


508 They are described as zur vierten franzsischen Suite. The Prelude is in
P. bk. 1959 p. 67.
509 Written respectively for the second and third French Suites (not in P.).
510 A fingered exercise.
511 The Appendices of the volume contain variant readings of movements
elsewhere contained in it, and of the first, third, and sixth Preludes and Fugues
in the second part of the Well-tempered Clavier.
512 See B.G. XLV. (1) Appendix.


324 Johann Sebastian Bach


4. Eight Short Preludes and Fugues in C major, D minor,
E minor, F major, G major, G minor, A minor, B flat
major (N. bk. 1).
5. Fantasia and Fugue in A minor (N. bk. 12 p. 60).

[247] 6. Fantasia con Imitazione in B minor (N. bk. 12 p. 71).
7. Fantasia in C major (N. bk. 12 p. 92).
8. Fantasia in C minor (N. bk. 3 p. 57).
9. Fantasia in G major (N. bk. 12 p. 75).
10. Fantasia in G major (N. bk. 9 p. 168).
11. Prelude in C major (N. bk. 12 p. 91).
12. Prelude in G major (N. bk. 2 p. 30).
13. Prelude in A minor (N. bk. 10 p. 238).
14. Fugue (Theme by Legrenzi) in C minor (and Variant)
(N. bk. 10 p. 230).
15. Fugue in C minor (N. bk. 12 p. 95). 16 Do. G major
(N. bk. 12 p. 86).
17. Fugue G major (N. bk. 12 p. 55).
18. Fugue G minor (N. bk. 3 p. 84).
19. Fugue B minor (Theme by Corelli) (N. bk. 3 p. 60).
20. Canzona in D minor (N. bk. 2 p. 34).
21. Allabreve in D major (N. bk. 2 p. 26).
22. Pastorale in F major (N. bk. 12 p. 102).
23. Trio in D minor (N. bk. 2 p. 54).
24. Four Concertos after Antonio Vivaldi: [513]


No. 1, in G major (N. bk. 11 no. I). [514]

No. 2, in A minor (N. bk. 11 no. 2). [515]

No. 3, in C major (N. bk. 11 no. 3).
No. 4, in C major (N. bk. 11 no. 4).


25. Fantasia (incomplete) in C major (not in N. or P.). [516]


513 Only nos. 2 and 3 are derived from Vivaldi.
514 A variant text is in B.G. XLII. 282.
515 Vivaldi's text of the first movement is in the Appendix (p. 229).
516 See B.G. XLIII. (2) sec. 1 no. 2.


325


26. Fugue (incomplete) in C minor (not in N. or P.).

27. Pedal Exercise in G minor (not in N. or P.).

28. Fugue (authenticity doubtful) in C major (not in N. or
P.).

29. Fugue (authenticity doubtful) in D major (N. bk. 12 p.
83). [517]


30. Fugue (authenticity doubtful) in G minor (N. bk. 2 p.
41).

31. Trio in C minor (N. bk. 12 p. 108).

32. Aria in F major (N. bk. 12 p. 112).

33. Kleinea harmonisches Labyrinth (authenticity doubtful) (P. bk. 2067 p. 16) (not in N.).


[248]

XXXIX. 1889 [1892]. Motetten, Chorle und Lieder. Ed. Franz

Wllner.


(1) Motets:


Motet: *Singet dem Herrn ein neues Lied.
Motet: *Der Geist hilft unsrer Schwachheit auf. [518]


Motet: *Jesu, meine Freude.

Motet: *Frchte dich nicht, ich bin bei dir.

Motet: *Komm, Jesu, komm.

Motet: * Lobet den Herrn, alle Heiden.

Motet: *Ich lasse dich nicht, du segnest mich
denn (by Johann Christoph Bach).

Motet: *Sei Lob und Preis mit Ehren (the second
number, Nun lob' mein' Seel' den Herrn, ofCantata
28).


517 The fugal subject is taken from the Allabreve.
518 Bach's instrumental accompaniments are in the Appendix (p. 143).


326 Johann Sebastian Bach


(2) 185 Chorals harmonised by Bach, from the collection
made by Carl Philipp Emmanuel Bach: [519]


1 (1). Ach bleib' bei uns, Herr Jesu Christ.
2 (2). Ach Gott, erhr' mein Seufzen und Wehklagen.
3 (3). Ach Gott und Herr, wie gross und schwer.
4 (385). Ach lieben Christen, seid getrost (Wo Gott der
Herr nicht bei uns hlt).
5 (388). Wr' Gott nicht mit uns diese Zeit (Wo Gott der
Herr nicht bei uns hlt). [520]

6 (383). Wo Gott der Herr nicht bei uns hlt.
7(10). Ach, was soll ich Snder machen.
8 (12). Allein Gott in der Hh' sei Ehr.
9 (15). Allein zu dir, Herr Jesu Christ.
10 (17). Alle Menschen mssen sterben.

[249] 11 (19). Alles ist an Gottes Segen.
12(20). Als der gtige Gott.
13 (21). Als Jesus Christus in der Nacht.
14 (22). Als vierzig Tag' nach Ostern war'n.
15 (23). An Wassernssen Babylon.
16(24). Auf, auf mein Herz.
17 (30). Aus meines Herzens Grunde.
18 (157). Befiehl du deine Wege (Herzlich thut mich verlangen).
19 (158). Ditto.
20 (32). Befiehl du deine Wege.
21 (33). Christ, der du bist der helle Tag.


519 C. P. E. Bach's collection of his father's Choral settings was published by
Immanuel Breitkopf in four volumes between the years 1784-87. They are all
inoluded in Breitkopf and Haertel's edition (1898) of Bach s Choralgesnge;
the numerals in brackets in the above list indicate the position of each Choral
in that collection. The latter includes also the simple four-part Chorals from
the Oratorios and Cantatas; hence the numeration of that volume and B.G.

XXXIX. is not uniform.
520 The bracket states the title by which the tune is better known.


327


22 (34). Christe, der du bist Tag und Licht.
23 (35). Christe, du Beistand deiner Kreuzgemeinde.
24 (36). Christ ist erstanden.
25 (38). Christ lag in Todesbanden.
26(39). Ditto.
27 (43). Christ, unser Herr, zum Jordan kam.
28 (46). Christus, der ist mein Leben.
29 (47). Ditto.
30 (48). Christus, der uns selig macht.
31 (51). Christus ist erstanden.
32 (52). Da der Herr zu Tische sass.
33 (53). Danket dem Herren, denn er ist sehr freundlich.
34 (54). Dank sei Gott in der Hhe.
35 (55). Das alte Jahr vergangen ist.
36 (56). Ditto.
37 (57). Das walt' Gott Vater und Gott Sohn.
38 (58). Das walt' mein Gott, Vater, Sohn.
39 (59). Den Vater dort oben.
40 (60). Der du bist drei in Einigkeit.
41 (61). Der Tag, der ist so freudenreich.
42 (62). Des heil'gen Geistes reiche Gnad'.
43 (63). Die Nacht ist kommen.
44 (64). Die Sohn' hat sich mit ihrem Glanz.
45 (65). Dies sind die heil'gen zehn Gebot.
46 (67). Dir, dir, Jehovah, will ich singen (Bach's melody).
47 (70). Du grosser Schmerzensmann.
48 (71). Du, 0 schnes Weltgebude.
49 (74). Ein' feste Burg ist unser Gott.
50 (75). Ditto.
51 (77). Eins ist noth, ach Herr, dies Eine.
52 (78). Erbarm' dich mein, 0 Herre Gott.
53 (85). Erstanden ist der heil'ge Christ.
54 (262). Est ist gewisslich an der Zeit (Nun freut euch,
lieben Christen g'mein).


328 Johann Sebastian Bach


55 (92). Es spricht der Unweisen Mund wohl.
56 (93). Es steh'n vor Gottes Throne.
57 (94). Es wird schier der letzte Tag herkommen.
58 (95). Es wol' uns Gott gendig sein.
59 (96). Ditto.
60 (106). Fr Freuden lasst uns springen.
61 (107). Gelobet seist du, Jesu Christ.
62 (111). Gieb dich zufrieden und sei stille (Bach's melody).
63 (112). Gott, der du selber bist das Licht.
64 (113). Gott der Vater wohn' uns bei.
65 (115). Gottes Sohn ist kommen.
66 (116). Gott hat das Evangelium.
67 (117). Gott lebet noch.
68 (118). Gottlob, es geht nunmehr zum Ende.
69 (119). Gott sei gelobet und gebenedeiet.
70 (120). Gott sei uns gndig und barmherzig.
71 (121). Meine Seele erhebet den Herrn.
72 (123a). Heilig, Heilig, Heilig!
73 (129). Herr Gott, dich loben alle wir.
74 (132). Fr deinen Thron tret' ich hiermit (Herr Gott dich
loben alle wir).
75 (133). Herr Gott dich loben wir.
76 (136). Herr, ich denk' an jene Zeit.
77 (137). Herr, ich habe missgehandelt.
78 (138). Ditto.
79 (139). Herr Jesu Christ, dich zu uns wend'.
80 (140). Herr Jesu Christ, du hast bereit't.
81 (141). Herr Jesu Christ, du hchstes Gut.
82 (145). Herr Jesu Christ, mein's Lebens Licht.
83 (146). Herr Jesu Christ, wahr' Mensch und Gott.
84 (148). Herr, nun lass in Friede.
85 (149). Herr, straf' mich nicht in deinem Zorn.
86 (151). Herr, wie du willst, so Schick's mit mir.
87 (152). Herzlich lieb hab' ich dich, 0 Herr.


329


88 (170). Heut' ist, O Mensch, ein grosser Trauertag.
89 (171). Heut' triumphiret Gottes Sohn.
90 (172). Hilf, Gott, dass mir's gelinge.
91 (173). Hilf, Herr Jesu, lass gelingen.
92 (174). Ich bin ja, Herr, in deiner Macht (Bach's melody).
93 (175). Ich dank' dir, Gott, fr all' Wohlthat.
94 (176). Ich dank' dir, lieber Herre.
95 (177). Ditto.
96 (179). Ich dank' dir schon durch deinen Sohn.
97 (180). Ich danke dir, O Gott, in deinem Throne.
98 (182). Ich hab' mein' Sach' Gott heimgestellt.
99 (185). Jesu, der du meine Seele.
100 (186). Ditto.
101 (187). Ditto.
102 (189). Jesu, der du selbst so wohl.
103 (190). Jesu, du mein liebstes Leben.
104 (191). Jesu, Jesu, du bist mein (Bach's melody).
105 (195). Jesu, meine Freude.
106 (363). Jesu, meiner Seelen Wonne (Werde munter, mein
Gemthe).
107 (364). Ditto.
108 (202). Jesu, meines Herzens Freud'.
109 (203). Jesu, nun sei gepreiset.
110 (206). Jesus Christus, unser Heiland, der von uns.
111 (207). Jesus Christus, unser Heiland, der den Tod.
112 (208). Jesus, meine Zuversicht.
113 (210). Ihr Gestirn', ihr hohlen Lfte.
114 (211). In allen meinen Thaten.
115 (215). In dulci jubilo.
116 (217). Keinen hat Gott verlassen.
117 (218). Komm, Gott, Schpfer, heiliger Geist.
118 (225). Kyrie! Gott Vater in Ewigkeit.
119 (226). Lass, O Herr, dein Ohr sich neigen.
120 (228). Liebster Jesu, wir sind hier. [252]


330 Johann Sebastian Bach


121 (232). Lobet den Herren, denn er ist sehr freundlich.
122 (233). Lobt Gott, ihr Christen allzugleich.
123 (234). Ditto.
124 (237). Mach's mit mir, Gott, nach deiner Gt.'
125 (240). Mein' Augen schliess' ich jetzt.
126 (241). Meinen Jesum lass' ich nicht, Jesus.
127 (242). Meinen Jesum lass' ich nicht, weil.
128 (248). Meines Lebens letzte Zeit.
129 (249). Mit Fried' und Freud' ich fahr' dahin.
130 (252). Mitten wir im Leben sind.
131 (253). Nicht so traurig, nicht so sehr (Bach's melody).
132 (254). Nun bitten wir den heiligen Geist.
133 (257). Nun danket Alle Gott.
134 (260). Nun freut euch, Gottes Kinder all.
135 (261). Nun freut euch, lieben Christen g'mein.
136 (269). Nun lob', mein' Seel', den Herren.
137 (270). Ditto.
138 (273). Nun preiset alle Gottes Barmherzigkeit.
139 (298). Nun ruhen alle Wlder (0 Welt, ich muss dich
lassen)
140 (289). 0 Welt, sieh' hier dein Leben (O Welt, ich muss
dich lassen).
141 (290). Ditto.
142 (291). Ditto.
143 (274). Nun sich der Tag geendet hat.
144 (275). O Ewigkeit, du Donnerwort.
145 (277). O Gott, du frommer Gott (1679 tune).
146(282). Ditto (1693 tune).
147 (284). O Herzensangst, O Bangigkeit und Zagen (Bach's
melody).
148 (285). 0 Lamm Gottes, unschuldig.
149 (286). O Mensch, bewein' dein Snde gross.
150 (287). 0 Mensch, schau' Jesum Christum an.
151 (288). 0 Traurigkeit, 0 Herzeleid.


331


152 (299). O wie selig seid ihr doch, ihr Frommen (1649).
153 (300). Ditto (1566).
154 (301). O wir armen Snder.
155 (303). Schaut, ihr Snder.
156(306). Seelenbrutigam, Jesu, Gottes Lamm.
157 (307). Sei gegrsset, Jesu gtig.
158 (309). Singt dem Herrn ein neues Lied.
159 (310). So giebst du nun, mein Jesu, gute Nacht.
160 (311). Sollt' ich meinem Gott nicht singen.
161 (313). Uns ist ein Kindlein heut' gebor'n.
162 (314). Valet will ich dir geben.
163 (316). Vater unser im Himmelreich.
164 (324). Von Gott will ich nicht lassen.
165 (325). Ditto.
166 (326). Ditto.
167 (331). Warum betrbst du dich, mein Herz.
168 (332). Ditto.
169 (334). Warum sollt' ich mich denn grmen.
170 (336). Was betrbst du dich, mein Herze (Bach's
melody).
171 (337). Was bist du doch, 0 Seele, so betrbet.
172 (349). Was willst du dich, 0 meine Seele.
173 (351). Weltlich Ehr' und zeitlich Gut.
174 (352). Wenn ich in Angst und Noth.
175 (353). Wenn mein Stndlein vorhanden ist.
176 (354). Ditto.
177 (355). Ditto.
178 (358). Wenn wir in hchsten Nthen sein.
179 (359). Ditto.
180 (366). Wer Gott vertraut, hat wohlgebaut.
181 (367). Wer nur den lieben Gott lsst walten.
182 (374). Wie bist du, Seele, in mir so gar betrbt.
183 (375). Wie schn leuchtet der Morgenstern.
184 (382). Wir glauben all' an einen Gott, Schpfer.


332 Johann Sebastian Bach


185 (389). Wo Gott zum Haus nicht gibt sein' Gunst.


(3) Seventy-five Chorals harmonised by Bach: [521]


*1 (S). Ach, dass ich nicht die letzte Stunde.
2 (S). Auf, auf! die rechte Zeit ist hier.
3 (S). Auf, auf! mein Herz, mit Freuden.
4 (S). Beglckter Stand getreuer Seelen.
*5 (S). Beschrnkt, ihr Weisen dieser Welt.
6 (S). Brich entzwei, mein armes Herze.
7 (S). Brunnquell aller Gter.
8 (S). Der lieben Sonne Lacht und Pracht.
9 (S). Der Tag ist hin, die Sonne gehet nieder.
10 (S). Der Tag mit seinem Lichte.
*11 (S). Dich bet' ich an, mein hchster Gott.
12 (S). Die bitt're Leidenszeit beginnet.
13 (S). Die gold'ne Sonne, voll Freud' und Wonne.
*14 (S). Dir, dir, Jehova, will ich singen.
*15 (S). Eins ist noth, ach Herr, dies Eine.
16 (S). Ermuntre dich, mein schwacher Geist.
17 (S). Erwrgtes Lamm, das die verwahrten Siegel.
18 (S). Es glnzet der Christen inwendiges Leben.
19 (S). Es ist nun aus mit meinem Leben.
20 (S). Es ist vollbracht! Vergiss ja nicht dies Wort.
21 (S). Es kostet viel, ein Christ zu sein.
*22. Gieb dich zufrieden und sei stille (erste Composition).


521 The Chorals are taken from two sources, Anna Magdalena Bach's
Notenbuch (1726; see B.G. XLIII. (2)), and Schemelli's Musicalisches
Gesang-Buch (1736), of which Bach was the musical editor. The latter
contains sixty-nine melodies (with figured bass), the former seven: one melody
(No. 14) is in both collections. The Schemelli tunes are indicated by an S
within a bracket after the numeral. One melody (No. 71) is indubitably by Bach
himself. It, and others, which may be attributed to him on good evidence, are
marked by an asterisk. The seventy-five settings are published in practicable
form by the N.B.G. I. (1) and I. (2).


333


*23. Ditto. (zweite Composition). [522]

24 (S). Ditto. (dritte Composition).
25 (S). Gott lebet noch! Seele, was verzagst du doch?
*26 (S). Gott, wie gross ist deine Gte.
27 (S). Herr, nicht schricke deine Rache.
*28 (S). Ich bin ja, Herr, in deiner Macht.
29 (S). Ich freue mich in dir.
*30 (S). Ich halte treulich still.
31 (S). Ich lass' dich nicht.
32 (S). Ich liebe Jesum alle Stund'. [255]
*33 (8). Ich steh' an deiner Krippen hier.
*34 (8). Jesu, Jesu, du bist mein.
35 (S). Jesu, deine Liebeswunden.
36 (8). Jesu, meines Glaubens Zier.
37 (8). Jesu, meines Herzens Freud'.
38 (8). Jesus ist das schnste Licht.
39 (8). Jesus, unser Trost und Leben.
40 (8). Ihr Gestirn', ihr hohlen Lfte.
41 (8). Kein Stndlein geht dahin.
*42 (8). Komm, ssser Tod, komm, sel'ge Ruh'!
*43 (8). Kommt, Seelen, dieser Tag.
*44 (8). Kommt wieder aus der finst'ren Gruft.
46 (8). Lasset uns mit Jesu ziehen.
46 (S). Liebes Herz, bedenke doch.
47 (8). Liebster Gott, wann werd' ioh sterben.
*48 (S). Liebeter Herr Jesu, wo bleibst du so lange.
49 (S). Laebster Immanuel.
60 (S). Mein Jesu, dem die Seraphinen.
*61 (S). Mein Jesu, was fr Seelenweh.
62 (S). Meines Lebens letzte Zeit.
*63 (S). Nicht so traurig, nicht so sehr.
64 (S). Nur mein Jesus 1st mein Leben.


522 Nos. 22 and 23 are the same tune.


334 Johann Sebastian Bach


66 (S). O du Liebe, meiner Liebe.

66. O Ewigkeit, du Donnerwort.
*67 (S). O finst're Nacht, wann wirst du doch vergehen.
68 (S). O Jesulein sss, O Jesulein mild.

*69 (S). O liebe Seele, zieh' die Sinnen.

60 (8). O wie selig seid ihr doch.
*61. Schaffs mit mir, Gott, naoh deinem Willen.

62 (8). Seelenbrutigam, Jesu, Gottes Lamm.
63 (8). Seelenweide, meine Freude.

64 (S). Selig, wer an Jesum denkt.
66 (8). Sei gegrsset, Jesu gtig.
66 (8). So gehest du nun, mein Jesu, hin.
67 (8). So giebst du nun, mein Jesu, gute Nacht.
68 (8). So wnsch' ich mir zu guter Letzt.
69 (S). Steh' ioh bei meinein Gott.

[256] 70 (8). Vergiss mein nioht, date ich dein nicht vergesse.
*71 (S). Vergiss mein nicht, mein allerliebster Gott.
*72. Warum betrbst du dich und beugest.
73 (S). Was bist du doch, 0 Seele, so betrbet.

*74. Wie wohl ist mir, 0 Freund der Seelen.
75 (S). Wo ist mein Schflein, das ich liebe. [523]


(4) Five Arias from Anna Magdalena Bach's Notenbuch
(1725)" [524]


*1. So oft ich meine Tabakspfeife.

*2. Bist bu bei mir.

*3. Gedenke doch, mein Geist, zurcke.

4. Gieb dich zufrieden und sei stille.


523 For a discussion of Bach's original hymn-tunes see the present writer's
Bach's Chorals, Part II. Introduction, pp. 67 ff. Six more of Bach's original
hymn-tunes are printed there.
524 The first three Arias are published by Novello, and also by the N.B.G. I.
(1).


335


5. Willst du dein Herz mir schenken (Aria di Giovannini).


XL. 1890 [1893]. Orgelwerke. Vierter Band. Ed. Ernst

Naumann.


(1) Choral Preludes, from Kirnberger's collection. [525]


1. Wer nur den lieben Gott lsst walten (N. bk. 19
p. 21).
2. Ditto (N. bk. 19 p. 22).
3. Ach Gott und Herr (N. bk. 18 p. 1).
4. Ditto (N. bk. 18 p. 2).
5. Wo soll ich fliehen hin (N. bk. 19 p. 32).
6. Christ lag in Todesbanden (Fantasia) (N. bk. 18
p. 16).
7. Christum wir sollen loben schon, _or_, Was frcht'st
du, Feind Herodes, sehr (N. bk. 18 p. 23).
8. Gelobet seist du, Jesu Christ (Fughetta) (N. bk.
18 p. 38).
9. Herr Christ, der ein'ge Gottes-Sohn (Fughetta) (N.
bk. 18 p. 43).
10. Nun komm der Heiden Heiland (Fughetta) (N.bk.
18 p. 83).
11. Vom Himmel hoch da komm ich her (N. bk. 19
p. 16).
12. Ditto. (Fughetta) (N. bk. 19 p. 14).
13. Das Jesulein soll doch mein Trost (Fughetta) (N.
bk. 18 p. 24).
14. Gottes Sohn ist kommen (Fughetta) (N. bk. 18 p.
41).
15. Lob sei dem allmchtigen Gott (Fughetta) (N. bk.
18 p. 73).


525 In the Royal Library, Berlin. Kirnberger was a pupil of Bach. See section
on Variants infra.


336 Johann Sebastian Bach


16. Durch Adams Fall ist ganz verderbt (N. bk. 18 p.
28).
17. Liebster Jesu wir sind hier (N. bk. 18 p. 72a).
18. Ditto. (N. bk. 18 p. 72b).
19. Ich hab' mein' Sach' Gott hergestellt (N. bk. 18 p.
54) [526]

20. Ditto. (N. bk. 18 p. 58a).
21. Herr Jesu Christ, dich zu uns wend' (N. bk. 18 p.
50).
22. Wir Christenleut' (N. bk. 19 p. 28b). [527]

23. Allein Gott in der Hh' sei Ehr (Bicinium) (N. bk.
18 p. 5).
24. In dich hab' ich gehoffet, Herr (N. bk. 18 p. 59).
25. Jesu, meine Freude (Fantasia) (N. bk. 18 p. 64).


(2) Twenty-eight other Choral Preludes [528]


1. Ach Gott und Herr (Canon) (N. bk. 18 p. 3).
2. Allein Gott in der Hh' sei Ehr' (N. bk. 18 p. 4).
3. Ditto. (Fuga) (N. bk. 18 p. 7).
4. Ditto. (N. bk. 18 p. 11).
5. An Wasserflssen Babylon (N. bk. 18 p. 13).
6. Christ lag in Todesbanden (N. bk. 18 p. 19).
7. Der Tag der ist so freudenreich (N. bk. 18 p. 26).
8. Ein' feste Burg ist unser Gott (N. bk. 18 p. 30).
9. Erbarm' dich mein, 0 Herre Gott (N. bk. 18 p. 35).

[258] 10. Gelobet seist du, Jesu Christ (N. bk. 18 p. 37).
11. Gelobet seist du, Jesu Christ (N. bk. 18 p. 39).
12. Gottes Sohn ist kommen (N. bk. 18 p. 42).
13. Herr Gott, dich loben wir (N. bk. 18 p. 44).
14. Herr Jesu Christ, dich zu uns wend' (N. bk. 18 p.
52).


526 Novello omits the concluding four-part Choral.
527 The Prelude is also attributed to J. L. Krebs, a pupil of Bach.
528 See section on Variants infra.:


337


15. Herzlich thut mich verlangen (N. bk. 18 p. 53).
16. Jesus, meine Zuversicht (N. bk. 18 p. 69).
17. In dulci jubilo (N. bk. 18 p. 61).
18. Liebster Jesu, wir sind hier (N. bk. 18 p. 70).
19. Ditto. (N. bk. 18 p. 71).
20. Lobt Gott, ihr Christen allzugleich (N. bk. 18 p.
74).
21. Meine Seele erhebt den Herren (Magnificat)
(Fuga) (N. bk. 18 p. 75).
22. Nun freut euch, lieben Christen g'mein, _or_, Es ist
gewisslich an der Zeit (N. bk. 18 p. 80).
23. Valet will ich dir geben (Fantasia) (N. bk. 19 p.
2).
24. Ditto. (N. bk. 19 p. 7).
25. Vaterunser im Himmelreich (N. bk. 19 p. 12).
26. Vom Himmel hoch da komm ich her (N. bk. 19
p. 19).
27. Wie schn leuchtet der Morgenstern (N. bk. 19 p.
23).
28. Wir glauben all' an einen Gott (N. bk. 19 p. 30).


(3) Choral Variations:


1. Christ, der du bist der helle Tag (N. bk. 19 p. 36).
2. 0 Gott, du frommer Gott (N. bk. 19 p. 44).
3. Sei gegrsset, Jesu gtig (N. bk. 19 p. 55).
4. Vom Himmel hoch da komm ich her (N. bk. 19
p. 73).


(4) Variant texts and fragments:


1. Variant of Kirnberger's No. 2 (P. bk. 244 p. 111).
2. Variant of Kirnberger's No. 3 (not in N. or P.).
3. Ich hab' mein' Sach' Gott heimgestellt (N. bk. 18
p. 58b).
4. Variant of Kirnberger's No. 6 (P. bk. 245 p. 104).


338 Johann Sebastian Bach


5. Variant of Kirnberger's No. 25 (P. bk. 245 p.
110).

6. Variant of No. 10 of the Twenty-eight supra (not

[259] in N. or P.).

7. Variant of No. 17 (not in N. or P.).

8. Variant of No. 20 (not in N. or P.).

9. Variant of No. 26 (not in N. or P.).

10. Variant of No. 22 (P. bk. 246 p. 91).

11. Variant of No. 23 (P. bk. 246 p. 100).

12. Jesu, meine Freude (fragment) (P. bk. 244 p.
112).

13. Wie schn leuchtet der Morgenstern (fragment)
(not in N. or P.).


(5) Choral Preludes and Variations of faulty text or doubtful authenticity:


1. Ach Gott vom Himmel sieh' darein (P. bk. 2067
p.44).

2. Auf meinen lieben Gott (P. bk. 2067 p. 39).

3. Aus der Tiefe rufe ich (P. bk. 2067 p. 64).

4. Christ ist erstanden (not in N. or P.).

5. Christ lag in Todesbanden (P. bk. 2067 p. 56).

6. Gott der Vater wohn' uns bei (P. bk. 245 p. 62)
(by J. G. Walther). [529]


7. O Vater, allmchtiger Gott (not in N. or P.).

8. Schmcke dich, O liebe Seele (not in N. or P.)
(also attributed to G. A. Homilius).

9. Vater unser im Himmelreich (not in N. or P.) (also
attributed to G. Bhm).

10. Ditto.


529 Variant, P. bk. 245 p. 106.


339


11. Wir glauben all' an einen Gott, Schpfer (P. bk.
2067 p. 40). [530]

12. Variations on Ach, was soll ich Snder machen
(not in N. or P.).
13. Variations on Allein Gott in der Hh' sei Ehr' (not
in N. or P.).


(6) Addendum to B.G. III.:


Allein Gott in der Hh' sei Ehr' (an early version
of N. bk. 16 p. 40*) (P. bk. 245 p. 96).

[260]
XLI. 1891 [1894]. Kirchenmusikwerke. Erganzungsband. Ed.
Alfred Dffel.


Cantata No. 191: Gloria in excelsis (the B minor Mass
Gloria).
Cantata No. 192: Nun danket Alle Gott (incomplete).
Cantata No.193: Ihr Pforten zu Zion (incomplete).
Ehre sei Gott in der Hone (incomplete).
Wedding Cantata: O ewiges Feuer, O Ursprung der
Liebe (incomplete).
Wedding Cantata: Herr Gott, Beherrscher aller Dinge
(incomplete).
Sanctus in D major.
Kyrie eleison (Christe, du Lamm Gottes).
Christe eleison (Johann Ludwig Bach).
Jesum lass' ich nicht von mir (the original concluding
Choral of the first Part of the St. Matthew Passion

(Breitkopf and Haertel's Choralgesange, No. 247).
Four Cantatas of doubtful authenticity:


Gedenke, Herr, wie es uns gehet.
Gott der Hoffnung erfulle euch.


530 Ernst Naumann remarks, Das Stck kann recht gut von Seb. Baoh
herrhren. The text is complete, and the omission of the Prelude from the
Novello edition is to be regretted.


340 Johann Sebastian Bach


Siehe, es hat iiberwunden der Lowe.

Lobt ihn mit Herz und Munde.


XLII. 1892 [1894]. Clavierwerke. Funfter Band. Ed. Ernst

Naumann.


Sonata in D minor (P. bk. 213 p. 24). [531]

Suite in E major (not in P.). [532]

Adagio in G major (P. bk. 213 p. 1). [533]

Sonata in A minor (P. bk. 213 p. 2). [534]

Sonata in C major (P. bk. 213 p. 16). [535]

[261] Fugue in B flat major (P. bk. 1959 p. 75). [536]
Fugue in B flat major (P. bk. 1959 p. 90). [537]

Sixteen Concertos after Antonio Vivaldi (P. bk.
217). [538]

Fifteen Compositions of probable authenticity :


1. Prelude and Fugue in A minor (P. bk. 1959 p. 84).
2. Fantasia and Fugue in D minor (P. bk. 1959 p.
80).
3. Fantasia in G minor (P. bk. 1959 p. 94).
4. Concerto and Fugue in C minor (not in P.).
5. Fugato in E minor (P. bk. 1959 p. 24).
6. Fugue in E minor (P. bk. 1959 p. 72).


531 A transcription of the second Sonata for Solo Violin, in A minor, See B.G.
XXVII. (1).
532 A transcription of the third Partita, in E major, for Solo Violin. See ibid.
533 From the third Sonata for Solo Violin, in C major. See ibid.
534 Both Sonatas are arrangements of instrumental Sonatas in J. A. Reinken's
Hortus Musicus. See Spitta, i. 430.
535 Both Sonatas are arrangements of instrumental Sonatas in J. A. Reinken's
Hortus Musicus. See Spitta, i. 430.
536 After a Sonata movement by J. A. Reinken.
537 After a Fugue by J. C. Erselius. The original is given in Anhang II. of the
volume.
538 Only Nos. 1, 2, 4, 5, 7, 9, 14 are derived from Vivaldi. The others are
founded on Benedetto Marcello (No. 3), Duke Johann Ernst of Weimar (Nos.
11, 16, and perhaps 13).


341


7. Fugue in G major (P. bk. 1959 p. 68).
8. Fugue in A minor (not in P.).
9. Fugue in A minor (not in P.).
10. Prelude in B minor (and Variant) (not in P.).
11. Suite in B flat major (P. bk. 1959 p. 54).
12. Andante in G minor (P. bk. 1959 p. 63).
13. Scherzo in D minor (and Variant) (P. bk. 1959 p.
62).
14. Sarabande con Partite in C major (P. bk. 1959 p.
26).
15. Passacaglia in D minor (P. bk. 1959 p. 40).


Ten Compositions of doubtful authenticity :


1. Fantasia in C minor (not in P.).
2. Toccata quasi Fantasia con Fuga in A major (not
in P.). [539]

3. Partie in A major (not in P.).
4. Allemande in C minor (not in P.).
5. Gigue in F minor (not in P.).
6. Allemande and Courante in A major (not in P.).
7. Allemande in A minor (not in P.).
8. Fantasia and Fughetta in B flat major (P. bk. 212
p. 58).
9. Do. D major (P. bk. 212 p. 60).
10. Fugue (unfinished) in E minor (not in P.).


Concerto in G major by Antonio Vivaldi (original of
the second Clavier Concerto supra). [540]

[262]
XLIII(l). 1893 [1894]. Kammermusik. Achter Band. Ed. Paul Graf

Waldersee.


Three Sonatas for Flute and Clavier:


539 The Toccata is by Henry Purcell. See Grove, vol. iii. p. 857.
540 The volume also contains a Variant of the first Organ Concerto (B.G.
XXXVIII.).


342 Johann Sebastian Bach


1. In C major (P. bk. 235 p. 33).
2. In E minor (ib. p. 39).
3. In E major (ib. p. 51).


Sonata in E minor, for Violin and Clavier (P. bk. 236).
Fugue in G minor for Violin and Clavier (P. bk. 236).
Sonata in F major for two Claviers (by Wilhelm Friedemann Bach).

Concerto in A minor for four Claviers and Orchestra
(Strings) (P. bk. 260 p. 3). [541]


XLIII (2). 1893 [1894]. Musikstcke in den Notenbchen der Anna
Magdalena Bach. Ed. Paul Graf Waldersee.


(1) The Notebook of the year 1722 contains:


1. The French Suites (incomplete) (see B.G. an. (2)).
2. Fantasia in C major for the Organ (see B.G.
XXXVIII. No. 25).
3. Air (unfinished) in C minor (not in P.).
4. Choral Prelude, ' Jesus, meine Zuversicht' (see
B.G. XL. sec. 2 No. 16).
5. Minuet in G major (see B.G. xxxvi. and P. bk.
215 p. 62).


(2) The Notebook of the year 1725 contains: [542]


1. Partita III. (A minor) from the Clavierbung,
Part I. (see B.G. III.).
2. Partita VI. (E minor) from the same (see B.G.
III.).
3 (P). Minuet in F major.


541 The Concerto is an arrangement of one by Antonio Vivaldi for four Violins,
the original of which (in B minor) is given in the Appendix to the volume.
542 Omitting the vocal numbers, movements printed elsewhere, and the
Menuet fait par Mons. Bhm, Peters' Bk. 1959 contains the remaining
twenty numbers of the Notebook. They are indicated in the above index by a P
in a bracket.


343


4 (P). Minuet in G major.
5 (P). Minuet in G minor. [263]
6 (P). Rondeau in B flat major (by Couperin).
7 (P). Minuet in G major.
8 (P). Polonaise in F major (two versions).
9 (P). Minuet in B flat major.
10 (P). Polonaise in G minor.
11. Choral Prelude, Wer nur den lieben Gott lsst
alten (see B.G. XL., Kirnberger's Collection, no.
2).
12. Choral, Gieb dich zufrieden und sei stille see
B.G. XXXIX. see. 4 no. 4).
13. Aria, Gieb dich zufrieden un sei stille (see B.G.
XXXIX. sec. 2 no. 62).
14 (P). Minuet in A minor.
15 (P). Do. C minor.
16 (P). March in D major.
17 (P). Polonaise in G minor.
18 (P). March in A major.
19 (P). Polonaise in G minor.
20. Aria, So oft ich meine Tabakspfeife (see B.G.
XXXIX. sec. 4 no. 1).
21. Minuet in G major, fait par Mns. Bhm.
22 (P). Musette in D major.
23 (P). March in E flat major.
24 (P). Polonaise in D minor.
25. Aria, Bist du bei mir (see B.G. XXIX. sec. 4
no. 2).
26. Aria in G major (the Aria of the Goldberg Variations. See B.G. III.).
27 (P). Solo per il Cembalo in E flat major.
28 (P). Polonaise in G major.
29. Prelude in C major (Prelude i. of the first Part of
the Well-tempered Clavier. See B.G. XIV.).


344 Johann Sebastian Bach


30. Suite in D minor (the first of the French Suites.
See B.G. XIII (2)).
31. Suite in C minor (the first three movements of the
second French Suite. See B.G. XIII (2)).

[264] 32. Choral (wordless) in F. major.
33. Aria, Warum betrbst du dich (see B.G.
XXXIX. sec. 3 no. 72).
34. Recitativo and Aria, Ich habe genug, and
Schlummert ein, for Basso (from Cantata 82,
nos. 2 and 3), transposed.
35. Aria, Schaff's mit mir, Gott, nach deinem
Willen (see B.G. xxxrx. sec. 3 no. 61).
36 (P). Minuet in D minor.
37. Aria, Willst du dein Herz mir schenken (di
Giovannini) (see B.G. XXXIX. sec. 4 no. 5).
38. Aria, No. 34 supra.
39. Choral, Dir, dir Jehovah, will ich singen (see
B.G. XXXIX. sec. 2 no. 46).
40. Aria, Wie wohl ist mir, 0 Freund der Seelen
(see B.G. XXXIX. sec. 3 no. 74).
41. Aria, Gedenke doch, mein Geist, zurticke (see
B.G. XXXIX. sec. 4 no. 3).
42. Choral, O Ewigkeit, du Donnerwort (see B.G.
XXXIX. sec. 2 no. 144).


XLIV. 1894 [1895]. Handschrift in zeitlich geordneten Nachbildungen. Ed. Hermann Kretzschmar. Contains facsimiles of
Bach's handwriting and autograph MSS.
XLV(1). 1895 [1897]. Clavierwerke. Zweiter Band (neue berichtigte
Ausgabe). Ed. Alfred Dffel. [543]


The Six English Suites (see B.G. XIII. (2)). (P. bks.
2794, 2795.)


543 A separate Preface to the reprinted Suites is by Ernst Naumann. It is dated
1895.


345


The Six French Suites (see B.G. XIII. (2)). (P. bk.
2793.)
Five Canons in 4, 6, 7, 8 parts.
Prelude and Fugue in E flat major (P. bk. 214 p. 40).
Suite in E minor (P. bk. 214 p. 68).
Suite in C minor (not in P.).
Sonata (first movement) in A minor (not in P.). [544] [265]
Four Inventions, in B minor, B flat major, C minor, D
major, for Violin and Clavier (P. bk. 2957).
Overture in G minor for Strings and Clavier (not in P.).

The Clavier-Bchlein of Wilhelm Friedemann Bach

contains:


1. Applicatio in C major (see B.G. XXXVI. no. 48).
2. Prelude in C major (the first of the Twelve Little
Preludes) (see B.G. XXXVI. no. 19).
3. Choral Prelude, Wer nur den lieben Gott lsst
walten (see B.G. XL., Kirnberger's Collection,
no. 2).
4. Prelude in D minor (the fifth of the Little Preludes)
(see B.G. XXXVI. no. 19).
5. Choral Prelude, Jesu meine Freude (fragment)
(see B.G. XL. sec 4 no. 12).
6. Allemande in G minor (not in P.).
7. Allemande (fragment) in G minor (not in P.).
8. Prelude in F major (the eighth of the Little Preludes) (see B.G. XXXVI. no. 19).
9. Prelude in G minor (the eleventh of the Little
Preludes) (see B.G. XXXVI. no. 19).
10. Prelude in F major (the ninth of the Little Preludes)
(see B.G. XXXVI. no. 19).
11. Minuet in G major (the first of the three Minuets)
(see B.G. XXXVI. no. 43).


544 Perhaps an arrangement of an orchestral piece. See Schweitzer, i. 342 n.


346 Johann Sebastian Bach


12. Minuet in G minor (the second of the three Minuets) (see B.G. XXXVI. no. 43).
13. Minuet in G major (the third of the three Minuets)
(see B.G. XXXVI. no. 43).
14. Prelude in C major (the first Prelude of the first
Part of the Well-tempered Clavier. See B.G.
XIV.).
15. Do. C minor (the second Prelude of the first Part
of the same. See B.G. XIV.).
16. Do. D minor (the sixth Prelude of the first Part of
the same. See B.G. XIV.).
17. Do. D major (the fifth Prelude of the first Part of

[266] the same. See B.G. XIV.).
18. Prelude in E minor (the tenth Prelude of the first
Part of the same. See B.G. XIV.).
19. Prelude in E major (the ninth Prelude of the first
Part of the same. See B.G. XIV.).
20. Prelude in F major (the eleventh Prelude of the
first Part of the same. See B.G. XIV.).
21. Prelude in C sharp major (the third Prelude of the
first Part of the same. See B.G. XIV.).
22. Prelude in C sharp minor (the fourth Prelude of
the first Part of the same. See B.G. XIV.).
23. Prelude in E flat minor (the eighth Prelude of the
first Part of the same. See B.G. XIV.).
24. Prelude in F minor (the twelfth Prelude of the first
Part of the same. See B.G. XIV.)
25. Allemande and Courante in C major, by J. C.
Richter.

26. Prelude in C major (first of the Little Preludes.
See B.G. XXXVI. no. 19).
27. Prelude in D major (fourth of the Little Preludes.
See B.G. XXXVI. no. 19).
28. Prelude in E minor (see B.G. xxxvi. no. 50).


347


29. Prelude in A minor (B.G. xxxvi. no. 49).
30. Prelude in G minor (not in P.).
31. Fugue in C major (see B.G. xxxvi. no. 38).
32. Prelude in C major (Invention i. See B.G. m.).
33. Prelude in D minor (Invention iv. See B.G. m.).
34. Prelude in E minor (Invention vii. See B.G. m.).
35. Prelude in F major (Invention viii. See B.G. m.).
36. Prelude in G major (Invention x. See B.G. in.).
37. Prelude in A minor (Invention xiii. See B.G. m.).
38. Prelude in B minor (Invention xv. See B.G. m.).
39. Prelude in B flat major (Invention xiv. See B.G.
III.).
40. Prelude in A major (Invention xii. See B.G. III.).
41. Prelude in G minor (Invention xi. See B.G. III.).
42. Prelude in F minor (Invention ix. See B.G. III.).
43. Prelude in E major (Invention vi. See B.G. III.).
44. Prelude in E flat major (Invention v. See B.G.
III.).
45. Prelude in D major (Invention iii. See B.G. III.).
46. Prelude in C minor (Invention ii. See B.G. III.).
47. Suite in A major (fragment) (see B.G. XXXVI.
no. 45).
48. Partita in G minor by Steltzel, including a Minuet
Trio by J. S. B. (Minuet in P. bk. 1959 p. 8).
49. Fantasia in C major (Sinfonia i. See B.G. III.).
50. Fantasia inD minor (Sinfonia iv. See B.G. III.).
51. Fantasia in E minor (Sinfonia vii. See B.G. III.).
52. Fantasia in F major (Sinfonia viii. See B.G. III.).
53. Fantasia in G major (Sinfonia x. See B.G. III.).
54. Fantasia in A minor (Sinfonia xiii. See B.G. III.).
55. Fantasia in B minor (Sinfonia xv. See B.G. III.).
56. Fantasia in B flat major (Sinfonia xiv. See B.G.
III.).
57. Fantasia in A major (Sinfonia xii. See B.G. III.).


348 Johann Sebastian Bach


58. Fantasia in G minor (Sinfonia xi. See B.G. III.).
59. Fantasia in F minor (Sinfonia ix. See B.G. III.).
60. Fantasia in E major (Sinfonia vi. See B.G. III.).
61. Fantasia in E flat major (Sinfonia v. See B.G.
III.).
62. Fantasia in D major (Sinfonia iii. See B.G. III.). [545]


XLV (2). 1895 [1898]. Passionsmusik nach dem Evangelisten Lucas.
Ed. Alfred Dffel.

Though the Score is in Bach's autograph, the work is
generally held not to be his.
XLVI. 1896 [1899]. [546] Schlussband. Bericht und Verzeichnisse.

Ed. Hermann Kretzschmar.

The volume contains:


Historical retrospect of the Society and its activities.
Thematic Index to Cantatas 121-191 (see B.G. XXVII
(2)), unfinished Cantatas, Cantatas of doubtful authenticity, Christmas Oratorio, Easter Oratorio, St.
Matthew Passion, St. John Passion, St. Luke Passion,
Mass in B minor, the four Masses in F major, A major,
G minor, G major, the four Sanctus in C major, D
major, D minor, G major, Magnificat in D major, the
Trauer-Ode Wedding Cantatas and Chorals, Motets,
Secular Cantatas (P. bk. 270b).
Alphabetical Index of the movements throughout the
vocal works.

Thematic Index to the Clavier music.

Thematic Index to the Chamber music.

Thematic Index to the Orchestral music.


545 The Appendix to the volume contains addenda to the Violin Concerto in
A minor (see B.G. XXL. (1)) and Cantata 188 (see B.G. XXXVII.). Also the
Zurich and London texts of the Welltempered Clavier (B.G. XIV.), with
critical notes.
546 The Preface is dated 1899. The volume was issued in 1900.


349


Thematic Index to the Organ music.
Thematic Index to the Musikalisches Opfer.
Thematic Index to the Kunst der Fuge
Index to the several movements throughout the instrumental works.

Index of names and places occurring in the Prefaces of
the B.G. volumes.

Bach's vocal and instrumental works arranged (1) in
the order of the yearly volumes, (2) in groups.

### (B) PUBLICATIONS OF THE NEW BACHGESELLSCHAFT


1(1). 1901. Lieder und Arien. Fur eine Singstimme mit Pianoforte
(Orgel oder Harmonium). Ed. Ernst Naumann
The seventy-eight Songs are those contained in B.G.
XXXIX. secs. 3 and 4 (first three only) supra.
I (2). 1901. Lieder und Arien. Furvierstimmigen gemischten
Chor. Ed. Franz Wllner.

The seventy-five Songs are those contained in I (1), omitting
those in sec. 4 of B.G. XXXIX. supra.
1(3). 1901. Erstes deutsches Bach-Fest in Berlin 21 bis 23 Marz

1901. Festschrift.

The frontispiece is Carl Seffner's bust of Bach.
II (1). 1902. Orgelbchlein. 46 krzere Choralbearbeitungen fr
Klavier zu vier Handen. Ed. Bernhard Fr. Richter.

The original forty-six Organ Preludes, here arranged for
two pianofortes (see B.G. XXV (2), sec. 1).
II(2). 1902. Kirchen-Kantaten. Klavierauszug. Erstes Heft. Ed.
Gustav Schreck and Ernst Naumann.

Contains Breitkopf and Haertel's vocal scores of


350 Johann Sebastian Bach


Cantata 61: Nun komm, der Heiden Heiland.

Cantata 64: Sehet, welch' eine Liebe.

Cantata 28: Gottlob! nun geht das Jahr zu Ende.

Cantata 65: Sie werden aus Saba Alle kommen.

Cantata 4: Christ lag in Todesbanden.


III (1). 1903. Kirchen-Kantaten. Klavierauszug. Zweites Heft. Ed.

Ernst Naumann.

Contains Breitkopf and Haertel's vocal scores of


Cantata 104: Du Hirte Israel, hre.

Cantata 11: Lobet Gott in seinen Reichen.

Cantata 34: O ewiges Feuer.
Cantata 45: Es ist dir gesagt.
Cantata 80: Bin' feste Burg.


III(2). 1903. Drei Sonaten fr Klavier und Violine. Ed. Ernst

Naumann.


Sonata I. in B minor.

Sonata II. in A major. (See B.G. IX.)
Sonata III. in E major.)


IV (1). 1904. Drei Sonaten fr Klavier und Violine. Ed. Ernst

Naumann.


Sonata IV. in C minor.

Sonata V. in F minor (See BG. IX)
Sonata VI. in G major.


IV (2). 1904. Joh. Seb. Bach, Bildnis in Heliogravure.
A print of the portrait discovered by Dr. Fritz Volbach
reproduced at p. 92 of this present volume.
IV (3). 1904. Zweites deutsches Bach-Fest in Leipzig 1 bis 3
Oktober 1904. Festschrift.

V (1). 1905. Fest-Gottesdienst zum deutschen Bachfeste in der
Thomaskirche zu Leipzig. Ed. Georg Rietschel.


351


Contains the order of service and music sung on the
occasion.

V (2). 1905. Ausgewahlte Arien und Duette mit einem obligaten
Instrument und Klavier- oder Orgelbegleitung.
I Abteilung: Arien fr Sopran Ed. Eusebius Mandyczewski.


1. Auch mit gedmpften schwachen Stimmen (Cantata
36: Violin).
2. Die Armen will der Herr unarmen (Cantata 186: Violin).
3. Es halt' es mit der blinden Welt (Cantata 94: Oboe
d'amore).
4. Gerechter Gott, ach, rechnest du (Cantata 89 : Oboe).
5. Gott versorget alles Leben (Cantata 187 : Oboe).
6. Hochster, was ich habe, ist nur deine Gabe (Cantata
39: Flauto).
7. Hrt, ihr Augen, auf zu weinen (Cantata 98 : Oboe).
8. Ich bin vergngt in meinem Leiden (Cantata 58: Violin).
9. Ich ende behende mein irdisches Leben (Cantata 57:
Violin).
10. Ich nehme mein Leiden mit Freuden auf mich (Cantata
75: Oboe d'amore).
11. Ich will auf den Herren schau'n (Cantata 93: Oboe).
12. Seufzer, Thranen, Kummer, Noth (Cantata 21 : Oboe).

[271]
V(3). 1905. Bach-Jahrbuch 1904. Herausgegeben von der Neuen
Bachgesellschaft.

In addition to sermons and addresses on the occasion of

the second Bach Festival at Leipzig in 1904, the volume
contains the following articles:


1. Bach und der evangelische Gottesdienst. By Karl
Greulich.

2. Praktische Bearbeitungen Bachscher Kompositionen.
By Max Seiffert.


352 Johann Sebastian Bach


3. Bachs Rezitativbehandlung mit besonderer Berck
sichtigung der Passionen. By Alfred Heuss.
4. Verschwundene Traditionen des Bachzeit alters. By
Arnold Schering.


VI (1). 1906. Ausgewahlte Arien und Duette mit einem obligaten
Instrument und Klavier- oder Orgelbegleitung. II Abteilung:
Arien fr Alt. Ed. Eusebius Mandyczewski.


1. Ach, bleibe doch, mein liebstes Leben (Cantata 11:
Violin).
2. Ach, es bleibt in meiner Liebe (Cantata 77: Tromba).
3. Ach Herr! was ist ein Menschenkind (Cantata 110:
Oboe d'amore).
4. Ach, unaussprechlich ist die Noth (Cantata 116: Oboe
d'amore).
5. Christen mssen auf der Erden (Cantata 44: Oboe).
6. Christi Glieder, ach, bedenket (Cantata 132: Violin).
7. Es kommt ein Tag (Cantata 136: Oboe d'amore).
8. Gelobet sei der Herr, mein Gott (Cantata 129: Oboe
d'amore).
9. Ich will doch wohl Rosen brechen (Cantata 86: Violin).
10. Jesus macht mich geistlich reich (Cantata 75: Violin).
11. Kein Arzt ist ausser dir zu finden (Cantata 103: Flauto).
12. Was Gott thut, das ist wohlgethan (Cantata 100: Oboe
d'amore).

[272]
VI (2). 1906. Ausgewahlte Arien und Duette mit einem obligaten Instrument und Klavier- odor Orgelbegleitung. III
Abteilung: Duette fr Sopran und Alt. Ed. Eusebius
Mandyczewski.


1. Die Armuth, so Gott auf sich nimmt (Cantata 91:
Violin).
2. Wenn Sorgen auf mich dringen (Cantata 3: Violin or
Oboe d'amore).


353


3. Er kennt die rechten Freudenstunden (Cantata 93: Violin).


VI (3). 1906. Bach-Jahrbuch 1905. Herausgegeben von der Neuen
Bachgesellschaft.
Contains the following articles:


1. Johann Sebastian Bachs Kapelle zu Cthen und deren
nachgelassene Instrumente. By Rudolf Bunge.
2. Geleitwort. By Arnold Sobering.
3. Die Wahl Joh. Seb. Bachs zum Kantor der

Thomaschule i. J. 1723. By Bernhard Fr. Richter.
4. Ein' feste Burg ist unser Gott. Kantata von Joh. Seb.
Bach. By Fritz Volbach.
5. Verzeichnis der bisher erschienenen Literatur ber

Johann Sebastian Bach. By Max Schneider.
6. Reviews of books.


VII (1). 1907. Kantate No. 88: Siehe, ich will viel Fischer

aussenden. Partitur. Ed. Max Seiffert.

VII (2). 1907. Kantate No. 88: Siehe, ich will viel Fischer
aussenden. Klavierauszug mit Text. Ed. Max Seiffert und
Otto Taubmann.

VII (3). 1907. Bach-Jahrbuch 1906. Herausgegeben von der Neuen
Bachgesellschaft.
Contains the following articles:


1. Erfahrungen und Ratschlger bezglich der Auffhrung Bachscher Kirchenkantaten. By Wilhelm
Voigt. [273]
2. ber die Schickssle der der Thomasschule zu Leipzig
angehorenden Kantaten Joh. Seb. Bachs. By Bernhard
Fr. Richter.

3. Die grosse A-moll Fuge fr Orgel [Novello bk. 7 p.
42] und ihre Vorlage. By Reinhardt Oppel.
4. Zur Rritik der Gesamtausgabe von Bachs Werken. By
Max Seiffert.


354 Johann Sebastian Bach


5. Verzeichnis der bis zum Jahre 1851 gedruckten (und
der geschrieben im Handel gewesenen) Werke von
Johann Sebastian Bach. By Max Schneider.
6. bersicht der Auffhrungen J. S. Bachscher Werke
von Ende 1904 bis Anfang 1907.

8. Notes.


VII (4). 1907. Drittes deutsches Bach-Fest zur Einweihung von
Johann Sebastian Bachs Geburtshaus als BachMuseum [at
Eisenach]. Fest- und Programmbuch [26-28 May 1907].
The frontispiece is Carl Seffner's bust of Bach.
VIII (1). 1908. Violinkonzert No. 2 in E dur. Partitur. Ed. Max

Seiffert.

See B.G. XXI (1) no. 2.

VIII (2). 1908. Violinkonzert No. 2 in E dur fur Violine und Klavier.

Ed. Max Seiffert and A. Saran.

VIII (3). 1908. Bach-Jahrbuch. 4 Jahrgang 1907: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering.
In addition to a sermon by Professor Georg Rietschel and
an obituary notice of Joseph Joachim, the volume contains
the following articles:


1. Sebastian Bach und Paul Gerhardt. By Wilhelm Nolle.
2. Stadtpfeifer und Alumnen der Thomasschule in

[274] Leipzig zu Bachs Zeit. By Bernhard Fr. Richter.
3. Angeblich von J. S. Bach komponierte Oden von Chr.
H. Hoffmannswaldau. By . Landmann.
4. Die neuen deutschen Ausgaben der zwei- und dreistimmigen Inventionen [Peters bk. 2792]. By Reinhardt
Oppel.

5. Thematisches Verzeichnis der musikalischen Werke

der Familie Bach. I. Theil. By Max Schneider.

6. Notes and Reviews of books.


355


IX (1). 1909. Kantate No. 85: Ich bin ein guter Hirt. Partitur. Ed.
Max Seiffert.

IX (2). 1909. Kantate No. 85: Ich bin ein guter Hirt. Klavierauszug mit Text. Ed. Max Seiffert and Max Schneider.
IX (3). 1909. Brandenburgisches Konzert No. 3. Partitur. Ed. Max
Seiffert.

See B.G. XIX. no. 3.

IX (4). 1909. Brandcnburgisches Konzert No. 3 fr Klavier zu vier
Hnden. Ed. Max Seiffert and Max Schneider.

IX (5). 1909. Viertes deutsches Bach-Fest in Chemnitz 3-5 Oktober
1908. Fest- und Programmbuch.
The frontispiece is a photograph of Carl Seffner's statue of
Bach, unveiled at Leipzig May 17, 1908.
IX (6). 1909. Bach-Jahrbuch. 5 Jahrgang 1908: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering.
Contains the following articles:


1. Zu Bachs Weihnachtsoratorium, Theil 1 bis 3. By
Woldemar Voigt.
2. ber Seb. Bachs Kantaten mit obligater Pedal. By
Bernhard Fr. Richter.

3. Cembalo oder Pianoforte? By Richard Buchmayer.
4. Bearbeitung Bachscher Kantaten. By Max Schneider. [275]
5. Nachrichten ber das Leben Georg Bhms mit
spezieller Bercksichtigung seiner Beziehungen zur
Bachschen Familie. By Richard Buchmayer.
6. Ein interessantes Beispiel Bachscher Textauffassung.
By Alfred Heuss.
7. Edgar Tinel ber Seb. Bach.

8. Notes.


X (I). 1910. Ausgewahlte Arien und Duette mit einem obligaten Instrument und Klavier- oder Orgelbegleitung. IV
Abteilung: Arien fr Tenor. Ed. Eusebius Mandyczewski.


356 Johann Sebastian Bach


1. Dein Blut, so meine Schuld durchstreit (Cantata 78:
Flauto).
2. Die Liebe zieht mit sanften Schritten (Cantata 36: Oboe
d'amore).
3. Ergiesse dich reichlich, du gottliche Quelle (Cantata 5:
Viola).
4. Handle nicht nach deiuen Bechten mit uns (Cantata
101: Violin).
5. Ich will an den Himmel denken (Cantata 166 : Oboe).
6. Ja, tausendmal Tausend (Cantata 43 : Violin).
7. Mich kann kein Zweifel stren (Cantata 108 : Violin).
8. Seht, was die Liebe thut! (Cantata 85 : Violin or
Viola).
9. Tausendfaches Unglck, Schrecken, Trbsal (Cantata
143: Violin).
10. Wir waren schon zu tief gesunken (Cantata 9 : Violin).
11. Woferne du den edlen Frieden (Cantata 41 : Violoncello).
12. Wo wird in diesem Jammerthale (Cantata 114: Flauto).


X (2). 1910. Brandenburgisches Konzert No. 1. Partitur. Ed. Max
Seiffert.

See B.G. XIX. no. 1.

X(3). 1910. Brandenburgisches Konzert No. 1 fur Klavier zu vier
Handen. Ed. Max Seiffert and Max Schneider.

X(4). 1910. Bach-Jahrbuch. 6 Jahrgang 1909: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering.
The volume contains the following articles:


1. Zum Linearprinzip J. S. Bachs. By Robert Handke.
2. Bachs Verhltnis zur Klaviermusik. By Karl Nes.
3. Zur Tenorarie [Ich will an den Himmel denken: See
X (1) no. 5, supra] der Kantate 166. By Reinhard
Oppel.


357


4. Die Verzierungen in den Werken von J. S. Bach. By
E. Dannreuther.

5. Konnte Bachs Gemeinde bei seinen einfachen Choral
stzen mitsingen? By Rudolf Wustmann.

6. Buxtehudes musikalischer Nachrnf heim Tode seines

Vaters (mit einer Notenbeilage). By Reinhard Oppel.
7. Matthauspassion, erster Theil. By Rudolf Wust
mann.

8. Zu den Beschlssen des Dessauer Kirchengesangver
einstages. By Arnold Schering.

9. Notes.


X (5). 1910. Fnftes deutsches Bach-Fest in Duisburg 4 bis 7 Juni
1910. Fest- und Programmbuch.
Frontispiece, St. Thomas' Church and School, Leipzig, in
1723. Reproduced at p. 28 of the present volume.
XI (1). 1911. Ausgewahlte Arien und Duetto mit einem obligaten
Instrument und Klavier- oder Orgelbegleitung V Abteilung:
Arien fr Bass, Ed. Eusebius Mandyczewski.


1. Achzen und erbrmlich Weinen (Cantata 13: Violin or
Flute). [277]
2. Die Welt mit allen Knigreichen (Cantata 59: Violin).
3. Endlicb, endlich wird niein Joch (Cantata 56: Oboe).
4. Erleucht' auch meine finstre Sinnen (Christmas Oratorio, Part V. no. 5: Oboe d'amore).
5. Gleichwie die wilden Meeres-Wellen (Cantata 178:
Violin or Viola).
6. Greifet zu, fasst das Heil (Cantata 174: Violin or
Viola).
7. Herr, nun lssest du deinen Diener (Cantata 83: Violin
or Viola).
8. Hier, in meines Vatera Sttte (Cantata 32: Violin).
9. Komm, ssses Kreuz (St. Matthew Passion, no. 57:
Violoncello).


358 Johann Sebastian Bach


10. Lass', O Welt, mich aus Verachtung (Cantata 123:
Flauto).
11. Tritt auf die Glaubensbahn (Cantata 152: Oboe
d'amore).
12. Wenn Trost und Hlf' ermangeln muss (Cantata 117:
Violin).


XI (2). 1911. Bach-Jahrbuch. 7 Jahrgang 1910: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Sobering.
The volume contains the following articles:


1. Die Diatonik in ihrem Einfluss auf die thematische

Gestaltung des Fugenbaues. By Robert Handke.
2. Bach und die franzosische Klaviermusik. By Wanda
Landowska.

3. Sebastian Bachs Kirchenkantatentexte. By Rudolf

Wustmann.

4. Uber Joh. Kasp. Fred. Fischers Einfluss auf Joh. Seb.
Bach. By Reinhard Oppel.
5. Hans Bach, der Spielmann. By Werner Wolffheim.
6. Vom Rhythmus des evangelischen Chorals. By Rudolf

Wustmann.

7. W. Friedemann Bach und seine hallische Wirksamkeit.

[278] By C. Zehler.
8. Neues Material zum Verzeichnis der bisher erschiene
nen Literatur ber Johann Sebastian Bach. By Max
Schneider.

9. Reviews of books.


XII (1). 1912. Ausgewahlte Arien und Duette mit einem obligaten Instrument und Klavier- oder Orgelbegleitnng. VI
Abteilung: Arien fur Sopran. 2 Heft. Ed. Eusebius
Mandyczewski.


1. Bereite dir, Jesu, noch itzo die Bahn (Cantata 147:
Violin).


359


2. Eilt, ihr Stunden, kommt herbei (Cantata 30: Violin).

3. Erfllet, ihr bimmlischen, gttlichen Flammen (Cantata 1: Oboe da caccia).

4. Gengsamkeit ist ein Schatz in diesem Leben (Cantata
144: Oboe d'amore).

5. Hrt, ihr Vlker, Gottes Stimme (Cantata 76: Violin).

6. Ich folge dir gleichfalls (St. John Passion, no. 9:
Flauto).

7. Jesus soll mein erstes Wort (Cantata 171: Violin).

8. Liebster Jesu, mein Verlangen (Cantata 32: Oboe).
9. Meinem Hirten bleib' ich treu (Cantata 92: Oboe
d'amore).

10. Seele, deine Spezereien sollen nicht (Easter Oratorio,
no. 4: Flauto or Violin).

11. Was Gott thut, das ist wohlgethan (Cantata 100:
Flauto).

12. Wie zittern und wanken der Snder Gedanken (Cantata
105: Oboe).


XII (2). 1912. Bach-Jahrbuch. 8 Jaargang 1911: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering. Mit 2 Bildnissen und 8 Faksimiles.
The volume contains the following articles:


1. Mein Herze schwimmt im Blut [see infra XIII (2)].
By Werner Wolffheim. [279]
2. Das sogensante Orgelkonzert D-moll, von Wilhelm
Friedemann Bach [Peters bk. 3002]. By Max Schneider.

3. Bachiana. By Werner Wolffheim.
4. Zur Geschichte der Passionsauffhrungen in Leipzig.
By Bernhard Fr. Richter.
5. Tonartensymbolik zu Bachs Zeit. By Rudolf Wust
mann.


360 Johann Sebastian Bach


6. ber die Viola da Gamba und ihre Verwendung bei
Joh. Seb. Bach. By Christian Dobereiner.
7. Carl Philipp Emanuel Bach und Joh. Gottl. Im.
Breitkopf. By Hermann von Hase.
8. Zur Lukaspassion. By Max Schneider.
9. Verzeichnis der Sammlung alter Musikinstrumente im
Bachhaus zu Eisenach. By G. Bornemann.


The illustrations are, portraits of W. Friedemann Bach
(aet. 72) and Johann Sebastian Bach (son of Carl P. E.
Bach); facsimiles of Bach's arrangement of the D minor
Vivaldi Organ Concerto (attributed to W. F. Bach) and
Lukaspassion, and of a letter written to J. G. I. Breitkopf
by C. P. E. Bach, dated 28th February 1786.
XII (3). 1912. Sechstes Deuteches Bach-Fest in Breslau 15 bis 17
Juni 1912. Fest- und Frogrammbuch.
Frontispiece, J. S. Bach after the oil-painting by G.
Haussmann in possession of St. Thomas' School, Leipzig
(see Spitta, vol. i. frontispiece and XVI (1) infra).
XIII (1). 1913. Ausgewahlte Arien mit obligaten Instrumenten und
Klavierbegleitung. VII Abteilung: Arien fur Sopran. 3 Heft.
Weltliche Arien. Ed. Eusebius Mrmdyczewski.


1. Wenn die Fruhlingslfte streichen (Weichet nur betrbte Schatten: Violin).
2. Sich ben im Lieben (Weichet nur betrbte Schatten:

[280] Oboe).
3. Des Reichtums Glanz (Ich bin in mir vergngt:
Violin). [547]

4. Meine Seele, sei vergngt (Ich bin in mir vergngt:
Flauto).
5. Angenehmer Zephryus (Der zufnedengestellte Aeolus: Violin).
6. Schweigt, ihr Flten (O holder Tag: Flauto).


547 The original words are Die Schtzbarkeit der weiten Erden.


361


7. Ei! wie schmeckt der Coffee ssse (Schweigt stille,
plaudert nicht: Flauto).
8. Ruhig und in sich zufrieden (Ich bin in mir vergngt:
2 Oboi).
9. Schafe knnen sicher weiden (Was mir behagt: 2
Flauti).
10. Ruhet hie, matte Tne (O holder Tag: Violin and
Oboe d'amore).
11. Jagen ist die Lust der Gtter (Was mir behagt: 2
Horns).
12. Hrt doch! der sanften Flten Chor (Schleicht, spielende Wellen: 3 Flauti).


XIII (2). 1913. Solo-Kantate fr Sopran, Mein Herze schwimmt
im Blut, ausgefunden und herausgegeben von C. A. Martiensen. Partitur.

XIII (3). 1913. Solo-Kantate fr Sopran, Mein Herze schwimmt im
Blut. Klavierauszug mit Text von Max Schneider.
XIII (4). 1913. Bach-Jahrbuch. 9 Jahrgang 1912: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering. Mit 2 Noten-Anhngen.
The volume contains the following articles:


1. Uber die Motetten Seb. Bachs. By Bernhard Ft.
Richter.

2. Uber die F-dur Toccata [N. bk. 9 p. 176] von J. S.
Bach. By Woldemar Voigt. [281]
3. Die Mllersche Handschrift. Ein unbekanntes Gegenstck zum Andreas-Bach-Buche (mit einem Notenanhange). By Werner Wolffheim.
4. Bachs Bearbeitungen und Umarbeitungen eigener und
fremder Werke. By Karl Grunsky.
5. ber die Kirchenkantaten vorbachischer Thomaskan
toren (mit einem Notenanhange). By Arnold Sobering.
6. Beitrge zur Bachkritik. By Arnold Sobering.


362 Johann Sebastian Bach


7. Auffhrungen von Joh. Seb. Bachs Kompositionen.
By Th. Biebrich.

8. Notes.


XIV (1). 1914. [548] Joh. Seb. Bachs Kantatentexte. Im Auftrage der
Neuen Bachgesellsehaft herausgegeben von Rudolf Wust
mann.

Contains the literary texts of the Church Cantatas, with
critical notes.

XIV (2). 1914. Bach-Jahrbuch. 10 Jahrgang 1913. Im
Auftrage der Neuen Bachgesellsehaft herausgegeben von
Arnold Sobering. Mit einem Titelbilde und einer Beilage.

The volume contains the following articles:


1. Studien zu J. S. Bachs Klavierkonzerten. By Adolf
Aber.

2. ber Joh. Seb. Bachs Konzerte fur drei Klaviere. By

Hans Boas.

3. Die Kantata Nr. 150, Nach dir, Herr, verlanget mich.
By Arnold Sobering.
4. ber die C-dur-Fuge aus dem I. Theil des Wohltemperierten Klaviers. By Wanda Landowska.

5. Die Varianten der grossen G-moll-Fuge fr Orgel

[Novello bk. 8 p. 127]. By Hermann Keller.

6. Ein Bachkonzert in Kamenz. By Hermann Kret
[282] zschmar.

7. Breitkopfsche Textdrucke zu Leipziger Musikauffhrungen zu Bachs Zeiten. By Hermann von Hase.

8. J. S. Bachs Aria, Erbauliche Gedanken ernes
Tabakrauchers. By Alfred Heuss. [549]


548 The title-page is dated 1913 and the Preface Im Advent auf 1914.
549 The Aria is no. 20 of A. M. Bach's Notenbuch for 1725. See E.G. XLII.

(2) no. 20.


363


9. Johann Seb. Bachs und Christoph Graupners Kompositionen zur Bewerbung um das Thomaskantorat in
Leipzig 1722-23. By Bernhard Fr. Richter.
10. Register zu den ersten 10 Jahrgangen des Bach
Jahrbuchs 1904-13. By Arnold Schering.


The frontispiece is a portrait of Bach, about thirty-five
years old, after the original in the Eisenach Museum by Job.
Jak. Ihle. See frontispiece of this volume.
XIV (3). 1914. Fest- und Programmbuch zum 7 Deutschen Bachfest
der Neuen Bachgesellschaft. Wien. 9 bis 11 May 1914.
The frontispiece is a picture of St. Thomas' Church and
School in 1723 (see p. 28 supra).
XV (1). 1914. Ausgewhlte Arien und Duette mit einem obligaten Instrument und Klavier- oder Orgelbegleitung. VIII
Abteilung: Arien fr Alt. 2 Heft. Ed. Eusebius Mandyczewski.


1. Bethrte Welt (Cantata 94: Flauto).

2. Ein ungefrbt Gemte (Cantata 24: Violin or Viola).
3. Ermuntert euch (Cantata 176: Oboe).

4. Gott ist unser Sonn' und Schild (Cantata 79: Oboe or
Flauto).

5. In Jesu Demuth (Cantata 151: Oboe d'amore or Violin).

6. Jesus ist ein guter Hirt (Cantata 85: Violin or Violoncello).

7. Kreuz und Krone (Cantata 12: Oboe).

8. Schme dich, O Seele, nicht (Cantata 147: Oboe
d'amore). [283]

9. Von der Welt verlang' ich nichts (Cantata 64: Oboe
d'amore).

10. Weh der Seele (Cantata 102 : Oboe).

11. Willkommen! will ich sagen (Cantata 27: Cor Anglais).
12. Zum reinen Wasser (Cantata 112: Oboe d'amore).


364 Johann Sebastian Bach


XV (2). 1915. Bach-Jahrbuch. 11 Jahrgang 1914: Im Anftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering (Leipzig). Mit einem Titelbilde und einer Bilderbeilage.
The volume contains the following articles:


1. Neues ber das Bachbildnis der Thomasschule und

andere Bildnisse Johann Sebastian Bachs. By Albrecht
Kurzwelly.
2. Zur Geschichte der Bachbewegung. Bericht ber eine
bisher unbekannte frhe Auffhrung der Matthauspassion. By Karl Anton.
3. Johann Christoph Friedrich Bach. By Georg Schne
mann.

4. Die Wiederbelebung der Kurrende in Eisenach. By W.
Nicolai.

5. Auffhrungen von Joh. Seb. Bachs Kompositionen
in der Zeit vom Oktober 1912 bis Juli 1914. By Th.
Biebrich.

6. Bachauffhrungen im ersten Jahre des deutschen
Krieges. By Th. Biebrich.
7. Mitgliederversammlung der Neuen Bachgesellschaft.
Montag, den 11 Mai 1914.

8. Reviews.


The frontispiece is a picture of Bach by Daniel Greiner.
XVI (1). 1916. Das Bachbildnis der Thomasschule zu Leipzig, nach
seiner Wiederherstellung im Jahre 1913. Gemalt von E. G.
Haussmanu 1746.

[284] A print of the renovated picture is at p. 48 of this volume.
XVI (2). 1916. Bach-Genealogie mit zwei Briefen von Carl Philipp
Emanuel Bach. Herausgegeben von Professor Max Schneider in Breslau. [550]


550 This publication, announced for 1916, appears under a different title as the
third issue for 1917. See infra, XVII. (3).


365


XVI (3). 1916. Bach-Jahrbuch. 12 Jahrgang 1915. Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Sobering (Leipzig). Mit dem Bildnisse J. S. Bachs nach der
Gedenkbste in der Walhalla.

The volume contains the following articles:


1. Johann Sebastian Bach im Gottesdienst der Thomaner.

By Bernhard Friedrich Richter.
2. Karl Philipp Emanuel Bach und der Dresdner Kreuz
kantor Gottfried August Homilius im Musikleben ihrer
Zeit. Ein Beitrag zur Geschichte der Stilwandlung des
18 Jahrhunderts. By Rudolf Steglich.
3. Eine Umdichtung des Zufriedengestellten Aeolus
(Mit einem Anhang ber die Kantata Schleicht, spielende Wellen). By Woldemar Voigt.
4. Eine alte, unbekannte Skizze von Sebastian Bachs
Leben. By Arthur Prfer.
5. Bachauffuhrungen im zweiten Jahre des deutschen
Krieges. By Th. Biebrich.

6. Reviews.


The frontispiece is a photograph of Professor F. Behn's
bust of Bach in the Walhalla.

XVII (1). 1916. Motette O Jesu Christ, mein's Lebens Licht. Nach
Bachs Handschrift zum ersten Male herausgegeben von
Max Schneider. Partitur, [See E.G. XXIV.]

XVII (2). 1916. Motette O Jesu Christ, mein's Lebens Licht.
Klavierauszug mit Text von Max Schneider. [See B.G.
XXIV.] [285]
XVII (3). 1917. Bach-Urkunden. Ursprung der musikalischBachischen Familie. Nachrichten ber Johann Sebastian

Bach von Carl Philipp Emanuel Bach. Herausgegeben von
Max Schneider.

The volume contains a facsimile of the Bach Genealogy
compiled by Joh. Seb. Bach and formerly in Carl Philipp


366 Johann Sebastian Bach


Emanuel's possession, and two letters from the latter to J.
N. Forkel.

XVII (4). 1917. Bach-Jahrbuch. 13 Jahrgang 1916. Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering (Leipzig).
The volume contains the following articles:


1. Die F.-Trompete im 2 Brandenburgischen Konzert von
Joh. Seb. Bach. By Richard Hofmann.
2. Zur Frage der Ausfhrung der Ornamente bei Bach.
Zhlzeit oder Notenwert? By Hans Joachim Moser.
3. Friedrich Bachs Briefwechsel mit Gerstenberg und
Breitkopf. By Georg Schunemann.
4. Bachauffhrurgen im dritten Jahre des deutschen
Krieges. By Th. Biebrich.
5. Laterarische Beigabe: Der Thomaskantor. Ein
Gemth-erfreuend Spiel von deme Herren Cantori Sebastian Bachen, vorgestellt in zween Auffzgen durch
Bernhard Christoph Breitkopfen seel. Erben: Breitkopf
und Hartel 1917. By Arnold Schering.


XVIII (1). 1917. Konzert in D moll nach der ursprnglichen Fassung
fur Violine wiederhergestellt von Robert Reitz. Partitur.

[See B.G. XVII.]
XVIII (2). 1917. Konzert in D moll nach der ursprnglichen Fassung
fr Violine wiederhergestellt von Robert Reitz. Ausgabe

[286] fur Violine und Klavier. [See B.G. XVII.]
XVIII (3). 1918. Bach-Jahrbuch. 14 Jahrgang 1917: Im Auftrage der
Neuen Bachgesellschaft herausgegeben von Arnold Schering (Leipzig). Mit einem Eildnis.
The volume contains the following articles :


1. Gustav Schreck [d. 22 Jan. 1918].

2. Das dritte kleine Bachfest zu Eisenach:


I. Der Festgottesdienst in der St. Georgenkirche zu
Eisenach am 30 September 1917.


367


II. Vortrage und Verhandlungen der Mitgliederversammlung des dritten kleinen Bachfestes in Eisenach am 29 September 1917.


3. Seb. Bachs Stellung zur Choralrhythmik der
Lutherzeit. By Hans Joachim Moser.
4. Zur Motivbildung Bachs. Kin Beitrag zur Stilpsychologie. By Ernst Kurth.
5. Ein Programmtrio Karl Philipp Emanuel Bachs. By

Hans Mersmann.

6. Hermann Kretzschmar [b. 19 Jan. 1848].

7. Review.


The frontispiece is a copy of the oil portrait of Bach after
Haussmann, copied by J. M. David in 1746.




[227]


# APPENDIX IV. BIBLIOGRAPHY OF BACH LITERATURE

The following list does not include magazine articles or technical
works. A comprehensive bibliography, compiled by Max
Schneider, will be found in the Bach-Jahrbuch for 1905 and
1910. Shorter lists are in C. F. Abdy Williams' _Bach_ (1900) and
Andre Pirro's _J.-S. Bach_ (1906). Titles within square brackets
in the following list are inserted upon the authority of the
_Bach-Jahrbuch,_ but are not discoverable in the annual Book
Catalogues. Since the absence of an Italian section may be
remarked, it should be said that the _Catalogo generate della_
_Libreria Italiana, 1847-1899_ (published in 1910) contains no
reference to Bach. Nor does the Supplement of 1912.

### I. Germany


Johann Christoph W. Khnau, _Die blinden Tonkstler._
Berlin. 1810.

J. E. Grosser, _Lebensbeschreibung des Kapellmeisters Jo-_

_hann Sebastian Bach._ Breslau. 1834.

Albert Schiffner, _Sebastian Bachs geistige Nachkommen-_
_schaft._ Leipzig. 1840.
Johann T. Mosewius, _Johann Sebastian Bach in seinen_
_Kirch-Kantaten und Choralgesngen._ Berlin. 1846.
Johann Carl Schauer, _Johann Sebastian Bachs Lebensbild:_
_Eine Denkschrift auf seinen 100jhringen Todestag._ Jena.
1850.


370 Johann Sebastian Bach


C. L. Hilgenfeldt, _Johann Sebastian Bachs Leben, Wirken_
_und Werke._ Leipzig. 1850.

[W. Naumann, _Johann Sebastian Bach. Eine Biographie._
Cassell. 1855.]

[Anon., _Biographien und Charakteristiken der grossen_
_Meister: Bach, Hndel, Gluck, Haydn, Mozart, Beethoven,_
_mit Portrats._ 2nd ed. Leipzig. 1860.]
C. H. Bitter, _Johann Sebastian Bach._ 2 vols. Berlin. 1865.

2nd ed. 1880.

C. Albert Ludwig, _Johann Sebastian Bach in seiner Be-_
_deutung fr Cantoren, Organisten, und Schullehrer._ Bleichroder. 1865.

Alfred Drffel, _Thematisches Verzeichniss der Instrumen-_

_talwerke von Joh. Seb. Bach._ Auf Grund der Gesammtaus
gabe von C. P. Peters. Leipzig. 1867. 2nd ed. 1882.
Carl Tamme, _Thematisches Verzeichniss der Vocalwerke_
_von Joh. Seb. Bach. Auf Grund der Gesammtausgaben von_
_F. Peters und der Bach-Gesellschaft._ Leipzig, n.d.
C. H. Bitter, _C. P. E. und W. F. Bach und deren Brder._ 2

vols. Berlin. 1868. New ed. 1880.

[Anon., _J. S. Bach. Biographie._ Leipzig. 1869.]
L. Ramann, _Bach und Handel._ Leipzig. 1869.
W. Junghans, _Johann Sebastian Bach als Schuler der Par-_
_tikularschule zu St._ _Michaelis in Lneburg._ Lneburg.

1870.

Emil Naumann, _Deutsche Tondichter von Sebastian Bach_
_bis auf die Gegenwart._ Berlin. 1871. 5th ed. 1882.
M. Schick, _J. S. Bach: ein musikalisches Lebensbild._ Reutlingen. 1873.
Philipp Spitta, _Johann Sebastian Bach._ 2 vols. Leipzig.

1873-1880.

E. Frommel, _Hndel und Bach._ Berlin. 1878.

Elise Polko, _Unsere Musikklassiker. Sechs biographische_
_Lebensbilder_ [Bach, etc.]. Leipzig. 1880.


371


[Anon., _J. S. Bach. Biographie._ [In _Meister der Tonkunst,_
no. 2.] Leipzig. 1880.]
August Reissmann, _Johann Sebastian Bach. Sein Leben_
_und seine Werke._ Berlin and Leipzig. 1881.
Otto Gumprecht, _Warum treiben wir Musik?_ [Bach and
others.] Leipzig. 1883.
C. H. Bitter, _Die Shne Seb. Bachs._ Leipzig. 1883.
Jul. Schmann, _Joh. Seb. Bach, der Kantor der Thomas-_
_schule zu Leipzig._ Leipzig. 1884.
A. L. Grbner, _Johann Sebastian Bach._ Dresden. 1885.
Fr. Spitta, _Haendel und Bach. Zwei Festreden._ Bonn. 1884.
E. Heinrich, _Johann Sebastian Bach. Ein kurzes Lebensbild._

Berlin. 1885.

E. Naumann, _Deutsche Tondichter von J. S. Bach bis_
_Richard Wagner._ Leipzig. 1886. 6th ed. 1896.
Paul Meyer, _Joh. Seb. Bach. Vortrag._ Basel. 1887.
Ludwig Ziemssen, _Johann Sebastian Bach._ _Lebensbild._
Glogau. 1889.
Richard Batka, _J. S. Bach._ Leipzig. 1893.
Wilhelm His, _Johann Sebastian Bach. Forschungen ber_
_dessen Grabsttte, Gebeine und Antlitz._ Leipzig. 1895.
Wilhelm His, _Anatomisches Forschungen ber J. S. Bach's_
_Gebeine und Antlitz, nebst Bemerkungen ber dessen Bilder._
Leipzig. 1895.
Armin Stein, _J. S. Bach. Ein Kntstlerleben._ Halle. 1896.
Hans von Wolzogen, _Bach_ [In _Grossmeister deutscher_
_Musik_ ]. Berlin. 1897.

[W. Kleefeld, _Bach und Graupner._ Leipzig. 1898.]

[Fr. Thomas, _Der Stammbaum des Ohrdruffer Zweigs der_
_Familie von J. S. Bach._ Ohrdruf. 1899.]

[Fr. Thomas, _Einige Ergebnisse ber J. S. Bachs Ohrdruffer_
_Schulzeit._ Ohrdruf. 1900.]

B. Stein, _Johann Sebastian Bach und die Familie der_

Bache. Bielefeld. 1900.


372 Johann Sebastian Bach


Fr. von Hausegger, _Unsere deutschen Meister_ [Bach and
others]. Munich. 1901.

Arnold Sobering, _Bachs Textbehandlung._ Leipzig. 1901.

[W. Tappert, _Sebastian Bachs Kompositionen fr die Laute._
Berlin. 1901.]

K. Shle, _Sebastian Bach in Arnstadt_ Berlin. 1902. 2nd ed.

1904.

Arthur Prfer, _Sebastian Bach und die Tonkunst des XIX._
_Jahrhunderts._ Leipzig. 1902.

H. Barth, _Joh. Sebastian Bach: Lebensbild._ Berlin. 1902.

Gustav Hcker, _Johann Sebastian Bach._ Gotha. 1903.

Paul von Bojanowski, _Das Weimar Johann Sebastian Bachs._
Weimar. 1903.

Jul. Schumann, _Bach, Hndel, Mendelssohn._ _Die_
_protestantische Kirchenmusik in Lebensbildern._ Calw and
Stuttgart. 1903.

[. Weissgerber, _J. S. Bach in Arnstadt._ Arnstadt. 1904.]

[K. Storck, _J. S. Bach: Charakter und Lebensgang._ Berlin.
1905.]

[A. Pischinger, _J. S. Bach._ Munich. 1905.]
Philipp Wolfrum, _Joh. Seb. Bach._ Berlin. 1906.

Albert Schweitzer, _J. S. Bach._ Berlin. 1908.

Friedrich Hashagen, _Joh. Sebastian Bach als Snger und_
_Musiker des Evangeliums._ Wismar. 1909.
Max Trmpelmann, _Joh. Sebastian Bach und seine Bedeu-_
_tung fr die Choralkomposition unserer Zeit._ Magdeburg.
1909.

August Wildenhahn, _Joh. Sebastian Bach._ Eisenach. 1909.
Philipp Wolfrum, _Johann Sebastian Bach._ 2 vols. Leipzig.
1910.

Andr Pirro, _Johann Sebastian Bach. Sein Leben und seine_
_Werke._ [Translated from the French by Bernhard Engelke.]
Berlin. 1910.


373


Johannes Schreyer, _Beitrge zur Bach-Kritik._ Leipzig.
1911.

Martin Falck, _Wilhelm Friedemann Bach. Sein Leben und_
_seine Werke, mit thematischem Verzeichnis seiner Kompo-_
_sitionen und zwei Bildern._ Leipzig, c. 1911-14.
K. Glebe, _Johann Sebastian Bach._ Halle. 1912.
La Mara, _Johann Sebastian Bach._ 5th edition. Leipzig.
1912.

H. Reimann, _Johann Sebastian Bach._ 1912.

Armin Stein, _Johann Sebastian Bach._ Halle. 1912.
Rudolf Wustmann, _Joh. Seb. Bachs Kantatentexte._ Leipzig.
1914.

Max Bitter, _Der Stil Joh. Seb. Bachs in seinem Choralsatze._

Bremen. 1913.

Ernst Kurth, _Grundlagen des linearen Kontrapunkts. Ein-_
_fhrung in Stil und Technik von Bachs melodischer Poly-_
_phonie._ Bern. 1917.

### II. France


Johann Nikolaus Forkel, _Vie, talents et travaux de Jean_
_Sbastien Bach._ [Translated from the German by Felx
Grenier.] Paris. 1876.
Ernest David, _La vie et les uvres de J.-S. Bach, sa famille,_
_ses lves, ses contemporains._ [An abridged translation of
Spitta.] Paris. 1882.
William Cart, _Un maitre deux fois centenaire: tude sur_
_J.-S. Bach, 1685-1750._ Paris. 1884. New ed. 1898.
Andr Pirro, _L'Orgue de Jean-Sbastien Bach._ Paris. 1895.

[G. Fink, _tude biographique sur Jean-Sbastien Bach._
Angoulme. 1899.]

[. Daubresse, _Haendel et Bach._ Paris. 1901.]


374 Johann Sebastian Bach


Albert Schweitzer, _J. S. Bach, le musicien-pote._ Leipzig.
1905.

Andr Pirro, _J.-S. Bach._ Paris. 1906. 4th edition. 1913.
Andr Pirro, _L'Esthtique de Jean-Sbastien Bach._ Paris.

1907.

### III. Great Britain


Johann Nikolaus Forkel, _Life of John Sebastian Bach._
_Translated from the German_ [by  Stephenson]. London. 1820.

C. H. Bitter, _The Life of J. Sebastian Bach. An abridged_
_translation from the German._ [By Janet Elizabeth Kay
Shuttleworth.] London. 1873.
R. Lane Poole, _Sebastian Bach._ London. 1881.
Sedley Taylor, _The Life of J. S. Bach in relation to his work_
_as a Church musician and composer._ Cambridge. 1897.
Philipp Spitta, _Johann Sebastian Bach:_ _His work and_
_influence on the music of Germany, 1685-1750._ Translated
from the German by Clara Bell and J. A. Fuller Maitland. 3
vols. London. 1899.

C. F. Abdy Williams, _Bach._ London. 1900.
A. Maczewski and F. G. Edwards, art. _Bach_ in _Grove's_
_Dictionary,_ vol. i. 1904.
E. H. Thome, _Bach._ London. 1904.
C. H. H. Parry, _Johann Sebastian Bach._ London and New
York. 1909.

Donald F. Tovey, art. _J. S. Bach,_ in _Encyclopaedia Britan-_
_nica._ Vol. iii. 1910.

Albert Schweitzer, _J. S. Bach. With a Preface by C. M._
_Widor._ _English translation by Ernest Newman._ 2 vols.

London. 1911.


375


C. Sanford Terry, _Bach's Chorals._ 3 vols. Cambridge. 1915,
1917, 1920.

W. G. Whittaker, _Fugitive Notes on certain Cantatas and_
_Motets by J. S. Bach._ London. 1920.

### IV. United States Of America


Andr Pirro, _Johann Sebastian Bach, the Organist, and his_
_works._ [Translated from the French by Wallace Goodrich.]
New York. 1902.

Elbert Hubbard, _Little voyages to the homes of great musi-_
_cians._ New York. 1902.

Ludwig Ziemssen, _Johann Sebastian Bach._ [Translated
from the German by G. Putnam Upton.] Chicago. 1905.
Rutland Boughton, _Bach._ New York. 1907.

### V. Holland


A. M. Oordt, _Een koort woord over Bach._ Leiden. 1873.

### VI. Belgium


Charles Martens, _Un livre nouveau sur J.-S. Bach._ Brussels.

1905.

Victor Hallut, _Les Matres classiques du dix-huitime siecle._

[Bach and others.] Brussels. 1909.


376 Johann Sebastian Bach

### VII. Russia


[Kuschenaw Dmitrevsky, _Das lyrische Museum_ (no. 25)].

[The oldest Russian biography of Bach.] Petrograd. 1831].

[W. Th. Odoewsky, _Sebastian Bach._ Petrograd. 1890.]

[G. M. Bazunow, _J. S. Bach._ Petrograd. 1894.]

[S. M. Haljutin, _J. S. Bach._ Minsk. 1894.]

[Adolf Chybinski, _J. S. Bach._ Warsaw. 1910.]




[294]


# APPENDIX V. A COLLATION OF THE NOVELLO AND PETERS EDITIONS OF THE ORGAN WORKS

Novello: Book I. Eight Short Preludes And Fugues.


Page 2. Prelude and Fugue in C major (P. bk. 247 p.
48).
Page 5. Do. do. D minor (ib. 51).
Page 8. Do. do. E minor (ib. 54).
Page 11. Do. do. F major (ib. 57).
Page 14. Do. do. Q major (ib. 60).
Page 17. Do. do. G minor (ib. 63).
Page 20. Do. do. A minor (ib. 66).
Page 23. Do. do. B flat major (ib. 69).


Novello: Book II. Preludes, Fugues, And Trio.


Page 26. Allabreve in D major (P. bk. 247 p. 72).
Page 30. Prelude in G major (ib. 82).
Page 34. Canzona in D minor (P. bk. 243 p. 54).
Page 38. Fugue (The Giant) in D minor (P. bk. 246 p.
78).
Page 41. Fugue in G minor (P. bk. 247 p. 85).
Page 44. Prelude and Fugue (the Short) in E minor (P.
bk. 242 p. 88).
Page 48. Prelude and Fugue in C minor (P. bk. 243 p.
32).
Page 54. Trio in D minor (ib. 72).


378 Johann Sebastian Bach


Novello: Book III. Fantasias, Preludes, And Fugues.


Page 57. Fantasia in C minor (5 parts) (P. bk. 243 p.
66).
Page 60. Fugue in B minor (on a theme by Corelli) (ib.
46).
Page 64. Prelude and Fugue in A major (P. bk. 241 p.
14)

[295] Page 70. Do. do. C major (ib. p. 2).
Page 76. Fantasia and Fugue in C minor (P. bk. 242 p.
55).
Page 84. Fugue (the Short) in G minor (P. bk. 243 p.
42).


Novello: Book IV. Sonatas Or Trios For Two Manuals And

Pedal.


Page 88. Sonata in E flat major (P. bk. 240 p. 2).
Page 97. Do. C minor (ib. 11).
Page 110. Do. D minor (ib. 24).


Novello: Book V. Sonatas Or Trios For Two Manuals And

Pedal (IV.-VI.).


Page 124. Sonata in E minor (P. bk. 240 p. 36).
Page 134. Do. C major (ib. 46).
Page 151. Do. G major (ib. 63).


Novello: Book VI. Toccata, Preludes, And Fugues.


Page 2. Toccata and Fugue in D minor (P. bk. 243 p.
24).
Page 10. Prelude and Fugue in D major (ib. p. 14).
Page 21. Do. do. F minor (P. bk. 241 p. 29).
Page 28. Do. do. E flat major (P. bk. 242 p. 2).


Novello: Book VII. Preludes And Fugues.


Page 42. Prelude and Fugue (the Great) in A minor (P.
bk. 241 p. 54).


379


Page 52. Do. do. B minor (ib. 78).
Page 64. Do. do. C minor (ib. 36).
Page 74. Prelude and Fugue in C major (P. bk. 243 p.
2).
Page 80. Do. do. G major (ib. 8).


Novello: Book VIII. Preludes And Fugues.


Page 88. Prelude and Fugue in C major (P. bk. 242 p.
62).
Page 98. Do. (the Great) in E minor (P. bk. 241 p. 64).
Page 112. Do. do. G major (ib p. 7).
Page 120. Do. in G minor (P. bk. 242 p. 48).
Page 127. Fantasia and Fugue (the Great) in G minor
(P. bk. 241 p. 20).

[296]
Novello: Book IX. Preludes And Fugues.


Page 137. Toccata and Fugue (the Great) in C major
(P. bk. 242 p. 72).
Page 150. Prelude and Fugue in D minor (ib. 42).
Page 156. Do. (the Great) in C major (P. bk. 241 p.
46).
Page 168. Fantasia in G major (P. bk. 243 p. 58).
Page 176. Toccata and Fugue (the Great) in F major
(P. bk. 242 p. 16).


Novello: Book X. Toccata, Preludes, And Fugues.


Page Page 196. Toccata and Fugue (the Dorian) in D
minor (P. bk. 242 p. 30.)
Page 208. Prelude and Fugue (the Short) in A minor
(ib. 84).
Page 214. Passacaglia in C minor (P. bk. 240 p. 75).
Page 230. Fugue in C minor (P. bk. 243 p. 36).
Page 238. Prelude in A minor (ib. 68).


Novello: Book XI. Four Concertos [after Antonio Vivaldi].


380 Johann Sebastian Bach


Page 1. Concerto in G major (P. bk. 247 p. 2).
Page 10. Do. A minor (ib. 10).
Page 24. Do. C major (ib. 22).
Page 49. Do. C major (ib. 44).


Novello: Book XII. Preludes, Fantasias, Fugues, Trios, Etc.


Page 55. Fugue in G major (P. bk. 2067 p. 18).
Page 60. Fantasia and Fugue in A minor (ib. 3).
Page 71. Fantasia with Imitation in B minor (P. bk.
215 p. 41).
Page 75. Fantasia in G major (P. bk. 2067 p. 25).
Page 83. Fugue in D major (P. bk. 2067 p. 22).
Page 86. Do. G major (ib. 12).
Page 91. Prelude in C major (P. bk. 247 p. 77).
Page 92. Fantasia in C major (ib. 78).
Page 94. Prelude in C major (ib. 76).

[297] Page 95. Fugue in C minor (P. bk. 243 p. 50).
Page 100. Fugue in C major (P. bk. 247 p. 80).
Page 102. Pastorale in F major (P. bk. 240 p. 86).
Page 108. Trio in C minor (P. bk. 2067 p. 30).
Page 112. Aria in F major (ib. 34).


[Novello's Books XIII. and XIV. (Choral Preludes and
Variations) are superseded by Books XV.-XIX.]
Novello: Book XV. Orgelbchlein (little Organ Book).


Page 3. Nun komm, der Heiden Heiland (P. bk. 244 p.
44).
Page 5. Gott durch deine Gte, or, Gottes Sohn ist
Kommen (ib. 20).
Page 9. Herr Christ, der ein'ge Gottes-Sohn, or, Herr
Gott, nun sei gepreiset (ib. 24).
Page 11. Lob sei dem allmchtigen Gott (ib. 40).
Page 13. Puer natus in Bethlehem (ib. 50).
Page 15. Gelobet seist du, Jesu Christ (ib. 19).


381


Page 18. Der Tag, der ist so freudenreich (ib. 13).
Page 21. Vom Himmel hoch, da komm ich her (ib. 53).
Page 23. Vom Himmel kam der Engel Schaar (ib. 54).
Page 26. In dulci jubilo (ib. 38).
Page 29. Lobt Gott, ihr Christen, allzugleich (ib. 42).
Page 31. Jesu, meine Freude (ib. 34).
Page 33. Christum wir sollen loben schon (ib. 8).
Page 36. Wir Christenleut' (ib. 58).
Page 39. Helft mir Gottes Gte preisen (ib. 23).
Page 43. Das alte Jahr vergangen ist (ib. 12).
Page 45. In dir ist Freude (ib. 36).
Page 50. Mit Fried' und Freud' ich fahr' dahin (ib. 42).
Page 53. Herr Gott, nun schleuss den Himmel auf (ib.
26).
Page 58. O Lamm Gottes unschuldig (ib. 46).
Page 61. Christe, du Lamm Gottes (ib. 3).
Page 64. Christus, der uns selig macht (ib. 10).
Page 67. Da Jesus an dem Kreuze stund (ib. 11).
Page 69. O Mensch, bewein' dein' Snde gross (ib.
48).
Page 73. Wir danken dir, Herr Jesu Christ (ib. 59).
Page 76. Hilf Gott, dass mir's gelinge (ib. 32).
Page 79. Christ lag in Todesbanden (ib. 7). 81. Jesus
Christus, unser Heiland (ib. 34).
Page 83. Christ ist eratanden (ib. 4). [298]
Page 89. Erstanden ist der heil'ge Christ (P. bk. 244 p.
16).
Page 91. Erschienen ist der herrliche Tag (ib. 17).
Page 94. Heut' triumphiret Gottes Sohn (ib. 30).
Page 97. Komm, Gott, Schpfer, heiliger Geist (P. bk.
246 p. 86).
Page 99. Herr Jesu Christ, dich zu uns wend' (P. bk.
244 p. 28).
Page 101. Liebster Jesu, wir sind hier (ib. 40).


382 Johann Sebastian Bach


Page 103. Dies sind die heil'gen zehn Gebot' (ib. 14).
Page 105. Vater unser im Himmelreich (ib. 52).
Page 107. Durch Adams Fall ist ganz verderbt (ib. 15).
Page 109. Es ist das Heil uns kommen her (ib. 18).
Page 111. Ich ruf' zu dir, Herr Jesu Christ (ib. 33).
Page 113. In dich hab' ich gehoffet, Herr (ib. 35).
Page 115. Wenn wir in hchsten Nothen sein (ib. 55).
Page 117. Wer nur den lieben Gott lsst walten (ib.
57).
Page 119. Alle Menschen mssen sterben (ib. 2).
Page 121. Ach wie nichtig, ach wie flchtig (ib. 2).


Novello: Book XVI. The Six Schbler Chorale Preludes

And The Clavierbung, Part III.


(a) The Schbler Preludes.


Page 1. Wachet auf, ruft uns die Stimme (P. bk.
246p. 72).
Page 4. Wo soll ich fliehen hin, or, Auf meinen
lieben Gott (ib. 84).
Page 6. Wer nur den lieben Gott lsst walten (ib.
76).
Page 8. Meine Seele erhebt den Herren (Hi. 33).
Page 10. Ach bleib bei uns, Herr Jesu Christ (P.
bk. 245 p. 4).
Page 14. Kommst du nun, Jesu, vom Himmel
herunter (P. bk. 246 p. 16).
(b) The Clavierbung, Part III.
Page 19. Prelude in E flat major (P. bk. 242 p. 2).
Page 28. Kyrie, Gott Vater in Ewigkeit (P. 246 p.
18).
Page 30. Christe, aller Welt Trost (ib. 20).
Page 33. Kyrie, Gott heiliger Geist (ib. 23).
Page 36. Kyrie, Gott Vater in Ewigkeit (ib. 26).

[299] Page 37. Christe, aller Welt Trost (ib. 27).


383


Page 38. Kyrie, Gott heiliger Geist (P. 246 p. 28).
Page 39. Allein Gott in der Hh' sei Ehr' (Pk. b.
245 p. 10).
Page 40. Do. do. do (ib. 12).
Page 41. Do. do. do. (ib. 29).
Page 42. Dies sind die heil'gen zehn Gebot' (ib.
50).
Page 47. Do. do. do (ib. 54).
Page 49. Wir glauben all' an einen Gott, Schpfer
(P. bk. 246 p. 78).
Page 52. Do. do. do. (ib. 81).
Page 53. Vater unser im Himmelreich (ib. 60).
Page 61. Do. do. (P. bk. 244 p. 51).
Page 62. Christ, unser Herr, zum Jordan kam (P.
bk. 245 p. 46).
Page 67. Do. do. do. (ib. 49).
Page 68. Aus tiefer Noth schrei' ich zu dir (ib.
36).
Page 72. Do. do. do. (ib. 38).
Page 74. Jesus Christus unser Heiland (ib. 82).
Page 80. Do. do. (ib. 92).
Page 83. Fugue in E flat major (P. bk. 242 p. 10).


Novello: Book XVII. The Eighteen Chorale Preludes.


Page 1. Komm, heiliger Geist, Herre Gott (P. bk. 246
p.4).
Page 10. Do. do. do. (ib. 10).
Page 18. An Wasserflssen Babylon (P. bk. 245 p.
34).
Page 22. Schmcke dich, O liebe Seele (P. bk. 246 p.
50).
Page 26. Herr Jesu Christ, dich zu uns wend' (P. bk.
245 p. 70).


384 Johann Sebastian Bach


Page 32. O Lamm Gottes unschuldig (P. bk. 246 p.
45).
Page 40. Nun danket alle Gott (ib. 34).
Page 43. Von Gott will ich nicht lassen (ib. 70).
Page 46. Nun komm, der Heiden Heiland (ib. 38).
Page 49. Do. do. do. (ib. 40).
Page 52. Do. do. do. (ib. 42).
Page 56. Allein Gott in der Hh' sei Ehr' (P. bk. 245 p.
26).
Page 60. Do. do. do (ib. 22).
Page 66. Do. do. do. (ib. 17).
Page 74. Jesus Christus, unser Heiland, der von uns
(ib. 87).

[300] Page 79. Do. do. do. (ib. 90).
Page 82. Komm, Gott, Schpfer, heiliger Geist (P. bk.
246 p. 2).
Page 85. Wenn wir in hchsten Nthen sein, or, Vor
deinen Thron tret' ich allhier (ib. 74).


Novello: Book XVIII. Miscellaneous Chorale Preludes (Part
I.).


Page 1. Ach Gott und Herr (P. bk. 2067 p. 38).
Page 2. Do. do. (P. bk. 245 p. 3).
Page 3. Do. do. (P. bk. 2067 p. 39).
Page 4. Allein Gott in der Hh' sei Ehr' (not in P.).
Page 5. Do. do. do. (P. bk. 245 p. 6)
Page 7. Do. do. do. (ib. 30).
Page 11. Do. do. do. (ib. 8).
Page 13. An Wasserflssen Babylon (ib. 32).
Page 16. Christ lag in Todesbanden (ib. 43).
Page 19. Do. do. (ib. 40).
Page 23. Christum wir sollen loben schon, or, Was
frcht'st du, Feind Herodes, sehr (P. bk. 244 p. 9).


385


Page 24. Das Jesulein soll doch mein Trost (P. bk.
2067 p. 47).
Page 26. Der Tag der ist so freudenreich (not in P.).
Page 28. Durch Adams Fall ist ganz verderbt (P. bk.
245 p. 66).
Page 30. Ein' feste Burg ist unser Gott (ib. 68).
Page 35. Erbarm' dich mein, O Herre Gott (not in P.).
Page 37. Gelobet seist du, Jesu Christ (P. bk. 244 p.
102).
Page 38. Do. do. do. (ib. 20).
Page 39. Do. do. do. (P. bk. 245 p. 61).
Page 41. Gottes Sohn ist kommen (P. bk. 244 p. 22).
Page 42. Do. do. (P. bk. 245 p. 64).
Page 43. Herr Christ, der ein'ge Gottes-Sohn (P. bk.
244 p. 25).
Page 44. Herr Gott, dich loben wir (Te Deum Laudamus) (P. bk. 245 p. 65).
Page 60. Herr Jesu Christ, dich zu uns wend' (P. bk.
244 p. 28).
Page 52. Do. do. do. (not in P.).
Page 53. Herzlich thut mich verlangen (P. bk. 244 p.
30). [301]
Page 54. Ich hab' mein' Sach Gott heimgestellt (P. bk.
245 p. 74).
Page 58. Do. do. do. (not in P.).
Page 59. In dich hab' ich gehoffet, Herr (P. bk. 245 p.
94).
Page 61. In dulci jubilo (P. bk. 244 p. 103).
Page 64. Jesu, meine Freude (P. bk. 245 p. 78).
Page 69. Jesus, meine Zuversicht (P. bk. 244 p. 103).
Page 70. Liebster Jesu, wir sind hier (ib. 105).
Page 71. Do. do. (ib. 105).
Page 72. Do. do. (ib. 39).
Page 73. Lob sei dem allmchtigen Gott (ib. 41).


386 Johann Sebastian Bach


Page 74. Lobt Gott, ihr Christen, allzugleich (ib. 106).
Page 75. Meine Seele erhebt den Herren (Magnificat)
(P. bk. 246 p. 29).
Page 80. Nun freut euch, lieben Christen g'mein, or,
Es ist gewisslich an der Zeit (ib. 36).
Page 83. Nun komm, der Heiden Heiland (P. bk. 244
p. 45).


Novello: Book XIX. Miscellaneous Chorale Preludes (part
II.) And Variations.
(a) Preludes.


Page 2. Valet will ich dir geben (P. bk. 246 p. 53).
Page 7. Do. do. (ib. 56).
Page 12. Vater unser im Himmelreich (ib. 66).
Page 14. Vom Himmel hoch, da komm ich her (ib. 67).
Page 16. Do. do. do. (ib 68).
Page 19. Do. do. do. (P. bk. 244 p. 106).
Page 21. Wer nur den lieben Gott lsst walten (ib. 56).
Page 22. Do. do. do. (ib. 56).
Page 23. Wie schn leuchtet der Morgenstern (not in
P.).
Page 28. Wir Christenleut' (P. bk. 2067 p. 52).
Page 30. Wir glauben all' an einen Gott, Vater (P. bk.
246 p. 82).
Page 32. Wo soll ich fliehen hin (P. bk. 2067 p. 48).
(6) Variations.
Page 36. Christ, der du bist der helle Tag (P. bk. 244

[302] p. 60).
Page 44. O Gott, du frommer Gott (P. bk. 244 p. 68).
Page 55. Sei gegrsset, Jesu gtig (ib. 76).
Page 73. Vom Himmel hoch, da komm ich her (ib. 92).


The Peters volumes 244, 245, 246, 2067 contain movements

excluded from the Novello edition, viz.:


387


Book 244: the figured Choral (Herr Christ, der ein'ge
Gottes-Sohn) on p. 107, and the Variant texts on pp.

108-112.

Book 245: the Variant texts on pp. 96-113.
Book 246: the Variant texts on pp. 86-103 (excepting the B
version of Komm, Gott, Schpfer, heiliger Geist).
Book 2067: the Choral Preludes on pp. 39 (Auf meinen
lichen Gott), 40 (Wir glauben all' an einen Gott), 42 (Jesu
Leiden, Pein und Tod), 44 (Ach Gott, vom Himmel sieh
darein), 54 (Aus der Tiefe ruf ich), 56 (Christ lag in
Todesbanden), and the Kleines harmonisches Labyrinth
on p. 16.


# APPENDIX VI. GENEALOGY OF THE FAMILY OF BACH Footnotes


390 Johann Sebastian Bach


Footnotes 391


392 Johann Sebastian Bach


Footnotes 393


394 Johann Sebastian Bach


Footnotes 395


396 Johann Sebastian Bach


Footnotes 397


***END OF THE PROJECT GUTENBERG EBOOK

JOHANN SEBASTIAN BACH

***


# Credits

January 24, 2011


Project Gutenberg Edition
Martin Schub


# A Word from Project Gutenberg

This file should be named 35041-pdf.pdf or 35041-pdf.zip.
This and all associated files of various formats will be found

in:


[http://www.gutenberg.org/dirs/3/5/0/4/35041/](http://www.gutenberg.org/dirs/3/5/0/4/35041/)


Updated editions will replace the previous one  the old
editions will be renamed.

Creating the works from public domain print editions means
that no one owns a United States copyright in these works, so the
Foundation (and you!) can copy and distribute it in the United
States without permission and without paying copyright royalties.
Special rules, set forth in the General Terms of Use part of this
license, apply to copying and distributing Project Gutenberg
electronic works to protect the Project Gutenbergconcept and
trademark. Project Gutenberg is a registered trademark, and may
not be used if you charge for the eBooks, unless you receive
specific permission. If you do not charge anything for copies
of this eBook, complying with the rules is very easy. You
may use this eBook for nearly any purpose such as creation of
derivative works, reports, performances and research. They may
be modified and printed and given away  you may do practically
_anything_ with public domain eBooks. Redistribution is subject
to the trademark license, especially commercial redistribution.


# The Full Project Gutenberg License

_Please read this before you distribute or use this work._
To protect the Project Gutenbergmission of promoting the
free distribution of electronic works, by using or distributing this
work (or any other work associated in any way with the phrase
Project Gutenberg), you agree to comply with all the terms of
the Full Project GutenbergLicense (available with this file or
[online at http://www.gutenberg.org/license).](http://www.gutenberg.org/license)

## Section 1.

### General Terms of Use & Redistributing Project Gutenbergelectronic works 1.A.


By reading or using any part of this Project Gutenberg
electronic work, you indicate that you have read, understand,
agree to and accept all the terms of this license and intellectual
property (trademark/copyright) agreement. If you do not agree
to abide by all the terms of this agreement, you must cease using
and return or destroy all copies of Project Gutenbergelectronic
works in your possession. If you paid a fee for obtaining a copy
of or access to a Project Gutenbergelectronic work and you do
not agree to be bound by the terms of this agreement, you may
obtain a refund from the person or entity to whom you paid the
fee as set forth in paragraph 1.E.8.


The Full Project Gutenberg License 405

### 1.B.


Project Gutenberg is a registered trademark. It may only be
used on or associated in any way with an electronic work by
people who agree to be bound by the terms of this agreement.
There are a few things that you can do with most Project
Gutenbergelectronic works even without complying with the
full terms of this agreement. See paragraph 1.C below. There are
a lot of things you can do with Project Gutenbergelectronic
works if you follow the terms of this agreement and help preserve
free future access to Project Gutenbergelectronic works. See
paragraph 1.E below.

### 1.C.


The Project Gutenberg Literary Archive Foundation (the
Foundation or PGLAF), owns a compilation copyright in the
collection of Project Gutenbergelectronic works. Nearly all
the individual works in the collection are in the public domain in
the United States. If an individual work is in the public domain
in the United States and you are located in the United States, we
do not claim a right to prevent you from copying, distributing,
performing, displaying or creating derivative works based on the
work as long as all references to Project Gutenberg are removed.
Of course, we hope that you will support the Project Gutenberg
mission of promoting free access to electronic works by freely
sharing Project Gutenbergworks in compliance with the terms
of this agreement for keeping the Project Gutenbergname
associated with the work. You can easily comply with the terms
of this agreement by keeping this work in the same format with
its attached full Project GutenbergLicense when you share it
without charge with others.


406 Johann Sebastian Bach

### 1.D.


The copyright laws of the place where you are located also
govern what you can do with this work. Copyright laws in most
countries are in a constant state of change. If you are outside
the United States, check the laws of your country in addition
to the terms of this agreement before downloading, copying,
displaying, performing, distributing or creating derivative works
based on this work or any other Project Gutenbergwork. The
Foundation makes no representations concerning the copyright
status of any work in any country outside the United States.

### 1.E.


Unless you have removed all references to Project Gutenberg:


1.E.1.


The following sentence, with active links to, or other immediate
access to, the full Project GutenbergLicense must appear
prominently whenever any copy of a Project Gutenbergwork
(any work on which the phrase Project Gutenberg appears,
or with which the phrase Project Gutenberg is associated) is
accessed, displayed, performed, viewed, copied or distributed:


This eBook is for the use of anyone anywhere at no cost
and with almost no restrictions whatsoever. You may copy
it, give it away or re-use it under the terms of the Project
Gutenberg License included with this eBook or online at
[http://www.gutenberg.org](http://www.gutenberg.org)


1.E.2.


The Full Project Gutenberg License 407


If an individual Project Gutenbergelectronic work is derived
from the public domain (does not contain a notice indicating that
it is posted with permission of the copyright holder), the work can
be copied and distributed to anyone in the United States without
paying any fees or charges. If you are redistributing or providing
access to a work with the phrase Project Gutenberg associated
with or appearing on the work, you must comply either with
the requirements of paragraphs 1.E.1 through 1.E.7 or obtain
permission for the use of the work and the Project Gutenberg
trademark as set forth in paragraphs 1.E.8 or 1.E.9.


1.E.3.


If an individual Project Gutenbergelectronic work is posted
with the permission of the copyright holder, your use and
distribution must comply with both paragraphs 1.E.1 through
1.E.7 and any additional terms imposed by the copyright holder.
Additional terms will be linked to the Project Gutenberg
License for all works posted with the permission of the copyright
holder found at the beginning of this work.


1.E.4.


Do not unlink or detach or remove the full Project Gutenberg
License terms from this work, or any files containing a part of
this work or any other work associated with Project Gutenberg.


1.E.5.


Do not copy, display, perform, distribute or redistribute this
electronic work, or any part of this electronic work, without
prominently displaying the sentence set forth in paragraph 1.E.1


408 Johann Sebastian Bach


with active links or immediate access to the full terms of the

Project GutenbergLicense.


1.E.6.


You may convert to and distribute this work in any binary,
compressed, marked up, nonproprietary or proprietary form,
including any word processing or hypertext form. However,
if you provide access to or distribute copies of a Project
Gutenbergwork in a format other than Plain Vanilla ASCII
or other format used in the official version posted on the official
Project Gutenbergweb site (http://www.gutenberg.org), you
must, at no additional cost, fee or expense to the user, provide
a copy, a means of exporting a copy, or a means of obtaining
a copy upon request, of the work in its original Plain Vanilla
ASCII or other form. Any alternate format must include the full
Project GutenbergLicense as specified in paragraph 1.E.1.


1.E.7.


Do not charge a fee for access to, viewing, displaying,
performing, copying or distributing any Project Gutenberg
works unless you comply with paragraph 1.E.8 or 1.E.9.


1.E.8.


You may charge a reasonable fee for copies of or providing
access to or distributing Project Gutenbergelectronic works
provided that


  - You pay a royalty fee of 20% of the gross profits you derive
from the use of Project Gutenbergworks calculated using
the method you already use to calculate your applicable
taxes. The fee is owed to the owner of the Project


The Full Project Gutenberg License 409


Gutenbergtrademark, but he has agreed to donate
royalties under this paragraph to the Project Gutenberg
Literary Archive Foundation. Royalty payments must
be paid within 60 days following each date on which
you prepare (or are legally required to prepare) your
periodic tax returns. Royalty payments should be clearly
marked as such and sent to the Project Gutenberg Literary
Archive Foundation at the address specified in Section
4, Information about donations to the Project Gutenberg
Literary Archive Foundation.

  - You provide a full refund of any money paid by a user
who notifies you in writing (or by e-mail) within 30 days
of receipt that s/he does not agree to the terms of the full
Project GutenbergLicense. You must require such a user
to return or destroy all copies of the works possessed in a
physical medium and discontinue all use of and all access
to other copies of Project Gutenbergworks.

  - You provide, in accordance with paragraph 1.F.3, a full
refund of any money paid for a work or a replacement copy,
if a defect in the electronic work is discovered and reported
to you within 90 days of receipt of the work.

  - You comply with all other terms of this agreement for free
distribution of Project Gutenbergworks.


1.E.9.


If you wish to charge a fee or distribute a Project Gutenberg
electronic work or group of works on different terms than are set
forth in this agreement, you must obtain permission in writing
from both the Project Gutenberg Literary Archive Foundation and
Michael Hart, the owner of the Project Gutenbergtrademark.
Contact the Foundation as set forth in Section 3 below.


410 Johann Sebastian Bach

### 1.F.


1.F.1.


Project Gutenberg volunteers and employees expend
considerable effort to identify, do copyright research on,
transcribe and proofread public domain works in creating the
Project Gutenbergcollection. Despite these efforts, Project
Gutenbergelectronic works, and the medium on which they
may be stored, may contain Defects, such as, but not limited
to, incomplete, inaccurate or corrupt data, transcription errors, a
copyright or other intellectual property infringement, a defective
or damaged disk or other medium, a computer virus, or computer
codes that damage or cannot be read by your equipment.


1.F.2.


LIMITED WARRANTY, DISCLAIMER OF DAMAGES 
Except for the Right of Replacement or Refund described
in paragraph 1.F.3, the Project Gutenberg Literary Archive
Foundation, the owner of the Project Gutenbergtrademark,
and any other party distributing a Project Gutenberg
electronic work under this agreement, disclaim all liability
to you for damages, costs and expenses, including legal
fees. YOU AGREE THAT YOU HAVE NO REMEDIES

FOR NEGLIGENCE, STRICT LIABILITY, BREACH OF

WARRANTY OR BREACH OF CONTRACT EXCEPT

THOSE PROVIDED IN PARAGRAPH F3. YOU AGREE

THAT THE FOUNDATION, THE TRADEMARK OWNER,

AND ANY DISTRIBUTOR UNDER THIS AGREEMENT

WILL NOT BE LIABLE TO YOU FOR ACTUAL,
DIRECT, INDIRECT, CONSEQUENTIAL, PUNITIVE OR


The Full Project Gutenberg License 411


INCIDENTAL DAMAGES EVEN IF YOU GIVE NOTICE

OF THE POSSIBILITY OF SUCH DAMAGE.


1.F.3.


LIMITED RIGHT OF REPLACEMENT OR REFUND  If

you discover a defect in this electronic work within 90 days
of receiving it, you can receive a refund of the money (if any)
you paid for it by sending a written explanation to the person
you received the work from. If you received the work on a
physical medium, you must return the medium with your written
explanation. The person or entity that provided you with the
defective work may elect to provide a replacement copy in lieu
of a refund. If you received the work electronically, the person
or entity providing it to you may choose to give you a second
opportunity to receive the work electronically in lieu of a refund.
If the second copy is also defective, you may demand a refund
in writing without further opportunities to fix the problem.


1.F.4.


Except for the limited right of replacement or refund set
forth in paragraph 1.F.3, this work is provided to you 'ASIS,' WITH NO OTHER WARRANTIES OF ANY KIND,

EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED

TO WARRANTIES OF MERCHANTIBILITY OR FITNESS

FOR ANY PURPOSE.


1.F.5.


Some states do not allow disclaimers of certain implied warranties
or the exclusion or limitation of certain types of damages.
If any disclaimer or limitation set forth in this agreement


412 Johann Sebastian Bach


violates the law of the state applicable to this agreement, the
agreement shall be interpreted to make the maximum disclaimer
or limitation permitted by the applicable state law. The invalidity
or unenforceability of any provision of this agreement shall not
void the remaining provisions.


1.F.6.


INDEMNITY  You agree to indemnify and hold the
Foundation, the trademark owner, any agent or employee of
the Foundation, anyone providing copies of Project Gutenberg
electronic works in accordance with this agreement, and any
volunteers associated with the production, promotion and
distribution of Project Gutenbergelectronic works, harmless
from all liability, costs and expenses, including legal fees, that
arise directly or indirectly from any of the following which you
do or cause to occur: (a) distribution of this or any Project
Gutenbergwork, (b) alteration, modification, or additions or
deletions to any Project Gutenbergwork, and (c) any Defect

you cause.

## Section 2.

### Information about the Mission of Project Gutenberg


Project Gutenbergis synonymous with the free distribution
of electronic works in formats readable by the widest variety
of computers including obsolete, old, middle-aged and new
computers. It exists because of the efforts of hundreds of
volunteers and donations from people in all walks of life.


The Full Project Gutenberg License 413


Volunteers and financial support to provide volunteers with the
assistance they need, is critical to reaching Project Gutenberg's
goals and ensuring that the Project Gutenbergcollection will
remain freely available for generations to come. In 2001, the
Project Gutenberg Literary Archive Foundation was created to
provide a secure and permanent future for Project Gutenberg
and future generations. To learn more about the Project
Gutenberg Literary Archive Foundation and how your efforts
and donations can help, see Sections 3 and 4 and the Foundation
[web page at http://www.pglaf.org.](http://www.pglaf.org)

## Section 3.

### Information about the Project Gutenberg Literary Archive Foundation


The Project Gutenberg Literary Archive Foundation is a non
profit 501(c)(3) educational corporation organized under the laws
of the state of Mississippi and granted tax exempt status by the
Internal Revenue Service. The Foundation's EIN or federal tax

identification number is 64-6221541. Its 501(c)(3) letter is posted
[at http://www.gutenberg.org/fundraising/pglaf.](http://www.gutenberg.org/fundraising/pglaf) Contributions
to the Project Gutenberg Literary Archive Foundation are tax
deductible to the full extent permitted by U.S. federal laws and
your state's laws.
The Foundation's principal office is located at 4557 Melan Dr.
S. Fairbanks, AK, 99712., but its volunteers and employees are
scattered throughout numerous locations. Its business office is
located at 809 North 1500 West, Salt Lake City, UT 84116, (801)
596-1887, email business@pglaf.org. Email contact links and up


414 Johann Sebastian Bach


to date contact information can be found at the Foundation's web

[site and official page at http://www.pglaf.org](http://www.pglaf.org)
For additional contact information:


Dr. Gregory B. Newby

Chief Executive and Director

gbnewby@pglaf.org

## Section 4.

### Information about Donations to the Project Gutenberg Literary Archive Foundation


Project Gutenbergdepends upon and cannot survive without
wide spread public support and donations to carry out its mission
of increasing the number of public domain and licensed works
that can be freely distributed in machine readable form accessible
by the widest array of equipment including outdated equipment.
Many small donations ($1 to $5,000) are particularly important
to maintaining tax exempt status with the IRS.
The Foundation is committed to complying with the laws
regulating charities and charitable donations in all 50 states of
the United States. Compliance requirements are not uniform
and it takes a considerable effort, much paperwork and many
fees to meet and keep up with these requirements. We do
not solicit donations in locations where we have not received

written confirmation of compliance. To SEND DONATIONS or
determine the status of compliance for any particular state visit
[http://www.gutenberg.org/fundraising/donate](http://www.gutenberg.org/fundraising/donate)
While we cannot and do not solicit contributions from states

where we have not met the solicitation requirements, we know


The Full Project Gutenberg License 415


of no prohibition against accepting unsolicited donations from
donors in such states who approach us with offers to donate.
International donations are gratefully accepted, but we cannot
make any statements concerning tax treatment of donations
received from outside the United States. U.S. laws alone swamp
our small staff.

Please check the Project Gutenberg Web pages for current
donation methods and addresses. Donations are accepted in
a number of other ways including checks, online payments
and credit card donations. To donate, please visit:
[http://www.gutenberg.org/fundraising/donate](http://www.gutenberg.org/fundraising/donate)

## Section 5.

### General Information About Project Gutenberg electronic works.


Professor Michael S. Hart is the originator of the Project
Gutenbergconcept of a library of electronic works that could
be freely shared with anyone. For thirty years, he produced
and distributed Project GutenbergeBooks with only a loose
network of volunteer support.
Project GutenbergeBooks are often created from several
printed editions, all of which are confirmed as Public Domain in
the U.S. unless a copyright notice is included. Thus, we do not
necessarily keep eBooks in compliance with any particular paper
edition.

Each eBook is in a subdirectory of the same number as the
eBook's eBook number, often in several formats including plain
vanilla ASCII, compressed (zipped), HTML and others.


416 Johann Sebastian Bach


Corrected _editions_ of our eBooks replace the old file and take
over the old filename and etext number. The replaced older file
is renamed. _Versions_ based on separate sources are treated as
new eBooks receiving new filenames and etext numbers.
Most people start at our Web site which has the main PG
search facility:


[http://www.gutenberg.org](http://www.gutenberg.org)


This Web site includes information about Project
Gutenberg, including how to make donations to the Project
Gutenberg Literary Archive Foundation, how to help produce
our new eBooks, and how to subscribe to our email newsletter to

hear about new eBooks.


`,E9=`### **The Project Gutenberg eBook of History of Astronomy**

This ebook is for the use of anyone anywhere in the United States and most other parts of the world at
no cost and with almost no restrictions whatsoever. You may copy it, give it away or re-use it under the
[terms of the Project Gutenberg License included with this ebook or online at www.gutenberg.org. If you](https://www.gutenberg.org/)
are not located in the United States, you will have to check the laws of the country where you are
located before using this eBook.


Title: History of Astronomy


Author: George Forbes


Release date: May 1, 2005 [eBook #8172]

Most recently updated: March 21, 2020


Language: English


Credits: Produced by Jonathan Ingram, Dave Maddock, Charles Franks

and the Online Distributed Proofreading Team.


*** START OF THE PROJECT GUTENBERG EBOOK HISTORY OF ASTRONOMY ***


S IR I SAAC N EWTON
(From the bust by Roubiliac In Trinity College, Cambridge.)

# HISTORY OF ASTRONOMY

## BY


## GEORGE FORBES, M.A., F.R.S., M. INST. C. E.,

**(FORMERLY PROFESSOR OF NATURAL PHILOSOPHY, ANDERSONS COLLEGE,**
**GLASGOW)**


AUTHOR OF THE TRANSIT OF VENUS, RENDUS THEORY OF THE GLACIERS OF SAVOY,
ETC., ETC.

## CONTENTS


PREFACE


**BOOK I. THE GEOMETRICAL PERIOD**

1. PRIMITIVE ASTRONOMY AND ASTROLOGY

2. ANCIENT ASTRONOMYCHINESE AND CHALDANS

3. ANCIENT GREEK ASTRONOMY

4. THE REIGN OF EPICYCLESFROM PTOLEMY TO COPERNICUS


**BOOK II. THE DYNAMICAL PERIOD**

5. DISCOVERY OF THE TRUE SOLAR SYSTEMTYCHO BRAHEKEPLER

6. GALILEO AND THE TELESCOPENOTIONS OF GRAVITY BY HORROCKS, ETC.

7. SIR ISAAC NEWTONLAW OF UNIVERSAL GRAVITATION

8. NEWTONS SUCCESSORSHALLEY, EULER, LAGRANGE, LAPLACE, ETC.

9. DISCOVERY OF NEW PLANETSHERSCHEL, PIAZZI, ADAMS, AND LE VERRIER


**BOOK III. OBSERVATION**

10. INSTRUMENTS OF PRECISIONSIZE OF THE SOLAR SYSTEM

11. HISTORY OF THE TELESCOPESPECTROSCOPE


**BOOK IV. THE PHYSICAL PERIOD**

12. THE SUN

13. THE MOON AND PLANETS

14. COMETS AND METEORS

15. THE STARS AND NEBUL


ILLUSTRATIONS

INDEX


## PREFACE

An attempt has been made in these pages to trace the evolution of intellectual thought in the progress of
astronomical discovery, and, by recognising the different points of view of the different ages, to give due
credit even to the ancients. No one can expect, in a history of astronomy of limited size, to find a treatise on
practical or on theoretical astronomy, nor a complete descriptive astronomy, and still less a book on
speculative astronomy. Something of each of these is essential, however, for tracing the progress of thought
and knowledge which it is the object of this History to describe.


The progress of human knowledge is measured by the increased habit of looking at facts from new points
of view, as much as by the accumulation of facts. The mental capacity of one age does not seem to differ
from that of other ages; but it is the imagination of new points of view that gives a wider scope to that
capacity. And this is cumulative, and therefore progressive. Aristotle viewed the solar system as a geometrical
problem; Kepler and Newton converted the point of view into a dynamical one. Aristotles mental capacity to
understand the meaning of facts or to criticise a train of reasoning may have been equal to that of Kepler or
Newton, but the point of view was different.


Then, again, new points of view are provided by the invention of new methods in that system of logic
which we call mathematics. All that mathematics can do is to assure us that a statement A is equivalent to
statements B, C, D, or is one of the facts expressed by the statements B, C, D; so that we may know, if B, C,
and D are true, then A is true. To many people our inability to understand all that is contained in statements
B, C, and D, without the cumbrous process of a mathematical demonstration, proves the feebleness of the
human mind as a logical machine. For it required the new point of view imagined by Newtons analysis to
enable people to see that, so far as planetary orbits are concerned, Keplers three laws (B, C, D) were
identical with Newtons law of gravitation (A). No one recognises more than the mathematical astronomer
this feebleness of the human intellect, and no one is more conscious of the limitations of the logical process
called mathematics, which even now has not solved directly the problem of only three bodies.

These reflections, arising from the writing of this History, go to explain the invariable humility of the great
mathematical astronomers. Newtons comparison of himself to the child on the seashore applies to them all.
As each new discovery opens up, it may be, boundless oceans for investigation, for wonder, and for
admiration, the great astronomers, refusing to accept mere hypotheses as true, have founded upon these
discoveries a science as exact in its observation of facts as in theories. So it is that these men, who have built
up the most sure and most solid of all the sciences, refuse to invite others to join them in vain speculation.
The writer has, therefore, in this short History, tried to follow that great master, Airy, whose pupil he was, and
the key to whose character was exactness and accuracy; and he recognises that Science is impotent except in
her own limited sphere.


It has been necessary to curtail many parts of the History in the attemptperhaps a hopeless oneto lay
before the reader in a limited space enough about each age to illustrate its tone and spirit, the ideals of the
workers, the gradual addition of new points of view and of new means of investigation.


It would, indeed, be a pleasure to entertain the hope that these pages might, among new recruits, arouse an
interest in the greatest of all the sciences, or that those who have handled the theoretical or practical side
might be led by them to read in the original some of the classics of astronomy. Many students have much
compassion for the schoolboy of to-day, who is not allowed the luxury of learning the art of reasoning from
him who still remains pre-eminently its greatest exponent, Euclid. These students pity also the man of tomorrow, who is not to be allowed to read, in the original Latin of the brilliant Kepler, how he was ableby
observations taken from a moving platform, the earth, of the directions of a moving object, Marsto deduce
the exact shape of the path of each of these planets, and their actual positions on these paths at any time.
Keplers masterpiece is one of the most interesting books that was ever written, combining wit, imagination,
ingenuity, and certainty.


Lastly, it must be noted that, as a History of England cannot deal with the present Parliament, so also the
unfinished researches and untested hypotheses of many well-known astronomers of to-day cannot be
included among the records of the History of Astronomy. The writer regrets the necessity that thus arises of
leaving without mention the names of many who are now making history in astronomical work.


G. F.



_August_ 1 _st_, 1909.


## BOOK I. THE GEOMETRICAL PERIOD


## 1. PRIMITIVE ASTRONOMY AND ASTROLOGY.

The growth of intelligence in the human race has its counterpart in that of the individual, especially in the
earliest stages. Intellectual activity and the development of reasoning powers are in both cases based upon the
accumulation of experiences, and on the comparison, classification, arrangement, and nomenclature of these
experiences. During the infancy of each the succession of events can be watched, but there can be no _ priori_
anticipations. Experience alone, in both cases, leads to the idea of cause and effect as a principle that seems
to dominate our present universe, as a rule for predicting the course of events, and as a guide to the choice of
a course of action. This idea of cause and effect is the most potent factor in developing the history of the
human race, as of the individual.


In no realm of nature is the principle of cause and effect more conspicuous than in astronomy; and we fall
into the habit of thinking of its laws as not only being unchangeable in our universe, but necessary to the
conception of any universe that might have been substituted in its place. The first inhabitants of the world
were compelled to accommodate their acts to the daily and annual alternations of light and darkness and of
heat and cold, as much as to the irregular changes of weather, attacks of disease, and the fortune of war. They
soon came to regard the influence of the sun, in connection with light and heat, as a cause. This led to a
search for other signs in the heavens. If the appearance of a comet was sometimes noted simultaneously with
the death of a great ruler, or an eclipse with a scourge of plague, these might well be looked upon as causes in
the same sense that the veering or backing of the wind is regarded as a cause of fine or foul weather.

For these reasons we find that the earnest men of all ages have recorded the occurrence of comets, eclipses,
new stars, meteor showers, and remarkable conjunctions of the planets, as well as plagues and famines,
floods and droughts, wars and the deaths of great rulers. Sometimes they thought they could trace
connections which might lead them to say that a comet presaged famine, or an eclipse war.


Even if these men were sometimes led to evolve laws of cause and effect which now seem to us absurd, let
us be tolerant, and gratefully acknowledge that these astrologers, when they suggested such working
hypotheses, were laying the foundations of observation and deduction.

If the ancient Chaldans gave to the planetary conjunctions an influence over terrestrial events, let us
remember that in our own time people have searched for connection between terrestrial conditions and
periods of unusual prevalence of sun spots; while De la Rue, Loewy, and Balfour Stewart [[1]] thought they
found a connection between sun-spot displays and the planetary positions. Thus we find scientific men, even
in our own time, responsible for the belief that storms in the Indian Ocean, the fertility of German vines,
famines in India, and high or low Nile-floods in Egypt follow the planetary positions.

And, again, the desire to foretell the weather is so laudable that we cannot blame the ancient Greeks for
announcing the influence of the moon with as much confidence as it is affirmed in Lord Wolseleys _Soldiers_
_Pocket Book_ .


Even if the scientific spirit of observation and deduction (astronomy) has sometimes led to erroneous
systems for predicting terrestrial events (astrology), we owe to the old astronomer and astrologer alike the
deepest gratitude for their diligence in recording astronomical events. For, out of the scanty records which
have survived the destructive acts of fire and flood, of monarchs and mobs, we have found much that has
helped to a fuller knowledge of the heavenly motions than was possible without these records.


So Hipparchus, about 150 B.C., and Ptolemy a little later, were able to use the observations of Chaldan
astrologers, as well as those of Alexandrian astronomers, and to make some discoveries which have helped
the progress of astronomy in all ages. So, also, Mr. Cowell [[2]] has examined the marks made on the baked
bricks used by the Chaldans for recording the eclipses of 1062 B.C. and 762 B.C.; and has thereby been
enabled, in the last few years, to correct the lunar tables of Hansen, and to find a more accurate value for the
secular acceleration of the moons longitude and the node of her orbit than any that could be obtained from
modern observations made with instruments of the highest precision.

So again, Mr. Hind [[3]] was enabled to trace back the period during which Halleys comet has been a member
of the solar system, and to identify it in the Chinese observations of comets as far back as 12 B.C. Cowell and
Cromellin extended the date to 240 B.C. In the same way the comet 1861.i. has been traced back in the
Chinese records to 617 A.D. [[4]]


The theoretical views founded on Newtons great law of universal gravitation led to the conclusion that the
inclination of the earths equator to the plane of her orbit (the obliquity of the ecliptic) has been diminishing
slowly since prehistoric times; and this fact has been confirmed by Egyptian and Chinese observations on the
length of the shadow of a vertical pillar, made thousands of years before the Christian era, in summer and
winter.


There are other reasons why we must be tolerant of the crude notions of the ancients. The historian,
wishing to give credit wherever it may be due, is met by two difficulties. Firstly, only a few records of very
ancient astronomy are extant, and the authenticity of many of these is open to doubt. Secondly, it is very
difficult to divest ourselves of present knowledge, and to appreciate the originality of thought required to
make the first beginnings.

With regard to the first point, we are generally dependent upon histories written long after the events. The
astronomy of Egyptians, Babylonians, and Assyrians is known to us mainly through the Greek historians, and
for information about the Chinese we rely upon the researches of travellers and missionaries in comparatively
recent times. The testimony of the Greek writers has fortunately been confirmed, and we now have in
addition a mass of facts translated from the original sculptures, papyri, and inscribed bricks, dating back
thousands of years.


In attempting to appraise the efforts of the beginners we must remember that it was natural to look upon
the earth (as all the first astronomers did) as a circular plane, surrounded and bounded by the heaven, which
was a solid vault, or hemisphere, with its concavity turned downwards. The stars seemed to be fixed on this
vault; the moon, and later the planets, were seen to crawl over it. It was a great step to look on the vault as a
hollow sphere carrying the sun too. It must have been difficult to believe that at midday the stars are shining
as brightly in the blue sky as they do at night. It must have been difficult to explain how the sun, having set in
the west, could get back to rise in the east without being seen _if_ it was always the same sun. It was a great
step to suppose the earth to be spherical, and to ascribe the diurnal motions to its rotation. Probably the
greatest step ever made in astronomical theory was the placing of the sun, moon, and planets at different
distances from the earth instead of having them stuck on the vault of heaven. It was a transition from
flatland to a space of three dimensions.

Great progress was made when systematic observations began, such as following the motion of the moon
and planets among the stars, and the inferred motion of the sun among the stars, by observing their _heliacal_
_risings_ i.e., the times of year when a star would first be seen to rise at sunrise, and when it could last be
seen to rise at sunset. The grouping of the stars into constellations and recording their places was a useful
observation. The theoretical prediction of eclipses of the sun and moon, and of the motions of the planets
among the stars, became later the highest goal in astronomy.


To not one of the above important steps in the progress of astronomy can we assign the author with
certainty. Probably many of them were independently taken by Chinese, Indian, Persian, Tartar, Egyptian,
Babylonian, Assyrian, Phoenician, and Greek astronomers. And we have not a particle of information about
the discoveries, which may have been great, by other peoplesby the Druids, the Mexicans, and the
Peruvians, for example.


We do know this, that all nations required to have a calendar. The solar year, the lunar month, and the day
were the units, and it is owing to their incommensurability that we find so many calendars proposed and in
use at different times. The only object to be attained by comparing the chronologies of ancient races is to fix
the actual dates of observations recorded, and this is not a part of a history of astronomy.


In conclusion, let us bear in mind the limited point of view of the ancients when we try to estimate their
merit. Let us remember that the first astronomy was of two dimensions; the second astronomy was of three
dimensions, but still purely geometrical. Since Keplers day we have had a dynamical astronomy.


**FOOTNOTES:**


[1] Trans. R. S. E., xxiii. 1864, p. 499, _On Sun Spots_, _etc_ ., by B. Stewart. Also Trans. R. S. 1860-70. Also
Prof. Ernest Brown, in _R. A. S. Monthly Notices_, 1900.


[2] _R. A. S. Monthly Notices_, Sup.; 1905.


C HALDAN B AKED B RICK OR T ABLET,

_Obverse and reverse sides_,
Containing record of solar eclipse, 1062 B.C., used lately by
Cowell for rendering the lunar theory more accurate than was

possible by finest modern observations. (British Museum

collection, No. 35908.)


[3] _R. A. S. Monthly Notices_, vol. x., p. 65.


[4] R. S. E. Proc., vol. x., 1880.


## 2. ANCIENT ASTRONOMYTHE CHINESE AND CHALDANS.

The last section must have made clear the difficulties the way of assigning to the ancient nations their
proper place in the development of primitive notions about astronomy. The fact that some alleged
observations date back to a period before the Chinese had invented the art of writing leads immediately to the
question how far tradition can be trusted.

Our first detailed knowledge was gathered in the far East by travellers, and by the Jesuit priests, and was
published in the eighteenth century. The Asiatic Society of Bengal contributed translations of Brahmin
literature. The two principal sources of knowledge about Chinese astronomy were supplied, first by Father
Souciet, who in 1729 published _Observations Astronomical, Geographical, Chronological, and Physical_,
drawn from ancient Chinese books; and later by Father Moyriac-de-Mailla, who in 1777-1785 published
_Annals of the Chinese Empire, translated from Tong-Kien-Kang-Mou_ .


Bailly, in his _Astronomie Ancienne_ (1781), drew, from these and other sources, the conclusion that all we
know of the astronomical learning of the Chinese, Indians, Chaldans, Assyrians, and Egyptians is but the
remnant of a far more complete astronomy of which no trace can be found.


Delambre, in his _Histoire de lAstronomie Ancienne_ (1817), ridicules the opinion of Bailly, and considers
that the progress made by all of these nations is insignificant.

It will be well now to give an idea of some of the astronomy of the ancients not yet entirely discredited.
China and Babylon may be taken as typical examples.

_China_ .It would appear that Fohi, the first emperor, reigned about 2952 B.C., and shortly afterwards YuChi made a sphere to represent the motions of the celestial bodies. It is also mentioned, in the book called
Chu-King, supposed to have been written in 2205 B.C., that a similar sphere was made in the time of Yao
(2357 B.C.). [[1]] It is said that the Emperor Chueni (2513 B.C.) saw five planets in conjunction the same day
that the sun and moon were in conjunction. This is discussed by Father Martin (MSS. of De Lisle); also by
M. Desvignolles (Mem. Acad. Berlin, vol. iii., p. 193), and by M. Kirsch (ditto, vol. v., p. 19), who both
found that Mars, Jupiter, Saturn, and Mercury were all between the eleventh and eighteenth degrees of
Pisces, all visible together in the evening on February 28th 2446 B.C., while on the same day the sun and
moon were in conjunction at 9 a.m., and that on March 1st the moon was in conjunction with the other four
planets. But this needs confirmation.

Yao, referred to above, gave instructions to his astronomers to determine the positions of the solstices and
equinoxes, and they reported the names of the stars in the places occupied by the sun at these seasons, and in
2285 B.C. he gave them further orders. If this account be true, it shows a knowledge that the vault of heaven
is a complete sphere, and that stars are shining at mid-day, although eclipsed by the suns brightness.


It is also asserted, in the book called _Chu-King_, that in the time of Yao the year was known to have 365
days, and that he adopted 365 days and added an intercalary day every four years (as in the Julian Calendar).
This may be true or not, but the ancient Chinese certainly seem to have divided the circle into 365 degrees.
To learn the length of the year needed only patient observationa characteristic of the Chinese; but many
younger nations got into a terrible mess with their calendar from ignorance of the years length.


It is stated that in 2159 B.C. the royal astronomers Hi and Ho failed to predict an eclipse. It probably
created great terror, for they were executed in punishment for their neglect. If this account be true, it means
that in the twenty-second century B.C. some rule for calculating eclipses was in use. Here, again, patient
observation would easily lead to the detection of the eighteen-year cycle known to the Chaldeans as the
_Saros_ . It consists of 235 lunations, and in that time the pole of the moons orbit revolves just once round the
pole of the ecliptic, and for this reason the eclipses in one cycle are repeated with very slight modification in
the next cycle, and so on for many centuries.

It may be that the neglect of their duties by Hi and Ho, and their punishment, influenced Chinese
astronomy; or that the succeeding records have not been available to later scholars; but the fact remains that
although at long intervals observations were made of eclipses, comets, and falling stars, and of the position
of the solstices, and of the obliquity of the eclipticrecords become rare, until 776 B.C., when eclipses
began to be recorded once more with some approach to continuity. Shortly afterwards notices of comets were
added. Biot gave a list of these, and Mr. John Williams, in 1871, published _Observations of Comets from 611_
_B.C. to 1640 A.D., Extracted from the Chinese Annals_ .


With regard to those centuries concerning which we have no astronomical Chinese records, it is fair to
state that it is recorded that some centuries before the Christian era, in the reign of Tsin-Chi-Hoang, all the
classical and scientific books that could be found were ordered to be destroyed. If true, our loss therefrom is
as great as from the burning of the Alexandrian library by the Caliph Omar. He burnt all the books because he
held that they must be either consistent or inconsistent with the Koran, and in the one case they were
superfluous, in the other case objectionable.

_Chaldans_ .Until the last half century historians were accustomed to look back upon the Greeks, who
led the world from the fifth to the third century B.C., as the pioneers of art, literature, and science. But the
excavations and researches of later years make us more ready to grant that in science as in art the Greeks only
developed what they derived from the Egyptians, Babylonians, and Assyrians. The Greek historians said as
much, in fact; and modern commentators used to attribute the assertion to undue modesty. Since, however,
the records of the libraries have been unearthed it has been recognised that the Babylonians were in no way
inferior in the matter of original scientific investigation to other races of the same era.

The Chaldans, being the most ancient Babylonians, held the same station and dignity in the State as did
the priests in Egypt, and spent all their time in the study of philosophy and astronomy, and the arts of
divination and astrology. They held that the world of which we have a conception is an eternal world without
any beginning or ending, in which all things are ordered by rules supported by a divine providence, and that
the heavenly bodies do not move by chance, nor by their own will, but by the determinate will and
appointment of the gods. They recorded these movements, but mainly in the hope of tracing the will of the
gods in mundane affairs. Ptolemy (about 130 A.D.) made use of Babylonian eclipses in the eighth century
B.C. for improving his solar and lunar tables.


Fragments of a library at Agade have been preserved at Nineveh, from which we learn that the star-charts
were even then divided into constellations, which were known by the names which they bear to this day, and
that the signs of the zodiac were used for determining the courses of the sun, moon, and of the five planets
Mercury, Venus, Mars, Jupiter, and Saturn.


We have records of observations carried on under Asshurbanapal, who sent astronomers to different parts
to study celestial phenomena. Here is one:


To the Director of Observations,My Lord, his humble servant Nabushum-iddin, Great Astronomer of
Nineveh, writes thus: May Nabu and Marduk be propitious to the Director of these Observations, my Lord.
The fifteenth day we observed the Node of the moon, and the moon was eclipsed.

The Phoenicians are supposed to have used the stars for navigation, but there are no records. The Egyptian
priests tried to keep such astronomical knowledge as they possessed to themselves. It is probable that they
had arbitrary rules for predicting eclipses. All that was known to the Greeks about Egyptian science is to be
found in the writings of Diodorus Siculus. But confirmatory and more authentic facts have been derived from
late explorations. Thus we learn from E. B. Knobel [[2]] about the Jewish calendar dates, on records of land
sales in Aramaic papyri at Assuan, translated by Professor A. H. Sayce and A. E. Cowley, (1) that the lunar
cycle of nineteen years was used by the Jews in the fifth century B.C. [the present reformed Jewish calendar
dating from the fourth century A.D.], a date a little more than a century after the grandfathers and greatgrandfathers of those whose business is recorded had fled into Egypt with Jeremiah (Sayce); and (2) that the
order of intercalation at that time was not dissimilar to that in use at the present day.


Then again, Knobel reminds us of the most interesting discovery a few years ago by Father Strassmeier of
a Babylonian tablet recording a partial lunar eclipse at Babylon in the seventh year of Cambyses, on the
fourteenth day of the Jewish month Tammuz. Ptolemy, in the Almagest (Suntaxis), says it occurred in the
seventh year of Cambyses, on the night of the seventeenth and eighteenth of the Egyptian month Phamenoth.
Pingr and Oppolzer fix the date July 16th, 533 B.C. Thus are the relations of the chronologies of Jews and
Egyptians established by these explorations.


**FOOTNOTES:**


[1] These ancient dates are uncertain.


[2] _R. A. S. Monthly Notices_, vol. lxviii., No. 5, March, 1908.


## 3. ANCIENT GREEK ASTRONOMY.

We have our information about the earliest Greek astronomy from Herodotus (born 480 B.C.). He put the
traditions into writing. Thales (639-546 B.C.) is said to have predicted an eclipse, which caused much alarm,
and ended the battle between the Medes and Lydians. Airy fixed the date May 28th, 585 B.C. But other
modern astronomers give different dates. Thales went to Egypt to study science, and learnt from its priests
the length of the year (which was kept a profound secret!), and the signs of the zodiac, and the positions of
the solstices. He held that the sun, moon, and stars are not mere spots on the heavenly vault, but solids; that
the moon derives her light from the sun, and that this fact explains her phases; that an eclipse of the moon
happens when the earth cuts off the suns light from her. He supposed the earth to be flat, and to float upon
water. He determined the ratio of the suns diameter to its orbit, and apparently made out the diameter
correctly as half a degree. He left nothing in writing.


His successors, Anaximander (610-547 B.C.) and Anaximenes (550-475 B.C.), held absurd notions about
the sun, moon, and stars, while Heraclitus (540-500 B.C.) supposed that the stars were lighted each night like
lamps, and the sun each morning. Parmenides supposed the earth to be a sphere.


Pythagoras (569-470 B.C.) visited Egypt to study science. He deduced his system, in which the earth
revolves in an orbit, from fantastic first principles, of which the following are examples: The circular motion
is the most perfect motion, Fire is more worthy than earth, Ten is the perfect number. He wrote nothing,
but is supposed to have said that the earth, moon, five planets, and fixed stars all revolve round the sun, which
itself revolves round an imaginary central fire called the Antichthon. Copernicus in the sixteenth century
claimed Pythagoras as the founder of the system which he, Copernicus, revived.


Anaxagoras (born 499 B.C.) studied astronomy in Egypt. He explained the return of the sun to the east
each morning by its going under the flat earth in the night. He held that in a solar eclipse the moon hides the
sun, and in a lunar eclipse the moon enters the earths shadowboth excellent opinions. But he entertained
absurd ideas of the vortical motion of the heavens whisking stones into the sky, there to be ignited by the
fiery firmament to form stars. He was prosecuted for this unsettling opinion, and for maintaining that the
moon is an inhabited earth. He was defended by Pericles (432 B.C.).


Solon dabbled, like many others, in reforms of the calendar. The common year of the Greeks originally had
360 daystwelve months of thirty days. Solons year was 354 days. It is obvious that these erroneous years
would, before long, remove the summer to January and the winter to July. To prevent this it was customary at
regular intervals to intercalate days or months. Meton (432 B.C.) introduced a reform based on the nineteenyear cycle. This is not the same as the Egyptian and Chaldean eclipse cycle called _Saros_ of 223 lunations, or
a little over eighteen years. The Metonic cycle is 235 lunations or nineteen years, after which period the sun
and moon occupy the same position relative to the stars. It is still used for fixing the date of Easter, the
number of the year in Melons cycle being the golden number of our prayer-books. Melons system divided
the 235 lunations into months of thirty days and omitted every sixty-third day. Of the nineteen years, twelve
had twelve months and seven had thirteen months.


Callippus (330 B.C.) used a cycle four times as long, 940 lunations, but one day short of Melons seventysix years. This was more correct.


Eudoxus (406-350 B.C.) is said to have travelled with Plato in Egypt. He made astronomical observations
in Asia Minor, Sicily, and Italy, and described the starry heavens divided into constellations. His name is
connected with a planetary theory which as generally stated sounds most fanciful. He imagined the fixed stars
to be on a vault of heaven; and the sun, moon, and planets to be upon similar vaults or spheres, twenty-six
revolving spheres in all, the motion of each planet being resolved into its components, and a separate sphere
being assigned for each component motion. Callippus (330 B.C.) increased the number to thirty-three. It is
now generally accepted that the real existence of these spheres was not suggested, but the idea was only a
mathematical conception to facilitate the construction of tables for predicting the places of the heavenly
bodies.


Aristotle (384-322 B.C.) summed up the state of astronomical knowledge in his time, and held the earth to
be fixed in the centre of the world.

Nicetas, Heraclides, and Ecphantes supposed the earth to revolve on its axis, but to have no orbital motion.


The short epitome so far given illustrates the extraordinary deductive methods adopted by the ancient
Greeks. But they went much farther in the same direction. They seem to have been in great difficulty to
explain how the earth is supported, just as were those who invented the myth of Atlas, or the Indians with the
tortoise. Thales thought that the flat earth floated on water. Anaxagoras thought that, being flat, it would be
buoyed up and supported on the air like a kite. Democritus thought it remained fixed, like the donkey
between two bundles of hay, because it was equidistant from all parts of the containing sphere, and there was
no reason why it should incline one way rather than another. Empedocles attributed its state of rest to
centrifugal force by the rapid circular movement of the heavens, as water is stationary in a pail when whirled
round by a string. Democritus further supposed that the inclination of the flat earth to the ecliptic was due to
the greater weight of the southern parts owing to the exuberant vegetation.


For further references to similar efforts of imagination the reader is referred to Sir George Cornwall
Lewiss _Historical Survey of the Astronomy of the Ancients_ ; London, 1862. His list of authorities is very
complete, but some of his conclusions are doubtful. At p. 113 of that work he records the real opinions of
Socrates as set forth by Xenophon; and the reader will, perhaps, sympathise with Socrates in his views on
contemporary astronomy:


With regard to astronomy he [Socrates] considered a knowledge of it desirable to the extent of determining
the day of the year or month, and the hour of the night, ... but as to learning the courses of the stars, to be
occupied with the planets, and to inquire about their distances from the earth, and their orbits, and the causes
of their motions, he strongly objected to such a waste of valuable time. He dwelt on the contradictions and
conflicting opinions of the physical philosophers, ... and, in fine, he held that the speculators on the universe
and on the laws of the heavenly bodies were no better than madmen ( _Xen. Mem_, i. 1, 11-15).


Plato (born 429 B.C.), the pupil of Socrates, the fellow-student of Euclid, and a follower of Pythagoras,
studied science in his travels in Egypt and elsewhere. He was held in so great reverence by all learned men
that a problem which he set to the astronomers was the keynote to all astronomical investigation from this
date till the time of Kepler in the sixteenth century. He proposed to astronomers _the problem of representing_
_the courses of the planets by circular and uniform motions_ .


Systematic observation among the Greeks began with the rise of the Alexandrian school. Aristillus and
Timocharis set up instruments and fixed the positions of the zodiacal stars, near to which all the planets in
their orbits pass, thus facilitating the determination of planetary motions. Aristarchus (320-250 B.C.) showed
that the sun must be at least nineteen times as far off as the moon, which is far short of the mark. He also
found the suns diameter, correctly, to be half a degree. Eratosthenes (276-196 B.C.) measured the inclination
to the equator of the suns apparent path in the heavensi.e., he measured the obliquity of the ecliptic,
making it 23 51, confirming our knowledge of its continuous diminution during historical times. He
measured an arc of meridian, from Alexandria to Syene (Assuan), and found the difference of latitude by the
length of a shadow at noon, summer solstice. He deduced the diameter of the earth, 250,000 stadia.
Unfortunately, we do not know the length of the stadium he used.


Hipparchus (190-120 B.C.) may be regarded as the founder of observational astronomy. He measured the
obliquity of the ecliptic, and agreed with Eratosthenes. He altered the length of the tropical year from 365
days, 6 hours to 365 days, 5 hours, 53 minutesstill four minutes too much. He measured the equation of
time and the irregular motion of the sun; and allowed for this in his calculations by supposing that the centre,
about which the sun moves uniformly, is situated a little distance from the fixed earth. He called this point the
_excentric_ . The line from the earth to the excentric was called the _line of apses_ . A circle having this centre
was called the _equant_, and he supposed that a radius drawn to the sun from the excentric passes over equal
arcs on the equant in equal times. He then computed tables for predicting the place of the sun.


He proceeded in the same way to compute Lunar tables. Making use of Chaldan eclipses, he was able to
get an accurate value of the moons mean motion. [Halley, in 1693, compared this value with his own
measurements, and so discovered the acceleration of the moons mean motion. This was conclusively
established, but could not be explained by the Newtonian theory for quite a long time.] He determined the
plane of the moons orbit and its inclination to the ecliptic. The motion of this plane round the pole of the
ecliptic once in eighteen years complicated the problem. He located the moons excentric as he had done the
suns. He also discovered some of the minor irregularities of the moons motion, due, as Newtons theory
proves, to the disturbing action of the suns attraction.


In the year 134 B.C. Hipparchus observed a new star. This upset every notion about the permanence of the
fixed stars. He then set to work to catalogue all the principal stars so as to know if any others appeared or
disappeared. Here his experiences resembled those of several later astronomers, who, when in search of some
special object, have been rewarded by a discovery in a totally different direction. On comparing his star


positions with those of Timocharis and Aristillus he found no stars that had appeared or disappeared in the
interval of 150 years; but he found that all the stars seemed to have changed their places with reference to
that point in the heavens where the ecliptic is 90 from the poles of the earthi.e., the equinox. He found
that this could be explained by a motion of the equinox in the direction of the apparent diurnal motion of the
stars. This discovery of _precession of the equinoxes_, which takes place at the rate of 52".1 every year, was
necessary for the progress of accurate astronomical observations. It is due to a steady revolution of the earths
pole round the pole of the ecliptic once in 26,000 years in the opposite direction to the planetary revolutions.


Hipparchus was also the inventor of trigonometry, both plane and spherical. He explained the method of
using eclipses for determining the longitude.


In connection with Hipparchus great discovery it may be mentioned that modern astronomers have often
attempted to fix dates in history by the effects of precession of the equinoxes. (1) At about the date when the
Great Pyramid may have been built  Draconis was near to the pole, and must have been used as the polestar. In the north face of the Great Pyramid is the entrance to an inclined passage, and six of the nine
pyramids at Gizeh possess the same feature; all the passages being inclined at an angle between 26 and 27
to the horizon and in the plane of the meridian. It also appears that 4,000 years agoi.e., about 2100 B.C.
an observer at the lower end of the passage would be able to see  Draconis, the then pole-star, at its lower
culmination. [[1]] It has been suggested that the passage was made for this purpose. On other grounds the date
assigned to the Great Pyramid is 2123 B.C.


(2) The Chaldans gave names to constellations now invisible from Babylon which would have been
visible in 2000 B.C., at which date it is claimed that these people were studying astronomy.


(3) In the Odyssey, Calypso directs Odysseus, in accordance with Phoenician rules for navigating the
Mediterranean, to keep the Great Bear ever on the left as he traversed the deep when sailing from the
pillars of Hercules (Gibraltar) to Corfu. Yet such a course taken now would land the traveller in Africa.
Odysseus is said in his voyage in springtime to have seen the Pleiades and Arcturus setting late, which
seemed to early commentators a proof of Homers inaccuracy. Likewise Homer, both in the _Odyssey_ [[2]] (v.
272-5) and in the _Iliad_ (xviii. 489), asserts that the Great Bear never set in those latitudes. Now it has been
found that the precession of the equinoxes explains all these puzzles; shows that in springtime on the
Mediterranean the Bear was just above the horizon, near the sea but not touching it, between 750 B.C. and
1000 B.C.; and fixes the date of the poems, thus confirming other evidence, and establishing Homers
character for accuracy. [[3]]


(4) The orientation of Egyptian temples and Druidical stones is such that possibly they were so placed as to
assist in the observation of the heliacal risings [[4]] of certain stars. If the star were known, this would give an
approximate date. Up to the present the results of these investigations are far from being conclusive.


Ptolemy (130 A.D.) wrote the Suntaxis, or Almagest, which includes a cyclopedia of astronomy,
containing a summary of knowledge at that date. We have no evidence beyond his own statement that he was
a practical observer. He theorised on the planetary motions, and held that the earth is fixed in the centre of the
universe. He adopted the excentric and equant of Hipparchus to explain the unequal motions of the sun and
moon. He adopted the epicycles and deferents which had been used by Apollonius and others to explain the
retrograde motions of the planets. We, who know that the earth revolves round the sun once in a year, can
understand that the apparent motion of a planet is only its motion relative to the earth. If, then, we suppose
the earth fixed and the sun to revolve round it once a year, and the planets each in its own period, it is only
necessary to impose upon each of these an additional _annual_ motion to enable us to represent truly the
apparent motions. This way of looking at the apparent motions shows why each planet, when nearest to the
earth, seems to move for a time in a retrograde direction. The attempts of Ptolemy and others of his time to
explain the retrograde motion in this way were only approximate. Let us suppose each planet to have a bar
with one end centred at the earth. If at the other end of the bar one end of a shorter bar is pivotted, having the
planet at its other end, then the planet is given an annual motion in the secondary circle (the epicycle), whose
centre revolves round the earth on the primary circle (the _deferent_ ), at a uniform rate round the excentric.
Ptolemy supposed the centres of the epicycles of Mercury and Venus to be on a bar passing through the sun,
and to be between the earth and the sun. The centres of the epicycles of Mars, Jupiter, and Saturn were
supposed to be further away than the sun. Mercury and Venus were supposed to revolve in their epicycles in
their own periodic times and in the deferent round the earth in a year. The major planets were supposed to
revolve in the deferent round the earth in their own periodic times, and in their epicycles once in a year.


It did not occur to Ptolemy to place the centres of the epicycles of Mercury and Venus at the sun, and to
extend the same system to the major planets. Something of this sort had been proposed by the Egyptians (we


are told by Cicero and others), and was accepted by Tycho Brahe; and was as true a representation of the
relative motions in the solar system as when we suppose the sun to be fixed and the earth to revolve.

The cumbrous system advocated by Ptolemy answered its purpose, enabling him to predict astronomical
events approximately. He improved the lunar theory considerably, and discovered minor inequalities which
could be allowed for by the addition of new epicycles. We may look upon these epicycles of Apollonius, and
the excentric of Hipparchus, as the responses of these astronomers to the demand of Plato for uniform
circular motions. Their use became more and more confirmed, until the seventeenth century, when the
accurate observations of Tycho Brahe enabled Kepler to abolish these purely geometrical makeshifts, and to
substitute a system in which the sun became physically its controller.


**FOOTNOTES:**


[1] _Phil. Mag_ ., vol. xxiv., pp. 481-4.


[2]
Plaeiadas t esoronte kai opse duonta bootaen
Arkton th aen kai amaxan epiklaesin kaleousin,
Ae t autou strephetai kai t Oriona dokeuei,
Oin dammoros esti loetron Okeanoio.


The Pleiades and Botes that setteth late, and the Bear, which they likewise call the Wain, which turneth
ever in one place, and keepeth watch upon Orion, and alone hath no part in the baths of the ocean.


[3] See Pearson in the Camb. Phil. Soc. Proc., vol. iv., pt. ii., p. 93, on whose authority the above statements
are made.


[4] See p. 6 for definition.


## 4. THE REIGN OF EPICYCLESFROM PTOLEMY TO COPERNICUS.

After Ptolemy had published his book there seemed to be nothing more to do for the solar system except to
go on observing and finding more and more accurate values for the constants involved--viz., the periods of
revolution, the diameter of the deferent, [[1]] and its ratio to that of the epicycle, [[2]] the distance of the excentric [[3]]
from the centre of the deferent, and the position of the line of apses, [[4]] besides the inclination and position of
the plane of the planets orbit. The only object ever aimed at in those days was to prepare tables for
predicting the places of the planets. It was not a mechanical problem; there was no notion of a governing law
of forces.


From this time onwards all interest in astronomy seemed, in Europe at least, to sink to a low ebb. When the
Caliph Omar, in the middle of the seventh century, burnt the library of Alexandria, which had been the centre
of intellectual progress, that centre migrated to Baghdad, and the Arabs became the leaders of science and
philosophy. In astronomy they made careful observations. In the middle of the ninth century Albategnius, a
Syrian prince, improved the value of excentricity of the suns orbit, observed the motion of the moons apse,
and thought he detected a smaller progression of the suns apse. His tables were much more accurate than
Ptolemys. Abul Wefa, in the tenth century, seems to have discovered the moons variation. Meanwhile the
Moors were leaders of science in the west, and Arzachel of Toledo improved the solar tables very much.
Ulugh Begh, grandson of the great Tamerlane the Tartar, built a fine observatory at Samarcand in the fifteenth
century, and made a great catalogue of stars, the first since the time of Hipparchus.

At the close of the fifteenth century King Alphonso of Spain employed computers to produce the
Alphonsine Tables (1488 A.D.), Purbach translated Ptolemys book, and observations were carried out in
Germany by Mller, known as Regiomontanus, and Waltherus.


Nicolai Copernicus, a Sclav, was born in 1473 at Thorn, in Polish Prussia. He studied at Cracow and in
Italy. He was a priest, and settled at Frauenberg. He did not undertake continuous observations, but devoted
himself to simplifying the planetary systems and devising means for more accurately predicting the positions
of the sun, moon, and planets. He had no idea of framing a solar system on a dynamical basis. His great
object was to increase the accuracy of the calculations and the tables. The results of his cogitations were
printed just before his death in an interesting book, _De Revolutionibus Orbium Celestium_ . It is only by
careful reading of this book that the true position of Copernicus can be realised. He noticed that Nicetas and
others had ascribed the apparent diurnal rotation of the heavens to a real daily rotation of the earth about its
axis, in the opposite direction to the apparent motion of the stars. Also in the writings of Martianus Capella
he learnt that the Egyptians had supposed Mercury and Venus to revolve round the sun, and to be carried with
him in his annual motion round the earth. He noticed that the same supposition, if extended to Mars, Jupiter,
and Saturn, would explain easily why they, and especially Mars, seem so much brighter in opposition. For
Mars would then be a great deal nearer to the earth than at other times. It would also explain the retrograde
motion of planets when in opposition.


We must here notice that at this stage Copernicus was actually confronted with the system accepted later
by Tycho Brahe, with the earth fixed. But he now recalled and accepted the views of Pythagoras and others,
according to which the sun is fixed and the earth revolves; and it must be noted that, geometrically, there is
no difference of any sort between the Egyptian or Tychonic system and that of Pythagoras as revived by
Copernicus, except that on the latter theory the stars ought to seem to move when the earth changes its
positiona test which failed completely with the rough means of observation then available. The radical
defect of all solar systems previous to the time of Kepler (1609 A.D.) was the slavish yielding to Platos
dictum demanding uniform circular motion for the planets, and the consequent evolution of the epicycle,
which was fatal to any conception of a dynamical theory.

Copernicus could not sever himself from this obnoxious tradition. [[5]] It is true that neither the Pythagorean
nor the Egypto-Tychonic system required epicycles for explaining retrograde motion, as the Ptolemaic theory
did. Furthermore, either system could use the excentric of Hipparchus to explain the irregular motion known
as the equation of the centre. But Copernicus remarked that he could also use an epicycle for this purpose, or
that he could use both an excentric and an epicycle for each planet, and so bring theory still closer into accord


with observation. And this he proceeded to do. [[6]] Moreover, observers had found irregularities in the moons
motion, due, as we now know, to the disturbing attraction of the sun. To correct for these irregularities
Copernicus introduced epicycle on epicycle in the lunar orbit.


This is in its main features the system propounded by Copernicus. But attention must, to state the case
fully, be drawn to two points to be found in his first and sixth books respectively. The first point relates to the
seasons, and it shows a strange ignorance of the laws of rotating bodies. To use the words of Delambre, [[7]] in
drawing attention to the strange conception,


he imagined that the earth, revolving round the sun, ought always to show to it the
same face; the contrary phenomena surprised him: to explain them he invented a third
motion, and added it to the two real motions (rotation and orbital revolution). By this
third motion the earth, he held, made a revolution on itself and on the poles of the
ecliptic once a year ... Copernicus did not know that motion in a straight line is the
natural motion, and that motion in a curve is the resultant of several movements. He
believed, with Aristotle, that circular motion was the natural one.


Copernicus made this rotation of the earths axis about the pole of the ecliptic retrograde (i.e., opposite to
the orbital revolution), and by making it perform more than one complete revolution in a year, the added part
being 1/26000 of the whole, he was able to include the precession of the equinoxes in his explanation of the
seasons. His explanation of the seasons is given on leaf 10 of his book (the pages of this book are not all
numbered, only alternate pages, or leaves).


In his sixth book he discusses the inclination of the planetary orbits to the ecliptic. In regard to this the
theory of Copernicus is unique; and it will be best to explain this in the words of Grant in his great work. [[8]]
He says:


Copernicus, as we have already remarked, did not attack the principle of the epicyclical
theory: he merely sought to make it more simple by placing the centre of the earths
orbit in the centre of the universe. This was the point to which the motions of the
planets were referred, for the planes of their orbits were made to pass through it, and
their points of least and greatest velocities were also determined with reference to it. By
this arrangement the sun was situate mathematically near the centre of the planetary
system, but he did not appear to have any physical connexion with the planets as the
centre of their motions.


According to Copernicus sixth book, the planes of the planetary orbits do not pass through the sun, and
the lines of apses do not pass through to the sun.


Such was the theory advanced by Copernicus: The earth moves in an epicycle, on a deferent whose centre
is a little distance from the sun. The planets move in a similar way on epicycles, but their deferents have no
geometrical or physical relation to the sun. The moon moves on an epicycle centred on a second epicycle,
itself centred on a deferent, excentric to the earth. The earths axis rotates about the pole of the ecliptic,
making one revolution and a twenty-six thousandth part of a revolution in the sidereal year, in the opposite
direction to its orbital motion.


In view of this fanciful structure it must be noted, in fairness to Copernicus, that he repeatedly states that
the reader is not obliged to accept his system as showing the real motions; that it does not matter whether
they be true, even approximately, or not, so long as they enable us to compute tables from which the places of
the planets among the stars can be predicted. [[9]] He says that whoever is not satisfied with this explanation
must be contented by being told that mathematics are for mathematicians (Mathematicis mathematica
scribuntur).


At the same time he expresses his conviction over and over again that the earth is in motion. It is with him
a pious belief, just as it was with Pythagoras and his school and with Aristarchus. But (as Dreyer says in his
most interesting book, _Tycho Brahe_ ) proofs of the physical truth of his system Copernicus had given none,
and could give none, any more than Pythagoras or Aristarchus.


There was nothing so startlingly simple in his system as to lead the cautious astronomer to accept it, as
there was in the later Keplerian system; and the absence of parallax in the stars seemed to condemn his
system, which had no physical basis to recommend it, and no simplification at all over the Egypto-Tychonic
system, to which Copernicus himself drew attention. It has been necessary to devote perhaps undue space to
the interesting work of Copernicus, because by a curious chance his name has become so widely known. He


has been spoken of very generally as the founder of the solar system that is now accepted. This seems unfair,
and on reading over what has been written about him at different times it will be noticed that the astronomers
those who have evidently read his great bookare very cautious in the words with which they eulogise
him, and refrain from attributing to him the foundation of our solar system, which is entirely due to Kepler. It
is only the more popular writers who give the idea that a revolution had been effected when Pythagoras
system was revived, and when Copernicus supported his view that the earth moves and is not fixed.

It may be easy to explain the association of the name of Copernicus with the Keplerian system. But the
time has long passed when the historian can support in any way this popular error, which was started not by
astronomers acquainted with Keplers work, but by those who desired to put the Church in the wrong by
extolling Copernicus.


Copernicus dreaded much the abuse he expected to receive from philosophers for opposing the authority of
Aristotle, who had declared that the earth was fixed. So he sought and obtained the support of the Church,
dedicating his great work to Pope Paul III. in a lengthy explanatory epistle. The Bishop of Cracow set up a
memorial tablet in his honour.


Copernicus was the most refined exponent, and almost the last representative, of the Epicyclical School. As
has been already stated, his successor, Tycho Brahe, supported the same use of epicycles and excentrics as
Copernicus, though he held the earth to be fixed. But Tycho Brahe was eminently a practical observer, and
took little part in theory; and his observations formed so essential a portion of the system of Kepler that it is
only fair to include his name among these who laid the foundations of the solar system which we accept today.


In now taking leave of the system of epicycles let it be remarked that it has been held up to ridicule more
than it deserves. On reading Airys account of epicycles, in the beautifully clear language of his _Six Lectures_
_on Astronomy_, the impression is made that the jointed bars there spoken of for describing the circles were
supposed to be real. This is no more the case than that the spheres of Eudoxus and Callippus were supposed
to be real. Both were introduced only to illustrate the mathematical conception upon which the solar,
planetary, and lunar tables were constructed. The epicycles represented nothing more nor less than the first
terms in the Fourier series, which in the last century has become a basis of such calculations, both in
astronomy and physics generally.


Q UADRANS M URALIS SIVE T ICHONICUS .
With portrait of Tycho Brahe, instruments, etc.,
painted on the wall; showing assistants using the sight,

watching the clock, and recording. (From the authors

copy of the _Astronomi Instaurat Mechanica_ .)


**FOOTNOTES:**


[1] For definition see p. 22.


[2] _Ibid_ .


[3] For definition see p. 18.


[4] For definition see p. 18.


[5] In his great book Copernicus says: The movement of the heavenly bodies is uniform, circular, perpetual,
or else composed of circular movements. In this he proclaimed himself a follower of Pythagoras (see p. 14),
as also when he says: The world is spherical because the sphere is, of all figures, the most perfect
(Delambre, _Ast. Mod. Hist_ ., pp. 86, 87).


[6] Kepler tells us that Tycho Brahe was pleased with this device, and adapted it to his own system.


[7] _Hist. Ast._, vol. i., p. 354.


[8] _Hist. of Phys. Ast._, p. vii.


[9] Est enim Astronomi proprium, historiam motuum coelestium diligenti et artificiosa observatione
colligere. Deinde causas earundem, seu hypotheses, cum veras assequi nulla ratione possit ... Neque enim
necesse est, eas hypotheses esse veras, imo ne verisimiles quidem, sed sufficit hoc usum, si calculum
observationibus congruentem exhibeant.


## BOOK II. THE DYNAMICAL PERIOD


## 5. DISCOVERY OF THE TRUE SOLAR SYSTEMTYCHO BRAHE KEPLER.

During the period of the intellectual and aesthetic revival, at the beginning of the sixteenth century, the
spirit of the age was fostered by the invention of printing, by the downfall of the Byzantine Empire, and the
scattering of Greek fugitives, carrying the treasures of literature through Western Europe, by the works of
Raphael and Michael Angelo, by the Reformation, and by the extension of the known world through the
voyages of Spaniards and Portuguese. During that period there came to the front the founder of accurate
observational astronomy. Tycho Brahe, a Dane, born in 1546 of noble parents, was the most distinguished,
diligent, and accurate observer of the heavens since the days of Hipparchus, 1,700 years before.


Tycho was devoted entirely to his science from childhood, and the opposition of his parents only
stimulated him in his efforts to overcome difficulties. He soon grasped the hopelessness of the old deductive
methods of reasoning, and decided that no theories ought to be indulged in until preparations had been made
by the accumulation of accurate observations. We may claim for him the title of founder of the inductive
method.


For a complete life of this great man the reader is referred to Dreyers _Tycho Brahe_, Edinburgh, 1890,
containing a complete bibliography. The present notice must be limited to noting the work done, and the
qualities of character which enabled him to attain his scientific aims, and which have been conspicuous in
many of his successors.


He studied in Germany, but King Frederick of Denmark, appreciating his great talents, invited him to carry
out his lifes work in that country. He granted to him the island of Hveen, gave him a pension, and made him
a canon of the Cathedral of Roskilde. On that island Tycho Brahe built the splendid observatory which he
called Uraniborg, and, later, a second one for his assistants and students, called Stjerneborg. These he fitted
up with the most perfect instruments, and never lost a chance of adding to his stock of careful observations. [[1]]


The account of all these instruments and observations, printed at his own press on the island, was
published by Tycho Brahe himself, and the admirable and numerous engravings bear witness to the
excellence of design and the stability of his instruments.

His mechanical skill was very great, and in his workmanship he was satisfied with nothing but the best. He
recognised the importance of rigidity in the instruments, and, whereas these had generally been made of
wood, he designed them in metal. His instruments included armillae like those which had been used in
Alexandria, and other armillae designed by himselfsextants, mural quadrants, large celestial globes and
various instruments for special purposes. He lived before the days of telescopes and accurate clocks. He
invented the method of sub-dividing the degrees on the arc of an instrument by transversals somewhat in the
way that Pedro Nunez had proposed.


He originated the true system of observation and reduction of observations, recognising the fact that the
best instrument in the world is not perfect; and with each of his instruments he set to work to find out the
errors of graduation and the errors of mounting, the necessary correction being applied to each observation.


When he wanted to point his instrument exactly to a star he was confronted with precisely the same
difficulty as is met in gunnery and rifle-shooting. The sights and the object aimed at cannot be in focus
together, and a great deal depends on the form of sight. Tycho Brahe invented, and applied to the pointers of
his instruments, an aperture-sight of variable area, like the iris diaphragm used now in photography. This
enabled him to get the best result with stars of different brightness. The telescope not having been invented,
he could not use a telescopic-sight as we now do in gunnery. This not only removes the difficulty of
focussing, but makes the minimum visible angle smaller. Helmholtz has defined the minimum angle
measurable with the naked eye as being one minute of arc. In view of this it is simply marvellous that, when
the positions of Tychos standard stars are compared with the best modern catalogues, his probable error in
right ascension is only  24, 1, and in declination only  25, 9.


Clocks of a sort had been made, but Tycho Brahe found them so unreliable that he seldom used them, and
many of his position-measurements were made by measuring the angular distances from known stars.


Taking into consideration the absence of either a telescope or a clock, and reading his account of the labour
he bestowed upon each observation, we must all agree that Kepler, who inherited these observations in MS.,


was justified, under the conditions then existing, in declaring that there was no hope of anyone ever
improving upon them.


In the year 1572, on November 11th, Tycho discovered in Cassiopeia a new star of great brilliance, and
continued to observe it until the end of January, 1573. So incredible to him was such an event that he refused
to believe his own eyes until he got others to confirm what he saw. He made accurate observations of its
distance from the nine principal stars in Casseiopeia, and proved that it had no measurable parallax. Later he
employed the same method with the comets of 1577, 1580, 1582, 1585, 1590, 1593, and 1596, and proved
that they too had no measurable parallax and must be very distant.


The startling discovery that stars are not necessarily permanent, that new stars may appear, and possibly
that old ones may disappear, had upon him exactly the same effect that a similar occurrence had upon
Hipparchus 1,700 years before. He felt it his duty to catalogue all the principal stars, so that there should be
no mistake in the future. During the construction of his catalogue of 1,000 stars he prepared and used
accurate tables of refraction deduced from his own observations. Thus he eliminated (so far as naked eye
observations required) the effect of atmospheric refraction which makes the altitude of a star seem greater
than it really is.


Tycho Brahe was able to correct the lunar theory by his observations. Copernicus had introduced two
epicycles on the lunar orbit in the hope of obtaining a better accordance between theory and observation; and
he was not too ambitious, as his desire was to get the tables accurate to ten minutes. Tycho Brahe found that
the tables of Copernicus were in error as much as two degrees. He re-discovered the inequality called
variation by observing the moon in all phasesa thing which had not been attended to. [It is remarkable
that in the nineteenth century Sir George Airy established an altazimuth at Greenwich Observatory with this
special object, to get observations of the moon in all phases.] He also discovered other lunar equalities, and
wanted to add another epicycle to the moons orbit, but he feared that these would soon become
unmanageable if further observations showed more new inequalities.


But, as it turned out, the most fruitful work of Tycho Brahe was on the motions of the planets, and
especially of the planet Mars, for it was by an examination of these results that Kepler was led to the
discovery of his immortal laws.


After the death of King Frederick the observatories of Tycho Brahe were not supported. The gigantic
power and industry displayed by this determined man were accompanied, as often happens, by an
overbearing manner, intolerant of obstacles. This led to friction, and eventually the observatories were
dismantled, and Tycho Brahe was received by the Emperor Rudolph II., who placed a house in Prague at his
disposal. Here he worked for a few years, with Kepler as one of his assistants, and he died in the year 1601.

It is an interesting fact that Tycho Brahe had a firm conviction that mundane events could be predicted by
astrology, and that this belief was supported by his own predictions.


It has already been stated that Tycho Brahe maintained that observation must precede theory. He did not
accept the Copernican theory that the earth moves, but for a working hypothesis he used a modification of an
old Egyptian theory, mathematically identical with that of Copernicus, but not involving a stellar parallax. He
says ( _De Mundi_, _etc_ .) that


the Ptolemean system was too complicated, and the new one which that great man
Copernicus had proposed, following in the footsteps of Aristarchus of Samos, though
there was nothing in it contrary to mathematical principles, was in opposition to those
of physics, as the heavy and sluggish earth is unfit to move, and the system is even
opposed to the authority of Scripture. The absence of annual parallax further involves
an incredible distance between the outermost planet and the fixed stars.


We are bound to admit that in the circumstances of the case, so long as there was no question of dynamical
forces connecting the members of the solar system, his reasoning, as we should expect from such a man, is
practical and sound. It is not surprising, then, that astronomers generally did not readily accept the views of
Copernicus, that Luther (Luthers _Tischreden_, pp. 22, 60) derided him in his usual pithy manner, that
Melancthon ( _Initia doctrinae physicae_ ) said that Scripture, and also science, are against the earths motion;
and that the men of science whose opinion was asked for by the cardinals (who wished to know whether
Galileo was right or wrong) looked upon Copernicus as a weaver of fanciful theories.


Johann Kepler is the name of the man whose place, as is generally agreed, would have been the most
difficult to fill among all those who have contributed to the advance of astronomical knowledge. He was born
at Wiel, in the Duchy of Wurtemberg, in 1571. He held an appointment at Gratz, in Styria, and went to join


Tycho Brahe in Prague, and to assist in reducing his observations. These came into his possession when
Tycho Brahe died, the Emperor Rudolph entrusting to him the preparation of new tables (called the
Rudolphine tables) founded on the new and accurate observations. He had the most profound respect for the
knowledge, skill, determination, and perseverance of the man who had reaped such a harvest of most
accurate data; and though Tycho hardly recognised the transcendent genius of the man who was working as
his assistant, and although there were disagreements between them, Kepler held to his post, sustained by the
conviction that, with these observations to test any theory, he would be in a position to settle for ever the
problem of the solar system.


P ORTRAIT OF J OHANNES K EPLER .
By F. Wanderer, from Reitlingers Johannes Kepler

(original in Strassburg).


It has seemed to many that Platos demand for uniform circular motion (linear or angular) was responsible
for a loss to astronomy of good work during fifteen hundred years, for a hundred ill-considered speculative
cosmogonies, for dissatisfaction, amounting to disgust, with these _ priori_ guesses, and for the relegation of
the science to less intellectual races than Greeks and other Europeans. Nobody seemed to dare to depart from
this fetish of uniform angular motion and circular orbits until the insight, boldness, and independence of
Johann Kepler opened up a new world of thought and of intellectual delight.


While at work on the Rudolphine tables he used the old epicycles and deferents and excentrics, but he
could not make theory agree with observation. His instincts told him that these apologists for uniform motion
were a fraud; and he proved it to himself by trying every possible variation of the elements and finding them
fail. The number of hypotheses which he examined and rejected was almost incredible (for example, that the
planets turn round centres at a little distance from the sun, that the epicycles have centres at a little distance
from the deferent, and so on). He says that, after using all these devices to make theory agree with Tychos
observations, he still found errors amounting to eight minutes of a degree. Then he said boldly that it was
impossible that so good an observer as Tycho could have made a mistake of eight minutes, and added: Out
of these eight minutes we will construct a new theory that will explain the motions of all the planets. And he
did it, with elliptic orbits having the sun in a focus of each. [[2]]


It is often difficult to define the boundaries between fancies, imagination, hypothesis, and sound theory.
This extraordinary genius was a master in all these modes of attacking a problem. His analogy between the
spaces occupied by the five regular solids and the distances of the planets from the sun, which filled him with
so much delight, was a display of pure fancy. His demonstration of the three fundamental laws of planetary
motion was the most strict and complete theory that had ever been attempted.


It has been often suggested that the revival by Copernicus of the notion of a moving earth was a help to
Kepler. No one who reads Keplers great book could hold such an opinion for a moment. In fact, the
excellence of Copernicuss book helped to prolong the life of the epicyclical theories in opposition to
Keplers teaching.


All of the best theories were compared by him with observation. These were the Ptolemaic, the
Copernican, and the Tychonic. The two latter placed all of the planetary orbits concentric with one another,
the sun being placed a little away from their common centre, and having no apparent relation to them, and
being actually outside the planes in which they move. Keplers first great discovery was that the planes of all
the orbits pass through the sun; his second was that the line of apses of each planet passes through the sun;
both were contradictory to the Copernican theory.


He proceeds cautiously with his propositions until he arrives at his great laws, and he concludes his book
by comparing observations of Mars, of all dates, with his theory.

His first law states that the planets describe ellipses with the sun at a focus of each ellipse.
His second law (a far more difficult one to prove) states that a line drawn from a planet to the sun sweeps
over equal areas in equal times. These two laws were published in his great work, _Astronomia Nova, sen._
_Physica Coelestis tradita commentariis de Motibus Stelloe; Martis_, Prague, 1609.

It took him nine years more [[3]] to discover his third law, that the squares of the periodic times are
proportional to the cubes of the mean distances from the sun.


These three laws contain implicitly the law of universal gravitation. They are simply an alternative way of
expressing that law in dealing with planets, not particles. Only, the power of the greatest human intellect is so
utterly feeble that the meaning of the words in Keplers three laws could not be understood until expounded
by the logic of Newtons dynamics.

The joy with which Kepler contemplated the final demonstration of these laws, the evolution of which had
occupied twenty years, can hardly be imagined by us. He has given some idea of it in a passage in his work
on _Harmonics_, which is not now quoted, only lest someone might say it was egotisticala term which is
simply grotesque when applied to such a man with such a lifes work accomplished.


The whole book, _Astronomia Nova_, is a pleasure to read; the mass of observations that are used, and the
ingenuity of the propositions, contrast strongly with the loose and imperfectly supported explanations of all
his predecessors; and the indulgent reader will excuse the devotion of a few lines to an example of the
ingenuity and beauty of his methods.

It may seem a hopeless task to find out the true paths of Mars and the earth (at that time when their shape
even was not known) from the observations giving only the relative direction from night to night. Now,
Kepler had twenty years of observations of Mars to deal with. This enabled him to use a new method, to find
the earths orbit. Observe the date at any time when Mars is in opposition. The earths position E at that date
gives the longitude of Mars M. His period is 687 days. Now choose dates before and after the principal date
at intervals of 687 days and its multiples. Mars is in each case in the same position. Now for any date when
Mars is at M and the earth at E 3 the date of the year gives the angle E 3 SM. And the observation of Tycho
gives the direction of Mars compared with the sun, SE 3 M. So all the angles of the triangle SEM in any of
these positions of E are known, and also the ratios of SE 1, SE 2, SE 3, SE 4 to SM and to each other.


For the orbit of Mars observations were chosen at intervals of a year, when the earth was always in the
same place.


But Kepler saw much farther than the geometrical facts. He realised that the orbits are followed owing to a
force directed to the sun; and he guessed that this is the same force as the gravity that makes a stone fall. He
saw the difficulty of gravitation acting through the void space. He compared universal gravitation to
magnetism, and speaks of the work of Gilbert of Colchester. (Gilberts book, _De Mundo Nostro Sublunari,_
_Philosophia Nova_, Amstelodami, 1651, containing similar views, was published forty-eight years after
Gilberts death, and forty-two years after Keplers book and reference. His book _De Magnete_ was published
in 1600.)


A few of Keplers views on gravitation, extracted from the Introduction to his _Astronomia Nova_, may now
be mentioned:


1. Every body at rest remains at rest if outside the attractive power of other bodies.

2. Gravity is a property of masses mutually attracting in such manner that the earth attracts a stone much
more than a stone attracts the earth.


3. Bodies are attracted to the earths centre, not because it is the centre of the universe, but because it is the
centre of the attracting particles of the earth.


4. If the earth be not round (but spheroidal?), then bodies at different latitudes will not be attracted to its
centre, but to different points in the neighbourhood of that centre.


5. If the earth and moon were not retained in their orbits by vital force ( _aut alia aligua aequipollenti_ ), the
earth and moon would come together.

6. If the earth were to cease to attract its waters, the oceans would all rise and flow to the moon.
7. He attributes the tides to lunar attraction. Kepler had been appointed Imperial Astronomer with a
handsome salary (on paper), a fraction of which was doled out to him very irregularly. He was led to
miserable makeshifts to earn enough to keep his family from starvation; and proceeded to Ratisbon in 1630
to represent his claims to the Diet. He arrived worn out and debilitated; he failed in his appeal, and died from
fever, contracted under, and fed upon, disappointment and exhaustion. Those were not the days when men
could adopt as a profession the research of endowment.


Before taking leave of Kepler, who was by no means a man of one idea, it ought to be here recorded that
he was the first to suggest that a telescope made with both lenses convex (not a Galilean telescope) can have
cross wires in the focus, for use as a pointer to fix accurately the positions of stars. An Englishman,
Gascoigne, was the first to use this in practice.

From the all too brief epitome here given of Keplers greatest book, it must be obvious that he had at that
time some inkling of the meaning of his lawsuniversal gravitation. From that moment the idea of universal
gravitation was in the air, and hints and guesses were thrown out by many; and in time the law of gravitation
would doubtless have been discovered, though probably not by the work of one man, even if Newton had not
lived. But, if Kepler had not lived, who else could have discovered his laws?


**FOOTNOTES:**


[1] When the writer visited M. DArrest, the astronomer, at Copenhagen, in 1872, he was presented by
DArrest with one of several bricks collected from the ruins of Uraniborg. This was one of his most cherished
possessions until, on returning home after a prolonged absence on astronomical work, he found that his
treasure had been tidied away from his study.


[2] An ellipse is one of the plane, sections of a cone. It is an oval curve, which may be drawn by fixing two
pins in a sheet of paper at S and H, fastening a string, SPH, to the two pins, and stretching it with a pencil
point at P, and moving the pencil point, while the string is kept taut, to trace the oval ellipse, APB. S and H
are the _foci_ . Kepler found the sun to be in one focus, say S. AB is the _major axis_ . DE is the _minor axis_ . C is
the _centre_ . The direction of AB is the _line of apses_ . The ratio of CS to CA is the _excentricity_ . The position of
the planet at A is the _perihelion_ (nearest to the sun). The position of the planet at B is the _aphelion_ (farthest
from the sun). The angle ASP is the _anomaly_ when the planet is at P. CA or a line drawn from S to D is the
_mean distance_ of the planet from the sun.


[3] The ruled logarithmic paper we now use was not then to be had by going into a stationers shop. Else he
would have accomplished this in five minutes.


## 6. GALILEO AND THE TELESCOPENOTIONS OF GRAVITY BY HORROCKS, ETC.

It is now necessary to leave the subject of dynamical astronomy for a short time in order to give some
account of work in a different direction originated by a contemporary of Keplers, his senior in fact by seven
years. Galileo Galilei was born at Pisa in 1564. The most scientific part of his work dealt with terrestrial
dynamics; but one of those fortunate chances which happen only to really great men put him in the way of
originating a new branch of astronomy.

The laws of motion had not been correctly defined. The only man of Galileos time who seems to have
worked successfully in the same direction as himself was that Admirable Crichton of the Italians, Leonardo
da Vinci. Galileo cleared the ground. It had always been noticed that things tend to come to rest; a ball rolled
on the ground, a boat moved on the water, a shot fired in the air. Galileo realised that in all of these cases a
resisting force acts to stop the motion, and he was the first to arrive at the not very obvious law that the
motion of a body will never stop, nor vary its speed, nor change its direction, except by the action of some
force.


It is not very obvious that a light body and a heavy one fall at the same speed (except for the resistance of
the air). Galileo proved this on paper, but to convince the world he had to experiment from the leaning tower
of Pisa.


At an early age he discovered the principle of isochronism of the pendulum, which, in the hands of
Huyghens in the middle of the seventeenth century, led to the invention of the pendulum clock, perhaps the
most valuable astronomical instrument ever produced.


These and other discoveries in dynamics may seem very obvious now; but it is often the most every-day
matters which have been found to elude the inquiries of ordinary minds, and it required a high order of
intellect to unravel the truth and discard the stupid maxims scattered through the works of Aristotle and
accepted on his authority. A blind worship of scientific authorities has often delayed the progress of human
knowledge, just as too much instruction of a youth often ruins his education. Grant, in his history of
Physical Astronomy, has well said that the sagacity and skill which Galileo displays in resolving the
phenomena of motion into their constituent elements, and hence deriving the original principles involved in
them, will ever assure to him a distinguished place among those who have extended the domains of science.


But it was work of a different kind that established Galileos popular reputation. In 1609 Galileo heard that
a Dutch spectacle-maker had combined a pair of lenses so as to magnify distant objects. Working on this hint,
he solved the same problem, first on paper and then in practice. So he came to make one of the first
telescopes ever used in astronomy. No sooner had he turned it on the heavenly bodies than he was rewarded
by such a shower of startling discoveries as forthwith made his name the best known in Europe. He found
curious irregular black spots on the sun, revolving round it in twenty-seven days; hills and valleys on the
moon; the planets showing discs of sensible size, not points like the fixed stars; Venus showing phases
according to her position in relation to the sun; Jupiter accompanied by four moons; Saturn with appendages
that he could not explain, but unlike the other planets; the Milky Way composed of a multitude of separate

stars.


His fame flew over Europe like magic, and his discoveries were much discussedand there were many
who refused to believe. Cosmo de Medici induced him to migrate to Florence to carry on his observations.
He was received by Paul V., the Pope, at Rome, to whom he explained his discoveries.


He thought that these discoveries proved the truth of the Copernican theory of the Earths motion; and he
urged this view on friends and foes alike. Although in frequent correspondence with Kepler, he never alluded
to the New Astronomy, and wrote to him extolling the virtue of epicycles. He loved to argue, never shirked
an encounter with any number of disputants, and laughed as he broke down their arguments.


Through some strange course of events, not easy to follow, the Copernican theory, whose birth was
welcomed by the Church, had now been taken up by certain anti-clerical agitators, and was opposed by the
cardinals as well as by the dignitaries of the Reformed Church. Galileoa good Catholicgot mixed up in
these discussions, although on excellent terms with the Pope and his entourage. At last it came about that
Galileo was summoned to appear at Rome, where he was charged with holding and teaching heretical


opinions about the movement of the earth; and he then solemnly abjured these opinions. There has been
much exaggeration and misstatement about his trial and punishment, and for a long time there was a great
deal of bitterness shown on both sides. But the general verdict of the present day seems to be that, although
Galileo himself was treated with consideration, the hostility of the Church to the views of Copernicus placed
it in opposition also to the true Keplerian system, and this led to unprofitable controversies. From the time of
Galileo onwards, for some time, opponents of religion included the theory of the Earths motion in their
disputations, not so much for the love, or knowledge, of astronomy, as for the pleasure of putting the Church
in the wrong. This created a great deal of bitterness and intolerance on both sides. Among the sufferers was
Giordano Bruno, a learned speculative philosopher, who was condemned to be burnt at the stake.


Galileo died on Christmas Day, 1642the day of Newtons birth. The further consideration of the grand
field of discovery opened out by Galileo with his telescopes must be now postponed, to avoid discontinuity in
the history of the intellectual development of this period, which lay in the direction of dynamical, or physical,
astronomy.


Until the time of Kepler no one seems to have conceived the idea of universal physical forces controlling
terrestrial phenomena, and equally applicable to the heavenly bodies. The grand discovery by Kepler of the
true relationship of the Sun to the Planets, and the telescopic discoveries of Galileo and of those who
followed him, spread a spirit of inquiry and philosophic thought throughout Europe, and once more did
astronomy rise in estimation; and the irresistible logic of its mathematical process of reasoning soon placed it
in the position it has ever since occupied as the foremost of the exact sciences.


The practical application of this process of reasoning was enormously facilitated by the invention of
logarithms by Napier. He was born at Merchistoun, near Edinburgh, in 1550, and died in 1617. By this
system the tedious arithmetical operations necessary in astronomical calculations, especially those dealing
with the trigonometrical functions of angles, were so much simplified that Laplace declared that by this
invention the life-work of an astronomer was doubled.


Jeremiah Horrocks (born 1619, died 1641) was an ardent admirer of Tycho Brahe and Kepler, and was able
to improve the Rudolphine tables so much that he foretold a transit of Venus, in 1639, which these tables
failed to indicate, and was the only observer of it. His life was short, but he accomplished a great deal, and
rightly ascribed the lunar inequality called _evection_ to variations in the value of the eccentricity and in the
direction of the line of apses, at the same time correctly assigning _the disturbing force of the Sun_ as the cause.
He discovered the errors in Jupiters calculated place, due to what we now know as the long inequality of
Jupiter and Saturn, and measured with considerable accuracy the acceleration at that date of Jupiters mean
motion, and indicated the retardation of Saturns mean motion.


Horrocks investigations, so far as they could be collected, were published posthumously in 1672, and
seldom, if ever, has a man who lived only twenty-two years originated so much scientific knowledge.

At this period British science received a lasting impetus by the wise initiation of a much-abused man,
Charles II., who founded the Royal Society of London, and also the Royal Observatory of Greeenwich,
where he established Flamsteed as first Astronomer Royal, especially for lunar and stellar observations likely
to be useful for navigation. At the same time the French Academy and the Paris Observatory were founded.
All this within fourteen years, 1662-1675.


Meanwhile gravitation in general terms was being discussed by Hooke, Wren, Halley, and many others. All
of these men felt a repugnance to accept the idea of a force acting across the empty void of space. Descartes
(1596-1650) proposed an ethereal medium whirling round the sun with the planets, and having local whirls
revolving with the satellites. As Delambre and Grant have said, this fiction only retarded the progress of pure
science. It had no sort of relation to the more modern, but equally misleading, nebular hypothesis. While
many were talking and guessing, a giant mind was needed at this stage to make things clear.


## 7. SIR ISAAC NEWTONLAW OF UNIVERSAL GRAVITATION.

We now reach the period which is the culminating point of interest in the history of dynamical astronomy.
Isaac Newton was born in 1642. Pemberton states that Newton, having quitted Cambridge to avoid the
plague, was residing at Wolsthorpe, in Lincolnshire, where he had been born; that he was sitting one day in
the garden, reflecting upon the force which prevents a planet from flying off at a tangent and which draws it
to the sun, and upon the force which draws the moon to the earth; and that he saw in the case of the planets
that the suns force must clearly be unequal at different distances, for the pull out of the tangential line in a
minute is less for Jupiter than for Mars. He then saw that the pull of the earth on the moon would be less than
for a nearer object. It is said that while thus meditating he saw an apple fall from a tree to the ground, and
that this fact suggested the questions: Is the force that pulled that apple from the tree the same as the force
which draws the moon to the earth? Does the attraction for both of them follow the same law as to distance as
is given by the planetary motions round the sun? It has been stated that in this way the first conception of
universal gravitation arose. [[1]]


Quite the most important event in the whole history of physical astronomy was the publication, in 1687, of
Newtons _Principia (Philosophiae Naturalis Principia Mathematica)_ . In this great work Newton started from
the beginning of things, the laws of motion, and carried his argument, step by step, into every branch of
physical astronomy; giving the physical meaning of Keplers three laws, and explaining, or indicating the
explanation of, all the known heavenly motions and their irregularities; showing that all of these were
included in his simple statement about the law of universal gravitation; and proceeding to deduce from that
law new irregularities in the motions of the moon which had never been noticed, and to discover the oblate
figure of the earth and the cause of the tides. These investigations occupied the best part of his life; but he
wrote the whole of his great book in fifteen months.

Having developed and enunciated the true laws of motion, he was able to show that Keplers second law
(that equal areas are described by the line from the planet to the sun in equal times) was only another way of
saying that the centripetal force on a planet is always directed to the sun. Also that Keplers first law (elliptic
orbits with the sun in one focus) was only another way of saying that the force urging a planet to the sun
varies inversely as the square of the distance. Also (if these two be granted) it follows that Keplers third law
is only another way of saying that the suns force on different planets (besides depending as above on
distance) is proportional to their masses.


Having further proved the, for that day, wonderful proposition that, with the law of inverse squares, the
attraction by the separate particles of a sphere of uniform density (or one composed of concentric spherical
shells, each of uniform density) acts as if the whole mass were collected at the centre, he was able to express
the meaning of Keplers laws in propositions which have been summarised as follows:


The law of universal gravitation. _Every particle of matter in the universe attracts every other particle_
_with a force varying inversely as the square of the distance between them, and directly as the product of the_
_masses of the two particles_ . [[2]]


But Newton did not commit himself to the law until he had answered that question about the apple; and the
above proposition now enabled him to deal with the Moon and the apple. Gravity makes a stone fall 16.1 feet
in a second. The moon is 60 times farther from the earths centre than the stone, so it ought to be drawn out
of a straight course through 16.1 feet in a minute. Newton found the distance through which she is actually
drawn as a fraction of the earths diameter. But when he first examined this matter he proceeded to use a
wrong diameter for the earth, and he found a serious discrepancy. This, for a time, seemed to condemn his
theory, and regretfully he laid that part of his work aside. Fortunately, before Newton wrote the _Principia_ the
French astronomer Picard made a new and correct measure of an arc of the meridian, from which he obtained
an accurate value of the earths diameter. Newton applied this value, and found, to his great joy, that when the
distance of the moon is 60 times the radius of the earth she is attracted out of the straight course 16.1 feet per
minute, and that the force acting on a stone or an apple follows the same law as the force acting upon the
heavenly bodies. [[3]]


The universality claimed for the lawif not by Newton, at least by his commentatorswas bold, and
warranted only by the large number of cases in which Newton had found it to apply. Its universality has been
under test ever since, and so far it has stood the test. There has often been a suspicion of a doubt, when some


inequality of motion in the heavenly bodies has, for a time, foiled the astronomers in their attempts to explain
it. But improved mathematical methods have always succeeded in the end, and so the seeming doubt has
been converted into a surer conviction of the universality of the law.


Having once established the law, Newton proceeded to trace some of its consequences. He saw that the
figure of the earth depends partly on the mutual gravitation of its parts, and partly on the centrifugal tendency
due to the earths rotation, and that these should cause a flattening of the poles. He invented a mathematical
method which he used for computing the ratio of the polar to the equatorial diameter.


He then noticed that the consequent bulging of matter at the equator would be attracted by the moon
unequally, the nearest parts being most attracted; and so the moon would tend to tilt the earth when in some
parts of her orbit; and the sun would do this to a less extent, because of its great distance. Then he proved that
the effect ought to be a rotation of the earths axis over a conical surface in space, exactly as the axis of a top
describes a cone, if the top has a sharp point, and is set spinning and displaced from the vertical. He actually
calculated the amount; and so he explained the cause of the precession of the equinoxes discovered by
Hipparchus about 150 B.C.


One of his grandest discoveries was a method of weighing the heavenly bodies by their action on each
other. By means of this principle he was able to compare the mass of the sun with the masses of those planets
that have moons, and also to compare the mass of our moon with the mass of the earth.


Thus Newton, after having established his great principle, devoted his splendid intellect to the calculation
of its consequences. He proved that if a body be projected with any velocity in free space, subject only to a
central force, varying inversely as the square of the distance, the body must revolve in a curve which may be
any one of the sections of a conea circle, ellipse, parabola, or hyperbola; and he found that those comets of
which he had observations move in parabolae round the Sun, and are thus subject to the universal law.

Newton realised that, while planets and satellites are chiefly controlled by the central body about which
they revolve, the new law must involve irregularities, due to their mutual actionsuch, in fact, as Horrocks
had indicated. He determined to put this to a test in the case of the moon, and to calculate the suns effect,
from its mass compared with that of the earth, and from its distance. He proved that the average effect upon
the plane of the orbit would be to cause the line in which it cuts the plane of the ecliptic (i.e., the line of
nodes) to revolve in the ecliptic once in about nineteen years. This had been a known fact from the earliest
ages. He also concluded that the line of apses would revolve in the plane of the lunar orbit also in about
nineteen years; but the observed period is only ten years. For a long time this was the one weak point in the
Newtonian theory. It was not till 1747 that Clairaut reconciled this with the theory, and showed why
Newtons calculation was not exact.


Newton proceeded to explain the other inequalities recognised by Tycho Brahe and older observers, and to
calculate their maximum amounts as indicated by his theory. He further discovered from his calculations two
new inequalities, one of the apogee, the other of the nodes, and assigned the maximum value. Grant has
shown the values of some of these as given by observation in the tables of Meyer and more modern tables,
and has compared them with the values assigned by Newton from his theory; and the comparison is very
remarkable.


Newton.   Modern Tables.

  "       "

Mean monthly motion of Apses     1.31.28     3.4.0
Mean annual motion of nodes     19.18.1,23   19.21.22,50
Mean value of variation       36.10     35.47
Annual equation            11.51     11.14
Inequality of mean motion of apogee  19.43     22.17
Inequality of mean motion of nodes   9.24      9.0


The only serious discrepancy is the first, which has been already mentioned. Considering that some of
these perturbations had never been discovered, that the cause of none of them had ever been known, and that
he exhibited his results, if he did not also make the discoveries, by the synthetic methods of geometry, it is
simply marvellous that he reached to such a degree of accuracy. He invented the infinitesimal calculus which
is more suited for such calculations, but had he expressed his results in that language he would have been
unintelligible to many.


Newtons method of calculating the precession of the equinoxes, already referred to, is as beautiful as
anything in the _Principia_ . He had already proved the regression of the nodes of a satellite moving in an orbit
inclined to the ecliptic. He now said that the nodes of a ring of satellites revolving round the earths equator
would consequently all regress. And if joined into a solid ring its node would regress; and it would do so,


only more slowly, if encumbered by the spherical part of the earths mass. Therefore the axis of the equatorial
belt of the earth must revolve round the pole of the ecliptic. Then he set to work and found the amount due to
the moon and that due to the sun, and so he solved the mystery of 2,000 years.

When Newton applied his law of gravitation to an explanation of the tides he started a new field for the
application of mathematics to physical problems; and there can be little doubt that, if he could have been
furnished with complete tidal observations from different parts of the world, his extraordinary powers of
analysis would have enabled him to reach a satisfactory theory. He certainly opened up many mines full of
intellectual gems; and his successors have never ceased in their explorations. This has led to improved
mathematical methods, which, combined with the greater accuracy of observation, have rendered physical
astronomy of to-day the most exact of the sciences.


Laplace only expressed the universal opinion of posterity when he said that to the _Principia_ is assured a
pre-eminence above all the other productions of the human intellect.


The name of Flamsteed, First Astronomer Royal, must here be mentioned as having supplied Newton with
the accurate data required for completing the theory.


The name of Edmund Halley, Second Astronomer Royal, must ever be held in repute, not only for his own
discoveries, but for the part he played in urging Newton to commit to writing, and present to the Royal
Society, the results of his investigations. But for his friendly insistence it is possible that the _Principia_ would
never have been written; and but for his generosity in supplying the means the Royal Society could not have
published the book.


D EATH M ASK OF S IR I SAAC N EWTON .
Photographed specially for this work from the
original, by kind permission of the Royal Society,

London.


Sir Isaac Newton died in 1727, at the age of eighty-five. His body lay in state in the Jerusalem Chamber,
and was buried in Westminster Abbey.


**FOOTNOTES:**


[1] The writer inherited from his father (Professor J. D. Forbes) a small box containing a bit of wood and a
slip of paper, which had been presented to him by Sir David Brewster. On the paper Sir David had written
these words: If there be any truth in the story that Newton was led to the theory of gravitation by the fall of
an apple, this bit of wood is probably a piece of the apple tree from which Newton saw the apple fall. When I
was on a pilgrimage to the house in which Newton was born, I cut it off an ancient apple tree growing in his
garden. When lecturing in Glasgow, about 1875, the writer showed it to his audience. The next morning,
when removing his property from the lecture table, he found that his precious relic had been stolen. It would
be interesting to know who has got it now!


[2] It must be noted that these words, in which the laws of gravitation are always summarised in histories and
text-books, do not appear in the _Principia_ ; but, though they must have been composed by some early
commentator, it does not appear that their origin has been traced. Nor does it appear that Newton ever
extended the law beyond the Solar System, and probably his caution would have led him to avoid any
statement of the kind until it should be proved.
With this exception the above statement of the law of universal gravitation contains nothing that is not to
be found in the _Principia_ ; and the nearest approach to that statement occurs in the Seventh Proposition of
Book III.:

Prop.: That gravitation occurs in all bodies, and that it is proportional to the quantity of matter in each.
Cor. I.: The total attraction of gravitation on a planet arises, and is composed, out of the attraction on the
separate parts.
Cor. II.: The attraction on separate equal particles of a body is reciprocally as the square of the distance
from the particles.


[3] It is said that, when working out this final result, the probability of its confirming that part of his theory
which he had reluctantly abandoned years before excited him so keenly that he was forced to hand over his
calculations to a friend, to be completed by him.


## 8. NEWTONS SUCCESSORSHALLEY, EULER, LAGRANGE, LAPLACE, ETC.

Edmund Halley succeeded Flamsteed as Second Astronomer Royal in 1721. Although he did not
contribute directly to the mathematical proofs of Newtons theory, yet his name is closely associated with
some of its greatest successes.

He was the first to detect the acceleration of the moons mean motion. Hipparchus, having compared his
own observations with those of more ancient astronomers, supplied an accurate value of the moons mean
motion in his time. Halley similarly deduced a value for modern times, and found it sensibly greater. He
announced this in 1693, but it was not until 1749 that Dunthorne used modern lunar tables to compute a lunar
eclipse observed in Babylon 721 B.C., another at Alexandria 201 B.C., a solar eclipse observed by Theon 360
A.D., and two later ones up to the tenth century. He found that to explain these eclipses Halleys suggestion
must be adopted, the acceleration being 10 in one century. In 1757 Lalande again fixed it at 10.

The Paris Academy, in 1770, offered their prize for an investigation to see if this could be explained by the
theory of gravitation. Euler won the prize, but failed to explain the effect, and said: It appears to be
established by indisputable evidence that the secular inequality of the moons mean motion cannot be
produced by the forces of gravitation.

The same subject was again proposed for a prize which was shared by Lagrange [[1]] and Euler, neither
finding a solution, while the latter asserted the existence of a resisting medium in space.

Again, in 1774, the Academy submitted the same subject, a third time, for the prize; and again Lagrange
failed to detect a cause in gravitation.

Laplace [[2]] now took the matter in hand. He tried the effect of a non-instantaneous action of gravity, to no
purpose. But in 1787 he gave the true explanation. The principal effect of the sun on the moons orbit is to
diminish the earths influence, thus lengthening the period to a new value generally taken as constant. But
Laplaces calculations showed the new value to depend upon the excentricity of the earths orbit, which,
according; to theory, has a periodical variation of enormous period, and has been continually diminishing for
thousands of years. Thus the solar influence has been diminishing, and the moons mean motion increased.
Laplace computed the amount at 10 in one century, agreeing with observation. (Later on Adams showed that
Laplaces calculation was wrong, and that the value he found was too large; so, part of the acceleration is
now attributed by some astronomers to a lengthening of the day by tidal friction.)

Another contribution by Halley to the verification of Newtons law was made when he went to St. Helena
to catalogue the southern stars. He measured the change in length of the seconds pendulum in different
latitudes due to the changes in gravity foretold by Newton.


Furthermore, he discovered the long inequality of Jupiter and Saturn, whose period is 929 years. For an
investigation of this also the Academy of Sciences offered their prize. This led Euler to write a valuable essay
disclosing a new method of computing perturbations, called the instantaneous ellipse with variable elements.
The method was much developed by Lagrange.


But again it was Laplace who solved the problem of the inequalities of Jupiter and Saturn by the theory of
gravitation, reducing the errors of the tables from 20 down to 12, thus abolishing the use of empirical
corrections to the planetary tables, and providing another glorious triumph for the law of gravitation. As
Laplace justly said: These inequalities appeared formerly to be inexplicable by the law of gravitationthey
now form one of its most striking proofs.


Let us take one more discovery of Halley, furnishing directly a new triumph for the theory. He noticed that
Newton ascribed parabolic orbits to the comets which he studied, so that they come from infinity, sweep
round the sun, and go off to infinity for ever, after having been visible a few weeks or months. He collected
all the reliable observations of comets he could find, to the number of twenty-four, and computed their
parabolic orbits by the rules laid down by Newton. His object was to find out if any of them really travelled
in elongated ellipses, practically undistinguishable, in the visible part of their paths, from parabol, in which
case they would be seen more than once. He found two old comets whose orbits, in shape and position,
resembled the orbit of a comet observed by himself in 1682. Apian observed one in 1531; Kepler the other in
1607. The intervals between these appearances is seventy-five or seventy-six years. He then examined and


found old records of similar appearance in 1456, 1380, and 1305. It is true, he noticed, that the intervals
varied by a year and a-half, and the inclination of the orbit to the ecliptic diminished with successive
apparitions. But he knew from previous calculations that this might easily be due to planetary perturbations.
Finally, he arrived at the conclusion that all of these comets were identical, travelling in an ellipse so
elongated that the part where the comet was seen seemed to be part of a parabolic orbit. He then predicted its
return at the end of 1758 or beginning of 1759, when he should be dead; but, as he said, if it should return,
according to our prediction, about the year 1758, impartial posterity will not refuse to acknowledge that this
was first discovered by an Englishman. [[3]] [ _Synopsis Astronomiae Cometicae_, 1749.]

Once again Halleys suggestion became an inspiration for the mathematical astronomer. Clairaut, assisted
by Lalande, found that Saturn would retard the comet 100 days, Jupiter 518 days, and predicted its return to
perihelion on April 13th, 1759. In his communication to the French Academy, he said that a comet travelling
into such distant regions might be exposed to the influence of forces totally unknown, and even of some
planet too far removed from the sun to be ever perceived.

The excitement of astronomers towards the end of 1758 became intense; and the honour of first catching
sight of the traveller fell to an amateur in Saxony, George Palitsch, on Christmas Day, 1758. It reached
perihelion on March 13th, 1759.

This fact was a startling confirmation of the Newtonian theory, because it was a new kind of calculation of
perturbations, and also it added a new member to the solar system, and gave a prospect of adding many more.


When Halleys comet reappeared in 1835, Pontecoulants computations for the date of perihelion passage
were very exact, and afterwards he showed that, with more exact values of the masses of Jupiter and Saturn,
his prediction was correct within two days, after an invisible voyage of seventy-five years!

Hind afterwards searched out many old appearances of this comet, going back to 11 B.C., and most of
these have been identified as being really Halleys comet by the calculations of Cowell and Cromellin [[4]] (of
Greenwich Observatory), who have also predicted its next perihelion passage for April 8th to 16th, 1910, and
have traced back its history still farther, to 240 B.C.


Already, in November, 1907, the Astronomer Royal was trying to catch it by the aid of photography.


**FOOTNOTES:**


[1] Born 1736; died 1813.


[2] Born 1749; died 1827.


[3] This sentence does not appear in the original memoir communicated to the Royal Society, but was first
published in a posthumous reprint.


[4] _R. A. S. Monthly Notices_, 1907-8.


## 9. DISCOVERY OF NEW PLANETSHERSCHEL, PIAZZI, ADAMS, AND LE VERRIER.

It would be very interesting, but quite impossible in these pages, to discuss all the exquisite researches of
the mathematical astronomers, and to inspire a reverence for the names connected with these researches,
which for two hundred years have been establishing the universality of Newtons law. The lunar and
planetary theories, the beautiful theory of Jupiters satellites, the figure of the earth, and the tides, were
mathematically treated by Maclaurin, DAlembert, Legendre, Clairaut, Euler, Lagrange, Laplace, Walmsley,
Bailly, Lalande, Delambre, Mayer, Hansen, Burchardt, Binet, Damoiseau, Plana, Poisson, Gauss, Bessel,
Bouvard, Airy, Ivory, Delaunay, Le Verrier, Adams, and others of later date.


By passing over these important developments it is possible to trace some of the steps in the crowning
triumph of the Newtonian theory, by which the planet Neptune was added to the known members of the solar
system by the independent researches of Professor J.C. Adams and of M. Le Verrier, in 1846.


It will be best to introduce this subject by relating how the eighteenth century increased the number of
known planets, which was then only six, including the earth.


On March 13th, 1781, Sir William Herschel was, as usual, engaged on examining some small stars, and,
noticing that one of them appeared to be larger than the fixed stars, suspected that it might be a comet. To test
this he increased his magnifying power from 227 to 460 and 932, finding that, unlike the fixed stars near it,
its definition was impaired and its size increased. This convinced him that the object was a comet, and he was
not surprised to find on succeeding nights that the position was changed, the motion being in the ecliptic. He
gave the observations of five weeks to the Royal Society without a suspicion that the object was a new planet.

For a long time people could not compute a satisfactory orbit for the supposed comet, because it seemed to
be near the perihelion, and no comet had ever been observed with a perihelion distance from the sun greater
than four times the earths distance. Lexell was the first to suspect that this was a new planet eighteen times
as far from the sun as the earth is. In January, 1783, Laplace published the elliptic elements. The discoverer
of a planet has a right to name it, so Herschel called it Georgium Sidus, after the king. But Lalande urged the
adoption of the name Herschel. Bode suggested Uranus, and this was adopted. The new planet was found to
rank in size next to Jupiter and Saturn, being 4.3 times the diameter of the earth.


In 1787 Herschel discovered two satellites, both revolving in nearly the same plane, inclined 80 to the
ecliptic, and the motion of both was retrograde.

In 1772, before Herschels discovery, Bode [[1]] had discovered a curious arbitrary law of planetary distances.
Opposite each planets name write the figure 4; and, in succession, add the numbers 0, 3, 6, 12, 24, 48, 96,
_etc_ ., to the 4, always doubling the last numbers. You then get the planetary distances.


Mercury, dist.-- 4 4 +  0 =  4
Venus   "   7 4 +  3 =  7

Earth   "  10 4 +  6 = 10

Mars    "  15 4 + 12 = 16

--         4 + 24 = 28

Jupiter dist. 52 4 + 48 = 52
Saturn   "  95 4 + 96 = 100

(Uranus)  "  192 4 + 192 = 196
--         4 + 384 = 388


All the five planets, and the earth, fitted this rule, except that there was a blank between Mars and Jupiter.
When Uranus was discovered, also fitting the rule, the conclusion was irresistible that there is probably a
planet between Mars and Jupiter. An association of twenty-four astronomers was now formed in Germany to
search for the planet. Almost immediately afterwards the planet was discovered, not by any member of the
association, but by Piazzi, when engaged upon his great catalogue of stars. On January 1st, 1801, he observed
a star which had changed its place the next night. Its motion was retrograde till January 11th, direct after the
13th. Piazzi fell ill before he had enough observations for computing the orbit with certainty, and the planet
disappeared in the suns rays. Gauss published an approximate ephemeris of probable positions when the


planet should emerge from the suns light. There was an exciting hunt, and on December 31st (the day before
its birthday) De Zach captured the truant, and Piazzi christened it Ceres.


The mean distance from the sun was found to be 2.767, agreeing with the 2.8 given by Bodes law. Its orbit
was found to be inclined over 10 to the ecliptic, and its diameter was only 161 miles.


On March 28th, 1802, Olbers discovered a new seventh magnitude star, which turned out to be a planet
resembling Ceres. It was called Pallas. Gauss found its orbit to be inclined 35 to the ecliptic, and to cut the
orbit of Ceres; whence Olbers considered that these might be fragments of a broken-up planet. He then
commenced a search for other fragments. In 1804 Harding discovered Juno, and in 1807 Olbers found Vesta.
The next one was not discovered until 1845, from which date asteroids, or minor planets (as these small
planets are called), have been found almost every year. They now number about 700.

It is impossible to give any idea of the interest with which the first additions since prehistoric times to the
planetary system were received. All of those who showered congratulations upon the discoverers regarded
these discoveries in the light of rewards for patient and continuous labours, the very highest rewards that
could be desired. And yet there remained still the most brilliant triumph of all, the addition of another planet
like Uranus, before it had ever been seen, when the analysis of Adams and Le Verrier gave a final proof of the
powers of Newtons great law to explain any planetary irregularity.


After Sir William Herschel discovered Uranus, in 1781, it was found that astronomers had observed it on
many previous occasions, mistaking it for a fixed star of the sixth or seventh magnitude. Altogether, nineteen
observations of Uranuss position, from the time of Flamsteed, in 1690, had been recorded.


In 1790 Delambre, using all these observations, prepared tables for computing its position. These worked
well enough for a time, but at last the differences between the calculated and observed longitudes of the
planet became serious. In 1821 Bouvard undertook a revision of the tables, but found it impossible to
reconcile all the observations of 130 years (the period of revolution of Uranus is eighty-four years). So he
deliberately rejected the old ones, expressing the opinion that the discrepancies might depend upon some
foreign and unperceived cause which may have been acting upon the planet. In a few years the errors even
of these tables became intolerable. In 1835 the error of longitude was 30; in 1838, 50; in 1841, 70; and, by
comparing the errors derived from observations made before and after opposition, a serious error of the
distance (radius vector) became apparent.


In 1843 John Couch Adams came out Senior Wrangler at Cambridge, and was free to undertake the
research which as an undergraduate he had set himselfto see whether the disturbances of Uranus could be
explained by assuming a certain orbit, and position in that orbit, of a hypothetical planet even more distant
than Uranus. Such an explanation had been suggested, but until 1843 no one had the boldness to attack the
problem. Bessel had intended to try, but a fatal illness overtook him.

Adams first recalculated all known causes of disturbance, using the latest determinations of the planetary
masses. Still the errors were nearly as great as ever. He could now, however, use these errors as being
actually due to the perturbations produced by the unknown planet.

In 1844, assuming a circular orbit, and a mean distance agreeing with Bodes law, he obtained a first
approximation to the position of the supposed planet. He then asked Professor Challis, of Cambridge, to
procure the latest observations of Uranus from Greenwich, which Airy immediately supplied. Then the whole
work was recalculated from the beginning, with more exactness, and assuming a smaller mean distance.


In September, 1845, he handed to Challis the elements of the hypothetical planet, its mass, and its apparent
position for September 30th, 1845. On September 22nd Challis wrote to Airy explaining the matter, and
declaring his belief in Adamss capabilities. When Adams called on him Airy was away from home, but at the
end of October, 1845, he called again, and left a paper with full particulars of his results, which had, for the
most part, reduced the discrepancies to about 1. As a matter of fact, it has since been found that the
heliocentric place of the new planet then given was correct within about 2.


Airy wrote expressing his interest, and asked for particulars about the radius vector. Adams did not then
reply, as the answer to this question could be seen to be satisfactory by looking at the data already supplied.
He was a most unassuming man, and would not push himself forward. He may have felt, after all the work he
had done, that Airys very natural inquiry showed no proportionate desire to search for the planet. Anyway,
the matter lay in embryo for nine months.


Meanwhile, one of the ablest French astronomers, Le Verrier, experienced in computing perturbations, was
independently at work, knowing nothing about Adams. He applied to his calculations every possible
refinement, and, considering the novelty of the problem, his calculation was one of the most brilliant in the
records of astronomy. In criticism it has been said that these were exhibitions of skill rather than helps to a


solution of the particular problem, and that, in claiming to find the elements of the orbit within certain limits,
he was claiming what was, under the circumstances, impossible, as the result proved.


In June, 1846, Le Verrier announced, in the _Comptes Rendus de lAcademie des Sciences_, that the
longitude of the disturbing planet, for January 1st, 1847, was 325, and that the probable error did not exceed
10.


This result agreed so well with Adamss (within 1) that Airy urged Challis to apply the splendid
Northumberland equatoreal, at Cambridge, to the search. Challis, however, had already prepared an
exhaustive plan of attack which must in time settle the point. His first work was to observe, and make a
catalogue, or chart, of all stars near Adamss position.


On August 31st, 1846, Le Verrier published the concluding part of his labours.

On September 18th, 1846, Le Verrier communicated his results to the Astronomers at Berlin, and asked
them to assist in searching for the planet. By good luck Dr. Bremiker had just completed a star-chart of the
very part of the heavens including Le Verriers position; thus eliminating all of Challiss preliminary work.
The letter was received in Berlin on September 23rd; and the same evening Galle found the new planet, of
the eighth magnitude, the size of its disc agreeing with Le Verriers prediction, and the heliocentric longitude
agreeing within 57. By this time Challis had recorded, without reduction, the observations of 3,150 stars, as
a commencement for his search. On reducing these, he found a star, observed on August 12th, which was not
in the same place on July 30th. This was the planet, and he had also observed it on August 4th.


The feeling of wonder, admiration, and enthusiasm aroused by this intellectual triumph was overwhelming.
In the world of astronomy reminders are met every day of the terrible limitations of human reasoning powers;
and every success that enables the minds eye to see a little more clearly the meaning of things has always
been heartily welcomed by those who have themselves been engaged in like researches. But, since the
publication of the _Principia_, in 1687, there is probably no analytical success which has raised among
astronomers such a feeling of admiration and gratitude as when Adams and Le Verrier showed the
inequalities in Uranuss motion to mean that an unknown planet was in a certain place in the heavens, where
it was found.


At the time there was an unpleasant display of international jealousy. The British people thought that the
earlier date of Adamss work, and of the observation by Challis, entitled him to at least an equal share of
credit with Le Verrier. The French, on the other hand, who, on the announcement of the discovery by Galle,
glowed with pride in the new proof of the great powers of their astronomer, Le Verrier, whose life had a long
record of successes in calculation, were incredulous on being told that it had all been already done by a
young man whom they had never heard of.


These displays of jealousy have long since passed away, and there is now universally an _entente cordiale_
that to each of these great men belongs equally the merit of having so thoroughly calculated this inverse
problem of perturbations as to lead to the immediate discovery of the unknown planet, since called Neptune.

It was soon found that the planet had been observed, and its position recorded as a fixed star by Lalande,
on May 8th and 10th, 1795.

Mr. Lassel, in the same year, 1846, with his two-feet reflector, discovered a satellite, with retrograde
motion, which gave the mass of the planet about a twentieth of that of Jupiter.


**FOOTNOTES:**


[1] Bodes law, or something like it, had already been fore-shadowed by Kepler and others, especially Titius
(see _Monatliche Correspondenz_, vol. vii., p. 72).


## BOOK III. OBSERVATION


## 10. INSTRUMENTS OF PRECISIONSTATE OF THE SOLAR SYSTEM.

Having now traced the progress of physical astronomy up to the time when very striking proofs of the
universality of the law of gravitation convinced the most sceptical, it must still be borne in mind that, while
gravitation is certainly the principal force governing the motions of the heavenly bodies, there may yet be a
resisting medium in space, and there may be electric and magnetic forces to deal with. There may, further, be
cases where the effects of luminous radiative repulsion become apparent, and also Crookes vacuum-effects
described as radiant matter. Nor is it quite certain that Laplaces proofs of the instantaneous propagation of
gravity are final.

And in the future, as in the past, Tycho Brahes dictum must be maintained, that all theory shall be
preceded by accurate observations. It is the pride of astronomers that their science stands above all others in
the accuracy of the facts observed, as well as in the rigid logic of the mathematics used for interpreting these
facts.


It is interesting to trace historically the invention of those instruments of precision which have led to this
result, and, without entering on the details required in a practical handbook, to note the guiding principles of
construction in different ages.


It is very probable that the Chaldeans may have made spheres, like the armillary sphere, for representing
the poles of the heavens; and with rings to show the ecliptic and zodiac, as well as the equinoctial and
solstitial colures; but we have no record. We only know that the tower of Belus, on an eminence, was their
observatory. We have, however, distinct records of two such spheres used by the Chinese about 2500 B.C.
Gnomons, or some kind of sundial, were used by the Egyptians and others; and many of the ancient nations
measured the obliquity of the ecliptic by the shadows of a vertical column in summer and winter. The natural
horizon was the only instrument of precision used by those who determined star positions by the directions of
their risings and settings; while in those days the clepsydra, or waterclock, was the best instrument for
comparing their times of rising and setting.

About 300 B.C. an observatory fitted with circular instruments for star positions was set up at Alexandria,
the then centre of civilisation. We know almost nothing about the instruments used by Hipparchus in
preparing his star catalogues and his lunar and solar tables; but the invention of the astrolabe is attributed to
him. [[1]]


In more modern times Nuremberg became a centre of astronomical culture. Waltherus, of that town, made
really accurate observations of star altitudes, and of the distances between stars; and in 1484 A.D. he used a
kind of clock. Tycho Brahe tried these, but discarded them as being inaccurate.


Tycho Brahe (1546-1601 A.D.) made great improvements in armillary spheres, quadrants, sextants, and
large celestial globes. With these he measured the positions of stars, or the distance of a comet from several
known stars. He has left us full descriptions of them, illustrated by excellent engravings. Previous to his time
such instruments were made of wood. Tycho always used metal. He paid the greatest attention to the stability
of mounting, to the orientation of his instruments, to the graduation of the arcs by the then new method of
transversals, and to the aperture sight used upon his pointer. There were no telescopes in his day, and no
pendulum clocks. He recognised the fact that there must be instrumental errors. He made these as small as
was possible, measured their amount, and corrected his observations. His table of refractions enabled him to
abolish the error due to our atmosphere so far as it could affect naked-eye observations. The azimuth circle of
Tychos largest quadrant had a diameter of nine feet, and the quadrant a radius of six feet. He introduced the
mural quadrant for meridian observations. [[2]]


A NCIENT C HINESE I NSTRUMENTS,
Including quadrant, celestial globe, and two armillae,
in the Observatory at Peking. Photographed in Peking

by the author in 1875, and stolen by the Germans
when the Embassies were relieved by the allies in

1900.


The French Jesuits at Peking, in the seventeenth century, helped the Chinese in their astronomy. In 1875
the writer saw and photographed, on that part of the wall of Peking used by the Mandarins as an observatory,
the six instruments handsomely designed by Father Verbiest, copied from the instruments of Tycho Brahe,
and embellished with Chinese dragons and emblems cast on the supports. He also saw there two old
instruments (which he was told were Arabic) of date 1279, by Ko Show-King, astronomer to Koblai Khan,
the grandson of Chenghis Khan. One of these last is nearly identical with the armillae of Tycho; and the other
with his armillae quatori maxim, with which he observed the comet of 1585, besides fixed stars and
planets. [[3]]


The discovery by Galileo of the isochronism of the pendulum, followed by Huyghenss adaptation of that
principle to clocks, has been one of the greatest aids to accurate observation. About the same time an equally
beneficial step was the employment of the telescope as a pointer; not the Galilean with concave eye-piece,
but with a magnifying glass to examine the focal image, at which also a fixed mark could be placed. Kepler
was the first to suggest this. Gascoigne was the first to use it. Huyghens used a metal strip of variable width
in the focus, as a micrometer to cover a planetary disc, and so to measure the width covered by the planet.
The Marquis Malvasia, in 1662, described the network of fine silver threads at right angles, which he used in
the focus, much as we do now.


In the hands of such a skilful man as Tycho Brahe, the old open sights, even without clocks, served their
purpose sufficiently well to enable Kepler to discover the true theory of the solar system. But telescopic
sights and clocks were required for proving some of Newtons theories of planetary perturbations. Picards
observations at Paris from 1667 onwards seem to embody the first use of the telescope as a pointer. He was
also the first to introduce the use of Huyghenss clocks for observing the right ascension of stars. Olaus
Romer was born at Copenhagen in 1644. In 1675, by careful study of the times of eclipses of Jupiters


satellites, he discovered that light took time to traverse space. Its velocity is 186,000 miles per second. In
1681 he took up his duties as astronomer at Copenhagen, and built the first transit circle on a window-sill of
his house. The iron axis was five feet long and one and a-half inches thick, and the telescope was fixed near
one end with a counterpoise. The telescope-tube was a double cone, to prevent flexure. Three horizontal and
three vertical wires were used in the focus. These were illuminated by a speculum, near the object-glass,
reflecting the light from a lantern placed over the axis, the upper part of the telescope-tube being partly cut
away to admit the light. A divided circle, with pointer and reading microscope, was provided for reading the
declination. He realised the superiority of a circle with graduations over a much larger quadrant. The
collimation error was found by reversing the instrument and using a terrestrial mark, the azimuth error by star
observations. The time was expressed in fractions of a second. He also constructed a telescope with
equatoreal mounting, to follow a star by one axial motion. In 1728 his instruments and observation records
were destroyed by fire.

Hevelius had introduced the vernier and tangent screw in his measurement of arc graduations. His
observatory and records were burnt to the ground in 1679. Though an old man, he started afresh, and left
behind him a catalogue of 1,500 stars.

Flamsteed began his duties at Greenwich Observatory, as first Astronomer Royal, in 1676, with very poor
instruments. In 1683 he put up a mural arc of 140, and in 1689 a better one, seventy-nine inches radius. He
conducted his measurements with great skill, and introduced new methods to attain accuracy, using certain
stars for determining the errors of his instruments; and he always reduced his observations to a form in which
they could be readily used. He introduced new methods for determining the position of the equinox and the
right ascension of a fundamental star. He produced a catalogue of 2,935 stars. He supplied Sir Isaac Newton
with results of observation required in his theoretical calculations. He died in 1719.

Halley succeeded Flamsteed to find that the whole place had been gutted by the latters executors. In 1721
he got a transit instrument, and in 1726 a mural quadrant by Graham. His successor in 1742, Bradley,
replaced this by a fine brass quadrant, eight feet radius, by Bird; and Bradleys zenith sector was purchased
for the observatory. An instrument like this, specially designed for zenith stars, is capable of greater rigidity
than a more universal instrument; and there is no trouble with refraction in the zenith. For these reasons
Bradley had set up this instrument at Kew, to attempt the proof of the earths motion by observing the annual
parallax of stars. He certainly found an annual variation of zenith distance, but not at the times of year
required by the parallax. This led him to the discovery of the aberration of light and of nutation. Bradley
has been described as the founder of the modern system of accurate observation. He died in 1762, leaving
behind him thirteen folio volumes of valuable but unreduced observations. Those relating to the stars were
reduced by Bessel and published in 1818, at Knigsberg, in his well-known standard work, _Fundamenta_
_Astronomiae_ . In it are results showing the laws of refraction, with tables of its amount, the maximum value of
aberration, and other constants.


Bradley was succeeded by Bliss, and he by Maskelyne (1765), who carried on excellent work, and laid the
foundations of the Nautical Almanac (1767). Just before his death he induced the Government to replace
Birds quadrant by a fine new mural _circle_, six feet in diameter, by Troughton, the divisions being read off by
microscopes fixed on piers opposite to the divided circle. In this instrument the micrometer screw, with a
divided circle for turning it, was applied for bringing the micrometer wire actually in line with a division on
the circlea plan which is still always adopted.

Pond succeeded Maskelyne in 1811, and was the first to use this instrument. From now onwards the places
of stars were referred to the pole, not to the zenith; the zero being obtained from measures on circumpolar
stars. Standard stars were used for giving the clock error. In 1816 a new transit instrument, by Troughton, was
added, and from this date the Greenwich star places have maintained the very highest accuracy.

George Biddell Airy, Seventh Astronomer Royal, [[4]] commenced his Greenwich labours in 1835. His first
and greatest reformation in the work of the observatory was one he had already established at Cambridge,
and is now universally adopted. He held that an observation is not completed until it has been reduced to a
useful form; and in the case of the sun, moon, and planets these results were, in every case, compared with
the tables, and the tabular error printed.

Airy was firmly impressed with the object for which Charles II. had wisely founded the observatory in
connection with navigation, and for observations of the moon. Whenever a meridian transit of the moon
could be observed this was done. But, even so, there are periods in the month when the moon is too near the
sun for a transit to be well observed. Also weather interferes with many meridian observations. To render the
lunar observations more continuous, Airy employed Troughtons successor, James Simms, in conjunction
with the engineers, Ransome and May, to construct an altazimuth with three-foot circles, and a five-foot


telescope, in 1847. The result was that the number of lunar observations was immediately increased
threefold, many of them being in a part of the moons orbit which had previously been bare of observations.
From that date the Greenwich lunar observations have been a model and a standard for the whole world.


Airy also undertook to superintend the reduction of all Greenwich lunar observations from 1750 to 1830.
The value of this laborious work, which was completed in 1848, cannot be over-estimated.


The demands of astronomy, especially in regard to small minor planets, required a transit instrument and
mural circle with a more powerful telescope. Airy combined the functions of both, and employed the same
constructors as before to make a _transit-circle_ with a telescope of eleven and a-half feet focus and a circle of
six-feet diameter, the object-glass being eight inches in diameter.


Airy, like Bradley, was impressed with the advantage of employing stars in the zenith for determining the
fundamental constants of astronomy. He devised a _reflex zenith tube_, in which the zenith point was
determined by reflection from a surface of mercury. The design was so simple, and seemed so perfect, that
great expectations were entertained. But unaccountable variations comparable with those of the transit circle
appeared, and the instrument was put out of use until 1903, when the present Astronomer Royal noticed that
the irregularities could be allowed for, being due to that remarkable variation in the position of the earths
axis included in circles of about six yards diameter at the north and south poles, discovered at the end of the
nineteenth century. The instrument is now being used for investigating these variations; and in the year 1907
as many as 1,545 observations of stars were made with the reflex zenith tube.

In connection with zenith telescopes it must be stated that Respighi, at the Capitol Observatory at Rome,
made use of a deep well with a level mercury surface at the bottom and a telescope at the top pointing
downwards, which the writer saw in 1871. The reflection of the micrometer wires and of a star very near the
zenith (but not quite in the zenith) can be observed together. His mercury trough was a circular plane surface
with a shallow edge to retain the mercury. The surface quickly came to rest after disturbance by street traffic.

Sir W. M. H. Christie, Eighth Astronomer Royal, took up his duties in that capacity in 1881. Besides a
larger altazimuth that he erected in 1898, he has widened the field of operations at Greenwich by the
extensive use of photography and the establishment of large equatoreals. From the point of view of
instruments of precision, one of the most important new features is the astrographic equatoreal, set up in
1892 and used for the Greenwich section of the great astrographic chart just completed. Photography has
come to be of use, not only for depicting the sun and moon, comets and nebulae, but also to obtain accurate
relative positions of neighbouring stars; to pick up objects that are invisible in any telescope; and, most of all
perhaps, in fixing the positions of faint satellites. Thus Saturns distant satellite, Phoebe, and the sixth and
seventh satellites of Jupiter, have been followed regularly in their courses at Greenwich ever since their
discovery with the thirty-inch reflector (erected in 1897); and while doing so Mr. Melotte made, in 1908, the
splendid discovery on some of the photographic plates of an eighth satellite of Jupiter, at an enormous
distance from the planet. From observations in the early part of 1908, over a limited arc of its orbit, before
Jupiter approached the sun, Mr. Cowell computed a retrograde orbit and calculated the future positions of this
satellite, which enabled Mr. Melotte to find it again in the autumna great triumph both of calculation and of
photographic observation. This satellite has never been seen, and has been photographed only at Greenwich,
Heidelberg, and the Lick Observatory.


Greenwich Observatory has been here selected for tracing the progress of accurate measurement. But there
is one instrument of great value, the heliometer, which is not used at Greenwich. This serves the purpose of a
double image micrometer, and is made by dividing the object-glass of a telescope along a diameter. Each half
is mounted so as to slide a distance of several inches each way on an arc whose centre is the focus. The
amount of the movement can be accurately read. Thus two fields of view overlap, and the adjustment is made
to bring an image of one star over that of another star, and then to do the same by a displacement in the
opposite direction. The total movement of the half-object glass is double the distance between the star images
in the focal plane. Such an instrument has long been established at Oxford, and German astronomers have
made great use of it. But in the hands of Sir David Gill (late His Majestys Astronomer at the Cape of Good
Hope), and especially in his great researches on Solar and on Stellar parallax, it has been recognised as an
instrument of the very highest accuracy, measuring the distance between stars correctly to less than a tenth of
a second of arc.


The superiority of the heliometer over all other devices (except photography) for measuring small angles
has been specially brought into prominence by Sir David Gills researches on the distance of the sun _i.e.,_
the scale of the solar system. A measurement of the distance of any planet fixes the scale, and, as Venus
approaches the earth most nearly of all the planets, it used to be supposed that a Transit of Venus offered the
best opportunity for such measurement, especially as it was thought that, as Venus entered on the solar disc,


the sweep of light round the dark disc of Venus would enable a very precise observation to be made. The
Transit of Venus in 1874, in which the present writer assisted, overthrew this delusion.


In 1877 Sir David Gill used Lord Crawfords heliometer at the Island of Ascension to measure the parallax
of Mars in opposition, and found the suns distance 93,080,000 miles. He considered that, while the
superiority of the heliometer had been proved, the results would be still better with the points of light shown
by minor planets rather than with the disc of Mars.


In 1888-9, at the Cape, he observed the minor planets Iris, Victoria, and Sappho, and secured the cooperation of four other heliometers. His final result was 92,870,000 miles, the parallax being 8",802 ( _Cape_
_Obs_ ., Vol. VI.).


So delicate were these measures that Gill detected a minute periodic error of theory of twenty-seven days,
owing to a periodically erroneous position of the centre of gravity of the earth and moon to which the
position of the observer was referred. This led him to correct the mass of the moon, and to fix its ratio to the
earths mass = 0.012240.


Another method of getting the distance from the sun is to measure the velocity of the earths orbital
motion, giving the circumference traversed in a year, and so the radius of the orbit. This has been done by
comparing observation and experiment. The aberration of light is an angle 20 48, giving the ratio of the
earths velocity to the velocity of light. The velocity of light is 186,000 miles a second; whence the distance
to the sun is 92,780,000 miles. There seems, however, to be some uncertainty about the true value of the
aberration, any determination of which is subject to irregularities due to the seasonal errors. The velocity of
light was experimentally found, in 1862, by Fizeau and Foucault, each using an independent method. These
methods have been developed, and new values found, by Cornu, Michaelson, Newcomb, and the present
writer.


Quite lately Halm, at the Cape of Good Hope, measured spectroscopically the velocity of the earth to and
from a star by observations taken six months apart. Thence he obtained an accurate value of the suns
distance. [[5]]


But the remarkably erratic minor planet, Eros, discovered by Witte in 1898, approaches the earth within
15,000,000 miles at rare intervals, and, with the aid of photography, will certainly give us the best result. A
large number of observatories combined to observe the opposition of 1900. Their results are not yet
completely reduced, but the best value deduced so far for the parallax [[6]] is 8".807  0".0028. [[7]]


**FOOTNOTES:**


[1] In 1480 Martin Behaim, of Nuremberg, produced his _astrolabe_ for measuring the latitude, by observation
of the sun, at sea. It consisted of a graduated metal circle, suspended by a ring which was passed over the
thumb, and hung vertically. A pointer was fixed to a pin at the centre. This arm, called the _alhidada_, worked
round the graduated circle, and was pointed to the sun. The altitude of the sun was thus determined, and, by
help of solar tables, the latitude could be found from observations made at apparent noon.


[2] See illustration on p. 76.


[3] See Dreyers article on these instruments in _Copernicus_, Vol. I. They were stolen by the Germans after the
relief of the Embassies, in 1900. The best description of these instruments is probably that contained in an
interesting volume, which may be seen in the library of the R. A. S., entitled _Chinese Researches_, by
Alexander Wyllie (Shanghai, 1897).


[4] Sir George Airy was very jealous of this honourable title. He rightly held that there is only one
Astronomer Royal at a time, as there is only one Mikado, one Dalai Lama. He said that His Majestys
Astronomer at the Cape of Good Hope, His Majestys Astronomer for Scotland, and His Majestys
Astronomer for Ireland are not called Astronomers Royal.


[5] _Annals of the Cape Observatory_, vol. x., part 3.


[6] The parallax of the sun is the angle subtended by the earths radius at the suns distance.


[7] A. R. Hinks, R.A.S.; Monthly Notices, June, 1909.


## 11. HISTORY OF THE TELESCOPE

Accounts of wonderful optical experiments by Roger Bacon (who died in 1292), and in the sixteenth
century by Digges, Baptista Porta, and Antonio de Dominis (Grant, _Hist. Ph. Ast_ .), have led some to suppose
that they invented the telescope. The writer considers that it is more likely that these notes refer to a kind of
_camera obscura_, in which a lens throws an inverted image of a landscape on the wall.

The first telescopes were made in Holland, the originator being either Henry Lipperhey, [[1]] Zacharias
Jansen, or James Metius, and the date 1608 or earlier.


In 1609 Galileo, being in Venice, heard of the invention, went home and worked out the theory, and made a
similar telescope. These telescopes were all made with a convex object-glass and a concave eye-lens, and this
type is spoken of as the Galilean telescope. Its defects are that it has no real focus where cross-wires can be
placed, and that the field of view is very small. Kepler suggested the convex eye-lens in 1611, and Scheiner
claimed to have used one in 1617. But it was Huyghens who really introduced them. In the seventeenth
century telescopes were made of great length, going up to 300 feet. Huyghens also invented the compound
eye-piece that bears his name, made of two convex lenses to diminish spherical aberration.


But the defects of colour remained, although their cause was unknown until Newton carried out his
experiments on dispersion and the solar spectrum. To overcome the spherical aberration James Gregory, [[2]] of
Aberdeen and Edinburgh, in 1663, in his _Optica Promota_, proposed a reflecting speculum of parabolic form.
But it was Newton, about 1666, who first made a reflecting telescope; and he did it with the object of
avoiding colour dispersion.

Some time elapsed before reflectors were much used. Pound and Bradley used one presented to the Royal
Society by Hadley in 1723. Hawksbee, Bradley, and Molyneaux made some. But James Short, of Edinburgh,
made many excellent Gregorian reflectors from 1732 till his death in 1768.


Newtons trouble with refractors, chromatic aberration, remained insurmountable until John Dollond (born
1706, died 1761), after many experiments, found out how to make an achromatic lens out of two lensesone
of crown glass, the other of flint glassto destroy the colour, in a way originally suggested by Euler. He soon
acquired a great reputation for his telescopes of moderate size; but there was a difficulty in making flint-glass
lenses of large size. The first actual inventor and constructor of an achromatic telescope was Chester Moor
Hall, who was not in trade, and did not patent it. Towards the close of the eighteenth century a Swiss named
Guinand at last succeeded in producing larger flint-glass discs free from striae. Frauenhofer, of Munich, took
him up in 1805, and soon produced, among others, Struves Dorpat refractor of 9.9 inches diameter and 13.5
feet focal length, and another, of 12 inches diameter and 18 feet focal length, for Lamont, of Munich.

In the nineteenth century gigantic _reflectors_ have been made. Lassels 2-foot reflector, made by himself,
did much good work, and discovered four new satellites. But Lord Rosses 6-foot reflector, 54 feet focal
length, constructed in 1845, is still the largest ever made. The imperfections of our atmosphere are against the
use of such large apertures, unless it be on high mountains. During the last half century excellent specula
have been made of silvered glass, and Dr. Commons 5-foot speculum (removed, since his death, to Harvard)
has done excellent work. Then there are the 5-foot Yerkes reflector at Chicago, and the 4-foot by Grubb at
Melbourne.


Passing now from these large reflectors to refractors, further improvements have been made in the
manufacture of glass by Chance, of Birmingham, Feil and Mantois, of Paris, and Schott, of Jena; while
specialists in grinding lenses, like Alvan Clark, of the U.S.A., and others, have produced many large
refractors.


Cooke, of York, made an object-glass, 25-inch diameter, for Newall, of Gateshead, which has done
splendid work at Cambridge. We have the Washington 26-inch by Clark, the Vienna 27-inch by Grubb, the
Nice 29-inch by Gautier, the Pulkowa 30-inch by Clark. Then there was the sensation of Clarks 36-inch for
the Lick Observatory in California, and finally his _tour de force_, the Yerkes 40-inch refractor, for Chicago.

At Greenwich there is the 28-inch photographic refractor, and the Thompson equatoreal by Grubb,
carrying both the 26-inch photographic refractor and the 30-inch reflector. At the Cape of Good Hope we find
Mr. Frank McCleans 24-inch refractor, with an object-glass prism for spectroscopic work.


It would be out of place to describe here the practical adjuncts of a modern equatorealthe adjustments
for pointing it, the clock for driving it, the position-micrometer and various eye-pieces, the photographic and
spectroscopic attachments, the revolving domes, observing seats, and rising floors and different forms of
mounting, the siderostats and coelostats, and other convenient adjuncts, besides the registering chronograph
and numerous facilities for aiding observation. On each of these a chapter might be written; but the most
important part of the whole outfit is the man behind the telescope, and it is with him that a history is more
especially concerned.

### SPECTROSCOPE.


Since the invention of the telescope no discovery has given so great an impetus to astronomical physics as
the spectroscope; and in giving us information about the systems of stars and their proper motions it rivals the
telescope.


Frauenhofer, at the beginning of the nineteenth century, while applying Dollonds discovery to make large
achromatic telescopes, studied the dispersion of light by a prism. Admitting the light of the sun through a
narrow slit in a window-shutter, an inverted image of the slit can be thrown, by a lens of suitable focal length,
on the wall opposite. If a wedge or prism of glass be interposed, the image is deflected to one side; but, as
Newton had shown, the images formed by the different colours of which white light is composed are
deflected to different extentsthe violet most, the red least. The number of colours forming images is so
numerous as to form a continuous spectrum on the wall with all the coloursred, orange, yellow, green,
blue, indigo, and violet. But Frauenhofer found with a narrow slit, well focussed by the lens, that some
colours were missing in the white light of the sun, and these were shown by dark lines across the spectrum.
These are the Frauenhofer lines, some of which he named by the letters of the alphabet. The D line is a very
marked one in the yellow. These dark lines in the solar spectrum had already been observed by Wollaston. [[3]]

On examining artificial lights it was found that incandescent solids and liquids (including the carbon
glowing in a white gas flame) give continuous spectra; gases, except under enormous pressure, give bright
lines. If sodium or common salt be thrown on the colourless flame of a spirit lamp, it gives it a yellow colour,
and its spectrum is a bright yellow line agreeing in position with line D of the solar spectrum.


In 1832 Sir David Brewster found some of the solar black lines increased in strength towards sunset, and
attributed them to absorption in the earths atmosphere. He suggested that the others were due to absorption
in the suns atmosphere. Thereupon Professor J. D. Forbes pointed out that during a nearly total eclipse the
lines ought to be strengthened in the same way; as that part of the suns light, coming from its edge, passes
through a great distance in the suns atmosphere. He tried this with the annular eclipse of 1836, with a
negative result which has never been accounted for, and which seemed to condemn Brewsters view.

In 1859 Kirchoff, on repeating Frauenhofers experiment, found that, if a spirit lamp with salt in the flame
were placed in the path of the light, the black D line is intensified. He also found that, if he used a limelight
instead of the sunlight and passed it through the flame with salt, the spectrum showed the D line black; or the
vapour of sodium absorbs the same light that it radiates. This proved to him the existence of sodium in the
suns atmosphere. [[4]] Iron, calcium, and other elements were soon detected in the same way.


Extensive laboratory researches (still incomplete) have been carried out to catalogue (according to their
wave-length on the undulatory theory of light) all the lines of each chemical element, under all conditions of
temperature and pressure. At the same time, all the lines have been catalogued in the light of the sun and the
brighter of the stars.

Another method of obtaining spectra had long been known, by transmission through, or reflection from, a
grating of equidistant lines ruled upon glass or metal. H. A. Rowland developed the art of constructing these
gratings, which requires great technical skill, and for this astronomers owe him a debt of gratitude.

In 1842 Doppler [[5]] proved that the colour of a luminous body, like the pitch or note of a sounding body,
must be changed by velocity of approach or recession. Everyone has noticed on a railway that, on meeting a
locomotive whistling, the note is lowered after the engine has passed. The pitch of a sound or the colour of a
light depends on the number of waves striking the ear or eye in a second. This number is increased by
approach and lowered by recession.


Thus, by comparing the spectrum of a star alongside a spectrum of hydrogen, we may see all the lines, and
be sure that there is hydrogen in the star; yet the lines in the star-spectrum may be all slightly displaced to
one side of the lines of the comparison spectrum. If towards the violet end, it means mutual approach of the
star and earth; if to the red end, it means recession. The displacement of lines does not tell us whether the


motion is in the star, the earth, or both. The displacement of the lines being measured, we can calculate the
rate of approach or recession in miles per second.

In 1868 Huggins [[6]] succeeded in thus measuring the velocities of stars in the direction of the line of sight.
In 1873 Vogel [[7]] compared the spectra of the suns East (approaching) limb and West (receding) limb, and
the displacement of lines endorsed the theory. This last observation was suggested by Zllner.


**FOOTNOTES:**


[1] In the _Encyclopaedia Britannica_, article Telescope, and in Grants _Physical Astronomy_, good reasons
are given for awarding the honour to Lipperhey.


[2] Will the indulgent reader excuse an anecdote which may encourage some workers who may have found
their mathematics defective through want of use? James Gregorys nephew David had a heap of MS. notes by
Newton. These descended to a Miss Gregory, of Edinburgh, who handed them to the present writer, when an
undergraduate at Cambridge, to examine. After perusal, he lent them to his kindest of friends, J. C. Adams
(the discoverer of Neptune), for his opinion. Adamss final verdict was: I fear they are of no value. It is
pretty evident that, when he wrote these notes, _Newtons mathematics were a little rusty_ .


[3] _R. S. Phil. Trans_ .


[4] The experiment had been made before by one who did not understand its meaning;. But Sir George G.
Stokes had already given verbally the true explanation of Frauenhofer lines.


[5] _Abh. d. Kn. Bhm. d. Wiss_ ., Bd. ii., 1841-42, p. 467. See also Fizeau in the _Ann. de Chem. et de Phys_ .,
1870, p. 211.


[6] _R. S. Phil. Trans_ ., 1868.


[7] _Ast. Nach_ ., No. 1, 864.


## BOOK IV. THE PHYSICAL PERIOD

We have seen how the theory of the solar system was slowly developed by the constant efforts of the
human mind to find out what are the rules of cause and effect by which our conception of the present
universe and its development seems to be bound. In the primitive ages a mere record of events in the heavens
and on the earth gave the only hope of detecting those uniform sequences from which to derive rules or laws
of cause and effect upon which to rely. Then came the geometrical age, in which rules were sought by which
to predict the movements of heavenly bodies. Later, when the relation of the sun to the courses of the planets
was established, the sun came to be looked upon as a cause; and finally, early in the seventeenth century, for
the first time in history, it began to be recognised that the laws of dynamics, exactly as they had been
established for our own terrestrial world, hold good, with the same rigid invariability, at least as far as the
limits of the solar system.


Throughout this evolution of thought and conjecture there were two types of astronomersthose who
supplied the facts, and those who supplied the interpretation through the logic of mathematics. So Ptolemy
was dependent upon Hipparchus, Kepler on Tycho Brahe, and Newton in much of his work upon Flamsteed.


When Galileo directed his telescope to the heavens, when Secchi and Huggins studied the chemistry of the
stars by means of the spectroscope, and when Warren De la Rue set up a photoheliograph at Kew, we see that
a progress in the same direction as before, in the evolution of our conception of the universe, was being
made. Without definite expression at any particular date, it came to be an accepted fact that not only do
earthly dynamics apply to the heavenly bodies, but that the laws we find established here, in geology, in
chemistry, and in the laws of heat, may be extended with confidence to the heavenly bodies. Hence arose the
branch of astronomy called astronomical physics, a science which claims a large portion of the work of the
telescope, spectroscope, and photography. In this new development it is more than ever essential to follow
the dictum of Tycho Brahenot to make theories until all the necessary facts are obtained. The great
astronomers of to-day still hold to Sir Isaac Newtons declaration, Hypotheses non fingo. Each one may
have his suspicions of a theory to guide him in a course of observation, and may call it a working hypothesis.
But the cautious astronomer does not proclaim these to the world; and the historian is certainly not justified in
including in his record those vague speculations founded on incomplete data which may be demolished tomorrow, and which, however attractive they may be, often do more harm than good to the progress of true
science. Meanwhile the accumulation of facts has been prodigious, and the revelations of the telescope and
spectroscope entrancing.


## 12. THE SUN.

One of Galileos most striking discoveries, when he pointed his telescope to the heavenly bodies, was that
of the irregularly shaped spots on the sun, with the dark central _umbra_ and the less dark, but more extensive,
_penumbra_ surrounding it, sometimes with several umbrae in one penumbra. He has left us many drawings of
these spots, and he fixed their period of rotation as a lunar month.

It is not certain whether Galileo, Fabricius, or Schemer was the first to see the spots. They all did good
work. The spots were found to be ever varying in size and shape. Sometimes, when a spot disappears at the
western limb of the sun, it is never seen again. In other cases, after a fortnight, it reappears at the eastern
limb. The faculae, or bright areas, which are seen all over the suns surface, but specially in the
neighbourhood of spots, and most distinctly near the suns edge, were discovered by Galileo. A high
telescopic power resolves their structure into an appearance like willow-leaves, or rice-grains, fairly uniform
in size, and more marked than on other parts of the suns surface.


S OLAR S URFACE .
As Photographed at the Royal Observatory, Greenwich, showing

sun-spots with umbr, penumbr, and facul.


Speculations as to the cause of sun-spots have never ceased from Galileos time to ours. He supposed them
to be clouds. Scheiner [[1]] said they were the indications of tumultuous movements occasionally agitating the
ocean of liquid fire of which he supposed the sun to be composed.

A. Wilson, of Glasgow, in 1769, [[2]] noticed a movement of the umbra relative to the penumbra in the transit
of the spot over the suns surface; exactly as if the spot were a hollow, with a black base and grey shelving
sides. This was generally accepted, but later investigations have contradicted its universality. Regarding the
cause of these hollows, Wilson said:


Whether their first production and subsequent numberless changes depend upon the
eructation of elastic vapours from below, or upon eddies or whirlpools commencing at
the surface, or upon the dissolving of the luminous matter in the solar atmosphere, as


clouds are melted and again given out by our air; or, if the reader pleases, upon the
annihilation and reproduction of parts of this resplendent covering, is left for theory to
guess at. [[3]]


Ever since that date theory has been guessing at it. The solar astronomer is still applying all the
instruments of modern research to find out which of these suppositions, or what modification of any of them,
is nearest the truth. The obstacleone that is perhaps fatal to a real theorylies in the impossibility of
reproducing comparative experiments in our laboratories or in our atmosphere.


Sir William Herschel propounded an explanation of Wilsons observation which received much notice, but
which, out of respect for his memory, is not now described, as it violated the elementary laws of heat.

Sir John Herschel noticed that the spots are mostly confined to two zones extending to about 35 on each
side of the equator, and that a zone of equatoreal calms is free from spots. But it was R. C. Carrington [[4]] who,
by his continuous observations at Redhill, in Surrey, established the remarkable fact that, while the rotation
period in the highest latitudes, 50, where spots are seen, is twenty-seven-and-a-half days, near the equator
the period is only twenty-five days. His splendid volume of observations of the sun led to much new
information about the average distribution of spots at different epochs.


Schwabe, of Dessau, began in 1826 to study the solar surface, and, after many years of work, arrived at a
law of frequency which has been more fruitful of results than any discovery in solar physics. [[5]] In 1843 he
announced a decennial period of maxima and minima of sun-spot displays. In 1851 it was generally accepted,
and, although a period of eleven years has been found to be more exact, all later observations, besides the
earlier ones which have been hunted up for the purpose, go to establish a true periodicity in the number of
sun-spots. But quite lately Schuster [[6]] has given reasons for admitting a number of co-existent periods, of
which the eleven-year period was predominant in the nineteenth century.


In 1851 Lament, a Scotchman at Munich, found a decennial period in the daily range of magnetic
declination. In 1852 Sir Edward Sabine announced a similar period in the number of magnetic storms
affecting all of the three magnetic elementsdeclination, dip, and intensity. Australian and Canadian
observations both showed the decennial period in all three elements. Wolf, of Zurich, and Gauthier, of
Geneva, each independently arrived at the same conclusion.


It took many years before this coincidence was accepted as certainly more than an accident by the oldfashioned astronomers, who want rigid proof for every new theory. But the last doubts have long vanished,
and a connection has been further traced between violent outbursts of solar activity and simultaneous
magnetic storms.


The frequency of the Aurora Borealis was found by Wolf to follow the same period. In fact, it is closely
allied in its cause to terrestrial magnetism. Wolf also collected old observations tracing the periodicity of sunspots back to about 1700 A.D.


Spoerer deduced a law of dependence of the average latitude of sun-spots on the phase of the sun-spot
period.


All modern total solar eclipse observations seem to show that the shape of the luminous corona
surrounding the moon at the moment of totality has a special distinct character during the time of a sun-spot
maximum, and another, totally different, during a sun-spot minimum.


A suspicion is entertained that the total quantity of heat received by the earth from the sun is subject to the
same period. This would have far-reaching effects on storms, harvests, vintages, floods, and droughts; but it
is not safe to draw conclusions of this kind except from a very long period of observations.


Solar photography has deprived astronomers of the type of Carrington of the delight in devoting a lifes
work to collecting data. It has now become part of the routine work of an observatory.


In 1845 Foucault and Fizeau took a daguerreotype photograph of the sun. In 1850 Bond produced one of
the moon of great beauty, Draper having made some attempts at an even earlier date. But astronomical
photography really owes its beginning to De la Rue, who used the collodion process for the moon in 1853,
and constructed the Kew photoheliograph in 1857, from which date these instruments have been multiplied,
and have given us an accurate record of the suns surface. Gelatine dry plates were first used by Huggins in
1876.


It is noteworthy that from the outset De la Rue recognised the value of stereoscopic vision, which is now
known to be of supreme accuracy. In 1853 he combined pairs of photographs of the moon in the same phase,
but under different conditions regarding libration, showing the moon from slightly different points of view.
These in the stereoscope exhibited all the relief resulting from binocular vision, and looked like a solid globe.


In 1860 he used successive photographs of the total solar eclipse stereoscopically, to prove that the red
prominences belong to the sun, and not to the moon. In 1861 he similarly combined two photographs of a
sun-spot, the perspective effect showing the umbra like a floor at the bottom of a hollow penumbra; and in
one case the facul were discovered to be sailing over a spot apparently at some considerable height. These
appearances may be partly due to a proper motion; but, so far as it went, this was a beautiful confirmation of
Wilsons discovery. Hewlett, however, in 1894, after thirty years of work, showed that the spots are not
always depressions, being very subject to disturbance.

The Kew photographs [[7]] contributed a vast amount of information about sun-spots, and they showed that
the facul generally follow the spots in their rotation round the sun.


The constitution of the suns photosphere, the layer which is the principal light-source on the sun, has
always been a subject of great interest; and much was done by men with exceptionally keen eyesight, like Mr.
Dawes. But it was a difficult subject, owing to the rapidity of the changes in appearance of the so-called ricegrains, about 1 in diameter. The rapid transformations and circulations of these rice-grains, if thoroughly
studied, might lead to a much better knowledge of solar physics. This seemed almost hopeless, as it was
found impossible to identify any rice-grain in the turmoil after a few minutes. But M. Hansky, of Pulkowa
(whose recent death is deplored), introduced successfully a scheme of photography, which might almost be
called a solar cinematograph. He took photographs of the sun at intervals of fifteen or thirty seconds, and then
enlarged selected portions of these two hundred times, giving a picture corresponding to a solar disc of six
metres diameter. In these enlarged pictures he was able to trace the movements, and changes of shape and
brightness, of individual rice-grains. Some granules become larger or smaller. Some seem to rise out of a
mist, as it were, and to become clearer. Others grow feebler. Some are split in two. Some are rotated through
a right angle in a minute or less, although each of the grains may be the size of Great Britain. Generally they
move together in groups of very various velocities, up to forty kilometres a second. These movements seem
to have definite relation to any sun-spots in the neighbourhood. From the results already obtained it seems
certain that, if this method of observation be continued, it cannot fail to supply facts of the greatest
importance.


It is quite impossible to do justice here to the work of all those who are engaged on astronomical physics.
The utmost that can be attempted is to give a fair idea of the directions of human thought and endeavour.
During the last half-century America has made splendid progress, and an entirely new process of studying the
photosphere has been independently perfected by Professor Hale at Chicago, and Deslandres at Paris. [[8]] They
have succeeded in photographing the suns surface in monochromatic light, such as the light given off as one
of the bright lines of hydrogen or of calcium, by means of the Spectroheliograph. The spectroscope is
placed with its slit in the focus of an equatoreal telescope, pointed to the sun, so that the circular image of the
sun falls on the slit. At the other end of the spectroscope is the photographic plate. Just in front of this plate
there is another slit parallel to the first, in the position where the image of the first slit formed by the K line of
calcium falls. Thus is obtained a photograph of the section of the sun, made by the first slit, only in K light.
As the image of the sun passes over the first slit the photographic plate is moved at the same rate and in the
same direction behind the second slit; and as successive sections of the suns image in the equatoreal enter
the apparatus, so are these sections successively thrown in their proper place on the photographic plate,
always in K light. By using a high dispersion the facul which give off K light can be correctly
photographed, not only at the suns edge, but all over his surface. The actual mechanical method of carrying
out the observation is not quite so simple as what is here described.

By choosing another line of the spectrum instead of calcium Kfor example, the hydrogen line H (3) we
obtain two photographs, one showing the appearance of the calcium floculi, and the other of the hydrogen
floculi, on the same part of the solar surface; and nothing is more astonishing than to note the total want of
resemblance in the forms shown on the two. This mode of research promises to afford many new and useful
data.


The spectroscope has revealed the fact that, broadly speaking, the sun is composed of the same materials
as the earth. ngstrom was the first to map out all of the lines to be found in the solar spectrum. But
Rowland, of Baltimore, after having perfected the art of making true gratings with equidistant lines ruled on
metal for producing spectra, then proceeded to make a map of the solar spectrum on a large scale.

In 1866 Lockyer [[9]] threw an image of the sun upon the slit of a spectroscope, and was thus enabled to
compare the spectrum of a spot with that of the general solar surface. The observation proved the darkness of
a spot to be caused by increased absorption of light, not only in the dark lines, which are widened, but over
the entire spectrum. In 1883 Young resolved this continuous obscurity into an infinite number of fine lines,
which have all been traced in a shadowy way on to the general solar surface. Lockyer also detected


displacements of the spectrum lines in the spots, such as would be produced by a rapid motion in the line of
sight. It has been found that both uprushes and downrushes occur, but there is no marked predominance of
either in a sun-spot. The velocity of motion thus indicated in the line of sight sometimes appears to amount to
320 miles a second. But it must be remembered that pressure of a gas has some effect in displacing the
spectral lines. So we must go on, collecting data, until a time comes when the meaning of all the facts can be
made clear.


_Total Solar Eclipses_ .During total solar eclipses the time is so short, and the circumstances so impressive,
that drawings of the appearance could not always be trusted. The red prominences of jagged form that are
seen round the moons edge, and the corona with its streamers radiating or interlacing, have much detail that
can hardly be recorded in a sketch. By the aid of photography a number of records can be taken during the
progress of totality. From a study of these the extent of the corona is demonstrated in one case to extend to at
least six diameters of the moon, though the eye has traced it farther. This corona is still one of the wonders of
astronomy, and leads to many questions. What is its consistency, if it extends many million miles from the
suns surface? How is it that it opposed no resistance to the motion of comets which have almost grazed the
suns surface? Is this the origin of the zodiacal light? The character of the corona in photographic records has
been shown to depend upon the phase of the sun-spot period. During the sun-spot maximum the corona
seems most developed over the spot-zonesi.e., neither at the equator nor the poles. The four great sheaves
of light give it a square appearance, and are made up of rays or plumes, delicate like the petals of a flower.
During a minimum the nebulous ring seems to be made of tufts of fine hairs with aigrettes or radiations from
both poles, and streamers from the equator.


S OLAR E CLIPSE, 1882.
From drawing by W. H. Wesley, Secretary R.A.S.; showing

the prominences, the corona, and an unknown comet.


On September 19th, 1868, eclipse spectroscopy began with the Indian eclipse, in which all observers found
that the red prominences showed a bright line spectrum, indicating the presence of hydrogen and other gases.
So bright was it that Jansen exclaimed:  _Je verrai ces lignes-l en dehors des clipses_ . And the next day he
observed the lines at the edge of the uneclipsed sun. Huggins had suggested this observation in February,
1868, his idea being to use prisms of such great dispersive power that the continuous spectrum reflected by
our atmosphere should be greatly weakened, while a bright line would suffer no diminution by the high
dispersion. On October 20th Lockyer, [[10]] having news of the eclipse, but not of Jansens observations the day
after, was able to see these lines. This was a splendid performance, for it enabled the prominences to be
observed, not only during eclipses, but every day. Moreover, the next year Huggins was able, by using a wide
slit, to see the whole of a prominence and note its shape. Prominences are classified, according to their form,
into flame and cloud prominences, the spectrum of the latter showing calcium, hydrogen, and helium;
that of the former including a number of metals.


The D line of sodium is a double line, and in the same eclipse (1868) an orange line was noticed which
was afterwards found to lie close to the two components of the D line. It did not correspond with any known
terrestrial element, and the unknown element was called helium. It was not until 1895 that Sir William
Ramsay found this element as a gas in the mineral cleavite.

The spectrum of the corona is partly continuous, indicating light reflected from the suns body. But it also
shows a green line corresponding with no known terrestrial element, and the name coronium has been
given to the substance causing it.


A vast number of facts have been added to our knowledge about the sun by photography and the
spectroscope. Speculations and hypotheses in plenty have been offered, but it may be long before we have a
complete theory evolved to explain all the phenomena of the storm-swept metallic atmosphere of the sun.

The proceedings of scientific societies teem with such facts and working hypotheses, and the best of
them have been collected by Miss Clerke in her _History of Astronomy during the Nineteenth Century_ . As to
established facts, we learn from the spectroscopic researches (1) that the continuous spectrum is derived from
the _photosphere_ or solar gaseous material compressed almost to liquid consistency; (2) that the _reversing_
_layer_ surrounds it and gives rise to black lines in the spectrum; that the _chromosphere_ surrounds this, is
composed mainly of hydrogen, and is the cause of the red prominences in eclipses; and that the gaseous
_corona_ surrounds all of these, and extends to vast distances outside the suns visible surface.


**FOOTNOTES:**


[1] _Rosa Ursina_, by C. Scheiner, _fol_ .; Bracciani, 1630.


[2] _R. S. Phil. Trans_ ., 1774.


[3] _Ibid_, 1783.


[4] _Observations on the Spots on the Sun, etc.,_ 4; London and Edinburgh, 1863.


[5] _Periodicitt der Sonnenflecken. Astron. Nach. XXI._, 1844, P. 234.


[6] _R.S. Phil. Trans._ (ser. A), 1906, p. 69-100.


[7] Researches on Solar Physics, by De la Rue, Stewart and Loewy; _R. S. Phil. Trans_ ., 1869, 1870.


[8] The Sun as Photographed on the K line; _Knowledge_, London, 1903, p. 229.


[9] _R. S. Proc._, xv., 1867, p. 256.


[10] _Acad. des Sc._, Paris; _C. R._, lxvii., 1868, p. 121.


## 13. THE MOON AND PLANETS.

_The Moon_ .Telescopic discoveries about the moon commence with Galileos discovery that her surface
has mountains and valleys, like the earth. He also found that, while she always turns the same face to us,
there is periodically a slight twist to let us see a little round the eastern or western edge. This was called
_libration_, and the explanation was clear when it was understood that in showing always the same face to us
she makes one revolution a month on her axis _uniformly_, and that her revolution round the earth is not
uniform.


Galileo said that the mountains on the moon showed greater differences of level than those on the earth.
Shrter supported this opinion. W. Herschel opposed it. But Beer and Mdler measured the heights of lunar
mountains by their shadows, and found four of them over 20,000 feet above the surrounding plains.

Langrenus [[1]] was the first to do serious work on selenography, and named the lunar features after eminent
men. Riccioli also made lunar charts. In 1692 Cassini made a chart of the full moon. Since then we have the
charts of Schrter, Beer and Mdler (1837), and of Schmidt, of Athens (1878); and, above all, the
photographic atlas by Loewy and Puiseux.


The details of the moons surface require for their discussion a whole book, like that of Neison or the one
by Nasmyth and Carpenter. Here a few words must suffice. Mountain ranges like our Andes or Himalayas are
rare. Instead of that, we see an immense number of circular cavities, with rugged edges and flat interior, often
with a cone in the centre, reminding one of instantaneous photographs of the splash of a drop of water falling
into a pool. Many of these are fifty or sixty miles across, some more. They are generally spoken of as
resembling craters of volcanoes, active or extinct, on the earth. But some of those who have most fully
studied the shapes of craters deny altogether their resemblance to the circular objects on the moon. These socalled craters, in many parts, are seen to be closely grouped, especially in the snow-white parts of the moon.
But there are great smooth dark spaces, like the clear black ice on a pond, more free from craters, to which
the equally inappropriate name of seas has been given. The most conspicuous crater, _Tycho_, is near the south
pole. At full moon there are seen to radiate from Tycho numerous streaks of light, or rays, cutting through
all the mountain formations, and extending over fully half the lunar disc, like the star-shaped cracks made on
a sheet of ice by a blow. Similar cracks radiate from other large craters. It must be mentioned that these white
rays are well seen only in full light of the sun at full moon, just as the white snow in the crevasses of a glacier
is seen bright from a distance only when the sun is high, and disappears at sunset. Then there are deep,
narrow, crooked rills which may have been water-courses; also clefts about half a mile wide, and often
hundreds of miles long, like deep cracks in the surface going straight through mountain and valley.


The moon shares with the sun the advantage of being a good subject for photography, though the planets
are not. This is owing to her larger apparent size, and the abundance of illumination. The consequence is that
the finest details of the moon, as seen in the largest telescope in the world, may be reproduced at a cost within
the reach of all.


No certain changes have ever been observed; but several suspicions have been expressed, especially as to
the small crater _Linn_, in the _Mare Serenitatis_ . It is now generally agreed that no certainty can be expected
from drawings, and that for real evidence we must await the verdict of photography.


No trace of water or of an atmosphere has been found on the moon. It is possible that the temperature is
too low. In any case, no displacement of a star by atmospheric refraction at occultation has been surely
recorded. The moon seems to be dead.


The distance of the moon from the earth is just now the subject of re-measurement. The base line is from
Greenwich to Cape of Good Hope, and the new feature introduced is the selection of a definite point on a
crater (Msting A), instead of the moons edge, as the point whose distance is to be measured.


_The Inferior Planets_ .When the telescope was invented, the phases of Venus attracted much attention; but
the brightness of this planet, and her proximity to the sun, as with Mercury also, seemed to be a bar to the
discovery of markings by which the axis and period of rotation could be fixed. Cassini gave the rotation as
twenty-three hours, by observing a bright spot on her surface. Shrter made it 23h. 21m. 19s. This value was
supported by others. In 1890 Schiaparelli [[2]] announced that Venus rotates, like our moon, once in one of her
revolutions, and always directs the same face to the sun. This property has also been ascribed to Mercury; but


in neither case has the evidence been generally accepted. Twenty-four hours is probably about the period of
rotation for each of these planets.


Several observers have claimed to have seen a planet within the orbit of Mercury, either in transit over the
suns surface or during an eclipse. It has even been named _Vulcan_ . These announcements would have
received little attention but for the fact that the motion of Mercury has irregularities which have not been
accounted for by known planets; and Le Verrier [[3]] has stated that an intra-Mercurial planet or ring of asteroids
would account for the unexplained part of the motion of the line of apses of Mercurys orbit amounting to
38 per century.

_Mars_ .The first study of the appearance of Mars by Miraldi led him to believe that there were changes
proceeding in the two white caps which are seen at the planets poles. W. Herschel attributed these caps to ice
and snow, and the dates of his observations indicated a melting of these ice-caps in the Martian summer.


Schroter attributed the other markings on Mars to drifting clouds. But Beer and Mdler, in 1830-39,
identified the same dark spots as being always in the same place, though sometimes blurred by mist in the
local winter. A spot sketched by Huyghens in 1672, one frequently seen by W. Herschel in 1783, another by
Arago in 1813, and nearly all the markings recorded by Beer and Mdler in 1830, were seen and drawn by F.
Kaiser in Leyden during seventeen nights of the opposition of 1862 ( _Ast. Nacht._, No. 1,468), whence he
deduced the period of rotation to be 24h. 37m. 22s.,62or one-tenth of a second less than the period deduced
by R. A. Proctor from a drawing by Hooke in 1666.


It must be noted that, if the periods of rotation both of Mercury and Venus be about twenty-four hours, as
seems probable, all the four planets nearest to the sun rotate in the same period, while the great planets rotate
in about ten hours (Uranus and Neptune being still indeterminate).


The general surface of Mars is a deep yellow; but there are dark grey or greenish patches. Sir John
Herschel was the first to attribute the ruddy colour of Mars to its soil rather than to its atmosphere.

The observations of that keen-sighted observer Dawes led to the first good map of Mars, in 1869. In the
1877 opposition Schiaparelli revived interest in the planet by the discovery of canals, uniformly about sixty
miles wide, running generally on great circles, some of them being three or four thousand miles long. During
the opposition of 1881-2 the same observer re-observed the canals, and in twenty of them he found the canals
duplicated, [[4]] the second canal being always 200 to 400 miles distant from its fellow.


The existence of these canals has been doubted. Mr. Lowell has now devoted years to the subject, has
drawn them over and over again, and has photographed them; and accepts the explanation that they are
artificial, and that vegetation grows on their banks. Thus is revived the old controversy between Whewell and
Brewster as to the habitability of the planets. The new arguments are not yet generally accepted. Lowell
believes he has, with the spectroscope, proved the existence of water on Mars.


One of the most unexpected and interesting of all telescopic discoveries took place in the opposition of
1877, when Mars was unusually near to the earth. The Washington Observatory had acquired the fine 26-inch
refractor, and Asaph Hall searched for satellites, concealing the planets disc to avoid the glare. On August
11th he had a suspicion of a satellite. This was confirmed on the 16th, and on the following night a second
one was added. They are exceedingly faint, and can be seen only by the most powerful telescopes, and only
at the times of opposition. Their diameters are estimated at six or seven miles. It was soon found that the first,
Deimos, completes its orbit in 30h. 18m. But the other, Phobos, at first was a puzzle, owing to its incredible
velocity being unsuspected. Later it was found that the period of revolution was only 7h. 39m. 22s. Since the
Martian day is twenty-four and a half hours, this leads to remarkable results. Obviously the easterly motion
of the satellite overwhelms the diurnal rotation of the planet, and Phobos must appear to the inhabitants, if
they exist, to rise in the west and set in the east, showing two or even three full moons in a day, so that,
sufficiently well for the ordinary purposes of life, the hour of the day can be told by its phases.

The discovery of these two satellites is, perhaps, the most interesting telescopic visual discovery made
with the large telescopes of the last half century; photography having been the means of discovering all the
other new satellites except Jupiters fifth (in order of discovery).


J UPITER .
From a drawing by E. M. Antoniadi, showing transit of a
satellites shadow, the belts, and the great red spot ( _Monthly_

_Notices_, R. A. S., vol. lix., pl. x.).


_Jupiter._ Galileos discovery of Jupiters satellites was followed by the discovery of his belts. Zucchi and
Torricelli seem to have seen them. Fontana, in 1633, reported three belts. In 1648 Grimaldi saw but two, and
noticed that they lay parallel to the ecliptic. Dusky spots were also noticed as transient. Hooke [[5]] measured the
motion of one in 1664. In 1665 Cassini, with a fine telescope, 35-feet focal length, observed many spots
moving from east to west, whence he concluded that Jupiter rotates on an axis like the earth. He watched an
unusually permanent spot during twenty-nine rotations, and fixed the period at 9h. 56m. Later he inferred that
spots near the equator rotate quicker than those in higher latitudes (the same as Carrington found for the sun);
and W. Herschel confirmed this in 1778-9.

Jupiters rapid rotation ought, according to Newtons theory, to be accompanied by a great flattening at the
poles. Cassini had noted an oval form in 1691. This was confirmed by La Hire, Rmer, and Picard. Pound
measured the ellipticity = 1/(13.25).


W. Herschel supposed the spots to be masses of cloud in the atmospherean opinion still accepted. Many
of them were very permanent. Cassinis great spot vanished and reappeared nine times between 1665 and
1713. It was close to the northern margin of the southern belt. Herschel supposed the belts to be the body of
the planet, and the lighter parts to be clouds confined to certain latitudes.

In 1665 Cassini observed transits of the four satellites, and also saw their shadows on the planet, and
worked out a lunar theory for Jupiter. Mathematical astronomers have taken great interest in the perturbations
of the satellites, because their relative periods introduce peculiar effects. Airy, in his delightful book,
_Gravitation_, has reduced these investigations to simple geometrical explanations.


In 1707 and 1713 Miraldi noticed that the fourth satellite varies much in brightness. W. Herschel found this
variation to depend upon its position in its orbit, and concluded that in the positions of feebleness it is always
presenting to us a portion of its surface, which does not well reflect the suns light; proving that it always
turns the same face to Jupiter, as is the case with our moon. This fact had also been established for Saturns
fifth satellite, and may be true for all satellites.


In 1826 Struve measured the diameters of the four satellites, and found them to be 2,429, 2,180, 3,561, and
3,046 miles.


In modern times much interest has been taken in watching a rival to Cassinis famous spot. The great red
spot was first observed by Niesten, Pritchett, and Tempel, in 1878, as a rosy cloud attached to a whitish zone
beneath the dark southern equatorial band, shaped like the new war balloons, 30,000 miles long and 7,000


miles across. The next year it was brick-red. A white spot beside it completed a rotation in less time by 5
minutes than the red spota difference of 260 miles an hour. Thus they came together again every six weeks,
but the motions did not continue uniform. The spot was feeble in 1882-4, brightened in 1886, and, after many
changes, is still visible.


Galileos great discovery of Jupiters four moons was the last word in this connection until September 9th,
1892, when Barnard, using the 36-inch refractor of the Lick Observatory, detected a tiny spot of light closely
following the planet. This proved to be a new satellite (fifth), nearer to the planet than any other, and
revolving round it in 11h. 57m. 23s. Between its rising and setting there must be an interval of 2 Jovian
days, and two or three full moons. The sixth and seventh satellites were found by the examination of
photographic plates at the Lick Observatory in 1905, since which time they have been continuously
photographed, and their orbits traced, at Greenwich. On examining these plates in 1908 Mr. Melotte detected
the eighth satellite, which seems to be revolving in a retrograde orbit three times as far from its planet as the
next one (seventh), in these two points agreeing with the outermost of Saturns satellites (Phoebe).

_Saturn._ This planet, with its marvellous ring, was perhaps the most wonderful object of those first
examined by Galileos telescope. He was followed by Dominique Cassini, who detected bands like Jupiters
belts. Herschel established the rotation of the planet in 1775-94. From observations during one hundred
rotations he found the period to be 10h. 16m. 0s., 44. Herschel also measured the ratio of the polar to the
equatoreal diameter as 10:11.


The ring was a complete puzzle to Galileo, most of all when the planet reached a position where the plane
of the ring was in line with the earth, and the ring disappeared (December 4th, 1612). It was not until 1656
that Huyghens, in his small pamphlet _De Saturni Luna Observatio Nova_, was able to suggest in a cypher the
ring form; and in 1659, in his Systema Saturnium, he gave his reasons and translated the cypher: The planet
is surrounded by a slender flat ring, everywhere distinct from its surface, and inclined to the ecliptic. This
theory explained all the phases of the ring which had puzzled others. This ring was then, and has remained
ever since, a unique structure. We in this age have got accustomed to it. But Huyghenss discovery was
received with amazement.


In 1675 Cassini found the ring to be double, the concentric rings being separated by a black banda fact
which was placed beyond dispute by Herschel, who also found that the thickness of the ring subtends an
angle less than 0".3. Shrter estimated its thickness at 500 miles.

Many speculations have been advanced to explain the origin and constitution of the ring. De Sejour said [[6]]
that it was thrown off from Saturns equator as a liquid ring, and afterwards solidified. He noticed that the
outside would have a greater velocity, and be less attracted to the planet, than the inner parts, and that
equilibrium would be impossible; so he supposed it to have solidified into a number of concentric rings, the
exterior ones having the least velocity.


Clerk Maxwell, in the Adams prize essay, gave a physico-mathematical demonstration that the rings must
be composed of meteoritic matter like gravel. Even so, there must be collisions absorbing the energy of
rotation, and tending to make the rings eventually fall into the planet. The slower motion of the external parts
has been proved by the spectroscope in Keelers hands, 1895.


Saturn has perhaps received more than its share of attention owing to these rings. This led to other
discoveries. Huyghens in 1655, and J. D. Cassini in 1671, discovered the sixth and eighth satellites (Titan and
Japetus). Cassini lost his satellite, and in searching for it found Rhea (the fifth) in 1672, besides his old
friend, whom he lost again. He added the third and fourth in 1684 (Tethys and Dione). The first and second
(Mimas and Encelades) were added by Herschel in 1789, and the seventh (Hyperion) simultaneously by
Lassel and Bond in 1848. The ninth (Phoebe) was found on photographs, by Pickering in 1898, with
retrograde motion; and he has lately added a tenth.


The occasional disappearance of Cassinis Japetus was found on investigation to be due to the same causes
as that of Jupiters fourth satellite, and proves that it always turns the same face to the planet.


_Uranus and Neptune_ .The splendid discoveries of Uranus and two satellites by Sir William Herschel in
1787, and of Neptune by Adams and Le Verrier in 1846, have been already described. Lassel added two more
satellites to Uranus in 1851, and found Neptunes satellite in 1846. All of the satellites of Uranus have
retrograde motion, and their orbits are inclined about 80 to the ecliptic.


The spectroscope has shown the existence of an absorbing atmosphere on Jupiter and Saturn, and there are
suspicions that they partake something of the character of the sun, and emit some light besides reflecting
solar light. On both planets some absorption lines seem to agree with the aqueous vapour lines of our own
atmosphere; while one, which is a strong band in the red common to both planets, seems to agree with a line
in the spectrum of some reddish stars.


Uranus and Neptune are difficult to observe spectroscopically, but appear to have peculiar spectra agreeing
together. Sometimes Uranus shows Frauenhofer lines, indicating reflected solar light. But generally these are
not seen, and six broad bands of absorption appear. One is the F. of hydrogen; another is the red-star line of
Jupiter and Saturn. Neptune is a very difficult object for the spectroscope.

Quite lately [[7]] P. Lowell has announced that V. M. Slipher, at Flagstaff Observatory, succeeded in 1907 in
rendering some plates sensitive far into the red. A reproduction is given of photographed spectra of the four
outermost planets, showing (1) a great number of new lines and bands; (2) intensification of hydrogen F. and
C. lines; (3) a steady increase of effects (1) and (2) as we pass from Jupiter and Saturn to Uranus, and a still
greater increase in Neptune.


_Asteroids_ .The discovery of these new planets has been described. At the beginning of the last century it
was an immense triumph to catch a new one. Since photography was called into the service by Wolf, they
have been caught every year in shoals. It is like the difference between sea fishing with the line and using a
steam trawler. In the 1908 almanacs nearly seven hundred asteroids are included. The computation of their
perturbations and ephemerides by Eulers and Lagranges method of variable elements became so laborious
that Encke devised a special process for these, which can be applied to many other disturbed orbits. [[8]]


When a photograph is taken of a region of the heavens including an asteroid, the stars are photographed as
points because the telescope is made to follow their motion; but the asteroids, by their proper motion, appear
as short lines.


The discovery of Eros and the photographic attack upon its path have been described in their relation to
finding the suns distance.

A group of four asteroids has lately been found, with a mean distance and period equal to that of Jupiter.
To three of these masculine names have been givenHector, Patroclus, Achilles; the other has not yet been
named.


**FOOTNOTES:**


[1] Langrenus (van Langren), F. Selenographia sive lumina austriae philippica; Bruxelles, 1645.


[2] _Astr. Nach._, 2,944.


[3] _Acad. des Sc._, Paris; _C.R._, lxxxiii., 1876.


[4] _Mem. Spettr. Ital._, xi., p. 28.


[5] _R. S. Phil. Trans_ ., No. 1.


[6] Grants _Hist. Ph. Ast_ ., p. 267.


[7] _Nature_, November 12th, 1908.


[8] _Ast. Nach_ ., Nos. 791, 792, 814, translated by G. B. Airy. _Naut. Alm_ ., Appendix, 1856.


## 14. COMETS AND METEORS.

Ever since Halley discovered that the comet of 1682 was a member of the solar system, these wonderful
objects have had a new interest for astronomers; and a comparison of orbits has often identified the return of
a comet, and led to the detection of an elliptic orbit where the difference from a parabola was imperceptible
in the small portion of the orbit visible to us. A remarkable case in point was the comet of 1556, of whose
identity with the comet of 1264 there could be little doubt. Hind wanted to compute the orbit more exactly
than Halley had done. He knew that observations had been made, but they were lost. Having expressed his
desire for a search, all the observations of Fabricius and of Heller, and also a map of the comets path among
the stars, were eventually unearthed in the most unlikely manner, after being lost nearly three hundred years.
Hind and others were certain that this comet would return between 1844 and 1848, but it never appeared.

When the spectroscope was first applied to finding the composition of the heavenly bodies, there was a
great desire to find out what comets are made of. The first opportunity came in 1864, when Donati observed
the spectrum of a comet, and saw three bright bands, thus proving that it was a gas and at least partly selfluminous. In 1868 Huggins compared the spectrum of Winneckes comet with that of a Geissler tube
containing olefiant gas, and found exact agreement. Nearly all comets have shown the same spectrum. [[1]] A
very few comets have given bright band spectra differing from the normal type. Also a certain kind of
continuous spectrum, as well as reflected solar light showing Frauenhofer lines, have been seen.


C OPY OF THE D RAWING M ADE BY P AUL F ABRICIUS .
To define the path of comet 1556. After being lost for 300 years,
this drawing was recovered by the prolonged efforts of Mr. Hind

and Professor Littrow in 1856.


When Wellss comet, in 1882, approached very close indeed to the sun, the spectrum changed to a monochromatic yellow colour, due to sodium.


For a full account of the wonders of the cometary world the reader is referred to books on descriptive
astronomy, or to monographs on comets. [[2]] Nor can the very uncertain speculations about the structure of
comets tails be given here. A new explanation has been proposed almost every time that a great discovery
has been made in the theory of light, heat, chemistry, or electricity.

Halleys comet remained the only one of which a prediction of the return had been confirmed, until the
orbit of the small, ill-defined comet found by Pons in 1819 was computed by Encke, and found to have a
period of 3 1/3 years. It was predicted to return in 1822, and was recognised by him as identical with many
previous comets. This comet, called after Encke, has showed in each of its returns an inexplicable reduction
of mean distance, which led to the assertion of a resisting medium in space until a better explanation could be
found. [[3]]


Since that date fourteen comets have been found with elliptic orbits, whose aphelion distances are all about
the same as Jupiters mean distance; and six have an aphelion distance about ten per cent, greater than
Neptunes mean distance. Other comets are similarly associated with the planets Saturn and Uranus.


The physical transformations of comets are among the most wonderful of unexplained phenomena in the
heavens. But, for physical astronomers, the greatest interest attaches to the reduction of radius vector of
Enckes comet, the splitting of Bielas comet into two comets in 1846, and the somewhat similar behaviour of
other comets. It must be noted, however, that comets have a sensible size, that all their parts cannot travel in
exactly the same orbit under the suns gravitation, and that their mass is not sufficient to retain the parts
together very forcibly; also that the inevitable collision of particles, or else fluid friction, is absorbing energy,
and so reducing the comets velocity.


In 1770 Lexell discovered a comet which, as was afterwards proved by investigations of Lexell, Burchardt,
and Laplace, had in 1767 been deflected by Jupiter out of an orbit in which it was invisible from the earth
into an orbit with a period of 5 years, enabling it to be seen. In 1779 it again approached Jupiter closer than
some of his satellites, and was sent off in another orbit, never to be again recognised.


But our interest in cometary orbits has been added to by the discovery that, owing to the causes just cited, a
comet, if it does not separate into discrete parts like Bielas, must in time have its parts spread out so as to
cover a sensible part of the orbit, and that, when the earth passes through such part of a comets orbit, a
meteor shower is the result.


A magnificent meteor shower was seen in America on November 12th-13th, 1833, when the paths of the
meteors all seemed to radiate from a point in the constellation Leo. A similar display had been witnessed in
Mexico by Humboldt and Bonpland on November 12th, 1799. H. A. Newton traced such records back to
October 13th, A.D. 902. The orbital motion of a cloud or stream of small particles was indicated. The period
favoured by H. A. Newton was 354 days; another suggestion was 375 days, and another 33 years. He
noticed that the advance of the date of the shower between 902 and 1833, at the rate of one day in seventy
years, meant a progression of the node of the orbit. Adams undertook to calculate what the amount would be
on all the five suppositions that had been made about the period. After a laborious work, he found that none
gave one day in seventy years except the 33-year period, which did so exactly. H. A. Newton predicted a
return of the shower on the night of November 13th-14th, 1866. He is now dead; but many of us are alive to
recall the wonder and enthusiasm with which we saw this prediction being fulfilled by the grandest display of
meteors ever seen by anyone now alive.


The _progression_ of the nodes proved the path of the meteor stream to be retrograde. The _radiant_ had
almost the exact longitude of the point towards which the earth was moving. This proved that the meteor
cluster was at perihelion. The period being known, the eccentricity of the orbit was obtainable, also the
orbital velocity of the meteors in perihelion; and, by comparing this with the earths velocity, the latitude of
the radiant enabled the inclination to be determined, while the longitude of the earth that night was the
longitude of the node. In such a way Schiaparelli was able to find first the elements of the orbit of the August
meteor shower (Perseids), and to show its identity with the orbit of Tuttles comet 1862.iii. Then, in January
1867, Le Verrier gave the elements of the November meteor shower (Leonids); and Peters, of Altona,
identified these with Oppolzers elements for Tempels comet 1866Schiaparelli having independently
attained both of these results. Subsequently Weiss, of Vienna, identified the meteor shower of April 20th
(Lyrids) with comet 1861. Finally, that indefatigable worker on meteors, A. S. Herschel, added to the number,
and in 1878 gave a list of seventy-six coincidences between cometary and meteoric orbits.


Cometary astronomy is now largely indebted to photography, not merely for accurate delineations of
shape, but actually for the discovery of most of them. The art has also been applied to the observation of


comets at distances from their perihelia so great as to prevent their visual observation. Thus has Wolf, of
Heidelburg, found upon old plates the position of comet 1905.v., as a star of the 15.5 magnitude, 783 days
before the date of its discovery. From the point of view of the importance of finding out the divergence of a
cometary orbit from a parabola, its period, and its aphelion distance, this increase of range attains the very
highest value.


The present Astronomer Royal, appreciating this possibility, has been searching by photography for
Halleys comet since November, 1907, although its perihelion passage will not take place until April, 1910.


**FOOTNOTES:**


[1] In 1874, when the writer was crossing the Pacific Ocean in H.M.S. Scout, Coggias comet unexpectedly
appeared, and (while Colonel Tupman got its positions with the sextant) he tried to use the prism out of a
portable direct-vision spectroscope, without success until it was put in front of the object-glass of a binocular,
when, to his great joy, the three band images were clearly seen.


[2] Such as _The World of Comets_, by A. Guillemin; _History of Comets_, by G. R. Hind, London, 1859;
_Theatrum Cometicum_, by S. de Lubienietz, 1667; _Cometographie_, by Pingr, Paris, 1783; _Donatis Comet_, by
Bond.


[3] The investigations by Von Asten (of St. Petersburg) seem to support, and later ones, especially those by
Backlund (also of St. Petersburg), seem to discredit, the idea of a resisting medium.


## 15. THE FIXED STARS AND NEBUL.

Passing now from our solar system, which appears to be subject to the action of the same forces as those
we experience on our globe, there remains an innumerable host of fixed stars, nebulas, and nebulous clusters
of stars. To these the attention of astronomers has been more earnestly directed since telescopes have been so
much enlarged. Photography also has enabled a vast amount of work to be covered in a comparatively short
period, and the spectroscope has given them the means, not only of studying the chemistry of the heavens,
but also of detecting any motion in the line of sight from less than a mile a second and upwards in any star,
however distant, provided it be bright enough.


S IR W ILLIAM H ERSCHEL, F.R.S.1738-1822.
Painted by Lemuel F. Abbott; National Portrait

Gallery, Room XX.


In the field of telescopic discovery beyond our solar system there is no one who has enlarged our
knowledge so much as Sir William Herschel, to whom we owe the greatest discovery in dynamical
astronomy among the starsviz., that the law of gravitation extends to the most distant stars, and that many
of them describe elliptic orbits about each other. W. Herschel was born at Hanover in 1738, came to England
in 1758 as a trained musician, and died in 1822. He studied science when he could, and hired a telescope,
until he learnt to make his own specula and telescopes. He made 430 parabolic specula in twenty-one years.
He discovered 2,500 nebul and 806 double stars, counted the stars in 3,400 guage-fields, and compared the
principal stars photometrically.


Some of the things for which he is best known were results of those accidents that happen only to the
indefatigable enthusiast. Such was the discovery of Uranus, which led to funds being provided for
constructing his 40-feet telescope, after which, in 1786, he settled at Slough. In the same way, while trying to
detect the annual parallax of the stars, he failed in that quest, but discovered binary systems of stars revolving
in ellipses round each other; just as Bradleys attack on stellar parallax failed, but led to the discovery of
aberration, nutation, and the true velocity of light.


_Parallax_ .The absence of stellar parallax was the great objection to any theory of the earths motion prior
to Keplers time. It is true that Keplers theory itself could have been geometrically expressed equally well
with the earth or any other point fixed. But in Keplers case the obviously implied physical theory of the
planetary motions, even before Newton explained the simplicity of conception involved, made astronomers
quite ready to waive the claim for a rigid proof of the earths motion by measurement of an annual parallax of
stars, which they had insisted on in respect of Copernicuss revival of the idea of the earths orbital motion.

Still, the desire to measure this parallax was only intensified by the practical certainty of its existence, and
by repeated failures. The attempts of Bradley failed. The attempts of Piazzi and Brinkley, [[1]] early in the
nineteenth century, also failed. The first successes, afterwards confirmed, were by Bessel and Henderson.
Both used stars whose proper motion had been found to be large, as this argued proximity. Henderson, at the
Cape of Good Hope, observed  Centauri, whose annual proper motion he found to amount to 3".6, in 18323; and a few years later deduced its parallax 1".16. His successor at the Cape, Maclear, reduced this to 0".92.


In 1835 Struve assigned a doubtful parallax of 0".261 to Vega ( Lyr). But Bessels observations,
between 1837 and 1840, of 61 Cygni, a star with the large proper motion of over 5, established its annual
parallax to be 0".3483; and this was confirmed by Peters, who found the value 0".349.

Later determinations for  2 Centauri, by Gill, [[2]] make its parallax 0".75This is the nearest known fixed
star; and its light takes 4 1/3 years to reach us. The lightyear is taken as the unit of measurement in the starry
heavens, as the earths mean distance is the astronomical unit for the solar system. [[3]] The proper motions
and parallaxes combined tell us the velocity of the motion of these stars across the line of sight:  Centauri
14.4 miles a second=4.2 astronomical units a year; 61 Cygni 37.9 miles a second=11.2 astronomical units a
year. These successes led to renewed zeal, and now the distances of many stars are known more or less
accurately.


Several of the brightest stars, which might be expected to be the nearest, have not shown a parallax
amounting to a twentieth of a second of arc. Among these are Canopus,  Orionis,  Cygni,  Centauri, and 
Cassiopeia. Oudemans has published a list of parallaxes observed. [[4]]

_Proper Motion._ In 1718 Halley [[5]] detected the proper motions of Arcturus and Sirius. In 1738 J.
Cassinis [[6]] showed that the former had moved five minutes of arc since Tycho Brahe fixed its position. In
1792 Piazzi noted the motion of 61 Cygni as given above. For a long time the greatest observed proper
motion was that of a small star 1830 Groombridge, nearly 7 a year; but others have since been found
reaching as much as 10.


Now the spectroscope enables the motion of stars to be detected at a single observation, but only that part
of the motion that is in the line of sight. For a complete knowledge of a stars motion the proper motion and
parallax must also be known.

When Huggins first applied the Doppler principle to measure velocities in the line of sight, [[7]] the faintness
of star spectra diminished the accuracy; but Vgel, in 1888, overcame this to a great extent by long exposures
of photographic plates.


It has often been noticed that stars which seem to belong to a group of nearly uniform magnitude have the
same proper motion. The spectroscope has shown that these have also often the same velocity in the line of
sight. Thus in the Great Bear, , , , , , all agree as to angular proper motion.  was too faint for a
spectroscopic measurement, but all the others have been shown to be approaching us at a rate of twelve to
twenty miles a second. The same has been proved for proper motion, and line of sight motion, in the case of
Pleiades and other groups.

Maskelyne measured many proper motions of stars, from which W. Herschel [[8]] came to the conclusion that
these apparent motions are for the most part due to a motion of the solar system in space towards a point in
the constellation Hercules, R.A. 257; N. Decl. 25. This grand discovery has been amply confirmed, and,
though opinions differ as to the exact direction, it happens that the point first indicated by Herschel, from
totally insufficient data, agrees well with modern estimates.

Comparing the proper motions and parallaxes to get the actual velocity of each star relative to our system,
C.L. Struve found the probable velocity of the solar system in space to be fifteen miles a second, or five
astronomical units a year.


The work of Herschel in this matter has been checked by comparing spectroscopic velocities in the line of
sight which, so far as the suns motion is concerned, would give a maximum rate of approach for stars near
Hercules, a maximum rate of recession for stars in the opposite part of the heavens, and no effect for stars
half-way between. In this way the spectroscope has confirmed generally Herschels view of the direction, and
makes the velocity eleven miles a second, or nearly four astronomical units a year.


The average proper motion of a first magnitude star has been found to be 0".25 annually, and of a sixth
magnitude star 0".04. But that all bright stars are nearer than all small stars, or that they show greater proper
motion for that reason, is found to be far from the truth. Many statistical studies have been made in this
connection, and interesting results may be expected from this treatment in the hands of Kapteyn of
Groningen, and others. [[9]]

On analysis of the directions of proper motions of stars in all parts of the heavens, Kapteyn has shown [[10]]
that these indicate, besides the solar motion towards Hercules, two general drifts of stars in nearly opposite
directions, which can be detected in any part of the heavens. This result has been confirmed from
independent data by Eddington ( _R.A.S., M.N._ ) and Dyson ( _R.S.E. Proc._ ).


Photography promises to assist in the measurement of parallax and proper motions. Herr Pulfrich, of the
firm of Carl Zeiss, has vastly extended the applications of stereoscopic vision to astronomya subject which
De la Rue took up in the early days of photography. He has made a stereo-comparator of great beauty and
convenience for comparing stereoscopically two star photographs taken at different dates. Wolf of Heidelberg
has used this for many purposes. His investigations depending on the solar motion in space are remarkable.
He photographs stars in a direction at right angles to the line of the suns motion. He has taken photographs
of the same region fourteen years apart, the two positions of his camera being at the two ends of a base-line
over 5,000,000,000 miles apart, or fifty-six astronomical units. On examining these stereoscopically, some of
the stars rise out of the general plane of the stars, and seem to be much nearer. Many of the stars are thus seen
to be suspended in space at different distances corresponding exactly to their real distances from our solar
system, except when their proper motion interferes. The effect is most striking; the accuracy of measurement
exceeds that of any other method of measuring such displacements, and it seems that with a long interval of
time the advantage of the method increases.


_Double Stars._ The large class of double stars has always been much studied by amateurs, partly for their
beauty and colour, and partly as a test for telescopic definition. Among the many unexplained stellar
problems there is one noticed in double stars that is thought by some to be likely to throw light on stellar
evolution. It is this: There are many instances where one star of the pair is comparatively faint, and the two
stars are contrasted in colour; and in every single case the general colour of the faint companion is invariably
to be classed with colours more near to the blue end of the spectrum than that of the principal star.


_Binary Stars._ Sir William Herschel began his observations of double stars in the hope of discovering an
annual parallax of the stars. In this he was following a suggestion of Galileos. The presumption is that, if
there be no physical connection between the stars of a pair, the largest is the nearest, and has the greatest
parallax. So, by noting the distance between the pair at different times of the year, a delicate test of parallax is
provided, unaffected by major instrumental errors.


Herschel did, indeed, discover changes of distance, but not of the character to indicate parallax. Following
this by further observation, he found that the motions were not uniform nor rectilinear, and by a clear analysis
of the movements he established the remarkable and wholly unexpected fact that in all these cases the motion
is due to a revolution about their common centre of gravity. [[11]] He gave the approximate period of revolution
of some of these: Castor, 342 years;  Serpentis, 375 years;  Leonis, 1,200 years;  Bootis, 1,681 years.

Twenty years later Sir John Herschel and Sir James South, after re-examination of these stars, confirmed [[12]]
and extended the results, one pair of Coron having in the interval completed more than a whole revolution.


It is, then, to Sir William Herschel that we owe the extension of the law of gravitation, beyond the limits of
the solar system, to the whole universe. His observations were confirmed by F.G.W. Struve (born 1793, died
1864), who carried on the work at Dorpat. But it was first to Savary, [[13]] and later to Encke and Sir John
Herschel, that we owe the computation of the elliptic elements of these stars; also the resulting identification
of their law of force with Newtons force of gravitation applied to the solar system, and the force that makes
an apple fall to the ground. As Grant well says in his _History_ : This may be justly asserted to be one of the
most sublime truths which astronomical science has hitherto disclosed to the researches of the human mind.


Latterly the best work on double stars has been done by S. W. Burnham, [[14]] at the Lick Observatory. The
shortest period he found was eleven years ( Pegasi). In the case of some of these binaries the parallax has
been measured, from which it appears that in four of the surest cases the orbits are about the size of the orbit
of Uranus, these being probably among the smallest stellar orbits.


The law of gravitation having been proved to extend to the stars, a discovery (like that of Neptune in its
origin, though unlike it in the labour and originality involved in the calculation) that entrances the
imagination became possible, and was realised by Besselthe discovery of an unknown body by its
gravitational disturbance on one that was visible. In 1834 and 1840 he began to suspect a want of uniformity
in the proper motion of Sirius and Procyon respectively. In 1844, in a letter to Sir John Herschel, [[15]] he


attributed these irregularities in each case to the attraction of an invisible companion, the period of revolution
of Sirius being about half a century. Later he said: I adhere to the conviction that Procyon and Sirius form
real binary systems, consisting of a visible and an invisible star. There is no reason to suppose luminosity an
essential quality of cosmical bodies. The visibility of countless stars is no argument against the invisibility of
countless others. This grand conception led Peters to compute more accurately the orbit, and to assign the
place of the invisible companion of Sirius. In 1862 Alvan G. Clark was testing a new 18-inch object-glass
(now at Chicago) upon Sirius, and, knowing nothing of these predictions, actually found the companion in
the very place assigned to it. In 1896 the companion of Procyon was discovered by Professor Schaeberle at
the Lick Observatory.

Now, by the refined parallax determinations of Gill at the Cape, we know that of Sirius to be 0".38. From
this it has been calculated that the mass of Sirius equals two of our suns, and its intrinsic brightness equals
twenty suns; but the companion, having a mass equal to our sun, has only a five-hundredth part of the suns
brightness.


_Spectroscopic Binaries_ .On measuring the velocity of a star in the line of sight at frequent intervals,
periodic variations have been found, leading to a belief in motion round an invisible companion. Vogel, in
1889, discovered this in the case of Spica ( Virginis), whose period is 4d. 0h. 19m., and the diameter of
whose orbit is six million miles. Great numbers of binaries of this type have since then been discovered, all
of short period.

Also, in 1889, Pickering found that at regular intervals of fifty-two days the lines in the spectrum of  of
the Great Bear are duplicated, indicating a relative velocity, equal to one hundred miles a second, of two
components revolving round each other, of which that apparently single star must be composed.


It would be interesting, no doubt, to follow in detail the accumulating knowledge about the distances,
proper motions, and orbits of the stars; but this must be done elsewhere. Enough has been said to show how
results are accumulating which must in time unfold to us the various stellar systems and their mutual
relationships.


_Variable Stars._ It has often happened in the history of different branches of physical science that
observation and experiment were so far ahead of theory that hopeless confusion appeared to reign; and then
one chance result has given a clue, and from that time all differences and difficulties in the previous
researches have stood forth as natural consequences, explaining one another in a rational sequence. So we
find parallax, proper motion, double stars, binary systems, variable stars, and new stars all bound together.

The logical and necessary explanation given of the cause of ordinary spectroscopic binaries, and of
irregular proper motions of Sirius and Procyon, leads to the inference that if ever the plane of such a binary
orbit were edge-on to us there ought to be an eclipse of the luminous partner whenever the non-luminous one
is interposed between us. This should give rise either to intermittence in the stars light or else to variability.
It was by supposing the existence of a dark companion to Algol that its discoverer, Goodricke of York, [[16]] in
1783, explained variable stars of this type. Algol ( Persei) completes the period of variable brightness in
68.8 hours. It loses three-fifths of its light, and regains it in twelve hours. In 1889 Vogel, [[17]] with the Potsdam
spectrograph, actually found that the luminous star is receding before each eclipse, and approaching us after
each eclipse; thus entirely supporting Goodrickes opinion. There are many variables of the Algol type, and
information is steadily accumulating. But all variable stars do not suffer the sudden variations of Algol. There
are many types, and the explanations of others have not proved so easy.


The Harvard College photographs have disclosed the very great prevalence of variability, and this is
certainly one of the lines in which modern discovery must progress.


Roberts, in South Africa, has done splendid work on the periods of variables of the Algol type.

_New Stars_ .Extreme instances of variable stars are the new stars such as those detected by Hipparchus,
Tycho Brahe, and Kepler, of which many have been found in the last half-century. One of the latest great
Nov was discovered in Auriga by a Scotsman, Dr. Anderson, on February 1st, 1892, and, with the
modesty of his race, he communicated the fact to His Majestys Astronomer for Scotland on an unsigned
post-card. [[18]] Its spectrum was observed and photographed by Huggins and many others. It was full of bright
lines of hydrogen, calcium, helium, and others not identified. The astounding fact was that lines were shown
in pairs, bright and dark, on a faint continuous spectrum, indicating apparently that a dark body approaching
us at the rate of 550 miles a second [[19]] was traversing a cold nebulous atmosphere, and was heated to
incandescence by friction, like a meteor in our atmosphere, leaving a luminous train behind it. It almost
disappeared, and on April 26th it was of the sixteenth magnitude; but on August 17th it brightened to the
tenth, showing the principal nebular band in its spectrum, and no sign of approach or recession. It was as if it


emerged from one part of the nebula, cooled down, and rushed through another part of the nebula, rendering
the nebular gas more luminous than itself. [[20]]


Since 1892 one Nova after another has shown a spectrum as described above, like a meteor rushing
towards us and leaving a train behind, for this seems to be the obvious meaning of the spectra.


The same may be said of the brilliant Nova Persei, brighter at its best than Capella, and discovered also by
Dr. Anderson on February 22nd, 1901. It increased in brightness as it reached the densest part of the nebula,
then it varied for some weeks by a couple of magnitudes, up and down, as if passing through separate nebular
condensations. In February, 1902, it could still be seen with an opera-glass. As with the other Nov, when it
first dashed into the nebula it was vaporised and gave a continuous spectrum with dark lines of hydrogen and
helium. It showed no bright lines paired with the dark ones to indicate a train left behind; but in the end its
own luminosity died out, and the nebular spectrum predominated.


The nebular illumination as seen in photographs, taken from August to November, seemed to spread out
slowly in a gradually increasing circle at the rate of 90 in forty-eight days. Kapteyn put this down to the
velocity of light, the original outburst sending its illumination to the nebulous gas and illuminating a
spherical shell whose radius increased at the velocity of light. This supposition seems correct, in which case
it can easily be shown from the above figures that the distance of this Nova was 300 light years.

_Star Catalogues._ Since the days of very accurate observations numerous star-catalogues have been
produced by individuals or by observatories. Bradleys monumental work may be said to head the list.
Lacailles, in the Southern hemisphere, was complementary. Then Piazzi, Lalande, Groombridge, and Bessel
were followed by Argelander with his 324,000 stars, Rumkers Paramatta catalogue of the southern
hemisphere, and the frequent catalogues of national observatories. Later the Astronomische Gesellschaft
started their great catalogue, the combined work of many observatories. Other southern ones were Goulds at
Cordova and Stones at the Cape.


After this we have a new departure. Gill at the Cape, having the comet 1882.ii. all to himself in those
latitudes, wished his friends in Europe to see it, and employed a local photographer to strap his camera to the
observatory equatoreal, driven by clockwork, and adjusted on the comet by the eye. The result with half-anhours exposure was good, so he tried three hours. The result was such a display of sharp star images that he
resolved on the Cape Photographic Durchmusterung, which after fourteen years, with Kapteyns aid in
reducing, was completed. Meanwhile the brothers Henry, of Paris, were engaged in going over Chacornacs
zodiacal stars, and were about to catalogue the Milky Way portion, a serious labour, when they saw Gills
Comet photograph and conceived the idea of doing the rest of their work by photography. Gill had previously
written to Admiral Mouchez, of the Paris Observatory, and explained to him his project for charting the
heavens photographically, by combining the work of many observatories. This led Admiral Mouchez to
support the brothers Henry in their scheme. [[21]] Gill, having got his own photographic work underway,
suggested an international astrographic chart, the materials for different zones to be supplied by observatories
of all nations, each equipped with similar photographic telescopes. At a conference in Paris, 1887, this was
decided on, the stars on the charts going down to the fourteenth magnitude, and the catalogues to the
eleventh.


G REAT C OMET, N OV . 14 TH, 1882. (Exposure 2hrs. 20m.)
By kind permission of Sir David Gill. From this photograph

originated all stellar chart-photography.


This monumental work is nearing completion. The labour involved was immense, and the highest skill was
required for devising instruments and methods to read off the star positions from the plates.


Then we have the Harvard College collection of photographic plates, always being automatically added to;
and their annex at Arequipa in Peru.


Such catalogues vary in their degree of accuracy; and fundamental catalogues of standard stars have been
compiled. These require extension, because the differential methods of the heliometer and the camera cannot
otherwise be made absolute.


The number of stars down to the fourteenth magnitude may be taken at about 30,000,000; and that of all
the stars visible in the greatest modern telescopes is probably about 100,000,000.


_Nebul and Star-clusters._ Our knowledge of nebul really dates from the time of W. Herschel. In his
great sweeps of the heavens with his giant telescopes he opened in this direction a new branch of astronomy.
At one time he held that all nebul might be clusters of innumerable minute stars at a great distance. Then he
recognised the different classes of nebul, and became convinced that there is a widely-diffused shining
fluid in space, though many so-called nebul could be resolved by large telescopes into stars. He considered
that the Milky Way is a great star cluster, whose form may be conjectured from numerous star-gaugings. He
supposed that the compact planetary nebul might show a stage of evolution from the diffuse nebul, and
that his classifications actually indicate various stages of development. Such speculations, like those of the
ancients about the solar system, are apt to be harmful to true progress of knowledge unless in the hands of the
ablest mathematical physicists; and Herschel violated their principles in other directions. But here his
speculations have attracted a great deal of attention, and, with modifications, are accepted, at least as a
working hypothesis, by a fair number of people.


When Sir John Herschel had extended his fathers researches into the Southern Hemisphere he was also
led to the belief that some nebulae were a phosphorescent material spread through space like fog or mist.


Then his views were changed by the revelations due to the great discoveries of Lord Rosse with his
gigantic refractor, [[22]] when one nebula after another was resolved into a cluster of minute stars. At that time
the opinion gained ground that with increase of telescopic power this would prove to be the case with all
nebul.


In 1864 all doubt was dispelled by Huggins [[23]] in his first examination of the spectrum of a nebula, and the
subsequent extension of this observation to other nebul; thus providing a certain test which increase in the
size of telescopes could never have given. In 1864 Huggins found that all true nebulae give a spectrum of
bright lines. Three are due to hydrogen; two (discovered by Copeland) are helium lines; others are unknown.
Fifty-five lines have been photographed in the spectrum of the Orion nebula. It seems to be pretty certain that
all true nebulae are gaseous, and show almost exactly the same spectrum.


Other nebul, and especially the white ones like that in Andromeda, which have not yet been resolved into
stars, show a continuous spectrum; others are greenish and give no lines.


A great deal has to be done by the chemist before the astronomer can be on sure ground in drawing
conclusions from certain portions of his spectroscopic evidence.

The light of the nebulas is remarkably actinic, so that photography has a specially fine field in revealing
details imperceptible in the telescope. In 1885 the brothers Henry photographed, round the star Maia in the
Pleiades, a spiral nebula 3 long, as bright on the plate as that star itself, but quite invisible in the telescope;
and an exposure of four hours revealed other new nebula in the same district. That painstaking and most
careful observer, Barnard, with 10 hours exposure, extended this nebulosity for several degrees, and
discovered to the north of the Pleiades a huge diffuse nebulosity, in a region almost destitute of stars. By
establishing a 10-inch instrument at an altitude of 6,000 feet, Barnard has revealed the wide distribution of
nebular matter in the constellation Scorpio over a space of 4 or 5 square. Barnard asserts that the nebular
hypothesis would have been killed at its birth by a knowledge of these photographs. Later he has used still
more powerful instruments, and extended his discoveries.


The association of stars with planetary nebul, and the distribution of nebul in the heavens, especially in
relation to the Milky Way, are striking facts, which will certainly bear fruit when the time arrives for
discarding vague speculations, and learning to read the true physical structure and history of the starry
universe.


_Stellar Spectra._ When the spectroscope was first available for stellar research, the leaders in this branch
of astronomy were Huggins and Father Secchi, [[24]] of Rome. The former began by devoting years of work
principally to the most accurate study of a few stars. The latter devoted the years from 1863 to 1867 to a
general survey of the whole heavens, including 4,000 stars. He divided these into four principal classes,
which have been of the greatest service. Half of his stars belonged to the first class, including Sirius, Vega,
Regulus, Altair. The characteristic feature of their spectra is the strength and breadth of the hydrogen lines
and the extreme faintness of the metallic lines. This class of star is white to the eye, and rich in ultra violet
light.


The second class includes about three-eighths of his stars, including Capella, Pollux, and Arcturus. These
stars give a spectrum like that of our sun, and appear yellowish to the eye.


The third class includes  Herculis,  Orionis (Betelgeux), Mira Ceti, and about 500 red and variable stars.
The spectrum has fluted bands shaded from blue to red, and sharply defined at the more refrangible edge.

The fourth class is a small one, containing no stars over fifth magnitude, of which 152 Schjellerup, in
Canes Venatici, is a good example. This spectrum also has bands, but these are shaded on the violet side and
sharp on the red side. They are due to carbon in some form. These stars are ruby red in the telescope.


It would appear, then, that all stars are suns with continuous spectra, and the classes are differentiated by
the character of the absorbent vapours of their atmospheres.


It is very likely that, after the chemists have taught us how to interpret all the varieties of spectrum, it will
be possible to ascribe the different spectrum-classes to different stages in the life-history of every star.
Already there are plenty of people ready to lay down arbitrary assumptions about the lessons to be drawn
from stellar spectra. Some say that they know with certainty that each star begins by being a nebula, and is
condensed and heated by condensation until it begins to shine as a star; that it attains a climax of temperature,
then cools down, and eventually becomes extinct. They go so far as to declare that they know what class of
spectrum belongs to each stage of a stars life, and how to distinguish between one that is increasing and
another that is decreasing in temperature.


The more cautious astronomers believe that chemistry is not sufficiently advanced to justify all of these
deductions; that, until chemists have settled the lately raised question of the transmutation of elements, no
theory can be sure. It is also held that until they have explained, without room for doubt, the reasons for the
presence of some lines, and the absence of others, of any element in a stellar spectrum; why the arc-spectrum
of each element differs from its spark spectrum; what are all the various changes produced in the spectrum of
a gas by all possible concomitant variations of pressure and temperature; also the meanings of all the flutings
in the spectra of metalloids and compounds; and other equally pertinent mattersuntil that time arrives the
part to be played by the astronomer is one of observation. By all means, they say, make use of working
hypotheses to add an interest to years of laborious research, and to serve as a guide to the direction of
further labours; but be sure not to fall into the error of calling any mere hypothesis a theory.

_Nebular Hypothesis._ The Nebular Hypothesis, which was first, as it were, tentatively put forward by
Laplace as a note in his _Systme du Monde_, supposes the solar system to have been a flat, disk-shaped nebula
at a high temperature in rapid rotation. In cooling it condensed, leaving revolving rings at different distances
from the centre. These themselves were supposed to condense into the nucleus for a rotating planet, which
might, in contracting, again throw off rings to form satellites. The speculation can be put in a really attractive
form, but is in direct opposition to many of the actual facts; and so long as it is not favoured by those who
wish to maintain the position of astronomy as the most exact of the sciencesexact in its facts, exact in its
logicthis speculation must be recorded by the historian, only as he records the guesses of the ancient
Greeks--as an interesting phase in the history of human thought.


Other hypotheses, having the same end in view, are the meteoritic hypothesis of Lockyer and the
planetesimal hypothesis that has been largely developed in the United States. These can best be read in the
original papers to various journals, references to which may be found in the footnotes of Miss Clerkes
_History of Astronomy during the Nineteenth Century_ . The same can be said of Bredichins hypothesis of
comets tails, Arrheniuss book on the applications of the theory of light repulsion, the speculations on
radium, the origin of the suns heat and the age of the earth, the electron hypothesis of terrestrial magnetism,
and a host of similar speculations, all combining to throw an interesting light on the evolution of a modern
train of thought that seems to delight in conjecture, while rebelling against that strict mathematical logic
which has crowned astronomy as the queen of the sciences.


**FOOTNOTES:**


[1] _R. S. Phil Trans_ ., 1810 and 1817-24.


[2] One of the most valuable contributions to our knowledge of stellar parallaxes is the result of Gills work
( _Cape Results_, vol. iii., part ii., 1900).


[3] Taking the velocity of light at 186,000 miles a second, and the earths mean distance at 93,000,000 miles,
1 light-year=5,865,696,000,000 miles or 63,072 astronomical units; 1 astronomical unit a year=2.94 miles a
second; and the earths orbital velocity=18.5 miles a second.


[4] Ast. Nacht., 1889.


[5] R. S. Phil. Trans., 1718.


[6] Mem. Acad. des Sciences, 1738, p. 337.


[7] R. S Phil. Trans., 1868.


[8] _R.S. Phil Trans._, 1783.


[9] See Kapteyns address to the Royal Institution, 1908. Also Gills presidential address to the British
Association, 1907.


[10] _Brit. Assoc. Rep._, 1905.


[11] R. S. Phil. Trans., 1803, 1804.


[12] Ibid, 1824.


[13] Connaisance des Temps, 1830.


[14] _R. A. S. Mem._, vol. xlvii., p. 178; _Ast. Nach._, No. 3,142; Catalogue published by Lick Observatory, 1901.


[15] _R. A. S., M. N._, vol. vi.


[16] _R. S. Phil. Trans._, vol. lxxiii., p. 484.


[17] _Astr. Nach._, No. 2,947.


[18] _R. S. E. Trans_ ., vol. xxvii. In 1901 Dr. Anderson discovered Nova Persei.


[19] _Astr. Nach_ ., No. 3,079.


[20] For a different explanation see Sir W. Hugginss lecture, Royal Institution, May 13th, 1892.


[21] For the early history of the proposals for photographic cataloguing of stars, see the _Cape Photographic_
_Durchmusterung_, 3 vols. ( _Ann. of the Cape Observatory_, vols. in., iv., and v., Introduction.)


[22] _R. S. Phil. Trans._, 1850, p. 499 _et seq._


[23] _Ibid_, vol. cliv., p. 437.


[24] _Brit. Assoc. Rep._, 1868, p. 165.


## ILLUSTRATIONS

S IR I SAAC N EWTON
(From the bust by Roubiliac In Trinity College, Cambridge.)

C HALDAN B AKED B RICK OR T ABLET
Obverse and reverse sides, containing record of solar eclipse, 1062 B.C., used lately by Cowell for rendering
the lunar theory more accurate than was possible by finest modern observations. (British Museum collection,
No. 35908.)

Q UADRANS M URALIS SIVE T ICHONICUS .
With portrait of Tycho Brahe, instruments, etc., painted on the wall; showing assistants using the sight,
watching the clock, and recording. (From the authors copy of the _Astronomi Instaurat Mechanica_ .)

P ORTRAIT OF J OHANNES K EPLER .
By F. Wanderer, from Reitlingers Johannes Kepler (Original in Strassburg).

D EATH -M ASK OF S IR I SAAC N EWTON .
Photographed specially for this work from the original, by kind permission of the Royal Society, London.

A NCIENT C HINESE I NSTRUMENTS,
Including quadrant, celestial globe, and two armillae, in the Observatory at Peking. Photographed in Peking
by the author in 1875, and stolen by the Germans when the Embassies were relieved by the allies in 1900.

S OLAR S URFACE .
As Photographed at the Royal Observatory, Greenwich, showing sun spots with umbr, penumbr, and
facul.

S OLAR E CLIPSE, 1882.
From drawing by W. H. Wesley, Secretary R.A.S.; showing the prominences, the corona, and an unknown

comet.

J UPITER .
From a drawing by E. M. Antoniadi, showing transit of a satellites shadow, the belts, and the great red
spot ( _Monthly Notices_, R. A. S., vol. lix., pl. x.).

C OPY OF THE D RAWING M ADE BY P AUL F ABRICIUS .
To define the path of comet 1556. After being lost for 300 years, this drawing was recovered by the
prolonged efforts of Mr. Hind and Professor Littrow in 1856.

S IR W ILLIAM H ERSCHEL, F.R.S.1738-1822.
Painted by Lemuel F. Abbott; National Portrait Gallery, Room XX.

G REAT C OMET, N OV . 14 TH, 1882. (Exposure 2hrs. 20m.)
By kind permission of Sir David Gill. From this photograph originated all stellar chart-photography.


## INDEX

Abul Wefa, 24
Acceleration of moons mean motion, 60
Achromatic lens invented, 88
Adams, J. C., 61, 65, 68, 69, 70, 87, 118, 124
Airy, G. B., 13, 30, 37, 65, 69, 70, 80, 81, 114, 119
Albetegnius, 24
Alphonso, 24
Altazimuth, 81
Anaxagoras, 14, 16
Anaximander, 14
Anaximenes, 14
Anderson, T. D., 137, 138
ngstrom, A. J., 102
Antoniadi, 113
Apian, P., 63
Apollonius, 22, 23
Arago, 111
Argelander, F. W. A., 139
Aristarchus, 18, 29
Aristillus, 17, 19
Aristotle, 16, 30, 47
Arrhenius, 146
Arzachel, 24
Asshurbanapal, 12
Asteroids, discovery of, 67, 119
Astrology, ancient and modern, 1-7, 38


Backlund, 122
Bacon, R., 86
Bailly, 8, 65
Barnard, E. E., 115, 143
Beer and Mdler, 107, 110, 111
Behaim, 74
Bessel, F.W., 65, 79, 128, 134, 139
Biela, 123
Binet, 65
Biot, 10
Bird, 79, 80
Bliss, 80
Bode, 66, 69
Bond, G. P., 99, 117, 122
Bouvard, A., 65, 68
Bradley, J., 79, 80, 81, 87, 127, 128, 139
Bredechin, 146
Bremiker, 71
Brewster, D., 52, 91, 112
Brinkley, 128
Bruno, G., 49
Burchardt, 65, 123
Burnham, S. W., 134


Callippus, 15, 16, 31
Carrington, R. C., 97, 99, 114
Cassini, G. D., 107, 114, 115, 116, 117, 118
Cassini, J., 109, 129
Chacornac, 139
Chaldan astronomy, 11-13
Challis, J., 69, 70, 71, 72
Chance, 88
Charles, II., 50, 81
Chinese astronomy, 8-11
Christie, W. M. H. (Ast. Roy.), 64, 82, 125
Chueni, 9
Clairaut, A. C., 56, 63, 65
Clark, A. G., 89, 135
Clerke, Miss, 106, 146
Comets, 120
Common, A. A., 88
Cooke, 89
Copeland, R., 142
Copernicus, N., 14, 24-31, 37, 38, 41, 42, 49, 128
Cornu, 85
Cowell, P. H., 3, 5, 64, 83
Crawford, Earl of, 84
Cromellin, A. C., 5, 64


DAlembert, 65
Damoiseau, 65
DArrest, H. L., 34
Dawes, W. R., 100, 111
Delambre, J. B. J., 8, 27, 51, 65, 68
De la Rue, W., 2, 94, 99, 100, 131
Delaunay, 65
Democritus, 16
Descartes, 51
De Sejour, 117
Deslandres, II., 101
Desvignolles, 9
De Zach, 67
Digges, L., 86
Dollond, J., 87, 90
Dominis, A. di., 86
Donati, 120
Doppler, 92, 129
Draper, 99
Dreyer, J. L. E., 29,77
Dunthorne, 60
Dyson, 131


Eclipses, total solar, 103
Ecphantes, 16
Eddington, 131
Ellipse, 41
Empedocles, 16
Encke, J. F., 119, 122, 123, 133
Epicycles, 22
Eratosthenes, 18
Euclid, 17
Eudoxus, 15, 31


Euler, L., 60, 61, 62, 65, 88, 119


Fabricius, D.,95, 120, 121
Feil and Mantois, 88
Fizeau, H. L., 85, 92, 99
Flamsteed, J., 50, 58, 68, 78, 79, 93
Fohi, 8
Forbes, J. D., 52, 91
Foucault, L., 85, 99
Frauenhofer, J., 88, 90, 91


Galilei, G., 38, 46-49, 77, 93, 94, 95, 96, 107, 113, 115, 116, 133
Galle, 71, 72
Gascoigne, W., 45, 77
Gauss, C. F., 65, 67
Gauthier, 98
Gautier, 89
Gilbert, 44
Gill, D., 84, 85, 128, 135, 139, 140
Goodricke, J., 136
Gould, B. A., 139
Grant, R., 27, 47, 51, 86, 134
Graham, 79
Greek astronomy, 8-11
Gregory, J. and D., 87
Grimaldi, 113
Groombridge, S., 139
Grubb, 88, 89
Guillemin, 122
Guinand, 88


Hale, G. E., 101
Hall, A., 112
Hall, C. M., 88
Halley, E., 19, 51, 58, 60, 61, 62, 63, 64, 79, 120, 122, 125, 129
Halleys comet, 62-64
Halm, 85
Hansen, P. A., 3, 65
Hansky, A. P., 100
Harding, C. L., 67
Heliometer, 83
Heller, 120
Helmholtz, H. L. F., 35
Henderson, T., 128
Henry, P. and P., 139, 140, 143
Heraclides, 16
Heraclitus, 14
Herodotus, 13
Herschel, W., 65, 68, 97, 107, 110, 114, 115, 116, 117, 118, 126, 127,
130, 131, 132, 141, 142
Herschel, J., 97, 111, 133, 134, 142
Herschel, A. S., 125
Hevelius, J., 178
Hind, J. R., 5, 64, 120, 121, 122
Hipparchus, 3, 18, 19, 20, 22, 23, 24, 26, 36, 55, 60, 74, 93, 137
Hooke, R., 51, 111, 114
Horrocks, J., 50, 56
Howlett, 100


Huggins, W., 92, 93, 99, 106, 120, 129, 137, 138, 142, 144
Humboldt and Bonpland, 124
Huyghens, C., 47, 77, 87, 110, 116, 117


Ivory, 65


Jansen, P. J. C., 105, 106
Jansen, Z., 86


Kaiser, F., 111
Kapteyn, J. C., 131, 138, 139
Keeler, 117
Kepler, J., 17, 23, 26, 29, 30, 36, 37, 38-46, 48, 49, 50, 52, 53, 63,
66, 77, 87, 93, 127, 137
Keplers laws, 42
Kirchoff, G.R., 91
Kirsch, 9
Knobel, E.B., 12, 13
Ko-Show-King, 76


Lacaile, N.L., 139
Lagrange, J.L., 61, 62, 65, 119
La Hire, 114
Lalande, J.J.L., 60, 63, 65, 66, 72, 139
Lamont, J., 98
Langrenus, 107
Laplace, P.S. de, 50, 58, 61, 62, 65,66, 123, 146
Lassel, 72, 88, 117, 118
Law of universal gravitation, 53
Legendre, 65
Leonardo da Vinci, 46
Lewis, G.C., 17
Le Verrier, U.J.J., 65, 68, 70, 71,72, 110, 118, 125
Lexell, 66, 123
Light year, 128
Lipperhey, H., 86
Littrow, 121
Lockyer, J.N., 103, 105, 146
Logarithms invented, 50
Loewy, 2, 100
Long inequality of Jupiter and Saturn, 50, 62
Lowell, P., 111, 112, 118
Lubienietz, S. de, 122
Luther, M., 38
Lunar theory, 37, 50, 56, 64


Maclaurin, 65
Maclear, T., 128
Malvasia, 77
Martin, 9
Maxwell, J. Clerk, 117
Maskelyne, N., 80, 130
McLean, F., 89
Medici, Cosmo di, 48
Melancthon, 38
Melotte, 83, 116
Meteors, 123
Meton, 15


Meyer, 57, 65
Michaelson, 85
Miraldi, 110, 114
Molyneux, 87
Moon, physical observations, 107
Mouchez, 139
Moyriac de Mailla, 8


Napier, Lord, 50
Nasmyth and Carpenter, 108
Nebulae, 141, 146
Neison, E., 108
Neptune, discovery of, 68-72
Newall, 89
Newcomb, 85
Newton, H.A., 124
Newton, I., 5, 19, 43, 49, 51-60, 62, 64, 68, 77, 79, 87, 90, 93, 94,
114, 127, 133
Nicetas, 16, 25
Niesten, 115
Nunez, P., 35


Olbers, H.W.M., 67
Omar, 11, 24
Oppolzer, 13, 125
Oudemans, 129


Palitsch, G., 64
Parallax, solar, 85, 86
Parmenides, 14
Paul III., 30
Paul V., 48
Pemberton, 51
Peters, C.A.F., 125, 128, 135
Photography, 99
Piazzi, G., 67, 128, 129, 139
Picard, 54, 77, 114
Pickering, E.C., 118, 135
Pingr, 13, 122
Plana, 65
Planets and satellites, physical observations, 109-119
Plato, 17, 23, 26, 40
Poisson, 65
Pond, J., 80
Pons, 122
Porta, B., 86
Pound, 87, 114
Pontecoulant, 64
Precession of the equinoxes, 19-21, 55, 57
Proctor, R.A., 111
Pritchett, 115
Ptolemy, 11, 13, 21, 22, 23, 24, 93
Puiseux and Loewy, 108
Pulfrich, 131
Purbach, G., 24
Pythagoras, 14, 17, 25, 29


Ramsay, W., 106


Ransome and May, 81
Reflecting telescopes invented, 87
Regiomontanus (Mller), 24
Respighi, 82
Retrograde motion of planets, 22
Riccioli, 107
Roberts, 137
Rmer, O.,78, 114
Rosse, Earl of, 88, 142
Rowland, H. A., 92, 102
Rudolph H.,37, 39
Rumker, C., 139


Sabine, E., 98
Savary, 133
Schaeberle, J. M., 135
Schiaparelli, G. V., 110, 111, 124, 125
Scheiner, C., 87, 95, 96
Schmidt, 108
Schott, 88
Schrter, J. H., 107, 110, 111, 124, 125
Schuster, 98
Schwabe, G. H., 97
Secchi, A., 93, 144
Short, 87
Simms, J., 81
Slipher, V. M., 119
Socrates, 17
Solon, 15
Souciet, 8
South, J., 133
Spectroscope, 89-92
Spectroheliograph, 101
Spoerer, G. F. W., 98
Spots on the sun, 84;
periodicity of, 97
Stars, Parallax, 127;
proper motion, 129;
double, 132;
binaries, 132, 135;
new, 19, 36, 137;
catalogues of, 19, 36, 139;
spectra of, 143
Stewart, B., 2, 100
Stokes, G. G., 91
Stone, E. J., 139
Struve, C. L., 130
Struve, F. G. W,, 88, 115, 128, 133


Telescopes invented, 47, 86;
large, 88
Temple, 115, 125
Thales, 13, 16
Theon, 60
Transit circle of Rmer, 78
Timocharis, 17, 19
Titius, 66
Torricelli, 113


Troughton, E., 80
Tupman, G. L., 120
Tuttle, 125
Tycho Brahe, 23, 25, 30, 33-38, 39, 40, 44, 50, 75, 77, 93, 94, 129, 137


Ulugh Begh, 24
Uranus, discovery of, 65


Velocity of light, 86, 128;
of earth in orbit, 128
Verbiest, 75
Vogel, H. C., 92, 129, 135, 136
Von Asten, 122


Walmsley, 65
Walterus, B., 24, 74
Weiss, E., 125
Wells, 122
Wesley, 104
Whewell, 112
Williams, 10
Wilson, A., 96, 100
Winnecke, 120
Witte, 86
Wollaston, 90
Wolf, M., 119, 125, 132
Wolf, R., 98
Wren, C., 51
Wyllie, A., 77


Yao, 9
Young, C. A., 103
Yu-Chi, 8


Zenith telescopes, 79, 82
Zllner, 92
Zucchi, 113


*** END OF THE PROJECT GUTENBERG EBOOK HISTORY OF ASTRONOMY ***


Updated editions will replace the previous onethe old editions will be renamed.


Creating the works from print editions not protected by U.S. copyright law means that no one owns a
United States copyright in these works, so the Foundation (and you!) can copy and distribute it in the
United States without permission and without paying copyright royalties. Special rules, set forth in the
General Terms of Use part of this license, apply to copying and distributing Project Gutenberg
electronic works to protect the PROJECT GUTENBERG concept and trademark. Project Gutenberg
is a registered trademark, and may not be used if you charge for an eBook, except by following the
terms of the trademark license, including paying royalties for use of the Project Gutenberg trademark. If
you do not charge anything for copies of this eBook, complying with the trademark license is very easy.
You may use this eBook for nearly any purpose such as creation of derivative works, reports,
performances and research. Project Gutenberg eBooks may be modified and printed and given away
you may do practically ANYTHING in the United States with eBooks not protected by U.S. copyright
law. Redistribution is subject to the trademark license, especially commercial redistribution.


#### START: FULL LICENSE

### THE FULL PROJECT GUTENBERG LICENSE

PLEASE READ THIS BEFORE YOU DISTRIBUTE OR USE THIS WORK


To protect the Project Gutenberg mission of promoting the free distribution of electronic works, by
using or distributing this work (or any other work associated in any way with the phrase Project
Gutenberg), you agree to comply with all the terms of the Full Project Gutenberg License available
with this file or online at www.gutenberg.org/license.

#### **Section 1. General Terms of Use and Redistributing Project Gutenberg electronic** **works**


1.A. By reading or using any part of this Project Gutenberg electronic work, you indicate that you
have read, understand, agree to and accept all the terms of this license and intellectual property
(trademark/copyright) agreement. If you do not agree to abide by all the terms of this agreement, you
must cease using and return or destroy all copies of Project Gutenberg electronic works in your
possession. If you paid a fee for obtaining a copy of or access to a Project Gutenberg electronic work
and you do not agree to be bound by the terms of this agreement, you may obtain a refund from the
person or entity to whom you paid the fee as set forth in paragraph 1.E.8.


1.B. Project Gutenberg is a registered trademark. It may only be used on or associated in any way
with an electronic work by people who agree to be bound by the terms of this agreement. There are a
few things that you can do with most Project Gutenberg electronic works even without complying
with the full terms of this agreement. See paragraph 1.C below. There are a lot of things you can do with
Project Gutenberg electronic works if you follow the terms of this agreement and help preserve free
future access to Project Gutenberg electronic works. See paragraph 1.E below.


1.C. The Project Gutenberg Literary Archive Foundation (the Foundation or PGLAF), owns a
compilation copyright in the collection of Project Gutenberg electronic works. Nearly all the
individual works in the collection are in the public domain in the United States. If an individual work is
unprotected by copyright law in the United States and you are located in the United States, we do not
claim a right to prevent you from copying, distributing, performing, displaying or creating derivative
works based on the work as long as all references to Project Gutenberg are removed. Of course, we hope
that you will support the Project Gutenberg mission of promoting free access to electronic works by
freely sharing Project Gutenberg works in compliance with the terms of this agreement for keeping
the Project Gutenberg name associated with the work. You can easily comply with the terms of this
agreement by keeping this work in the same format with its attached full Project Gutenberg License
when you share it without charge with others.


1.D. The copyright laws of the place where you are located also govern what you can do with this work.
Copyright laws in most countries are in a constant state of change. If you are outside the United States,
check the laws of your country in addition to the terms of this agreement before downloading, copying,
displaying, performing, distributing or creating derivative works based on this work or any other Project
Gutenberg work. The Foundation makes no representations concerning the copyright status of any
work in any country other than the United States.


1.E. Unless you have removed all references to Project Gutenberg:


1.E.1. The following sentence, with active links to, or other immediate access to, the full Project
Gutenberg License must appear prominently whenever any copy of a Project Gutenberg work (any
work on which the phrase Project Gutenberg appears, or with which the phrase Project Gutenberg is
associated) is accessed, displayed, performed, viewed, copied or distributed:


This eBook is for the use of anyone anywhere in the United States and most other parts of
the world at no cost and with almost no restrictions whatsoever. You may copy it, give it
away or re-use it under the terms of the Project Gutenberg License included with this eBook
[or online at www.gutenberg.org. If you are not located in the United States, you will have to](https://www.gutenberg.org/)
check the laws of the country where you are located before using this eBook.


1.E.2. If an individual Project Gutenberg electronic work is derived from texts not protected by U.S.
copyright law (does not contain a notice indicating that it is posted with permission of the copyright
holder), the work can be copied and distributed to anyone in the United States without paying any fees
or charges. If you are redistributing or providing access to a work with the phrase Project Gutenberg
associated with or appearing on the work, you must comply either with the requirements of paragraphs
1.E.1 through 1.E.7 or obtain permission for the use of the work and the Project Gutenberg trademark
as set forth in paragraphs 1.E.8 or 1.E.9.


1.E.3. If an individual Project Gutenberg electronic work is posted with the permission of the
copyright holder, your use and distribution must comply with both paragraphs 1.E.1 through 1.E.7 and
any additional terms imposed by the copyright holder. Additional terms will be linked to the Project
Gutenberg License for all works posted with the permission of the copyright holder found at the
beginning of this work.


1.E.4. Do not unlink or detach or remove the full Project Gutenberg License terms from this work, or
any files containing a part of this work or any other work associated with Project Gutenberg.


1.E.5. Do not copy, display, perform, distribute or redistribute this electronic work, or any part of this
electronic work, without prominently displaying the sentence set forth in paragraph 1.E.1 with active
links or immediate access to the full terms of the Project Gutenberg License.


1.E.6. You may convert to and distribute this work in any binary, compressed, marked up,
nonproprietary or proprietary form, including any word processing or hypertext form. However, if you
provide access to or distribute copies of a Project Gutenberg work in a format other than Plain
Vanilla ASCII or other format used in the official version posted on the official Project Gutenberg
website (www.gutenberg.org), you must, at no additional cost, fee or expense to the user, provide a copy,
a means of exporting a copy, or a means of obtaining a copy upon request, of the work in its original
Plain Vanilla ASCII or other form. Any alternate format must include the full Project Gutenberg
License as specified in paragraph 1.E.1.


1.E.7. Do not charge a fee for access to, viewing, displaying, performing, copying or distributing any
Project Gutenberg works unless you comply with paragraph 1.E.8 or 1.E.9.


1.E.8. You may charge a reasonable fee for copies of or providing access to or distributing Project
Gutenberg electronic works provided that:


- You pay a royalty fee of 20% of the gross profits you derive from the use of Project Gutenberg

works calculated using the method you already use to calculate your applicable taxes. The fee is owed
to the owner of the Project Gutenberg trademark, but he has agreed to donate royalties under this
paragraph to the Project Gutenberg Literary Archive Foundation. Royalty payments must be paid
within 60 days following each date on which you prepare (or are legally required to prepare) your
periodic tax returns. Royalty payments should be clearly marked as such and sent to the Project
Gutenberg Literary Archive Foundation at the address specified in Section 4, Information about
donations to the Project Gutenberg Literary Archive Foundation.


- You provide a full refund of any money paid by a user who notifies you in writing (or by e-mail) within

30 days of receipt that s/he does not agree to the terms of the full Project Gutenberg License. You
must require such a user to return or destroy all copies of the works possessed in a physical medium
and discontinue all use of and all access to other copies of Project Gutenberg works.


- You provide, in accordance with paragraph 1.F.3, a full refund of any money paid for a work or a

replacement copy, if a defect in the electronic work is discovered and reported to you within 90 days of
receipt of the work.


- You comply with all other terms of this agreement for free distribution of Project Gutenberg works.


1.E.9. If you wish to charge a fee or distribute a Project Gutenberg electronic work or group of works
on different terms than are set forth in this agreement, you must obtain permission in writing from the


Project Gutenberg Literary Archive Foundation, the manager of the Project Gutenberg trademark.
Contact the Foundation as set forth in Section 3 below.


1.F.


1.F.1. Project Gutenberg volunteers and employees expend considerable effort to identify, do copyright
research on, transcribe and proofread works not protected by U.S. copyright law in creating the Project
Gutenberg collection. Despite these efforts, Project Gutenberg electronic works, and the medium on
which they may be stored, may contain Defects, such as, but not limited to, incomplete, inaccurate or
corrupt data, transcription errors, a copyright or other intellectual property infringement, a defective or
damaged disk or other medium, a computer virus, or computer codes that damage or cannot be read by
your equipment.


1.F.2. LIMITED WARRANTY, DISCLAIMER OF DAMAGES - Except for the Right of Replacement
or Refund described in paragraph 1.F.3, the Project Gutenberg Literary Archive Foundation, the owner
of the Project Gutenberg trademark, and any other party distributing a Project Gutenberg electronic
work under this agreement, disclaim all liability to you for damages, costs and expenses, including legal
fees. YOU AGREE THAT YOU HAVE NO REMEDIES FOR NEGLIGENCE, STRICT LIABILITY,
BREACH OF WARRANTY OR BREACH OF CONTRACT EXCEPT THOSE PROVIDED IN

PARAGRAPH 1.F.3. YOU AGREE THAT THE FOUNDATION, THE TRADEMARK OWNER, AND
ANY DISTRIBUTOR UNDER THIS AGREEMENT WILL NOT BE LIABLE TO YOU FOR

ACTUAL, DIRECT, INDIRECT, CONSEQUENTIAL, PUNITIVE OR INCIDENTAL DAMAGES
EVEN IF YOU GIVE NOTICE OF THE POSSIBILITY OF SUCH DAMAGE.


1.F.3. LIMITED RIGHT OF REPLACEMENT OR REFUND - If you discover a defect in this
electronic work within 90 days of receiving it, you can receive a refund of the money (if any) you paid
for it by sending a written explanation to the person you received the work from. If you received the
work on a physical medium, you must return the medium with your written explanation. The person or
entity that provided you with the defective work may elect to provide a replacement copy in lieu of a
refund. If you received the work electronically, the person or entity providing it to you may choose to
give you a second opportunity to receive the work electronically in lieu of a refund. If the second copy is
also defective, you may demand a refund in writing without further opportunities to fix the problem.


1.F.4. Except for the limited right of replacement or refund set forth in paragraph 1.F.3, this work is
provided to you AS-IS, WITH NO OTHER WARRANTIES OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO WARRANTIES OF MERCHANTABILITY OR
FITNESS FOR ANY PURPOSE.


1.F.5. Some states do not allow disclaimers of certain implied warranties or the exclusion or limitation
of certain types of damages. If any disclaimer or limitation set forth in this agreement violates the law of
the state applicable to this agreement, the agreement shall be interpreted to make the maximum
disclaimer or limitation permitted by the applicable state law. The invalidity or unenforceability of any
provision of this agreement shall not void the remaining provisions.


1.F.6. INDEMNITY - You agree to indemnify and hold the Foundation, the trademark owner, any agent
or employee of the Foundation, anyone providing copies of Project Gutenberg electronic works in
accordance with this agreement, and any volunteers associated with the production, promotion and
distribution of Project Gutenberg electronic works, harmless from all liability, costs and expenses,
including legal fees, that arise directly or indirectly from any of the following which you do or cause to
occur: (a) distribution of this or any Project Gutenberg work, (b) alteration, modification, or additions
or deletions to any Project Gutenberg work, and (c) any Defect you cause.

#### **Section 2. Information about the Mission of Project Gutenberg**


Project Gutenberg is synonymous with the free distribution of electronic works in formats readable by
the widest variety of computers including obsolete, old, middle-aged and new computers. It exists
because of the efforts of hundreds of volunteers and donations from people in all walks of life.


Volunteers and financial support to provide volunteers with the assistance they need are critical to
reaching Project Gutenbergs goals and ensuring that the Project Gutenberg collection will remain
freely available for generations to come. In 2001, the Project Gutenberg Literary Archive Foundation
was created to provide a secure and permanent future for Project Gutenberg and future generations.
To learn more about the Project Gutenberg Literary Archive Foundation and how your efforts and
donations can help, see Sections 3 and 4 and the Foundation information page at www.gutenberg.org.

#### **Section 3. Information about the Project Gutenberg Literary Archive Foundation**


The Project Gutenberg Literary Archive Foundation is a non-profit 501(c)(3) educational corporation
organized under the laws of the state of Mississippi and granted tax exempt status by the Internal
Revenue Service. The Foundations EIN or federal tax identification number is 64-6221541.
Contributions to the Project Gutenberg Literary Archive Foundation are tax deductible to the full extent
permitted by U.S. federal laws and your states laws.


The Foundations business office is located at 809 North 1500 West, Salt Lake City, UT 84116, (801)
596-1887. Email contact links and up to date contact information can be found at the Foundations
website and official page at www.gutenberg.org/contact

#### **Section 4. Information about Donations to the Project Gutenberg Literary Archive** **Foundation**


Project Gutenberg depends upon and cannot survive without widespread public support and donations
to carry out its mission of increasing the number of public domain and licensed works that can be freely
distributed in machine-readable form accessible by the widest array of equipment including outdated
equipment. Many small donations ($1 to $5,000) are particularly important to maintaining tax exempt
status with the IRS.


The Foundation is committed to complying with the laws regulating charities and charitable donations in
all 50 states of the United States. Compliance requirements are not uniform and it takes a considerable
effort, much paperwork and many fees to meet and keep up with these requirements. We do not solicit
donations in locations where we have not received written confirmation of compliance. To SEND
DONATIONS or determine the status of compliance for any particular state visit
[www.gutenberg.org/donate.](https://www.gutenberg.org/donate/)


While we cannot and do not solicit contributions from states where we have not met the solicitation
requirements, we know of no prohibition against accepting unsolicited donations from donors in such
states who approach us with offers to donate.


International donations are gratefully accepted, but we cannot make any statements concerning tax
treatment of donations received from outside the United States. U.S. laws alone swamp our small staff.


Please check the Project Gutenberg web pages for current donation methods and addresses. Donations
are accepted in a number of other ways including checks, online payments and credit card donations. To
donate, please visit: www.gutenberg.org/donate.

#### **Section 5. General Information About Project Gutenberg electronic works**


Professor Michael S. Hart was the originator of the Project Gutenberg concept of a library of
electronic works that could be freely shared with anyone. For forty years, he produced and distributed
Project Gutenberg eBooks with only a loose network of volunteer support.


Project Gutenberg eBooks are often created from several printed editions, all of which are confirmed
as not protected by copyright in the U.S. unless a copyright notice is included. Thus, we do not
necessarily keep eBooks in compliance with any particular paper edition.


[Most people start at our website which has the main PG search facility: www.gutenberg.org.](https://www.gutenberg.org/)


This website includes information about Project Gutenberg, including how to make donations to the
Project Gutenberg Literary Archive Foundation, how to help produce our new eBooks, and how to
subscribe to our email newsletter to hear about new eBooks.


`,ec={bach:w9,astronomy:E9};function C9(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var hr={exports:{}},A9=hr.exports,tc;function S9(){return tc||(tc=1,(function(n,e){(function(i,o){n.exports=o()})(typeof self<"u"?self:A9,function(){return(function(t){var i={};function o(r){if(i[r])return i[r].exports;var l=i[r]={i:r,l:!1,exports:{}};return t[r].call(l.exports,l,l.exports,o),l.l=!0,l.exports}return o.m=t,o.c=i,o.d=function(r,l,h){o.o(r,l)||Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:h})},o.n=function(r){var l=r&&r.__esModule?function(){return r.default}:function(){return r};return o.d(l,"a",l),l},o.o=function(r,l){return Object.prototype.hasOwnProperty.call(r,l)},o.p="",o(o.s=3)})([(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=(function(){function l(h,c){this.width=c,this.height=h.length/c,this.data=h}return l.createEmpty=function(h,c){return new l(new Uint8ClampedArray(h*c),h)},l.prototype.get=function(h,c){return h<0||h>=this.width||c<0||c>=this.height?!1:!!this.data[c*this.width+h]},l.prototype.set=function(h,c,d){this.data[c*this.width+h]=d?1:0},l.prototype.setRegion=function(h,c,d,u,f){for(var m=c;m<c+u;m++)for(var p=h;p<h+d;p++)this.set(p,m,!!f)},l})();i.BitMatrix=r}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(2);function l(c,d){return c^d}i.addOrSubtractGF=l;var h=(function(){function c(d,u,f){this.primitive=d,this.size=u,this.generatorBase=f,this.expTable=new Array(this.size),this.logTable=new Array(this.size);for(var m=1,p=0;p<this.size;p++)this.expTable[p]=m,m=m*2,m>=this.size&&(m=(m^this.primitive)&this.size-1);for(var p=0;p<this.size-1;p++)this.logTable[this.expTable[p]]=p;this.zero=new r.default(this,Uint8ClampedArray.from([0])),this.one=new r.default(this,Uint8ClampedArray.from([1]))}return c.prototype.multiply=function(d,u){return d===0||u===0?0:this.expTable[(this.logTable[d]+this.logTable[u])%(this.size-1)]},c.prototype.inverse=function(d){if(d===0)throw new Error("Can't invert 0");return this.expTable[this.size-this.logTable[d]-1]},c.prototype.buildMonomial=function(d,u){if(d<0)throw new Error("Invalid monomial degree less than 0");if(u===0)return this.zero;var f=new Uint8ClampedArray(d+1);return f[0]=u,new r.default(this,f)},c.prototype.log=function(d){if(d===0)throw new Error("Can't take log(0)");return this.logTable[d]},c.prototype.exp=function(d){return this.expTable[d]},c})();i.default=h}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(1),l=(function(){function h(c,d){if(d.length===0)throw new Error("No coefficients.");this.field=c;var u=d.length;if(u>1&&d[0]===0){for(var f=1;f<u&&d[f]===0;)f++;if(f===u)this.coefficients=c.zero.coefficients;else{this.coefficients=new Uint8ClampedArray(u-f);for(var m=0;m<this.coefficients.length;m++)this.coefficients[m]=d[f+m]}}else this.coefficients=d}return h.prototype.degree=function(){return this.coefficients.length-1},h.prototype.isZero=function(){return this.coefficients[0]===0},h.prototype.getCoefficient=function(c){return this.coefficients[this.coefficients.length-1-c]},h.prototype.addOrSubtract=function(c){var d;if(this.isZero())return c;if(c.isZero())return this;var u=this.coefficients,f=c.coefficients;u.length>f.length&&(d=[f,u],u=d[0],f=d[1]);for(var m=new Uint8ClampedArray(f.length),p=f.length-u.length,b=0;b<p;b++)m[b]=f[b];for(var b=p;b<f.length;b++)m[b]=r.addOrSubtractGF(u[b-p],f[b]);return new h(this.field,m)},h.prototype.multiply=function(c){if(c===0)return this.field.zero;if(c===1)return this;for(var d=this.coefficients.length,u=new Uint8ClampedArray(d),f=0;f<d;f++)u[f]=this.field.multiply(this.coefficients[f],c);return new h(this.field,u)},h.prototype.multiplyPoly=function(c){if(this.isZero()||c.isZero())return this.field.zero;for(var d=this.coefficients,u=d.length,f=c.coefficients,m=f.length,p=new Uint8ClampedArray(u+m-1),b=0;b<u;b++)for(var E=d[b],g=0;g<m;g++)p[b+g]=r.addOrSubtractGF(p[b+g],this.field.multiply(E,f[g]));return new h(this.field,p)},h.prototype.multiplyByMonomial=function(c,d){if(c<0)throw new Error("Invalid degree less than 0");if(d===0)return this.field.zero;for(var u=this.coefficients.length,f=new Uint8ClampedArray(u+c),m=0;m<u;m++)f[m]=this.field.multiply(this.coefficients[m],d);return new h(this.field,f)},h.prototype.evaluateAt=function(c){var d=0;if(c===0)return this.getCoefficient(0);var u=this.coefficients.length;if(c===1)return this.coefficients.forEach(function(m){d=r.addOrSubtractGF(d,m)}),d;d=this.coefficients[0];for(var f=1;f<u;f++)d=r.addOrSubtractGF(this.field.multiply(c,d),this.coefficients[f]);return d},h})();i.default=l}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(4),l=o(5),h=o(11),c=o(12);function d(m){var p=c.locate(m);if(!p)return null;for(var b=0,E=p;b<E.length;b++){var g=E[b],x=h.extract(m,g),T=l.decode(x.matrix);if(T)return{binaryData:T.bytes,data:T.text,chunks:T.chunks,version:T.version,location:{topRightCorner:x.mappingFunction(g.dimension,0),topLeftCorner:x.mappingFunction(0,0),bottomRightCorner:x.mappingFunction(g.dimension,g.dimension),bottomLeftCorner:x.mappingFunction(0,g.dimension),topRightFinderPattern:g.topRight,topLeftFinderPattern:g.topLeft,bottomLeftFinderPattern:g.bottomLeft,bottomRightAlignmentPattern:g.alignmentPattern}}}return null}var u={inversionAttempts:"attemptBoth"};function f(m,p,b,E){E===void 0&&(E={});var g=u;Object.keys(g||{}).forEach(function(B){g[B]=E[B]||g[B]});var x=g.inversionAttempts==="attemptBoth"||g.inversionAttempts==="invertFirst",T=g.inversionAttempts==="onlyInvert"||g.inversionAttempts==="invertFirst",C=r.binarize(m,p,b,x),y=C.binarized,F=C.inverted,_=d(T?F:y);return!_&&(g.inversionAttempts==="attemptBoth"||g.inversionAttempts==="invertFirst")&&(_=d(T?y:F)),_}f.default=f,i.default=f}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(0),l=8,h=24;function c(f,m,p){return f<m?m:f>p?p:f}var d=(function(){function f(m,p){this.width=m,this.data=new Uint8ClampedArray(m*p)}return f.prototype.get=function(m,p){return this.data[p*this.width+m]},f.prototype.set=function(m,p,b){this.data[p*this.width+m]=b},f})();function u(f,m,p,b){if(f.length!==m*p*4)throw new Error("Malformed data passed to binarizer.");for(var E=new d(m,p),g=0;g<m;g++)for(var x=0;x<p;x++){var T=f[(x*m+g)*4+0],C=f[(x*m+g)*4+1],y=f[(x*m+g)*4+2];E.set(g,x,.2126*T+.7152*C+.0722*y)}for(var F=Math.ceil(m/l),_=Math.ceil(p/l),B=new d(F,_),P=0;P<_;P++)for(var A=0;A<F;A++){for(var S=0,R=1/0,U=0,x=0;x<l;x++)for(var g=0;g<l;g++){var z=E.get(A*l+g,P*l+x);S+=z,R=Math.min(R,z),U=Math.max(U,z)}var J=S/Math.pow(l,2);if(U-R<=h&&(J=R/2,P>0&&A>0)){var Y=(B.get(A,P-1)+2*B.get(A-1,P)+B.get(A-1,P-1))/4;R<Y&&(J=Y)}B.set(A,P,J)}var X=r.BitMatrix.createEmpty(m,p),ee=null;b&&(ee=r.BitMatrix.createEmpty(m,p));for(var P=0;P<_;P++)for(var A=0;A<F;A++){for(var $=c(A,2,F-3),he=c(P,2,_-3),S=0,fe=-2;fe<=2;fe++)for(var re=-2;re<=2;re++)S+=B.get($+fe,he+re);for(var ve=S/25,fe=0;fe<l;fe++)for(var re=0;re<l;re++){var g=A*l+fe,x=P*l+re,Ge=E.get(g,x);X.set(g,x,Ge<=ve),b&&ee.set(g,x,!(Ge<=ve))}}return b?{binarized:X,inverted:ee}:{binarized:X}}i.binarize=u}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(0),l=o(6),h=o(9),c=o(10);function d(y,F){for(var _=y^F,B=0;_;)B++,_&=_-1;return B}function u(y,F){return F<<1|y}var f=[{bits:21522,formatInfo:{errorCorrectionLevel:1,dataMask:0}},{bits:20773,formatInfo:{errorCorrectionLevel:1,dataMask:1}},{bits:24188,formatInfo:{errorCorrectionLevel:1,dataMask:2}},{bits:23371,formatInfo:{errorCorrectionLevel:1,dataMask:3}},{bits:17913,formatInfo:{errorCorrectionLevel:1,dataMask:4}},{bits:16590,formatInfo:{errorCorrectionLevel:1,dataMask:5}},{bits:20375,formatInfo:{errorCorrectionLevel:1,dataMask:6}},{bits:19104,formatInfo:{errorCorrectionLevel:1,dataMask:7}},{bits:30660,formatInfo:{errorCorrectionLevel:0,dataMask:0}},{bits:29427,formatInfo:{errorCorrectionLevel:0,dataMask:1}},{bits:32170,formatInfo:{errorCorrectionLevel:0,dataMask:2}},{bits:30877,formatInfo:{errorCorrectionLevel:0,dataMask:3}},{bits:26159,formatInfo:{errorCorrectionLevel:0,dataMask:4}},{bits:25368,formatInfo:{errorCorrectionLevel:0,dataMask:5}},{bits:27713,formatInfo:{errorCorrectionLevel:0,dataMask:6}},{bits:26998,formatInfo:{errorCorrectionLevel:0,dataMask:7}},{bits:5769,formatInfo:{errorCorrectionLevel:3,dataMask:0}},{bits:5054,formatInfo:{errorCorrectionLevel:3,dataMask:1}},{bits:7399,formatInfo:{errorCorrectionLevel:3,dataMask:2}},{bits:6608,formatInfo:{errorCorrectionLevel:3,dataMask:3}},{bits:1890,formatInfo:{errorCorrectionLevel:3,dataMask:4}},{bits:597,formatInfo:{errorCorrectionLevel:3,dataMask:5}},{bits:3340,formatInfo:{errorCorrectionLevel:3,dataMask:6}},{bits:2107,formatInfo:{errorCorrectionLevel:3,dataMask:7}},{bits:13663,formatInfo:{errorCorrectionLevel:2,dataMask:0}},{bits:12392,formatInfo:{errorCorrectionLevel:2,dataMask:1}},{bits:16177,formatInfo:{errorCorrectionLevel:2,dataMask:2}},{bits:14854,formatInfo:{errorCorrectionLevel:2,dataMask:3}},{bits:9396,formatInfo:{errorCorrectionLevel:2,dataMask:4}},{bits:8579,formatInfo:{errorCorrectionLevel:2,dataMask:5}},{bits:11994,formatInfo:{errorCorrectionLevel:2,dataMask:6}},{bits:11245,formatInfo:{errorCorrectionLevel:2,dataMask:7}}],m=[function(y){return(y.y+y.x)%2===0},function(y){return y.y%2===0},function(y){return y.x%3===0},function(y){return(y.y+y.x)%3===0},function(y){return(Math.floor(y.y/2)+Math.floor(y.x/3))%2===0},function(y){return y.x*y.y%2+y.x*y.y%3===0},function(y){return(y.y*y.x%2+y.y*y.x%3)%2===0},function(y){return((y.y+y.x)%2+y.y*y.x%3)%2===0}];function p(y){var F=17+4*y.versionNumber,_=r.BitMatrix.createEmpty(F,F);_.setRegion(0,0,9,9,!0),_.setRegion(F-8,0,8,9,!0),_.setRegion(0,F-8,9,8,!0);for(var B=0,P=y.alignmentPatternCenters;B<P.length;B++)for(var A=P[B],S=0,R=y.alignmentPatternCenters;S<R.length;S++){var U=R[S];A===6&&U===6||A===6&&U===F-7||A===F-7&&U===6||_.setRegion(A-2,U-2,5,5,!0)}return _.setRegion(6,9,1,F-17,!0),_.setRegion(9,6,F-17,1,!0),y.versionNumber>6&&(_.setRegion(F-11,0,3,6,!0),_.setRegion(0,F-11,6,3,!0)),_}function b(y,F,_){for(var B=m[_.dataMask],P=y.height,A=p(F),S=[],R=0,U=0,z=!0,J=P-1;J>0;J-=2){J===6&&J--;for(var Y=0;Y<P;Y++)for(var X=z?P-1-Y:Y,ee=0;ee<2;ee++){var $=J-ee;if(!A.get($,X)){U++;var he=y.get($,X);B({y:X,x:$})&&(he=!he),R=u(he,R),U===8&&(S.push(R),U=0,R=0)}}z=!z}return S}function E(y){var F=y.height,_=Math.floor((F-17)/4);if(_<=6)return c.VERSIONS[_-1];for(var B=0,P=5;P>=0;P--)for(var A=F-9;A>=F-11;A--)B=u(y.get(A,P),B);for(var S=0,A=5;A>=0;A--)for(var P=F-9;P>=F-11;P--)S=u(y.get(A,P),S);for(var R=1/0,U,z=0,J=c.VERSIONS;z<J.length;z++){var Y=J[z];if(Y.infoBits===B||Y.infoBits===S)return Y;var X=d(B,Y.infoBits);X<R&&(U=Y,R=X),X=d(S,Y.infoBits),X<R&&(U=Y,R=X)}if(R<=3)return U}function g(y){for(var F=0,_=0;_<=8;_++)_!==6&&(F=u(y.get(_,8),F));for(var B=7;B>=0;B--)B!==6&&(F=u(y.get(8,B),F));for(var P=y.height,A=0,B=P-1;B>=P-7;B--)A=u(y.get(8,B),A);for(var _=P-8;_<P;_++)A=u(y.get(_,8),A);for(var S=1/0,R=null,U=0,z=f;U<z.length;U++){var J=z[U],Y=J.bits,X=J.formatInfo;if(Y===F||Y===A)return X;var ee=d(F,Y);ee<S&&(R=X,S=ee),F!==A&&(ee=d(A,Y),ee<S&&(R=X,S=ee))}return S<=3?R:null}function x(y,F,_){var B=F.errorCorrectionLevels[_],P=[],A=0;if(B.ecBlocks.forEach(function(he){for(var fe=0;fe<he.numBlocks;fe++)P.push({numDataCodewords:he.dataCodewordsPerBlock,codewords:[]}),A+=he.dataCodewordsPerBlock+B.ecCodewordsPerBlock}),y.length<A)return null;y=y.slice(0,A);for(var S=B.ecBlocks[0].dataCodewordsPerBlock,R=0;R<S;R++)for(var U=0,z=P;U<z.length;U++){var J=z[U];J.codewords.push(y.shift())}if(B.ecBlocks.length>1)for(var Y=B.ecBlocks[0].numBlocks,X=B.ecBlocks[1].numBlocks,R=0;R<X;R++)P[Y+R].codewords.push(y.shift());for(;y.length>0;)for(var ee=0,$=P;ee<$.length;ee++){var J=$[ee];J.codewords.push(y.shift())}return P}function T(y){var F=E(y);if(!F)return null;var _=g(y);if(!_)return null;var B=b(y,F,_),P=x(B,F,_.errorCorrectionLevel);if(!P)return null;for(var A=P.reduce(function(ee,$){return ee+$.numDataCodewords},0),S=new Uint8ClampedArray(A),R=0,U=0,z=P;U<z.length;U++){var J=z[U],Y=h.decode(J.codewords,J.codewords.length-J.numDataCodewords);if(!Y)return null;for(var X=0;X<J.numDataCodewords;X++)S[R++]=Y[X]}try{return l.decode(S,F.versionNumber)}catch{return null}}function C(y){if(y==null)return null;var F=T(y);if(F)return F;for(var _=0;_<y.width;_++)for(var B=_+1;B<y.height;B++)y.get(_,B)!==y.get(B,_)&&(y.set(_,B,!y.get(_,B)),y.set(B,_,!y.get(B,_)));return T(y)}i.decode=C}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(7),l=o(8),h;(function(E){E.Numeric="numeric",E.Alphanumeric="alphanumeric",E.Byte="byte",E.Kanji="kanji",E.ECI="eci"})(h=i.Mode||(i.Mode={}));var c;(function(E){E[E.Terminator=0]="Terminator",E[E.Numeric=1]="Numeric",E[E.Alphanumeric=2]="Alphanumeric",E[E.Byte=4]="Byte",E[E.Kanji=8]="Kanji",E[E.ECI=7]="ECI"})(c||(c={}));function d(E,g){for(var x=[],T="",C=[10,12,14][g],y=E.readBits(C);y>=3;){var F=E.readBits(10);if(F>=1e3)throw new Error("Invalid numeric value above 999");var _=Math.floor(F/100),B=Math.floor(F/10)%10,P=F%10;x.push(48+_,48+B,48+P),T+=_.toString()+B.toString()+P.toString(),y-=3}if(y===2){var F=E.readBits(7);if(F>=100)throw new Error("Invalid numeric value above 99");var _=Math.floor(F/10),B=F%10;x.push(48+_,48+B),T+=_.toString()+B.toString()}else if(y===1){var F=E.readBits(4);if(F>=10)throw new Error("Invalid numeric value above 9");x.push(48+F),T+=F.toString()}return{bytes:x,text:T}}var u=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function f(E,g){for(var x=[],T="",C=[9,11,13][g],y=E.readBits(C);y>=2;){var F=E.readBits(11),_=Math.floor(F/45),B=F%45;x.push(u[_].charCodeAt(0),u[B].charCodeAt(0)),T+=u[_]+u[B],y-=2}if(y===1){var _=E.readBits(6);x.push(u[_].charCodeAt(0)),T+=u[_]}return{bytes:x,text:T}}function m(E,g){for(var x=[],T="",C=[8,16,16][g],y=E.readBits(C),F=0;F<y;F++){var _=E.readBits(8);x.push(_)}try{T+=decodeURIComponent(x.map(function(B){return"%"+("0"+B.toString(16)).substr(-2)}).join(""))}catch{}return{bytes:x,text:T}}function p(E,g){for(var x=[],T="",C=[8,10,12][g],y=E.readBits(C),F=0;F<y;F++){var _=E.readBits(13),B=Math.floor(_/192)<<8|_%192;B<7936?B+=33088:B+=49472,x.push(B>>8,B&255),T+=String.fromCharCode(l.shiftJISTable[B])}return{bytes:x,text:T}}function b(E,g){for(var x,T,C,y,F=new r.BitStream(E),_=g<=9?0:g<=26?1:2,B={text:"",bytes:[],chunks:[],version:g};F.available()>=4;){var P=F.readBits(4);if(P===c.Terminator)return B;if(P===c.ECI)F.readBits(1)===0?B.chunks.push({type:h.ECI,assignmentNumber:F.readBits(7)}):F.readBits(1)===0?B.chunks.push({type:h.ECI,assignmentNumber:F.readBits(14)}):F.readBits(1)===0?B.chunks.push({type:h.ECI,assignmentNumber:F.readBits(21)}):B.chunks.push({type:h.ECI,assignmentNumber:-1});else if(P===c.Numeric){var A=d(F,_);B.text+=A.text,(x=B.bytes).push.apply(x,A.bytes),B.chunks.push({type:h.Numeric,text:A.text})}else if(P===c.Alphanumeric){var S=f(F,_);B.text+=S.text,(T=B.bytes).push.apply(T,S.bytes),B.chunks.push({type:h.Alphanumeric,text:S.text})}else if(P===c.Byte){var R=m(F,_);B.text+=R.text,(C=B.bytes).push.apply(C,R.bytes),B.chunks.push({type:h.Byte,bytes:R.bytes,text:R.text})}else if(P===c.Kanji){var U=p(F,_);B.text+=U.text,(y=B.bytes).push.apply(y,U.bytes),B.chunks.push({type:h.Kanji,bytes:U.bytes,text:U.text})}}if(F.available()===0||F.readBits(F.available())===0)return B}i.decode=b}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=(function(){function l(h){this.byteOffset=0,this.bitOffset=0,this.bytes=h}return l.prototype.readBits=function(h){if(h<1||h>32||h>this.available())throw new Error("Cannot read "+h.toString()+" bits");var c=0;if(this.bitOffset>0){var d=8-this.bitOffset,u=h<d?h:d,f=d-u,m=255>>8-u<<f;c=(this.bytes[this.byteOffset]&m)>>f,h-=u,this.bitOffset+=u,this.bitOffset===8&&(this.bitOffset=0,this.byteOffset++)}if(h>0){for(;h>=8;)c=c<<8|this.bytes[this.byteOffset]&255,this.byteOffset++,h-=8;if(h>0){var f=8-h,m=255>>f<<f;c=c<<h|(this.bytes[this.byteOffset]&m)>>f,this.bitOffset+=h}}return c},l.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},l})();i.BitStream=r}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0}),i.shiftJISTable={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:165,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:8254,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:92,33120:12316,33121:8214,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:8722,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:162,33170:163,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:172,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081}}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(1),l=o(2);function h(f,m,p,b){var E;m.degree()<p.degree()&&(E=[p,m],m=E[0],p=E[1]);for(var g=m,x=p,T=f.zero,C=f.one;x.degree()>=b/2;){var y=g,F=T;if(g=x,T=C,g.isZero())return null;x=y;for(var _=f.zero,B=g.getCoefficient(g.degree()),P=f.inverse(B);x.degree()>=g.degree()&&!x.isZero();){var A=x.degree()-g.degree(),S=f.multiply(x.getCoefficient(x.degree()),P);_=_.addOrSubtract(f.buildMonomial(A,S)),x=x.addOrSubtract(g.multiplyByMonomial(A,S))}if(C=_.multiplyPoly(T).addOrSubtract(F),x.degree()>=g.degree())return null}var R=C.getCoefficient(0);if(R===0)return null;var U=f.inverse(R);return[C.multiply(U),x.multiply(U)]}function c(f,m){var p=m.degree();if(p===1)return[m.getCoefficient(1)];for(var b=new Array(p),E=0,g=1;g<f.size&&E<p;g++)m.evaluateAt(g)===0&&(b[E]=f.inverse(g),E++);return E!==p?null:b}function d(f,m,p){for(var b=p.length,E=new Array(b),g=0;g<b;g++){for(var x=f.inverse(p[g]),T=1,C=0;C<b;C++)g!==C&&(T=f.multiply(T,r.addOrSubtractGF(1,f.multiply(p[C],x))));E[g]=f.multiply(m.evaluateAt(x),f.inverse(T)),f.generatorBase!==0&&(E[g]=f.multiply(E[g],x))}return E}function u(f,m){var p=new Uint8ClampedArray(f.length);p.set(f);for(var b=new r.default(285,256,0),E=new l.default(b,p),g=new Uint8ClampedArray(m),x=!1,T=0;T<m;T++){var C=E.evaluateAt(b.exp(T+b.generatorBase));g[g.length-1-T]=C,C!==0&&(x=!0)}if(!x)return p;var y=new l.default(b,g),F=h(b,b.buildMonomial(m,1),y,m);if(F===null)return null;var _=c(b,F[0]);if(_==null)return null;for(var B=d(b,F[1],_),P=0;P<_.length;P++){var A=p.length-1-b.log(_[P]);if(A<0)return null;p[A]=r.addOrSubtractGF(p[A],B[P])}return p}i.decode=u}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0}),i.VERSIONS=[{infoBits:null,versionNumber:1,alignmentPatternCenters:[],errorCorrectionLevels:[{ecCodewordsPerBlock:7,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:13,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:13}]},{ecCodewordsPerBlock:17,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:2,alignmentPatternCenters:[6,18],errorCorrectionLevels:[{ecCodewordsPerBlock:10,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:34}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:28}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:16}]}]},{infoBits:null,versionNumber:3,alignmentPatternCenters:[6,22],errorCorrectionLevels:[{ecCodewordsPerBlock:15,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:55}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:13}]}]},{infoBits:null,versionNumber:4,alignmentPatternCenters:[6,26],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:80}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:32}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:9}]}]},{infoBits:null,versionNumber:5,alignmentPatternCenters:[6,30],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:43}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:11},{numBlocks:2,dataCodewordsPerBlock:12}]}]},{infoBits:null,versionNumber:6,alignmentPatternCenters:[6,34],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68}]},{ecCodewordsPerBlock:16,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:27}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:31892,versionNumber:7,alignmentPatternCenters:[6,22,38],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:78}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:31}]},{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:13},{numBlocks:1,dataCodewordsPerBlock:14}]}]},{infoBits:34236,versionNumber:8,alignmentPatternCenters:[6,24,42],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:97}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:38},{numBlocks:2,dataCodewordsPerBlock:39}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:18},{numBlocks:2,dataCodewordsPerBlock:19}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:14},{numBlocks:2,dataCodewordsPerBlock:15}]}]},{infoBits:39577,versionNumber:9,alignmentPatternCenters:[6,26,46],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:12},{numBlocks:4,dataCodewordsPerBlock:13}]}]},{infoBits:42195,versionNumber:10,alignmentPatternCenters:[6,28,50],errorCorrectionLevels:[{ecCodewordsPerBlock:18,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:68},{numBlocks:2,dataCodewordsPerBlock:69}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:43},{numBlocks:1,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:15},{numBlocks:2,dataCodewordsPerBlock:16}]}]},{infoBits:48118,versionNumber:11,alignmentPatternCenters:[6,30,54],errorCorrectionLevels:[{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:81}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:50},{numBlocks:4,dataCodewordsPerBlock:51}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:22},{numBlocks:4,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:12},{numBlocks:8,dataCodewordsPerBlock:13}]}]},{infoBits:51042,versionNumber:12,alignmentPatternCenters:[6,32,58],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:92},{numBlocks:2,dataCodewordsPerBlock:93}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:36},{numBlocks:2,dataCodewordsPerBlock:37}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:20},{numBlocks:6,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:14},{numBlocks:4,dataCodewordsPerBlock:15}]}]},{infoBits:55367,versionNumber:13,alignmentPatternCenters:[6,34,62],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:37},{numBlocks:1,dataCodewordsPerBlock:38}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:20},{numBlocks:4,dataCodewordsPerBlock:21}]},{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:11},{numBlocks:4,dataCodewordsPerBlock:12}]}]},{infoBits:58893,versionNumber:14,alignmentPatternCenters:[6,26,46,66],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:40},{numBlocks:5,dataCodewordsPerBlock:41}]},{ecCodewordsPerBlock:20,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:16},{numBlocks:5,dataCodewordsPerBlock:17}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:5,dataCodewordsPerBlock:13}]}]},{infoBits:63784,versionNumber:15,alignmentPatternCenters:[6,26,48,70],errorCorrectionLevels:[{ecCodewordsPerBlock:22,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:87},{numBlocks:1,dataCodewordsPerBlock:88}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:41},{numBlocks:5,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:12},{numBlocks:7,dataCodewordsPerBlock:13}]}]},{infoBits:68472,versionNumber:16,alignmentPatternCenters:[6,26,50,74],errorCorrectionLevels:[{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:98},{numBlocks:1,dataCodewordsPerBlock:99}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:19},{numBlocks:2,dataCodewordsPerBlock:20}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:70749,versionNumber:17,alignmentPatternCenters:[6,30,54,78],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:1,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:22},{numBlocks:15,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:17,dataCodewordsPerBlock:15}]}]},{infoBits:76311,versionNumber:18,alignmentPatternCenters:[6,30,56,82],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:120},{numBlocks:1,dataCodewordsPerBlock:121}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:43},{numBlocks:4,dataCodewordsPerBlock:44}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:1,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:14},{numBlocks:19,dataCodewordsPerBlock:15}]}]},{infoBits:79154,versionNumber:19,alignmentPatternCenters:[6,30,58,86],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:113},{numBlocks:4,dataCodewordsPerBlock:114}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:44},{numBlocks:11,dataCodewordsPerBlock:45}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:21},{numBlocks:4,dataCodewordsPerBlock:22}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:9,dataCodewordsPerBlock:13},{numBlocks:16,dataCodewordsPerBlock:14}]}]},{infoBits:84390,versionNumber:20,alignmentPatternCenters:[6,34,62,90],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:107},{numBlocks:5,dataCodewordsPerBlock:108}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:41},{numBlocks:13,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:5,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:15},{numBlocks:10,dataCodewordsPerBlock:16}]}]},{infoBits:87683,versionNumber:21,alignmentPatternCenters:[6,28,50,72,94],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:116},{numBlocks:4,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:42}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:16},{numBlocks:6,dataCodewordsPerBlock:17}]}]},{infoBits:92361,versionNumber:22,alignmentPatternCenters:[6,26,50,74,98],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:111},{numBlocks:7,dataCodewordsPerBlock:112}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:24,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:13}]}]},{infoBits:96236,versionNumber:23,alignmentPatternCenters:[6,30,54,74,102],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:121},{numBlocks:5,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:47},{numBlocks:14,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:16,dataCodewordsPerBlock:15},{numBlocks:14,dataCodewordsPerBlock:16}]}]},{infoBits:102084,versionNumber:24,alignmentPatternCenters:[6,28,54,80,106],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:45},{numBlocks:14,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:24},{numBlocks:16,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:30,dataCodewordsPerBlock:16},{numBlocks:2,dataCodewordsPerBlock:17}]}]},{infoBits:102881,versionNumber:25,alignmentPatternCenters:[6,32,58,84,110],errorCorrectionLevels:[{ecCodewordsPerBlock:26,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:106},{numBlocks:4,dataCodewordsPerBlock:107}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:47},{numBlocks:13,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:13,dataCodewordsPerBlock:16}]}]},{infoBits:110507,versionNumber:26,alignmentPatternCenters:[6,30,58,86,114],errorCorrectionLevels:[{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:114},{numBlocks:2,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:46},{numBlocks:4,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:28,dataCodewordsPerBlock:22},{numBlocks:6,dataCodewordsPerBlock:23}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:33,dataCodewordsPerBlock:16},{numBlocks:4,dataCodewordsPerBlock:17}]}]},{infoBits:110734,versionNumber:27,alignmentPatternCenters:[6,34,62,90,118],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:45},{numBlocks:3,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:8,dataCodewordsPerBlock:23},{numBlocks:26,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:117786,versionNumber:28,alignmentPatternCenters:[6,26,50,74,98,122],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:117},{numBlocks:10,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:3,dataCodewordsPerBlock:45},{numBlocks:23,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:24},{numBlocks:31,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:31,dataCodewordsPerBlock:16}]}]},{infoBits:119615,versionNumber:29,alignmentPatternCenters:[6,30,54,78,102,126],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:7,dataCodewordsPerBlock:116},{numBlocks:7,dataCodewordsPerBlock:117}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:21,dataCodewordsPerBlock:45},{numBlocks:7,dataCodewordsPerBlock:46}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:1,dataCodewordsPerBlock:23},{numBlocks:37,dataCodewordsPerBlock:24}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:26,dataCodewordsPerBlock:16}]}]},{infoBits:126325,versionNumber:30,alignmentPatternCenters:[6,26,52,78,104,130],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:5,dataCodewordsPerBlock:115},{numBlocks:10,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:47},{numBlocks:10,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:15,dataCodewordsPerBlock:24},{numBlocks:25,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:25,dataCodewordsPerBlock:16}]}]},{infoBits:127568,versionNumber:31,alignmentPatternCenters:[6,30,56,82,108,134],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:3,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:46},{numBlocks:29,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:24},{numBlocks:1,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:23,dataCodewordsPerBlock:15},{numBlocks:28,dataCodewordsPerBlock:16}]}]},{infoBits:133589,versionNumber:32,alignmentPatternCenters:[6,34,60,86,112,138],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:24},{numBlocks:35,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:15},{numBlocks:35,dataCodewordsPerBlock:16}]}]},{infoBits:136944,versionNumber:33,alignmentPatternCenters:[6,30,58,86,114,142],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:115},{numBlocks:1,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:21,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:24},{numBlocks:19,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:11,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:141498,versionNumber:34,alignmentPatternCenters:[6,34,62,90,118,146],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:115},{numBlocks:6,dataCodewordsPerBlock:116}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:14,dataCodewordsPerBlock:46},{numBlocks:23,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:44,dataCodewordsPerBlock:24},{numBlocks:7,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:59,dataCodewordsPerBlock:16},{numBlocks:1,dataCodewordsPerBlock:17}]}]},{infoBits:145311,versionNumber:35,alignmentPatternCenters:[6,30,54,78,102,126,150],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:121},{numBlocks:7,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:12,dataCodewordsPerBlock:47},{numBlocks:26,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:39,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:22,dataCodewordsPerBlock:15},{numBlocks:41,dataCodewordsPerBlock:16}]}]},{infoBits:150283,versionNumber:36,alignmentPatternCenters:[6,24,50,76,102,128,154],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:121},{numBlocks:14,dataCodewordsPerBlock:122}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:6,dataCodewordsPerBlock:47},{numBlocks:34,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:46,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:2,dataCodewordsPerBlock:15},{numBlocks:64,dataCodewordsPerBlock:16}]}]},{infoBits:152622,versionNumber:37,alignmentPatternCenters:[6,28,54,80,106,132,158],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:17,dataCodewordsPerBlock:122},{numBlocks:4,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:29,dataCodewordsPerBlock:46},{numBlocks:14,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:49,dataCodewordsPerBlock:24},{numBlocks:10,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:24,dataCodewordsPerBlock:15},{numBlocks:46,dataCodewordsPerBlock:16}]}]},{infoBits:158308,versionNumber:38,alignmentPatternCenters:[6,32,58,84,110,136,162],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:4,dataCodewordsPerBlock:122},{numBlocks:18,dataCodewordsPerBlock:123}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:13,dataCodewordsPerBlock:46},{numBlocks:32,dataCodewordsPerBlock:47}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:48,dataCodewordsPerBlock:24},{numBlocks:14,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:42,dataCodewordsPerBlock:15},{numBlocks:32,dataCodewordsPerBlock:16}]}]},{infoBits:161089,versionNumber:39,alignmentPatternCenters:[6,26,54,82,110,138,166],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:117},{numBlocks:4,dataCodewordsPerBlock:118}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:40,dataCodewordsPerBlock:47},{numBlocks:7,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:43,dataCodewordsPerBlock:24},{numBlocks:22,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:10,dataCodewordsPerBlock:15},{numBlocks:67,dataCodewordsPerBlock:16}]}]},{infoBits:167017,versionNumber:40,alignmentPatternCenters:[6,30,58,86,114,142,170],errorCorrectionLevels:[{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:19,dataCodewordsPerBlock:118},{numBlocks:6,dataCodewordsPerBlock:119}]},{ecCodewordsPerBlock:28,ecBlocks:[{numBlocks:18,dataCodewordsPerBlock:47},{numBlocks:31,dataCodewordsPerBlock:48}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:34,dataCodewordsPerBlock:24},{numBlocks:34,dataCodewordsPerBlock:25}]},{ecCodewordsPerBlock:30,ecBlocks:[{numBlocks:20,dataCodewordsPerBlock:15},{numBlocks:61,dataCodewordsPerBlock:16}]}]}]}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=o(0);function l(u,f,m,p){var b=u.x-f.x+m.x-p.x,E=u.y-f.y+m.y-p.y;if(b===0&&E===0)return{a11:f.x-u.x,a12:f.y-u.y,a13:0,a21:m.x-f.x,a22:m.y-f.y,a23:0,a31:u.x,a32:u.y,a33:1};var g=f.x-m.x,x=p.x-m.x,T=f.y-m.y,C=p.y-m.y,y=g*C-x*T,F=(b*C-x*E)/y,_=(g*E-b*T)/y;return{a11:f.x-u.x+F*f.x,a12:f.y-u.y+F*f.y,a13:F,a21:p.x-u.x+_*p.x,a22:p.y-u.y+_*p.y,a23:_,a31:u.x,a32:u.y,a33:1}}function h(u,f,m,p){var b=l(u,f,m,p);return{a11:b.a22*b.a33-b.a23*b.a32,a12:b.a13*b.a32-b.a12*b.a33,a13:b.a12*b.a23-b.a13*b.a22,a21:b.a23*b.a31-b.a21*b.a33,a22:b.a11*b.a33-b.a13*b.a31,a23:b.a13*b.a21-b.a11*b.a23,a31:b.a21*b.a32-b.a22*b.a31,a32:b.a12*b.a31-b.a11*b.a32,a33:b.a11*b.a22-b.a12*b.a21}}function c(u,f){return{a11:u.a11*f.a11+u.a21*f.a12+u.a31*f.a13,a12:u.a12*f.a11+u.a22*f.a12+u.a32*f.a13,a13:u.a13*f.a11+u.a23*f.a12+u.a33*f.a13,a21:u.a11*f.a21+u.a21*f.a22+u.a31*f.a23,a22:u.a12*f.a21+u.a22*f.a22+u.a32*f.a23,a23:u.a13*f.a21+u.a23*f.a22+u.a33*f.a23,a31:u.a11*f.a31+u.a21*f.a32+u.a31*f.a33,a32:u.a12*f.a31+u.a22*f.a32+u.a32*f.a33,a33:u.a13*f.a31+u.a23*f.a32+u.a33*f.a33}}function d(u,f){for(var m=h({x:3.5,y:3.5},{x:f.dimension-3.5,y:3.5},{x:f.dimension-6.5,y:f.dimension-6.5},{x:3.5,y:f.dimension-3.5}),p=l(f.topLeft,f.topRight,f.alignmentPattern,f.bottomLeft),b=c(p,m),E=r.BitMatrix.createEmpty(f.dimension,f.dimension),g=function(_,B){var P=b.a13*_+b.a23*B+b.a33;return{x:(b.a11*_+b.a21*B+b.a31)/P,y:(b.a12*_+b.a22*B+b.a32)/P}},x=0;x<f.dimension;x++)for(var T=0;T<f.dimension;T++){var C=T+.5,y=x+.5,F=g(C,y);E.set(T,x,u.get(Math.floor(F.x),Math.floor(F.y)))}return{matrix:E,mappingFunction:g}}i.extract=d}),(function(t,i,o){Object.defineProperty(i,"__esModule",{value:!0});var r=4,l=.5,h=1.5,c=function(C,y){return Math.sqrt(Math.pow(y.x-C.x,2)+Math.pow(y.y-C.y,2))};function d(C){return C.reduce(function(y,F){return y+F})}function u(C,y,F){var _,B,P,A,S=c(C,y),R=c(y,F),U=c(C,F),z,J,Y;return R>=S&&R>=U?(_=[y,C,F],z=_[0],J=_[1],Y=_[2]):U>=R&&U>=S?(B=[C,y,F],z=B[0],J=B[1],Y=B[2]):(P=[C,F,y],z=P[0],J=P[1],Y=P[2]),(Y.x-J.x)*(z.y-J.y)-(Y.y-J.y)*(z.x-J.x)<0&&(A=[Y,z],z=A[0],Y=A[1]),{bottomLeft:z,topLeft:J,topRight:Y}}function f(C,y,F,_){var B=(d(p(C,F,_,5))/7+d(p(C,y,_,5))/7+d(p(F,C,_,5))/7+d(p(y,C,_,5))/7)/4;if(B<1)throw new Error("Invalid module size");var P=Math.round(c(C,y)/B),A=Math.round(c(C,F)/B),S=Math.floor((P+A)/2)+7;switch(S%4){case 0:S++;break;case 2:S--;break}return{dimension:S,moduleSize:B}}function m(C,y,F,_){var B=[{x:Math.floor(C.x),y:Math.floor(C.y)}],P=Math.abs(y.y-C.y)>Math.abs(y.x-C.x),A,S,R,U;P?(A=Math.floor(C.y),S=Math.floor(C.x),R=Math.floor(y.y),U=Math.floor(y.x)):(A=Math.floor(C.x),S=Math.floor(C.y),R=Math.floor(y.x),U=Math.floor(y.y));for(var z=Math.abs(R-A),J=Math.abs(U-S),Y=Math.floor(-z/2),X=A<R?1:-1,ee=S<U?1:-1,$=!0,he=A,fe=S;he!==R+X;he+=X){var re=P?fe:he,ve=P?he:fe;if(F.get(re,ve)!==$&&($=!$,B.push({x:re,y:ve}),B.length===_+1))break;if(Y+=J,Y>0){if(fe===U)break;fe+=ee,Y-=z}}for(var Ge=[],Z=0;Z<_;Z++)B[Z]&&B[Z+1]?Ge.push(c(B[Z],B[Z+1])):Ge.push(0);return Ge}function p(C,y,F,_){var B,P=y.y-C.y,A=y.x-C.x,S=m(C,y,F,Math.ceil(_/2)),R=m(C,{x:C.x-A,y:C.y-P},F,Math.ceil(_/2)),U=S.shift()+R.shift()-1;return(B=R.concat(U)).concat.apply(B,S)}function b(C,y){var F=d(C)/d(y),_=0;return y.forEach(function(B,P){_+=Math.pow(C[P]-B*F,2)}),{averageSize:F,error:_}}function E(C,y,F){try{var _=p(C,{x:-1,y:C.y},F,y.length),B=p(C,{x:C.x,y:-1},F,y.length),P={x:Math.max(0,C.x-C.y)-1,y:Math.max(0,C.y-C.x)-1},A=p(C,P,F,y.length),S={x:Math.min(F.width,C.x+C.y)+1,y:Math.min(F.height,C.y+C.x)+1},R=p(C,S,F,y.length),U=b(_,y),z=b(B,y),J=b(A,y),Y=b(R,y),X=Math.sqrt(U.error*U.error+z.error*z.error+J.error*J.error+Y.error*Y.error),ee=(U.averageSize+z.averageSize+J.averageSize+Y.averageSize)/4,$=(Math.pow(U.averageSize-ee,2)+Math.pow(z.averageSize-ee,2)+Math.pow(J.averageSize-ee,2)+Math.pow(Y.averageSize-ee,2))/ee;return X+$}catch{return 1/0}}function g(C,y){for(var F=Math.round(y.x);C.get(F,Math.round(y.y));)F--;for(var _=Math.round(y.x);C.get(_,Math.round(y.y));)_++;for(var B=(F+_)/2,P=Math.round(y.y);C.get(Math.round(B),P);)P--;for(var A=Math.round(y.y);C.get(Math.round(B),A);)A++;var S=(P+A)/2;return{x:B,y:S}}function x(C){for(var y=[],F=[],_=[],B=[],P=function(re){for(var ve=0,Ge=!1,Z=[0,0,0,0,0],ge=function(me){var _e=C.get(me,re);if(_e===Ge)ve++;else{Z=[Z[1],Z[2],Z[3],Z[4],ve],ve=1,Ge=_e;var we=d(Z)/7,Ne=Math.abs(Z[0]-we)<we&&Math.abs(Z[1]-we)<we&&Math.abs(Z[2]-3*we)<3*we&&Math.abs(Z[3]-we)<we&&Math.abs(Z[4]-we)<we&&!_e,rt=d(Z.slice(-3))/3,lt=Math.abs(Z[2]-rt)<rt&&Math.abs(Z[3]-rt)<rt&&Math.abs(Z[4]-rt)<rt&&_e;if(Ne){var Xe=me-Z[3]-Z[4],O=Xe-Z[2],pt={startX:O,endX:Xe,y:re},Ye=F.filter(function(it){return O>=it.bottom.startX&&O<=it.bottom.endX||Xe>=it.bottom.startX&&O<=it.bottom.endX||O<=it.bottom.startX&&Xe>=it.bottom.endX&&Z[2]/(it.bottom.endX-it.bottom.startX)<h&&Z[2]/(it.bottom.endX-it.bottom.startX)>l});Ye.length>0?Ye[0].bottom=pt:F.push({top:pt,bottom:pt})}if(lt){var Ke=me-Z[4],Ie=Ke-Z[3],pt={startX:Ie,y:re,endX:Ke},Ye=B.filter(function(N){return Ie>=N.bottom.startX&&Ie<=N.bottom.endX||Ke>=N.bottom.startX&&Ie<=N.bottom.endX||Ie<=N.bottom.startX&&Ke>=N.bottom.endX&&Z[2]/(N.bottom.endX-N.bottom.startX)<h&&Z[2]/(N.bottom.endX-N.bottom.startX)>l});Ye.length>0?Ye[0].bottom=pt:B.push({top:pt,bottom:pt})}}},ce=-1;ce<=C.width;ce++)ge(ce);y.push.apply(y,F.filter(function(me){return me.bottom.y!==re&&me.bottom.y-me.top.y>=2})),F=F.filter(function(me){return me.bottom.y===re}),_.push.apply(_,B.filter(function(me){return me.bottom.y!==re})),B=B.filter(function(me){return me.bottom.y===re})},A=0;A<=C.height;A++)P(A);y.push.apply(y,F.filter(function(re){return re.bottom.y-re.top.y>=2})),_.push.apply(_,B);var S=y.filter(function(re){return re.bottom.y-re.top.y>=2}).map(function(re){var ve=(re.top.startX+re.top.endX+re.bottom.startX+re.bottom.endX)/4,Ge=(re.top.y+re.bottom.y+1)/2;if(C.get(Math.round(ve),Math.round(Ge))){var Z=[re.top.endX-re.top.startX,re.bottom.endX-re.bottom.startX,re.bottom.y-re.top.y+1],ge=d(Z)/Z.length,ce=E({x:Math.round(ve),y:Math.round(Ge)},[1,1,3,1,1],C);return{score:ce,x:ve,y:Ge,size:ge}}}).filter(function(re){return!!re}).sort(function(re,ve){return re.score-ve.score}).map(function(re,ve,Ge){if(ve>r)return null;var Z=Ge.filter(function(ce,me){return ve!==me}).map(function(ce){return{x:ce.x,y:ce.y,score:ce.score+Math.pow(ce.size-re.size,2)/re.size,size:ce.size}}).sort(function(ce,me){return ce.score-me.score});if(Z.length<2)return null;var ge=re.score+Z[0].score+Z[1].score;return{points:[re].concat(Z.slice(0,2)),score:ge}}).filter(function(re){return!!re}).sort(function(re,ve){return re.score-ve.score});if(S.length===0)return null;var R=u(S[0].points[0],S[0].points[1],S[0].points[2]),U=R.topRight,z=R.topLeft,J=R.bottomLeft,Y=T(C,_,U,z,J),X=[];Y&&X.push({alignmentPattern:{x:Y.alignmentPattern.x,y:Y.alignmentPattern.y},bottomLeft:{x:J.x,y:J.y},dimension:Y.dimension,topLeft:{x:z.x,y:z.y},topRight:{x:U.x,y:U.y}});var ee=g(C,U),$=g(C,z),he=g(C,J),fe=T(C,_,ee,$,he);return fe&&X.push({alignmentPattern:{x:fe.alignmentPattern.x,y:fe.alignmentPattern.y},bottomLeft:{x:he.x,y:he.y},topLeft:{x:$.x,y:$.y},topRight:{x:ee.x,y:ee.y},dimension:fe.dimension}),X.length===0?null:X}i.locate=x;function T(C,y,F,_,B){var P,A,S;try{P=f(_,F,B,C),A=P.dimension,S=P.moduleSize}catch{return null}var R={x:F.x-_.x+B.x,y:F.y-_.y+B.y},U=(c(_,B)+c(_,F))/2/S,z=1-3/U,J={x:_.x+z*(R.x-_.x),y:_.y+z*(R.y-_.y)},Y=y.map(function(ee){var $=(ee.top.startX+ee.top.endX+ee.bottom.startX+ee.bottom.endX)/4,he=(ee.top.y+ee.bottom.y+1)/2;if(C.get(Math.floor($),Math.floor(he))){var fe=[ee.top.endX-ee.top.startX,ee.bottom.endX-ee.bottom.startX,ee.bottom.y-ee.top.y+1];d(fe)/fe.length;var re=E({x:Math.floor($),y:Math.floor(he)},[1,1,1],C),ve=re+c({x:$,y:he},J);return{x:$,y:he,score:ve}}}).filter(function(ee){return!!ee}).sort(function(ee,$){return ee.score-$.score}),X=U>=15&&Y.length?Y[0]:J;return{alignmentPattern:X,dimension:A}}})]).default})})(hr)),hr.exports}var B9=S9();const _9=C9(B9);var T9=cs('<div><video style="width: 100vw; height: 100vh; object-fit: cover;" autoplay></video> <canvas style="position: absolute; top:0; left:0; visibility: hidden;"></canvas> <canvas></canvas></div>',2);function F9(n,e){hs(e,!0);let t=Zi(e,"z_index",3,10),i=Zi(e,"enabled",3,!1),o=Zi(e,"qr_code",15),r=Zi(e,"updateStatus",3,null),l=Zi(e,"captureImage",15),h=Nt(void 0),c=Nt(void 0),d=Nt(void 0);const u=(g,x)=>{g.beginPath(),g.moveTo(x.topLeftCorner.x,x.topLeftCorner.y),g.lineTo(x.topRightCorner.x,x.topRightCorner.y),g.lineTo(x.bottomRightCorner.x,x.bottomRightCorner.y),g.lineTo(x.bottomLeftCorner.x,x.bottomLeftCorner.y),g.closePath(),g.lineWidth=4,g.strokeStyle="blue",g.stroke()},f=async()=>{const g={audio:!1,video:{facingMode:"environment"}};if(i())try{Se(h).srcObject=await navigator.mediaDevices.getUserMedia(g),Se(h).onloadeddata=()=>{Se(h).play();const x=Se(h).videoWidth,T=Se(h).videoHeight,C=Se(h).clientWidth,y=Se(h).clientHeight;Se(c).width=C,Se(c).height=y,Se(d).width=C,Se(d).height=y;const F=(x-T*C/y)/2,_=0,B=x-F*2,P=T,A=0,S=0,R=()=>{const U=Se(c).getContext("2d",{willReadFrequently:!0}),z=Se(d).getContext("2d");U.drawImage(Se(h),F,_,B,P,A,S,C,y);const J=U.getImageData(0,0,C,y),Y=_9(J.data,C,y);z.clearRect(0,0,C,y),Y&&Y.data!==""&&(u(z,Y.location),r()(`QR code found: ${Y.data}`),console.log(`QR code found: ${Y.data}`),o(Y.data)),i()&&requestAnimationFrame(R)};R()}}catch(x){console.error("Error accessing camera:",x),r()(`Camera Error: ${x.message}`)}else Se(h).srcObject&&(Se(h).srcObject.getTracks().forEach(T=>{T.stop()}),Se(h).srcObject=null)};l(()=>(Se(c).getContext("2d").drawImage(Se(h),0,0,Se(c).width,Se(c).height),Se(c).toDataURL("image/jpeg").split(",")[1])),cr(()=>{i(),f()}),ls(()=>{document.documentElement.requestFullscreen();try{screen.orientation.lock("portrait-primary")}catch(g){console.log(g)}});var m=T9(),p=oo(m);Qo(p,g=>Mt(h,g),()=>Se(h));var b=mn(p,2);Qo(b,g=>Mt(c,g),()=>Se(c));var E=mn(b,2);Qo(E,g=>Mt(d,g),()=>Se(d)),ro(m),nc(()=>{so(m,`width: 100vw; height: 100vh; background-color: #100C14; ${i()?"display: block":"display: none"}`),so(E,`position: absolute; top:0; left:0; z-index: ${t()??""};`)}),ds(n,m),us()}var D9=(n,e,t)=>{Mt(e,!Se(e)),Se(e)&&Mt(t,null)},M9=cs('<div style="height: 100vh; margin:0; padding:0;"><div class="controls svelte-1uha8ag"><button id="resetButton" aria-label="Reset Session" class="svelte-1uha8ag"><svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#ffffff"><path d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z"></path></svg></button> <button id="settingsButton" aria-label="Settings" class="svelte-1uha8ag">S</button> <button id="captureButton" aria-label="Capture Image" class="svelte-1uha8ag"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16"><path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"></path><path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"></path></svg></button> <button id="qrCodeReaderButton" aria-label="Start Reading QR Code" class="svelte-1uha8ag"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2z"></path></svg></button> <button id="startButton" aria-label="Start Recording" class="svelte-1uha8ag"><svg viewBox="0 0 100 100" width="36" height="36" fill="white" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"></circle></svg></button> <button id="stopButton" aria-label="Stop Recording" class="svelte-1uha8ag"><svg viewBox="0 0 100 100" width="36" height="36" fill="orange" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50"></circle></svg></button></div> <div id="status" class="svelte-1uha8ag"> </div> <div><!></div> <!></div>');function L9(n,e){hs(e,!0);const t={INPUT_SAMPLE_RATE:16e3,OUTPUT_SAMPLE_RATE:24e3,OUTPUT_CHANNEL_COUNT:1},i={model:"gemini-live-2.5-flash-preview",voice:"Leda",languageCode:"en-US",systemInstruction:"You are a guide for a museum"};let o=Nt(!1),r=Nt(!1),l=Nt(""),h=Nt(!1),c=Nt(null),d,u,f,m,p=Nt(void 0),b=Nt(void 0),E=0,g,x=Nt(null),T=null,C,y,F=new Set,_=Nt(void 0);ls(()=>{f=new(window.AudioContext||window.webkitAudioContext)({sampleRate:t.INPUT_SAMPLE_RATE}),m=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),Mt(p,f.createGain(),!0),Mt(b,m.createGain(),!0),B()});const B=async()=>{E=m.currentTime,d=new Av({apiKey:"AIzaSyAugytjnDjFQ10XjmH2Sy-UPOUARWPL9PM",httpOptions:{apiVersion:"v1alpha"}}),Se(b).connect(m.destination),P()},P=async()=>{try{u=await d.live.connect({model:i.model,callbacks:{onopen:()=>{A("Opened")},onmessage:async we=>{var lt,Xe,O,pt;const Ne=(O=(Xe=(lt=we.serverContent)==null?void 0:lt.modelTurn)==null?void 0:Xe.parts[0])==null?void 0:O.inlineData;if(Ne){E=Math.max(E,m.currentTime);const Ye=await Tv(Bv(Ne.data),m,t.OUTPUT_SAMPLE_RATE,t.OUTPUT_CHANNEL_COUNT),Ke=m.createBufferSource();Ke.buffer=Ye,Ke.connect(Se(b)),Ke.addEventListener("ended",()=>{F.delete(Ke)}),Ke.start(E),E=E+Ye.duration,F.add(Ke)}if((pt=we.serverContent)==null?void 0:pt.interrupted){for(const Ye of F.values())Ye.stop(),F.delete(Ye);E=0}},onerror:we=>{S(we.message)},onclose:we=>{A("Close:"+we.reason)}},config:{responseModalities:[co.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:i.voice}},languageCode:i.languageCode},systemInstruction:i.systemInstruction}})}catch(we){console.error(we)}},A=we=>{Mt(l,we,!0)},S=we=>{Mt(c,we?`Error: ${we}`:null,!0)},R=async()=>{if(!Se(o)){f.resume(),A("Requesting microphone access...");try{g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),A("Microphone access granted. Starting capture..."),C=f.createMediaStreamSource(g),C.connect(Se(p)),await f.audioWorklet.addModule("audio-processor.js"),y=new AudioWorkletNode(f,"audio-processor"),y.port.onmessage=we=>{if(!Se(o))return;const Ne=we.data;u.sendRealtimeInput({media:_v(Ne)})},C.connect(y),y.connect(f.destination),Mt(o,!0),A(" Capturing voice...")}catch(we){console.error("Error starting capturing voice:",we),A(`Error: ${we.message}`),U()}}},U=()=>{!Se(o)&&!g&&!f||(A("Stopping..."),Mt(o,!1),y&&C&&f&&(y.disconnect(),C.disconnect()),y=null,C=null,g&&(g.getTracks().forEach(we=>we.stop()),g=null),A("Stopped"))},z=()=>{u==null||u.close(),P(),A("Session cleared")},J=async we=>{const Ne=`In the showroom, the visitor is seeing a panel on the following script, explain the panel briefly: ${we}`;await(u==null?void 0:u.sendClientContent({turns:{role:"user",parts:[{text:Ne}]},turnComplete:!0}))},Y=async()=>{Mt(h,!0),setTimeout(()=>{Mt(h,!1)},500);const we=Se(_)();console.log(we),await(u==null?void 0:u.sendClientContent({turns:{role:"user",parts:[{inlineData:{mimeType:"image/jpeg",data:we}},{text:"Explain about the image in the center"}]},turnComplete:!0}))};cr(async()=>{Se(x)===null||T===Se(x)||Se(x)in ec&&(console.log(`Update context with this QR Code: ${Se(x)}`),await J(ec[Se(x)]),T=Se(x))});var X=M9(),ee=oo(X),$=oo(ee);$.__click=z;var he=mn($,2);he.__click=z;var fe=mn(he,2);fe.__click=Y;var re=mn(fe,2);re.__click=[D9,r,x];var ve=mn(re,2);ve.__click=R;var Ge=mn(ve,2);Ge.__click=U,ro(ee);var Z=mn(ee,2),ge=oo(Z,!0);ro(Z);var ce=mn(Z,2),me=oo(ce);v9(me,{get inputNode(){return Se(p)},get outputNode(){return Se(b)}}),ro(ce);var _e=mn(ce,2);F9(_e,{get enabled(){return Se(r)},updateStatus:A,z_index:10,get qr_code(){return Se(x)},set qr_code(we){Mt(x,we,!0)},get captureImage(){return Se(_)},set captureImage(we){Mt(_,we,!0)}}),ro(X),nc(()=>{$.disabled=Se(o),fe.disabled=!Se(r),so(fe,Se(h)?"color: orange":"color: white"),so(re,Se(r)?"color: orange":"color: white"),ve.disabled=Se(o),Ge.disabled=!Se(o),wd(ge,Se(c)||Se(l)),so(ce,`width: 100%; height: 100%; ${Se(r)?"display: none":"display: block"}`)}),ds(n,X),us()}vd(["click"]);export{L9 as component};
